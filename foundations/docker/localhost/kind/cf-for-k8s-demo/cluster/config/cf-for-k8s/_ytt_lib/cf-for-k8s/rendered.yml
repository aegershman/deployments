apiVersion: kapp.k14s.io/v1alpha1
kind: Config
metadata:
  name: kapp-version
minimumRequiredVersion: 0.29.0
---
apiVersion: kapp.k14s.io/v1alpha1
kind: Config
metadata:
  name: kapp-istio-gateway-rules
templateRules:
- resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: Secret
  affectedResources:
    objectReferences:
    - path:
      - spec
      - servers
      - allIndexes: true
      - tls
      resourceMatchers:
      - apiVersionKindMatcher:
          apiVersion: networking.istio.io/v1alpha3
          kind: Gateway
      nameKey: credentialName
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cf-api-server
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 2
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-server
  template:
    metadata:
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9102"
        prometheus.io/path: metrics
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app.kubernetes.io/name: cf-api-server
    spec:
      containers:
      - name: cf-api-server
        image: cloudfoundry/cloud-controller-ng@sha256:ed8c3fb25b43fcdd6ebd7b7d895e6b2f761785d9f5091edad1edae1b7d8cd52c
        command:
        - /cloud_controller_ng/bin/cloud_controller
        - -c
        - /config/cloud_controller_ng.yml
        - -s
        - /config/secrets.yml
        imagePullPolicy: Always
        resources: {}
        volumeMounts:
        - name: cloud-controller-ng-yaml
          mountPath: /config/cloud_controller_ng.yml
          subPath: cloud_controller_ng.yml
        - name: cloud-controller-ng-secrets-yaml
          mountPath: /config/secrets.yml
          subPath: secrets.yml
        - name: cf-api-db-password
          mountPath: /etc/cf-api/ccdb
        - name: cf-api-username-lookup-client-secret
          mountPath: /etc/cf-api/username-lookup-client-secret
        - name: cf-api-blobstore-secret-access-key
          mountPath: /etc/cf-api/blobstore/secret-access-key
        - name: server-sock
          mountPath: /data/cloud_controller_ng
        - name: uaa-certs
          mountPath: /config/uaa/certs
        - name: eirini-certs
          mountPath: /config/eirini/certs
        - name: metric-proxy-certs
          mountPath: /config/metric_proxy/certs
        - name: metric-proxy-ca
          mountPath: /config/metric_proxy/ca
      - name: cf-api-local-worker
        image: cloudfoundry/cloud-controller-ng@sha256:ed8c3fb25b43fcdd6ebd7b7d895e6b2f761785d9f5091edad1edae1b7d8cd52c
        imagePullPolicy: Always
        command:
        - /usr/local/bin/bundle
        args:
        - exec
        - rake
        - jobs:local
        env:
        - name: CLOUD_CONTROLLER_NG_CONFIG
          value: /config/cloud_controller_ng.yml
        - name: CLOUD_CONTROLLER_NG_SECRETS
          value: /config/secrets.yml
        resources: {}
        volumeMounts:
        - name: cloud-controller-ng-yaml
          mountPath: /config/cloud_controller_ng.yml
          subPath: cloud_controller_ng.yml
        - name: cloud-controller-ng-secrets-yaml
          mountPath: /config/secrets.yml
          subPath: secrets.yml
        - name: cf-api-db-password
          mountPath: /etc/cf-api/ccdb
        - name: cf-api-username-lookup-client-secret
          mountPath: /etc/cf-api/username-lookup-client-secret
        - name: cf-api-blobstore-secret-access-key
          mountPath: /etc/cf-api/blobstore/secret-access-key
        - name: nginx-uploads
          mountPath: /tmp/uploads
      - name: nginx
        image: cloudfoundry/capi-nginx@sha256:980f50e190cbff72d23300bc422da23faa888271c2d07ac3abaa65af55a5316a
        imagePullPolicy: Always
        ports:
        - containerPort: 80
        readinessProbe:
          httpGet:
            port: 80
            path: /healthz
        volumeMounts:
        - name: nginx
          mountPath: /etc/nginx
          readOnly: true
        - name: server-sock
          mountPath: /data/cloud_controller_ng
        - name: nginx-logs
          mountPath: /cloud_controller_ng
        - name: nginx-uploads
          mountPath: /tmp/uploads
      - name: statsd-exporter
        image: oratos/statsd_exporter:v0.15.0@sha256:10a64dc4ad0a3e3fe88372f0481dea5c02595c38d168617836a99a649d3ac407
        imagePullPolicy: Always
      serviceAccountName: cf-api-server-service-account
      volumes:
      - name: cloud-controller-ng-yaml
        configMap:
          name: cloud-controller-ng-yaml
      - name: cloud-controller-ng-secrets-yaml
        configMap:
          name: cloud-controller-ng-secrets-yaml
      - name: cf-api-db-password
        secret:
          secretName: capi-database-password
      - name: cf-api-username-lookup-client-secret
        secret:
          secretName: cloud-controller-username-lookup-client-secret
      - name: cf-api-blobstore-secret-access-key
        secret:
          secretName: capi-blobstore-secret-key
      - name: server-sock
        emptyDir: {}
      - name: nginx
        configMap:
          name: nginx
      - name: nginx-logs
        emptyDir: {}
      - name: uaa-certs
        secret:
          secretName: uaa-certs
      - name: eirini-certs
        secret:
          secretName: eirini-internal-tls-certs
      - name: metric-proxy-certs
        secret:
          secretName: metric-proxy-cert
      - name: metric-proxy-ca
        secret:
          secretName: metric-proxy-ca
      - name: nginx-uploads
        emptyDir: {}
---
apiVersion: batch/v1
kind: Job
metadata:
  name: ccdb-migrate
  namespace: cf-system
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  backoffLimit: 6
  template:
    spec:
      containers:
      - name: run-migrations
        image: cloudfoundry/cloud-controller-ng@sha256:ed8c3fb25b43fcdd6ebd7b7d895e6b2f761785d9f5091edad1edae1b7d8cd52c
        imagePullPolicy: Always
        command:
        - /bin/bash
        - -c
        args:
        - |
          bundle exec rake db:wait_for_istio && \
          bundle exec rake db:setup_database && \
          bundle exec rake db:terminate_istio
        env:
        - name: CLOUD_CONTROLLER_NG_CONFIG
          value: /config/cloud_controller_ng.yml
        - name: CLOUD_CONTROLLER_NG_SECRETS
          value: /config/secrets.yml
        volumeMounts:
        - name: cloud-controller-ng-yaml
          mountPath: /config/cloud_controller_ng.yml
          subPath: cloud_controller_ng.yml
        - name: cloud-controller-ng-secrets-yaml
          mountPath: /config/secrets.yml
          subPath: secrets.yml
        - name: cf-api-db-password
          mountPath: /etc/cf-api/ccdb
        - name: cf-api-username-lookup-client-secret
          mountPath: /etc/cf-api/username-lookup-client-secret
        - name: cf-api-blobstore-secret-access-key
          mountPath: /etc/cf-api/blobstore/secret-access-key
      restartPolicy: OnFailure
      volumes:
      - name: cloud-controller-ng-yaml
        configMap:
          name: cloud-controller-ng-yaml
      - name: cloud-controller-ng-secrets-yaml
        configMap:
          name: cloud-controller-ng-secrets-yaml
      - name: cf-api-db-password
        secret:
          secretName: capi-database-password
      - name: cf-api-username-lookup-client-secret
        secret:
          secretName: cloud-controller-username-lookup-client-secret
      - name: cf-api-blobstore-secret-access-key
        secret:
          secretName: capi-blobstore-secret-key
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cloud-controller-ng-yaml
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  cloud_controller_ng.yml: |
    local_route: 0.0.0.0
    external_port: 9022
    tls_port: 9023
    readiness_port:
      cloud_controller_worker: 4444
      deployment_updater: 4445
      clock: 4446
    fluent:
      host: fluentd-forwarder-ingress
      port: 24224
    internal_service_hostname: capi.cf-system.svc.cluster.local
    pid_filename: /cloud_controller_ng/cloud_controller_ng.pid
    newrelic_enabled: false
    development_mode: false
    external_protocol: https
    external_domain: api.vcap.me
    temporary_disable_deployments: false
    temporary_use_logcache: true
    system_domain_organization: system
    system_domain: vcap.me
    app_domains:
    - apps.vcap.me
    reserved_private_domains: /dev/null
    disable_private_domain_cross_space_context_path_route_sharing: false
    jobs:
      global:
        timeout_in_seconds: 14400
    default_app_memory: 1024
    default_app_disk_in_mb: 1024
    maximum_app_disk_in_mb: 2048
    instance_file_descriptor_limit: 16384
    request_timeout_in_seconds: 900
    bulk_api:
      auth_user: TODO
      auth_password: TODO
    internal_api:
      auth_user: TODO
      auth_password: TODO
    nginx:
      use_nginx: true
      instance_socket: /data/cloud_controller_ng/cloud_controller.sock
    index: 0
    name: ""
    route_services_enabled: true
    volume_services_enabled: true
    info:
      name: ""
      build: ""
      version: 0
      support_address: ""
      description: ""
      app_ssh_endpoint: TODO.TODO
      app_ssh_host_key_fingerprint: placeholder
      app_ssh_oauth_client: placeholder
      min_cli_version: ""
      min_recommended_cli_version: ""
    directories:
      tmpdir: /tmp/
      diagnostics: /cloud_controller_ng/diagnostics/
    logging:
      file: /dev/stdout
      syslog: vcap.cloud_controller_ng
      level: info
      max_retries: 1
    logcache:
      host: metric-proxy
      port: 8080
      temporary_ignore_server_unavailable_errors: true
    logcache_tls:
      ca_file: /config/metric_proxy/ca/tls.crt
      cert_file: /config/metric_proxy/certs/tls.crt
      key_file: /config/metric_proxy/certs/tls.key
      subject_name: metric-proxy
    log_stream:
      url: https://log-stream.vcap.me
    doppler:
      url: wss://doppler.vcap.me:443
    db:
      database:
        adapter: postgres
        host: cf-db-postgresql.cf-db.svc.cluster.local
        port: 5432
        user: cloud_controller
        database: cloud_controller
      max_connections: 25
      pool_timeout: 10
      log_level: debug2
      log_db_queries: false
      read_timeout: 3600
      connection_validation_timeout: 3600
      ssl_verify_hostname: false
    telemetry_log_path: /dev/null
    log_cache:
      url: https://log-cache.vcap.me
    threadpool_size: 20
    internal_route_vip_range: ""
    login:
      url: https://login.vcap.me
    uaa:
      url: https://uaa.vcap.me
      internal_url: http://uaa.cf-system.svc.cluster.local:8080
      resource_id: cloud_controller,cloud_controller_service_permissions
      client_timeout: 60
      ca_file: /config/uaa/certs/uaa.crt
    routing_api:
      url: https://api.vcap.me/routing
      routing_client_name: TODO
      routing_client_secret: TODO
    credential_references:
      interpolate_service_bindings: true
    staging:
      timeout_in_seconds: 900
      minimum_staging_memory_mb: 1024
      minimum_staging_disk_mb: 4096
      minimum_staging_file_descriptor_limit: 16384
      auth:
        user: TODO
        password: TODO
    default_health_check_timeout: 60
    maximum_health_check_timeout: 180
    runtimes_file: /dev/null
    stacks_file: /cloud_controller_ng/config/stacks.yml
    shared_isolation_segment_name: shared
    quota_definitions:
      default:
        memory_limit: 102400
        non_basic_services_allowed: true
        total_routes: 1000
        total_services: -1
        total_reserved_route_ports: 100
    default_quota_definition: default
    resource_pool:
      resource_directory_key: cc-resources
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      minimum_size: 65536
      maximum_size: 536870912
      cdn:
        uri: null
        key_pair_id: null
        private_key: ""
      fog_aws_storage_options: {}
    packages:
      app_package_directory_key: cc-packages
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      max_valid_packages_stored: 5
      max_package_size: 1073741824
      cdn:
        uri: null
        key_pair_id: null
        private_key: ""
      fog_aws_storage_options: {}
    droplets:
      droplet_directory_key: cc-droplets
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      cdn:
        uri: null
        key_pair_id: null
        private_key: ""
      fog_aws_storage_options: {}
      max_staged_droplets_stored: 5
    buildpacks:
      buildpack_directory_key: cc-buildpacks
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      cdn:
        uri: null
        key_pair_id: null
        private_key: ""
      fog_aws_storage_options: {}
    db_encryption_key: TODO
    database_encryption:
      keys:
        encryption_key_0: TODO
      current_key_label: encryption_key_0
      pbkdf2_hmac_iterations: 2048
    disable_custom_buildpacks: false
    broker_client_timeout_seconds: 60
    broker_client_default_async_poll_interval_seconds: 60
    broker_client_max_async_poll_duration_minutes: 10080
    renderer:
      max_results_per_page: 100
      default_results_per_page: 50
      max_inline_relations_depth: 2
    uaa_client_name: cc-service-dashboards
    uaa_client_secret: TODO
    uaa_client_scope: openid,cloud_controller_service_permissions.read
    cloud_controller_username_lookup_client_name: cloud_controller_username_lookup
    cc_service_key_client_name: cc_service_key_client
    cc_service_key_client_secret: TODO
    allow_app_ssh_access: true
    default_app_ssh_access: true
    skip_cert_verify: true
    install_buildpacks: []
    app_bits_upload_grace_period_in_seconds: 1200
    security_group_definitions:
    - name: public_networks
      rules:
      - destination: 0.0.0.0-9.255.255.255
        protocol: all
      - destination: 11.0.0.0-169.253.255.255
        protocol: all
      - destination: 169.255.0.0-172.15.255.255
        protocol: all
      - destination: 172.32.0.0-192.167.255.255
        protocol: all
      - destination: 192.169.0.0-255.255.255.255
        protocol: all
    - name: dns
      rules:
      - destination: 0.0.0.0/0
        ports: "53"
        protocol: tcp
      - destination: 0.0.0.0/0
        ports: "53"
        protocol: udp
    default_running_security_groups:
    - public_networks
    - dns
    default_staging_security_groups:
    - public_networks
    - dns
    allowed_cors_domains: []
    statsd_host: 127.0.0.1
    statsd_port: 9125
    security_event_logging:
      enabled: false
      file: /dev/null
    system_hostnames:
    - api
    - uaa
    - login
    - doppler
    - loggregator
    - hm9000
    - credhub
    bits_service:
      enabled: false
      public_endpoint: https://bits.vcap.me
      private_endpoint: https://TODO.TODO
      username: TODO
      password: TODO
      ca_cert_path: /dev/null
    rate_limiter:
      enabled: false
      general_limit: 2000
      unauthenticated_limit: 100
      reset_interval_in_minutes: 60
    diego:
      bbs:
        url: https://TODO.TODO
        key_file: /dev/null
        cert_file: /dev/null
        ca_file: /dev/null
        connect_timeout: 10
        send_timeout: 10
        receive_timeout: 10
      cc_uploader_url: https://TODO.TODO
      docker_staging_stack: cflinuxfs3
      file_server_url: https://TODO.TODO
      insecure_docker_registry_list: []
      lifecycle_bundles:
        buildpack/cflinuxfs3: buildpack_app_lifecycle/buildpack_app_lifecycle.tgz
        buildpack/windows: buildpack_app_lifecycle/buildpack_app_lifecycle.tgz
        buildpack/windows2012R2: windows_app_lifecycle/windows_app_lifecycle.tgz
        buildpack/windows2016: buildpack_app_lifecycle/buildpack_app_lifecycle.tgz
        docker: docker_app_lifecycle/docker_app_lifecycle.tgz
      droplet_destinations:
        cflinuxfs3: /home/vcap
        windows: /Users/vcap
        windows2012R2: /
        windows2016: /Users/vcap
      pid_limit: 1024
      temporary_oci_buildpack_mode: null
      enable_declarative_asset_downloads: false
      use_privileged_containers_for_running: false
      use_privileged_containers_for_staging: false
    opi:
      url: http://eirini.cf-system.svc.cluster.local:8080
      opi_staging: true
      enabled: true
      cc_uploader_url: https://TODO.TODO
    perm:
      enabled: false
    max_labels_per_resource: 50
    max_annotations_per_resource: 200
    custom_metric_tag_prefix_list:
    - metric.tag.cloudfoundry.org
    default_app_lifecycle: kpack
    kubernetes:
      host_url: https://kubernetes.default
      service_account:
        token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
      workloads_namespace: cf-workloads
      kpack:
        builder_namespace: cf-workloads-staging
        registry_service_account_name: cc-kpack-registry-service-account
        registry_tag_base: harbor.harbor.svc.cluster.local:80/library
    perform_blob_cleanup: true
    app_usage_events:
      cutoff_age_in_days: 31
    audit_events:
      cutoff_age_in_days: 31
    failed_jobs:
      cutoff_age_in_days: 31
    completed_tasks:
      cutoff_age_in_days: 31
    service_usage_events:
      cutoff_age_in_days: 31
    max_retained_deployments_per_app: 100
    max_retained_builds_per_app: 100
    max_retained_revisions_per_app: 100
    diego_sync:
      frequency_in_seconds: 15
    pending_builds:
      frequency_in_seconds: 300
      expiration_in_seconds: 42
    pending_droplets:
      frequency_in_seconds: 300
      expiration_in_seconds: 42
    deployment_updater:
      update_frequency_in_seconds: 1
---
apiVersion: v1
kind: Namespace
metadata:
  name: cf-workloads-staging
  labels:
    istio-injection: enabled
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cf-api-clock
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-clock
  template:
    metadata:
      labels:
        app.kubernetes.io/name: cf-api-clock
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - name: cf-api-clock
        image: cloudfoundry/cloud-controller-ng@sha256:ed8c3fb25b43fcdd6ebd7b7d895e6b2f761785d9f5091edad1edae1b7d8cd52c
        imagePullPolicy: Always
        workingDir: /cloud_controller_ng
        command:
        - /usr/local/bin/bundle
        args:
        - exec
        - rake
        - clock:start
        env:
        - name: CLOUD_CONTROLLER_NG_CONFIG
          value: /config/cloud_controller_ng.yml
        - name: CLOUD_CONTROLLER_NG_SECRETS
          value: /config/secrets.yml
        resources: {}
        readinessProbe:
          tcpSocket:
            port: 4446
          periodSeconds: 3
        volumeMounts:
        - name: cloud-controller-ng-yaml
          mountPath: /config/cloud_controller_ng.yml
          subPath: cloud_controller_ng.yml
        - name: cloud-controller-ng-secrets-yaml
          mountPath: /config/secrets.yml
          subPath: secrets.yml
        - name: cf-api-db-password
          mountPath: /etc/cf-api/ccdb
        - name: cf-api-username-lookup-client-secret
          mountPath: /etc/cf-api/username-lookup-client-secret
        - name: cf-api-blobstore-secret-access-key
          mountPath: /etc/cf-api/blobstore/secret-access-key
        - name: eirini-certs
          mountPath: /config/eirini/certs
      volumes:
      - name: cloud-controller-ng-yaml
        configMap:
          name: cloud-controller-ng-yaml
      - name: cloud-controller-ng-secrets-yaml
        configMap:
          name: cloud-controller-ng-secrets-yaml
      - name: cf-api-db-password
        secret:
          secretName: capi-database-password
      - name: cf-api-username-lookup-client-secret
        secret:
          secretName: cloud-controller-username-lookup-client-secret
      - name: cf-api-blobstore-secret-access-key
        secret:
          secretName: capi-blobstore-secret-key
      - name: eirini-certs
        secret:
          secretName: eirini-internal-tls-certs
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cf-api-controllers
  namespace: cf-system
  labels:
    app.kubernetes.io/name: cf-api-controllers
    app.kubernetes.io/instance: cf-api-controllers-0
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-controllers
  template:
    metadata:
      labels:
        app.kubernetes.io/name: cf-api-controllers
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      serviceAccountName: cf-api-controllers-service-account
      containers:
      - name: manager
        image: cloudfoundry/capi-kpack-watcher@sha256:a3e7e356e8c6395f8c79de36624c72844dff1b5d71e8da8d89a9c4bff4fe6ed2
        env:
        - name: UAA_CLIENT_SECRET
          value: ""
        - name: UAA_ENDPOINT
          value: http://uaa.cf-system.svc.cluster.local:8080
        - name: UAA_CLIENT_NAME
          value: cf_api_controllers
        - name: CF_API_HOST
          value: http://capi.cf-system.svc.cluster.local
        - name: STAGING_NAMESPACE
          value: cf-workloads-staging
        - name: WORKLOADS_NAMESPACE
          value: cf-workloads
        resources: {}
      terminationGracePeriodSeconds: 10
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf-api-controllers
rules:
- apiGroups:
  - build.pivotal.io
  resources:
  - images
  - builds
  - builds/status
  - images/status
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: controllers-binding
subjects:
- kind: ServiceAccount
  namespace: cf-system
  name: cf-api-controllers-service-account
roleRef:
  kind: ClusterRole
  name: cf-api-controllers
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cf-api-deployment-updater
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-deployment-updater
  template:
    metadata:
      labels:
        app.kubernetes.io/name: cf-api-deployment-updater
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - name: cf-api-deployment-updater
        image: cloudfoundry/cloud-controller-ng@sha256:ed8c3fb25b43fcdd6ebd7b7d895e6b2f761785d9f5091edad1edae1b7d8cd52c
        imagePullPolicy: Always
        workingDir: /cloud_controller_ng
        command:
        - /usr/local/bin/bundle
        args:
        - exec
        - rake
        - deployment_updater:start
        env:
        - name: CLOUD_CONTROLLER_NG_CONFIG
          value: /config/cloud_controller_ng.yml
        - name: CLOUD_CONTROLLER_NG_SECRETS
          value: /config/secrets.yml
        resources: {}
        readinessProbe:
          tcpSocket:
            port: 4445
          periodSeconds: 3
        volumeMounts:
        - name: cloud-controller-ng-yaml
          mountPath: /config/cloud_controller_ng.yml
          subPath: cloud_controller_ng.yml
        - name: cloud-controller-ng-secrets-yaml
          mountPath: /config/secrets.yml
          subPath: secrets.yml
        - name: cf-api-db-password
          mountPath: /etc/cf-api/ccdb
        - name: cf-api-username-lookup-client-secret
          mountPath: /etc/cf-api/username-lookup-client-secret
        - name: cf-api-blobstore-secret-access-key
          mountPath: /etc/cf-api/blobstore/secret-access-key
        - name: eirini-certs
          mountPath: /config/eirini/certs
      volumes:
      - name: cloud-controller-ng-yaml
        configMap:
          name: cloud-controller-ng-yaml
      - name: cloud-controller-ng-secrets-yaml
        configMap:
          name: cloud-controller-ng-secrets-yaml
      - name: cf-api-db-password
        secret:
          secretName: capi-database-password
      - name: cf-api-username-lookup-client-secret
        secret:
          secretName: cloud-controller-username-lookup-client-secret
      - name: cf-api-blobstore-secret-access-key
        secret:
          secretName: capi-blobstore-secret-key
      - name: eirini-certs
        secret:
          secretName: eirini-internal-tls-certs
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  nginx.conf: |
    error_log stderr info;

    worker_processes auto;

    events {}

    http {
      server_tokens off;

      access_log  /cloud_controller_ng/nginx-access.log;

      tcp_nopush           on;
      tcp_nodelay          on;  #disable nagel's algorithm

      upstream cloud_controller {
        server unix:/data/cloud_controller_ng/cloud_controller.sock;
      }

      server {
          # TODO: get TLS working
          # include nginx_server_mtls.conf;

          listen 80;

          # TODO: move to a separate file and `include` like capi-release?
          # proxy and log all CC traffic
          location / {
            access_log  /cloud_controller_ng/nginx-access.log;
            proxy_buffering             off;
            proxy_set_header            Host $host;
            proxy_set_header            X-Real_IP $remote_addr;
            proxy_set_header            X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_redirect              off;
            proxy_connect_timeout       10;
            proxy_pass                  http://cloud_controller;
          }

          location @cc_uploads {
            proxy_pass http://cloud_controller;
          }

          location ~ /v3/packages/.*/upload {
            if ($arg_bits_path) { return 422; }

            include public_upload.conf;
            upload_pass_form_field "^resources$";
          }

          location ~ /v2/apps/[^/]+/bits {
            if ($arg_application_path) { return 422; }

            include public_upload.conf;

            upload_pass_args on;
            upload_pass_form_field "^resources$";
          }
      }
    }
  public_upload.conf: |
    # Pass altered request body to this location
    upload_pass   @cc_uploads;

    # Allow large uploads
    client_max_body_size 1536M;

    # Store files to this directory
    upload_store /tmp/uploads;

    # No limit for output body forwarded to CC
    upload_max_output_body_len 0;

    # Allow uploaded files to be read only by user
    upload_store_access user:r;

    # Set specified fields in request body
    upload_set_form_field "${upload_field_name}_name" $upload_file_name;
    upload_set_form_field "${upload_field_name}_path" $upload_tmp_path;

    #forward the following fields from existing body
    upload_pass_form_field "_method";

    #on any error, delete uploaded files.
    upload_cleanup 400-505;
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cloud-controller-ng-secrets-yaml
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  secrets.yml: |
    cloud_controller_username_lookup_client_secret: /etc/cf-api/username-lookup-client-secret/password
    db:
      database:
        password: /etc/cf-api/ccdb/password
    resource_pool:
      fog_connection:
        aws_secret_access_key: /etc/cf-api/blobstore/secret-access-key/password
    packages:
      fog_connection:
        aws_secret_access_key: /etc/cf-api/blobstore/secret-access-key/password
    droplets:
      fog_connection:
        aws_secret_access_key: /etc/cf-api/blobstore/secret-access-key/password
    buildpacks:
      fog_connection:
        aws_secret_access_key: /etc/cf-api/blobstore/secret-access-key/password
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-api-server-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:routes-admin
rules:
- apiGroups:
  - networking.cloudfoundry.org
  resources:
  - routes
  verbs:
  - create
  - get
  - update
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:kpack-builds-admin
rules:
- apiGroups:
  - build.pivotal.io
  resources:
  - images
  verbs:
  - create
  - get
  - update
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:kpack-custombuilder-admin
rules:
- apiGroups:
  - experimental.kpack.pivotal.io
  resources:
  - custombuilders
  - custombuilders/status
  verbs:
  - get
  - create
  - update
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-server-service-account-cf-routes-admin
  namespace: cf-workloads
subjects:
- kind: ServiceAccount
  name: cf-api-server-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:routes-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-server-service-account-kpack-builds-admin
  namespace: cf-workloads-staging
subjects:
- kind: ServiceAccount
  name: cf-api-server-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:kpack-builds-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-server-service-account-kpack-custombuilder-admin
  namespace: cf-workloads-staging
subjects:
- kind: ServiceAccount
  name: cf-api-server-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:kpack-custombuilder-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-api-worker-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-worker-service-account-cf-routes-admin
  namespace: cf-workloads
subjects:
- kind: ServiceAccount
  name: cf-api-worker-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:routes-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-worker-service-account-kpack-builds-admin
  namespace: cf-workloads-staging
subjects:
- kind: ServiceAccount
  name: cf-api-worker-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:kpack-builds-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-worker-service-account-kpack-custombuilder-admin
  namespace: cf-workloads-staging
subjects:
- kind: ServiceAccount
  name: cf-api-worker-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:kpack-custombuilder-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-api-controllers-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:kpack-builds-informer
rules:
- apiGroups:
  - build.pivotal.io
  resources:
  - builds
  verbs:
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:service-accounts-secrets-fetcher
rules:
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  - secrets
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:statefulsets-updater
rules:
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - list
  - update
  - patch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-controllers-service-account-kpack-builds-reader
  namespace: cf-workloads-staging
subjects:
- kind: ServiceAccount
  name: cf-api-controllers-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:kpack-builds-informer
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-controllers-service-account-service-accounts-secrets-fetcher
  namespace: cf-workloads-staging
subjects:
- kind: ServiceAccount
  name: cf-api-controllers-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:service-accounts-secrets-fetcher
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-controllers-service-account-statefulsets-updater
  namespace: cf-workloads
subjects:
- kind: ServiceAccount
  name: cf-api-controllers-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:statefulsets-updater
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: Secret
metadata:
  name: cc-kpack-registry-auth-secret
  namespace: cf-workloads-staging
  annotations:
    kapp.k14s.io/versioned: ""
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwOi8vaGFyYm9yLmhhcmJvci5zdmMuY2x1c3Rlci5sb2NhbDo4MCI6eyJhdXRoIjoiWVdSdGFXNDZZV1J0YVc0PSIsInBhc3N3b3JkIjoiYWRtaW4iLCJ1c2VybmFtZSI6ImFkbWluIn19fQ==
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cc-kpack-registry-service-account
  namespace: cf-workloads-staging
secrets:
- name: cc-kpack-registry-auth-secret
imagePullSecrets:
- name: cc-kpack-registry-auth-secret
---
apiVersion: v1
kind: Service
metadata:
  name: capi
  namespace: cf-system
spec:
  type: ClusterIP
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
    name: http
  selector:
    app.kubernetes.io/name: cf-api-server
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cf-api-worker
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-worker
  template:
    metadata:
      labels:
        app.kubernetes.io/name: cf-api-worker
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - name: cf-api-worker
        image: cloudfoundry/cloud-controller-ng@sha256:ed8c3fb25b43fcdd6ebd7b7d895e6b2f761785d9f5091edad1edae1b7d8cd52c
        imagePullPolicy: Always
        workingDir: /cloud_controller_ng
        command:
        - /usr/local/bin/bundle
        args:
        - exec
        - rake
        - jobs:generic
        env:
        - name: CLOUD_CONTROLLER_NG_CONFIG
          value: /config/cloud_controller_ng.yml
        - name: CLOUD_CONTROLLER_NG_SECRETS
          value: /config/secrets.yml
        resources: {}
        readinessProbe:
          tcpSocket:
            port: 4444
          periodSeconds: 3
        volumeMounts:
        - name: cloud-controller-ng-yaml
          mountPath: /config/cloud_controller_ng.yml
          subPath: cloud_controller_ng.yml
        - name: cloud-controller-ng-secrets-yaml
          mountPath: /config/secrets.yml
          subPath: secrets.yml
        - name: cf-api-db-password
          mountPath: /etc/cf-api/ccdb
        - name: cf-api-username-lookup-client-secret
          mountPath: /etc/cf-api/username-lookup-client-secret
        - name: cf-api-blobstore-secret-access-key
          mountPath: /etc/cf-api/blobstore/secret-access-key
        - name: eirini-certs
          mountPath: /config/eirini/certs
      serviceAccountName: cf-api-worker-service-account
      volumes:
      - name: cloud-controller-ng-yaml
        configMap:
          name: cloud-controller-ng-yaml
      - name: cloud-controller-ng-secrets-yaml
        configMap:
          name: cloud-controller-ng-secrets-yaml
      - name: cf-api-db-password
        secret:
          secretName: capi-database-password
      - name: cf-api-username-lookup-client-secret
        secret:
          secretName: cloud-controller-username-lookup-client-secret
      - name: cf-api-blobstore-secret-access-key
        secret:
          secretName: capi-blobstore-secret-key
      - name: eirini-certs
        secret:
          secretName: eirini-internal-tls-certs
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: cf-api-external-virtual-service
  namespace: cf-system
spec:
  hosts:
  - api.vcap.me
  gateways:
  - cf-system/istio-ingressgateway
  http:
  - route:
    - destination:
        host: capi.cf-system.svc.cluster.local
        port:
          number: 80
---
apiVersion: v1
kind: Secret
metadata:
  name: capi-database-password
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  password: 1p9vj9oezx9nzng4qq4t
---
apiVersion: v1
kind: Secret
metadata:
  name: capi-blobstore-secret-key
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  password: euuh827v61z71x1afb3o
---
apiVersion: v1
kind: Secret
metadata:
  name: cf-api-controllers-client-secret
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  password: ""
---
apiVersion: v1
kind: Secret
metadata:
  name: cloud-controller-username-lookup-client-secret
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  password: ""
---
apiVersion: v1
kind: Secret
metadata:
  name: capi-database-encryption-key-secret
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  password: ""
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-app-ingress
  namespace: cf-workloads
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: cf-system
      podSelector:
        matchLabels:
          app.kubernetes.io/component: router
    - namespaceSelector:
        matchLabels:
          name: cf-system
      podSelector:
        matchLabels:
          app.kubernetes.io/component: adapter
  podSelector: {}
  policyTypes:
  - Ingress
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default,runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: cf-workloads-app-psp
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: RunAsAny
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: eirini-controller
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: MustRunAsNonRoot
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
  - secret
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: eirini
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: MustRunAsNonRoot
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
  - emptyDir
  - projected
  - secret
  - downwardAPI
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: eirini-events
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: RunAsAny
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
  - secret
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default,runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: cf-workloads-staging-psp
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: RunAsAny
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
  - emptyDir
  - projected
  - secret
  - downwardAPI
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: eirini-task-reporter
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: MustRunAsNonRoot
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
  - secret
  - projected
---
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  name: eirini
  namespace: cf-workloads
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: eirini-controller
  namespace: cf-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: eirini-events
  namespace: cf-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: opi
  namespace: cf-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: eirini-staging
  namespace: cf-workloads
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: eirini-task-reporter
  namespace: cf-system
---
apiVersion: v1
data:
  eirini-controller.yml: |
    app_namespace: cf-workloads
    eirini_uri: "https://eirini-opi.cf-system.svc.cluster.local:8085"
    eirini_cert_path: "/etc/eirini/secrets/eirini-client.crt"
    eirini_key_path: "/etc/eirini/secrets/eirini-client.key"
    ca_path: "/etc/eirini/secrets/eirini-client.ca"
  events.yml: |
    app_namespace: cf-workloads
    cc_internal_api: http://capi.cf-system.svc.cluster.local:80
    cc_tls_disabled: false
    cc_cert_path: /etc/eirini/secrets/cc.crt
    cc_key_path: /etc/eirini/secrets/cc.key
    cc_ca_path: /etc/eirini/secrets/cc.ca
  metrics.yml: |
    app_namespace: cf-workloads
    loggregator_address: "doppler-doppler.cf-system.svc.cluster.local:8082"
    loggregator_cert_path: "/etc/eirini/secrets/doppler.crt"
    loggregator_key_path: "/etc/eirini/secrets/doppler.key"
    loggregator_ca_path: "/etc/eirini/secrets/doppler.ca"
  opi.yml: |
    opi:
      app_namespace: cf-workloads
      registry_address: registry.not-used:443
      registry_secret_name: app-registry-credentials
      eirini_address: https://eirini-opi.cf-system.svc.cluster.local:8085
      downloader_image: eirini/recipe-downloader@sha256:29ad8eb7ea8d19723d6a3129f6bc3a3db2dc65e12bf0ec3a9df7a21110cf01c6
      executor_image: eirini/recipe-executor@sha256:792cd50172fad8beae01a09aef27cf66356949d43c04b3a2c84d723a7f24e862
      uploader_image: eirini/recipe-uploader@sha256:8869f8be894654726b8206062ebcc90bbbb7ad1daac2ac5bffa2e587f95fbcd6
      cc_uploader_secret_name: secrets-2.16.4-2
      cc_uploader_cert_path: cc-server-crt
      cc_uploader_key_path: cc-server-crt-key
      client_certs_secret_name: secrets-2.16.4-2
      client_cert_path: eirini-client-crt
      client_key_path: eirini-client-crt-key
      ca_cert_secret_name: secrets-2.16.4-2
      ca_cert_path: internal-ca-cert
      cc_tls_disabled: false
      cc_cert_path: /workspace/jobs/opi/secrets/cc.crt
      cc_key_path: /workspace/jobs/opi/secrets/cc.key
      cc_ca_path: /workspace/jobs/opi/secrets/cc.ca
      rootfs_version: v75.0.0
      client_ca_path: /workspace/jobs/opi/secrets/eirini.ca
      server_cert_path: /workspace/jobs/opi/secrets/eirini-server.crt
      server_key_path: /workspace/jobs/opi/secrets/eirini-server.key
      disk_limit_mb: 2048
      application_service_account: eirini
      staging_service_account: eirini-staging
      allow_run_image_as_root: false
      unsafe_allow_automount_service_account_token: false
      serve_plaintext: true
      plaintext_port: 8080
  routing.yml: |
    app_namespace: cf-workloads
    nats_ip: "nats-nats.cf-system.svc.cluster.local"
    nats_port: 4222
  staging-reporter.yml: |
    app_namespace: cf-workloads
    eirini_cert_path: "/etc/eirini/secrets/eirini-client.crt"
    eirini_key_path: "/etc/eirini/secrets/eirini-client.key"
    ca_path: "/etc/eirini/secrets/eirini-client.ca"
  task-reporter.yml: |
    app_namespace: cf-workloads
    cc_tls_disabled: false
    cc_cert_path: "/etc/eirini/secrets/cc.crt"
    cc_cert_path: "/etc/eirini/secrets/cc.crt"
    cc_key_path: "/etc/eirini/secrets/cc.key"
    ca_path: "/etc/eirini/secrets/cc.ca"
kind: ConfigMap
metadata:
  name: eirini
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: lrps.eirini.cloudfoundry.org
spec:
  group: eirini.cloudfoundry.org
  names:
    kind: LRP
    plural: lrps
    shortNames:
    - lrp
    singular: lrp
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            properties:
              GUID:
                type: string
              appGUID:
                type: string
              appName:
                type: string
              appRoutes:
                items:
                  properties:
                    hostname:
                      type: string
                    port:
                      format: in32
                      type: integer
                  type: object
                type: array
              command:
                items:
                  type: string
                type: array
              cpuWeight:
                format: uint8
                type: integer
              diskMB:
                format: int64
                type: integer
              env:
                additionalProperties:
                  type: string
                type: object
              health:
                properties:
                  endpoint:
                    type: string
                  port:
                    format: int32
                    type: integer
                  timeoutMs:
                    format: uint8
                    type: integer
                  type:
                    type: string
                type: object
              image:
                type: string
              instances:
                type: integer
              lastUpdated:
                type: string
              memoryMB:
                format: int64
                type: integer
              orgGUID:
                type: string
              orgName:
                type: string
              ports:
                items:
                  format: int32
                  type: integer
                type: array
              privateRegistry:
                properties:
                  password:
                    type: string
                  server:
                    type: string
                  username:
                    type: string
                type: object
              processType:
                type: string
              runsAsRoot:
                type: boolean
              spaceGUID:
                type: string
              spaceName:
                type: string
              userDefinedAnnotations:
                additionalProperties:
                  type: string
                type: object
              version:
                type: string
              volumeMounts:
                items:
                  properties:
                    claimName:
                      type: string
                    mountPath:
                      type: string
                  type: object
                type: array
            type: object
          status:
            properties:
              instances:
                items:
                  properties:
                    crashCount:
                      format: uint64
                      type: integer
                    crashTimestamp:
                      format: uint64
                      type: integer
                    exitReason:
                      type: string
                    exitStatus:
                      format: uint32
                      type: integer
                    index:
                      format: uint32
                      type: integer
                    since:
                      format: uint64
                      type: integer
                    state:
                      default: Pending
                      enum:
                      - Pending
                      - Running
                      - Failed
                      type: string
                  type: object
                type: array
              replicas:
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: tasks.eirini.cloudfoundry.org
spec:
  group: eirini.cloudfoundry.org
  names:
    kind: Task
    plural: tasks
    shortNames:
    - t
    singular: task
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            properties:
              appGuid:
                type: string
              appName:
                type: string
              command:
                items:
                  type: string
                type: array
              completionCallback:
                type: string
              cpuWeight:
                format: uint8
                type: integer
              diskMB:
                format: int64
                type: integer
              env:
                additionalProperties:
                  type: string
                type: object
              guid:
                type: string
              image:
                type: string
              memoryMB:
                format: int64
                type: integer
              name:
                type: string
              orgGuid:
                type: string
              orgName:
                type: string
              privateRegistry:
                properties:
                  password:
                    type: string
                  server:
                    type: string
                  username:
                    type: string
                type: object
              spaceGuid:
                type: string
              spaceName:
                type: string
            required:
            - guid
            - image
            - command
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: eirini-controller-cluster-role
rules:
- apiGroups:
  - eirini.cloudfoundry.org
  resources:
  - lrps
  - tasks
  verbs:
  - watch
  - list
  - get
- apiGroups:
  - eirini.cloudfoundry.org
  resources:
  - lrps/status
  verbs:
  - update
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - create
  - update
  - get
  - watch
  - list
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - list
  - create
  - update
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - create
  - update
  - get
  - watch
  - list
- apiGroups:
  - policy
  resources:
  - poddisruptionbudgets
  verbs:
  - create
  - delete
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: eirini-cluster-role
rules:
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - create
  - delete
  - list
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - create
  - update
  - delete
  - list
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - list
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - list
  - delete
- apiGroups:
  - policy
  resources:
  - poddisruptionbudgets
  verbs:
  - create
  - delete
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: eirini-task-reporter
rules:
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - delete
  - list
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - watch
  - list
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - delete
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: eirini-controller-cluster-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: eirini-controller-cluster-role
subjects:
- kind: ServiceAccount
  name: eirini-controller
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: eirini-cluster-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: eirini-cluster-role
subjects:
- kind: ServiceAccount
  name: opi
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
  name: eirini-events
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: eirini-nodes-policy
subjects:
- kind: ServiceAccount
  name: eirini-events
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: eirini-task-reporter
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: eirini-task-reporter
subjects:
- kind: ServiceAccount
  name: eirini-task-reporter
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: cf-workloads-app-role
  namespace: cf-workloads
rules:
- apiGroups:
  - policy
  resourceNames:
  - cf-workloads-app-psp
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-controller-role
  namespace: cf-system
rules:
- apiGroups:
  - policy
  resourceNames:
  - eirini-controller
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-role
  namespace: cf-system
rules:
- apiGroups:
  - policy
  resourceNames:
  - eirini
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-events
  namespace: cf-workloads
rules:
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - list
- apiGroups:
  - events.k8s.io
  resources:
  - pods
  verbs:
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-events-psp
  namespace: cf-system
rules:
- apiGroups:
  - policy
  resourceNames:
  - eirini-events
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: cf-workloads-staging-role
  namespace: cf-workloads
rules:
- apiGroups:
  - policy
  resourceNames:
  - cf-workloads-staging-psp
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-task-reporter-psp
  namespace: cf-system
rules:
- apiGroups:
  - policy
  resourceNames:
  - eirini-task-reporter
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-workloads-app-rolebinding
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: cf-workloads-app-role
subjects:
- kind: ServiceAccount
  name: eirini
  namespace: cf-workloads
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-controller-rolebinding
  namespace: cf-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-controller-role
subjects:
- kind: ServiceAccount
  name: eirini-controller
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-rolebinding
  namespace: cf-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-role
subjects:
- kind: ServiceAccount
  name: opi
  namespace: cf-system
- kind: ServiceAccount
  name: eirini-rootfs-patcher
  namespace: cf-system
- kind: ServiceAccount
  name: eirini-secret-smuggler
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-events
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-events
subjects:
- kind: ServiceAccount
  name: eirini-events
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-events-psp
  namespace: cf-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-events-psp
subjects:
- kind: ServiceAccount
  name: eirini-events
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-workloads-staging-rolebinding
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: cf-workloads-staging-role
subjects:
- kind: ServiceAccount
  name: eirini-staging
  namespace: cf-workloads
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-task-reporter-psp
  namespace: cf-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-task-reporter-psp
subjects:
- kind: ServiceAccount
  name: eirini-task-reporter
  namespace: cf-system
---
apiVersion: v1
kind: Service
metadata:
  name: eirini
  namespace: cf-system
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
  selector:
    name: eirini
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas: null
        URL: index.docker.io/eirini/opi@sha256:c7c60d73c89db5c1a74019b86db0fb93686ed5572984411f1d4a027681aec457
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
  name: eirini
  namespace: cf-system
spec:
  selector:
    matchLabels:
      name: eirini
  template:
    metadata:
      labels:
        eirinifs_version: v75.0.0
        name: eirini
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - image: index.docker.io/eirini/opi@sha256:c7c60d73c89db5c1a74019b86db0fb93686ed5572984411f1d4a027681aec457
        imagePullPolicy: Always
        name: opi
        ports:
        - name: http
          containerPort: 8080
        resources: {}
        volumeMounts:
        - mountPath: /workspace/jobs/opi/config
          name: config-map-volume
        - mountPath: /workspace/jobs/opi/secrets
          name: cf-secrets
      dnsPolicy: ClusterFirst
      securityContext:
        runAsNonRoot: true
      serviceAccountName: opi
      volumes:
      - configMap:
          items:
          - key: opi.yml
            path: opi.yml
          name: eirini
        name: config-map-volume
      - name: cf-secrets
        projected:
          sources:
          - secret:
              items:
              - key: tls.crt
                path: cc.crt
              - key: tls.key
                path: cc.key
              name: eirini-internal-tls-certs
          - secret:
              items:
              - key: tls.ca
                path: cc.ca
              name: eirini-internal-tls-certs
          - secret:
              items:
              - key: tls.crt
                path: eirini-server.crt
              - key: tls.key
                path: eirini-server.key
              name: eirini-internal-tls-certs
          - secret:
              items:
              - key: tls.ca
                path: eirini.ca
              name: eirini-internal-tls-certs
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas: null
        URL: index.docker.io/eirini/eirini-controller@sha256:142c4f335d8a117300eac610accd7183a0bfa5c793594deee5487b9af95f3a33
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
  name: eirini-controller
  namespace: cf-system
spec:
  selector:
    matchLabels:
      name: eirini-controller
  template:
    metadata:
      labels:
        name: eirini-controller
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - image: index.docker.io/eirini/eirini-controller@sha256:142c4f335d8a117300eac610accd7183a0bfa5c793594deee5487b9af95f3a33
        imagePullPolicy: Always
        name: eirini-controller
        resources: {}
        volumeMounts:
        - mountPath: /etc/eirini/config
          name: config-map-volume
        - mountPath: /etc/eirini/secrets
          name: cf-secrets
      dnsPolicy: ClusterFirst
      securityContext:
        runAsNonRoot: true
      serviceAccountName: eirini-controller
      volumes:
      - configMap:
          items:
          - key: eirini-controller.yml
            path: eirini-controller.yml
          name: eirini
        name: config-map-volume
      - name: cf-secrets
        secret:
          items:
          - key: tls.crt
            path: eirini-client.crt
          - key: tls.key
            path: eirini-client.key
          - key: tls.ca
            path: eirini-client.ca
          secretName: eirini-internal-tls-certs
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas: null
        URL: index.docker.io/eirini/event-reporter@sha256:62a30205593b22dfb954dfe803c0e01866e4ac08717ec3089c4c32aec2f00457
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
  name: eirini-events
  namespace: cf-system
spec:
  selector:
    matchLabels:
      name: eirini-events
  template:
    metadata:
      labels:
        name: eirini-events
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - image: index.docker.io/eirini/event-reporter@sha256:62a30205593b22dfb954dfe803c0e01866e4ac08717ec3089c4c32aec2f00457
        imagePullPolicy: Always
        name: event-reporter
        resources: {}
        volumeMounts:
        - mountPath: /etc/eirini/config
          name: config-map-volume
        - mountPath: /etc/eirini/secrets
          name: cf-secrets
      dnsPolicy: ClusterFirst
      securityContext:
        runAsNonRoot: true
      serviceAccountName: eirini-events
      volumes:
      - configMap:
          items:
          - key: events.yml
            path: events.yml
          name: eirini
        name: config-map-volume
      - name: cf-secrets
        projected:
          sources:
          - secret:
              items:
              - key: tls.crt
                path: cc.crt
              - key: tls.key
                path: cc.key
              name: eirini-internal-tls-certs
          - secret:
              items:
              - key: tls.ca
                path: cc.ca
              name: eirini-internal-tls-certs
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas: null
        URL: index.docker.io/eirini/task-reporter@sha256:23e081f0875c40f59526aa2f3bc77cd25c26776d840b2e6e49c4b0f2cbf5a04a
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
  name: eirini-task-reporter
  namespace: cf-system
spec:
  selector:
    matchLabels:
      name: eirini-task-reporter
  template:
    metadata:
      labels:
        name: eirini-task-reporter
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - image: index.docker.io/eirini/task-reporter@sha256:23e081f0875c40f59526aa2f3bc77cd25c26776d840b2e6e49c4b0f2cbf5a04a
        imagePullPolicy: Always
        name: task-reporter
        resources: {}
        volumeMounts:
        - mountPath: /etc/eirini/config
          name: config-map-volume
        - mountPath: /etc/eirini/secrets
          name: cf-secrets
      dnsPolicy: ClusterFirst
      securityContext:
        runAsNonRoot: true
      serviceAccountName: eirini-task-reporter
      volumes:
      - configMap:
          items:
          - key: task-reporter.yml
            path: task-reporter.yml
          name: eirini
        name: config-map-volume
      - name: cf-secrets
        secret:
          items:
          - key: tls.crt
            path: cc.crt
          - key: tls.key
            path: cc.key
          - key: tls.ca
            path: cc.ca
          secretName: eirini-internal-tls-certs
---
apiVersion: v1
kind: Secret
metadata:
  name: eirini-internal-tls-certs
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVpakNDQXZLZ0F3SUJBZ0lRSzhXcUdUQTl0SG9SQWZ6TVNYWWt2VEFOQmdrcWhraUc5dzBCQVFzRkFEQXoKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEN6QUpCZ05WQkFNVApBbU5oTUI0WERUSXdNRGN4TnpJeE1EUXhOVm9YRFRJeE1EY3hOekl4TURReE5Wb3dUakVNTUFvR0ExVUVCaE1EClZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1TWXdKQVlEVlFRRERCMHFMbU5tTFhONWMzUmwKYlM1emRtTXVZMngxYzNSbGNpNXNiMk5oYkRDQ0FhSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnR1BBRENDQVlvQwpnZ0dCQUpxei9SMExWUlZVSlRoMll1RGNoaVA0a2FLMDJjb1l3NkJnN1pocVNTTFJ0cnhaR0FneGR6dWZRWU90CmltR1hsc3h5WmR5RS8wM2FMSnJPY0taQUoxYlRtaE9XNjQvRlBYOXJjYzhTVTRaRFlRNWU4M2NPZ0FjREdCZFAKWVB4TStVVnRRb1p4WUpabGJNYXZkSURrK3BKRlJUZGs3MFZWZ0ZXMk04ZWJTZCtwSk1RZlhaZEdQUUsyaGlxNwplVkJmK0lqcWpjT3Z5SWZScy9OMWlJeVBKVlJNdW0xK2hrblJpcjBtcDhhVWZvdVdlN0VOd0toemllQmdZVkdtCmROZkxNY2xpOXV6bEE5QmxxK1pNamFzcUhhMGlKR3UybW5nL2NJc3YxSjVtOEhtRnFlSS9pNFIrR3F0TnhJaEoKQStmMHpYUnFjSE5oSGZSYW5NcWpLbmwyQ3crOC95bm5JUGNNN2QzVGF4dHJaYk9XWnhzWEd6SEtNSEIxWUQ5OQo2NldWY2Uzc3QzZW9jWjRNZ1ppVzA3SWkvTjYxSktxajhjMzJ3a09aZnpIdURKTTJVRFBrWFl4SFVMejRFYkp4Ck1QWmJrbVpxSy9NQmpGcngvSnpYWVpnMXVZSk9iaVlrMmhjNFo4TWowQWVrNEFxd2RpTkp0b2x1VVYwRkFOaVkKWW10OFR3SURBUUFCbzM4d2ZUQU9CZ05WSFE4QkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSApBd0lHQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdIUVlEVlIwT0JCWUVGTWJ5ZlVUbzJWUjducjI5CjAvSUJnYW1OSHhpVE1COEdBMVVkSXdRWU1CYUFGUG5XSUlDVVc2N25GTjhSUVdhMllrd3lTbkdCTUEwR0NTcUcKU0liM0RRRUJDd1VBQTRJQmdRQlE2TUNVYnBaYlZBd0hZbWo3NWRXVUk4UUFmcU82K1pUb2lQb2JuL1d1YjAwWQpQbWFIWnh2M1dYWGVZb2ltTkVxcmYvZzdiaG50QUdpV2RTa0lzOUoxUGpmVDVkR3hRZkIvOUNHVllHeDd4K0c5ClZXWWhNN2xqKzdFYmI0YlBSZFZEU0hyMkZISllIWUxZcmp6cDBEUHFDZTQ2QlVkeDJtZ3hYeklteWx2RjF2dTAKYWl5S1NxcDd3RVRmcG5NSERGRkh0S3FMUzVaQjR1eGhVUU0vL2h3bGNsdnhGZVBkMkV2b2F4bGF5MVgrTjYyVgowbjk2WnRmS05WczRzV3UvRTVUemVHT09zZ0NGSWhMM21IL1dJTkJ0WGpNZ0FlRG1XSFNSZGIvdEtFMTFQZ1c5CkVyek9yWWlQQi95M3kzL2lROFJHL2dhVWxsMWZxMlVlZHllUUVTVXFkNUQ0L290SU9JYlg5azJyWEg4MmxsQU4KbytEL0lTcWVvZUdxdTh6aG95ZUl2UDBlaFBrMWRNWVRNbjFVRDZOcTB2ZksrV2oxQzlDVjdlb2t2blZUeEhXdQpMRzJaZU5ZMWNudmpDQVBRUTNmOGJ6RWZuUFVRUzdUb0FDclFiT3pYTGUvMWpTNFg2RFdTdlZPaWZkb3grMmI5CnRjY3pCTHlPY1Npa3JLRzRNSVE9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNGdJQkFBS0NBWUVBbXJQOUhRdFZGVlFsT0haaTROeUdJL2lSb3JUWnloakRvR0R0bUdwSkl0RzJ2RmtZCkNERjNPNTlCZzYyS1laZVd6SEpsM0lUL1Rkb3NtczV3cGtBblZ0T2FFNWJyajhVOWYydHh6eEpUaGtOaERsN3oKZHc2QUJ3TVlGMDlnL0V6NVJXMUNobkZnbG1Wc3hxOTBnT1Q2a2tWRk4yVHZSVldBVmJZeng1dEozNmtreEI5ZApsMFk5QXJhR0tydDVVRi80aU9xTnc2L0loOUd6ODNXSWpJOGxWRXk2Ylg2R1NkR0t2U2FueHBSK2k1WjdzUTNBCnFIT0o0R0JoVWFaMDE4c3h5V0wyN09VRDBHV3I1a3lOcXlvZHJTSWthN2FhZUQ5d2l5L1VubWJ3ZVlXcDRqK0wKaEg0YXEwM0VpRWtENS9UTmRHcHdjMkVkOUZxY3lxTXFlWFlMRDd6L0tlY2c5d3p0M2ROckcydGxzNVpuR3hjYgpNY293Y0hWZ1AzM3JwWlZ4N2V5M2Q2aHhuZ3lCbUpiVHNpTDgzclVrcXFQeHpmYkNRNWwvTWU0TWt6WlFNK1JkCmpFZFF2UGdSc25FdzlsdVNabW9yOHdHTVd2SDhuTmRobURXNWdrNXVKaVRhRnpobnd5UFFCNlRnQ3JCMkkwbTIKaVc1UlhRVUEySmhpYTN4UEFnTUJBQUVDZ2dHQVNKMTNqNnlFRVhEZno3THlFcTR3WUs0S1hoOFpvMTBnWmlWWgpJUk95cEo5ZmNPVTQvSStMY2ZiODMzd1QybDgzTDF2N0tCbGRaUU9sc0R4NmIrN3BDRDVtc2c5REhzYnNhT1RjCkZPQjdTQ2hVWkZSNVgwYjFIVlY4ZDJTUkY1eGgzUTYrRFRFbXJ6R0liM0puOHlDSDVTU1Nxcis3K0FWOEtiOU8KYXNFZldkYWhKVlc3cm9nUGx6aHBuYUZGL2s0dDhNWjRLSVJZVWpoQ2lXSi81OHBCTVdLYWwwNnVaZlB2ZFgyeApmdXF3dzRDdEtweFQ5RDNYVi9TbGVaZnlmR0Fwa1ljcnF6aHZKa1o0eFQ4TGZXVFM4SlNQRm41akZEdzVTN2UyCjF5bFp0L0FyNVRybS8xaU5vZjE5N24vdXpXWHNmV2hPWEN1ZVRwQ1M0RzF4anBTazBoVVlRZTFSZjNpTGJkZlQKUnQ1dlJCZ3FGdU1RSWhZMXZCcGVRTG1YaEt0NlZ3UkdxeTl2MURkYktSRG4rQ2JvN0JFQXJ5K1haREc1dkR1cwpKNTVwNDdGMWgrZ1hxSVAwS2JIVzhSeS94UDRVcGxWV1Q0RnVnOCsvSTF0ZHBhc2NUbXY0ekViNlR0azFjM200CmpSL25sK1RMS2dyMnR0VnVFNG9qS09qenpDTVJBb0hCQU1KUjJ6RFB3ZTR4MlIwSTZvOEtFa01pcU91cmJ1cTgKbXVnaHlQQjVPbjFwdmtFbk5XL1NJV1N5SUVZSEszSnV4MWlscHZhRXlRa0lnR3E4a2hGaFdTajJQeVR4QU8vcApRdGtkaUFrM1piRi9XRElFbkRKUlhtQnJRdzVvVnhJYWtVcTEyLytyVGV1VVdQL0VEZ0FaNldGSUZIQUEwNUlzClBHQU9lNjIrNVRrbll2dFhQMTVaZ1JCbFRGd0pEY09rYy9zeGhLU0FKYUFpRWhMYXFLV1lZVEJJL21YdGF0TFcKOEZSRFJUS29vSVhKUWt3cktOY05zVUNpaXZYb2RZK3hsUUtCd1FETHp2QlhQSm01YVU3bTlWOFEzd3dlT1BDaAptaVVXK3B1bWFKVjNrV1Y3NzJwK2dKdkVTUkZGbFZXUkJHOXhDaytEZ09wRnMvTVo5MTkxT0F6L09QZU0yWnJVCkVLMUxlcGQ1cUNWOXZla05RMHZWeGJuVEdLL1Mwb1U1Umo3Q0JsUVRXeGY5amlxQjVIKzlzR1RhTk4rOFkveDQKbmVkY1FRdDlaMzRPQWZnM0lNOEVlYjk4dFRNYmxwTzJ6NWExZ1NFREI5Q2dZUWRaaXdDaUNKQ0hGcklyQ2ZRWgo1Vk5LUnRWeTZXNFFjME5FQlo1bmdSUkR0ZndHOGdxc1lJK3BCVk1DZ2NBVlhua1RRaFdhZ3lMVUhaSGx6djY1CklVdWdOd2NJaTFzaG9lMTkvR2JoT2NxeFVZVi8yWVRRbFFJVmtWNUd4RVhweXJXMHNGK0hQY2NaZGNrK1hnMDMKQXZWb3M1UWR6ZklLL0VOa2VCSVgxZUEyQituQllzOVZIUmFQdEF1M012SzlXNGhvOGthc1hIRDVGMjlPdFlyRApwdkNRYkpiWG9VTzJjSUZMVnczUUhqTzFYaC9hMlU3bkpheWpCbC9jSHU2ZU5oRFhJanlCQXA0b01xR1BMRldyCndLc3hQRTJlQ0FMLzBUSC80eWxiN1FqOFpWYWxaNTBSZFk2QWdtTERQWTBDZ2NBY2ZmK25rbmRETG0relpoWTIKTzVoc0dUVzZ3ZHZ4akhONkhpRFhLR0p4b3hUV1BwQ0lMbGJWelh5NjIwM2hGYm5yL25mQjZ0aFBodiszV1hDbgp0WVVXRWMzTlc4OStQOU14Vk1wNCs3VzYvdTk1SVQxTFA2WkU2TjFyRm1EcnF3clI4ZWcyc0V0TkFXN0NUQWl0CllMcnVrV1BZVU9ycFFNYWtiM1YxNjl5UmlHcW9pNFN6b0hsV29BUmlpRDdmZlAvcWRvczZBSmFRZEJoUWpyWDEKekx4M3U5cCtURXNLbFVCOTRoaGJBR0lrL2t3WTJEakhCb2dIU0lzcGNnNWphTFVDZ2NCOUx6TXBWRkZTYVMxVgpjU1FqTnJUcVpjRjhvOVpmWDZtYUdQUDN6ODlHSmNrQnZ6NDVjTTlCM0svT0pESnNacjNjNkhDRWFqTUlwQVFuCk9laVV4Zy94OW1nZGFYZCtwT1B6T3BPeitMdm5FTTh3WkRxaXErVVhWSXV3Mm5CL1ZnbzkxMThxNlFUcEtwSEwKSDJ1bU4wbWgraUZZMS93RW4vU2dhVHRUUmFZSnlRdS8wK29USVdPMSs3bGhUSHNIaUJtemhVVXFVOTNyaWlOMQpnTW1KZHd0M3drR1ZCSnp5cldxRzI5My8vSVFGbm1iWVJZa3RPQVowL1U2SDZDelZteHc9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCgo=
  tls.ca: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVWRENDQXJ5Z0F3SUJBZ0lSQU8xY0hRZTRBcW9aMDU3eEdPc3F3QVF3RFFZSktvWklodmNOQVFFTEJRQXcKTXpFTU1Bb0dBMVVFQmhNRFZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1Rc3dDUVlEVlFRRApFd0pqWVRBZUZ3MHlNREEzTVRjeU1UQTBNVE5hRncweU1UQTNNVGN5TVRBME1UTmFNRE14RERBS0JnTlZCQVlUCkExVlRRVEVXTUJRR0ExVUVDaE1OUTJ4dmRXUWdSbTkxYm1SeWVURUxNQWtHQTFVRUF4TUNZMkV3Z2dHaU1BMEcKQ1NxR1NJYjNEUUVCQVFVQUE0SUJqd0F3Z2dHS0FvSUJnUUM3K0kwVTdSdDBmak5QRk5mcCt2dVEwUExaTWJIUgpYM3ptY1UyZmExV2pJd0JFTkYvam9PM3F0MnUrQm56bFJLeGc5czhPV2lsZlVzNUxsRmxQb283VFdITy9OeFlmCldqTk8wZHBhYlErbUJCNmc2REJNSjhTWmNYVG1NaUVmUXNEVW1GQnhZNFQ0SXdXSExNQmNlOTFtWEJYaTUzUVIKVjdKREY2c2tGT01sdVBYZDVhQm1PbnU2TG02dEhpYlF1T29vYVhvNUg3ajdvRW96UkhSbVRhNFNxdmlPV0Z0dwp3N28za3lDRFJPcDJZOG0wOUE1V2ZQQ0ptN1A1bHlOcEpjaHFnSTY1WEp0UXhNOWlyaCtLTllHK0dndkM1cnNnCis2YUpQSWxtb3k5alhiSHo4cmZlNDFQNXNldWRRaW8rQ2Q0TXpmN2U4VmpjWVRZK3RtSnVoK3J5UXZQSkpyckgKTnF6eE53Z1IvWXhFa3VZTmRRcS9Ia0J4OTFGdVhoM1h2dmx5MStxeTk5Y0RMTEx0L1ZrWk5QZE5iazFtanJUegpYbC84QlhwKzk2bXBRclUwajk3UjBabWpqTFhZT2ZXTE92TDRXV1RKQ0hvc1p1ZHhXM0dvak4xT3VScXhxSlVNCnQ2d2xpajllT01jT2JxZUVWaUd6SjlLN2ZtR1VWZWd0MEJNQ0F3RUFBYU5qTUdFd0RnWURWUjBQQVFIL0JBUUQKQWdFR01BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZQbldJSUNVVzY3bkZOOFJRV2EyWWt3eQpTbkdCTUI4R0ExVWRJd1FZTUJhQUZQbldJSUNVVzY3bkZOOFJRV2EyWWt3eVNuR0JNQTBHQ1NxR1NJYjNEUUVCCkN3VUFBNElCZ1FBK25nUnJoVjBuMktXVFhwazlOdm9uMlpFZGRPY3BCZlV6WENudGdtL3BIOFd4cWxNN1ltUUgKQnhrQVoyWU5BK3YrdWlyWkhpSWVIS2pTZU1yR0dxUkFSZEJaVFU4M01Na0lzQVZHbzg1MWdLVkhnTWppY2pQNApZWVhOdlRWZG80NzZuZFJsSVJvV09yZVh1Unl5d2htVmxTMWlBYmhoRm5HVjBoaHMrRkREZkgybmZ4dUxUV3k5CndDV3N1OGpCUVRtV1JXV0owUVB1Z1phcnJCa2cyOEJMY1lUdG4rMEcyNWpva2g5amNkTGNLaUZRMGM1bW5vYmUKY1JSa29HRDY2RDEyU0VpMFQzd2V4cmVtbmNNZ0o1SnVqcFlsSnhRYTUrZ21YUVpmaWlmMSt1Wk1aZzhYNTY3SQpycU53emQ0TkU2RDdRRjNHNG93Zm5wMGFiSTlnY2l3endLS201dmh1dE9jYnhEbkVickFPZFVPbVc0RWR3cjZYCm1PZzlPQWQ5NDBwTm5CaWtvaU9FKzZScHBsYlgyY3ZwSlhiTEduVjZpY2ZLL0pGQXczTlJqSEdDMjI5T2ROdk0KTlA5cmZKRG5LL2xGRnJsRDE3dFJOcDI5MHQyekpjVnNFTjdZQ3dBRnpXVkgwYnhKc0JpWFpqVkZLRUFNUm8zWgp2bUxrWnlydnI5WT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-app-ingress-from-ingressgateway
  namespace: cf-workloads
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
      podSelector:
        matchLabels:
          istio: ingressgateway
---
apiVersion: v1
kind: Secret
metadata:
  name: app-registry-credentials
  namespace: cf-workloads
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwOi8vaGFyYm9yLmhhcmJvci5zdmMuY2x1c3Rlci5sb2NhbDo4MCI6eyJhdXRoIjoiWVdSdGFXNDZZV1J0YVc0PSIsInBhc3N3b3JkIjoiYWRtaW4iLCJ1c2VybmFtZSI6ImFkbWluIn19fQ==
---
apiVersion: kapp.k14s.io/v1alpha1
kind: Config
metadata:
  name: kapp-config
rebaseRules:
- path:
  - metadata
  - annotations
  - pv.kubernetes.io/bind-completed
  type: copy
  sources:
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: PersistentVolumeClaim
- path:
  - metadata
  - annotations
  - pv.kubernetes.io/bound-by-controller
  type: copy
  sources:
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: PersistentVolumeClaim
- path:
  - metadata
  - annotations
  - volume.beta.kubernetes.io/storage-provisioner
  type: copy
  sources:
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: PersistentVolumeClaim
- path:
  - spec
  - volumeMode
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: PersistentVolumeClaim
- path:
  - webhooks
  - allIndexes: true
  - rules
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - metadata
  - annotations
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: ServiceAccount
- path:
  - metadata
  - annotations
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - webhooks
  - allIndexes: true
  - namespaceSelector
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - webhooks
  - allIndexes: true
  - clientConfig
  - service
  - path
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - webhooks
  - allIndexes: true
  - sideEffects
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - webhooks
  - allIndexes: true
  - timeoutSeconds
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - spec
  - healthCheckNodePort
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: Service
---
apiVersion: experimental.kpack.pivotal.io/v1alpha1
kind: Store
metadata:
  name: cf-buildpack-store
  annotations:
    kapp.k14s.io/change-group.kpack-resources: cf-for-k8s.cloudfoundry.org/kpack-resources
spec:
  sources:
  - image: gcr.io/paketo-community/ruby@sha256:5d95274fc0468f34d29ff2fd115634206fa6beaa3d8ecb2e0d8f06b42f37a777
  - image: gcr.io/paketo-community/python@sha256:c152763e3bc606f72cb7d8c513abe2fcf6ee2d8650b1e3a2884a0b7966404300
  - image: gcr.io/paketo-buildpacks/java@sha256:32ba0e8e7e8fee56adda85b2ff6a43bd6baa06088cf9c5b08d0a7fe5a342ae8b
  - image: gcr.io/paketo-buildpacks/nodejs@sha256:3234414b97541a9661ba89fe20a8fe6505f6e1ca64f27227342399e5ca86138e
  - image: gcr.io/paketo-buildpacks/go@sha256:bad4b5bae7818134cfef2609057e40b4d6bcc2406c5f7c4a85f77e9b31d1c96e
  - image: gcr.io/paketo-buildpacks/dotnet-core@sha256:52952dbaf7bd65ea10ac6491c5af8dda238bdda0c33a938806026d327c3a075f
  - image: gcr.io/paketo-buildpacks/php@sha256:43ba252c72d3ce60930ded5e30f87f1f8715fc8f5d964fcbce3a3548c2d2e03e
  - image: gcr.io/paketo-buildpacks/procfile@sha256:224f4f533d9bd44f675b704f51a21ec86dad8979aefa0d30cad2f0d72e7f2d9e
---
apiVersion: experimental.kpack.pivotal.io/v1alpha1
kind: Stack
metadata:
  name: cflinuxfs3-stack
  annotations:
    kapp.k14s.io/change-group.kpack-resources: cf-for-k8s.cloudfoundry.org/kpack-resources
spec:
  id: org.cloudfoundry.stacks.cflinuxfs3
  buildImage:
    image: gcr.io/paketo-buildpacks/build@sha256:84f7b60192e69036cb363b2fc7d9834cff69dcbcf7aaf8c058d986fdee6941c3
  runImage:
    image: gcr.io/paketo-buildpacks/run@sha256:84f7b60192e69036cb363b2fc7d9834cff69dcbcf7aaf8c058d986fdee6941c3
---
apiVersion: experimental.kpack.pivotal.io/v1alpha1
kind: CustomBuilder
metadata:
  name: cf-default-builder
  namespace: cf-workloads-staging
  annotations:
    kapp.k14s.io/change-rule.kpack-resources: upsert after upserting cf-for-k8s.cloudfoundry.org/kpack-resources
spec:
  tag: harbor.harbor.svc.cluster.local:80/library/cf-default-builder
  serviceAccount: cc-kpack-registry-service-account
  stack: cflinuxfs3-stack
  store: cf-buildpack-store
  order:
  - group:
    - id: paketo-community/ruby
  - group:
    - id: paketo-community/python
  - group:
    - id: paketo-buildpacks/java
  - group:
    - id: paketo-buildpacks/nodejs
  - group:
    - id: paketo-buildpacks/go
  - group:
    - id: paketo-buildpacks/dotnet-core
  - group:
    - id: paketo-buildpacks/php
  - group:
    - id: paketo-buildpacks/httpd
  - group:
    - id: paketo-buildpacks/nginx
  - group:
    - id: paketo-buildpacks/procfile
---
apiVersion: kapp.k14s.io/v1alpha1
kind: Config
metadata:
  name: kapp-wait-rule-config
waitRules:
- supportsObservedGeneration: true
  conditionMatchers:
  - type: Ready
    status: "True"
    success: true
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: experimental.kpack.pivotal.io/v1alpha1
      kind: Stack
  - apiVersionKindMatcher:
      apiVersion: experimental.kpack.pivotal.io/v1alpha1
      kind: Store
- supportsObservedGeneration: true
  conditionMatchers:
  - type: Ready
    status: "True"
    success: true
  - type: Ready
    status: "False"
    failure: true
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: experimental.kpack.pivotal.io/v1alpha1
      kind: CustomBuilder
---
apiVersion: v1
kind: Namespace
metadata:
  name: kpack
  labels:
    istio-injection: enabled
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: builds.build.pivotal.io
spec:
  group: build.pivotal.io
  version: v1alpha1
  names:
    kind: Build
    singular: build
    plural: builds
    shortNames:
    - cnbbuild
    - cnbbuilds
    - bld
    - blds
    categories:
    - kpack
  scope: Namespaced
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: Image
    type: string
    JSONPath: .status.latestImage
  - name: Succeeded
    type: string
    JSONPath: .status.conditions[?(@.type=="Succeeded")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: builders.build.pivotal.io
spec:
  group: build.pivotal.io
  version: v1alpha1
  names:
    kind: Builder
    singular: builder
    plural: builders
    shortNames:
    - cnbbuilder
    - cnbbuilders
    - bldr
    - bldrs
    categories:
    - kpack
  scope: Namespaced
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: LatestImage
    type: string
    JSONPath: .status.latestImage
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: clusterbuilders.build.pivotal.io
spec:
  group: build.pivotal.io
  version: v1alpha1
  names:
    kind: ClusterBuilder
    singular: clusterbuilder
    plural: clusterbuilders
    shortNames:
    - clstbldr
    categories:
    - kpack
  scope: Cluster
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: LatestImage
    type: string
    JSONPath: .status.latestImage
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: build-init-image
  namespace: kpack
  annotations:
    kapp.k14s.io/versioned: ""
data:
  image: gcr.io/cf-build-service-public/kpack/build-init@sha256:090bf83938b3a6e8559d566a816825035c3226a5b2b89710db3f2b9b8a0a218b
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: rebase-image
  namespace: kpack
  annotations:
    kapp.k14s.io/versioned: ""
data:
  image: gcr.io/cf-build-service-public/kpack/rebase@sha256:68f116436c555fc655fb6cdf58a58b229dca6c64c46df730c01b0b2c995d24e3
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: lifecycle-image
  namespace: kpack
  annotations:
    kapp.k14s.io/versioned: ""
data:
  image: gcr.io/cf-build-service-public/kpack/lifecycle@sha256:830f6026479a0b43bdc6ba3e942a80c7c5e49839e911ad5592c1e54933419d05
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: completion-image
  namespace: kpack
  annotations:
    kapp.k14s.io/versioned: ""
data:
  image: gcr.io/cf-build-service-public/kpack/completion@sha256:dd21b848f5ac7d1c844c780bb2b51596f5eadc300bee9bdc34cc912fa7d2ce9f
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kpack-controller
  namespace: kpack
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kpack-controller
  template:
    metadata:
      labels:
        app: kpack-controller
        version: dev
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      serviceAccountName: controller
      containers:
      - name: controller
        image: gcr.io/cf-build-service-public/kpack/controller@sha256:350e74b06c196070d4b256a9ab358aeb981cb55369d6933b89072d7625ec240a
        env:
        - name: CONFIG_LOGGING_NAME
          value: config-logging
        - name: CONFIG_OBSERVABILITY_NAME
          value: config-observability
        - name: METRICS_DOMAIN
          value: kpack.io
        - name: SYSTEM_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: BUILD_INIT_IMAGE
          valueFrom:
            configMapKeyRef:
              name: build-init-image
              key: image
        - name: REBASE_IMAGE
          valueFrom:
            configMapKeyRef:
              name: rebase-image
              key: image
        - name: COMPLETION_IMAGE
          valueFrom:
            configMapKeyRef:
              name: completion-image
              key: image
        - name: LIFECYCLE_IMAGE
          valueFrom:
            configMapKeyRef:
              name: lifecycle-image
              key: image
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: controller
  namespace: kpack
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kpack-controller-admin
rules:
- apiGroups:
  - build.pivotal.io
  resources:
  - builds
  - builds/status
  - builds/finalizers
  - images
  - images/status
  - images/finalizers
  - builders
  - builders/status
  - clusterbuilders
  - clusterbuilders/status
  - sourceresolvers
  - sourceresolvers/status
  verbs:
  - get
  - list
  - create
  - update
  - delete
  - patch
  - watch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  verbs:
  - get
  - list
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  - pods
  verbs:
  - get
  - list
  - create
  - update
  - delete
  - watch
- apiGroups:
  - experimental.kpack.pivotal.io
  resources:
  - custombuilders
  - custombuilders/status
  - customclusterbuilders
  - customclusterbuilders/status
  - stores
  - stores/status
  - stacks
  - stacks/status
  verbs:
  - get
  - list
  - create
  - update
  - delete
  - patch
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kpack-controller-admin-binding
subjects:
- kind: ServiceAccount
  name: controller
  namespace: kpack
roleRef:
  kind: ClusterRole
  name: kpack-controller-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kpack-controller-local-config
  namespace: kpack
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kpack-controller-local-config-binding
  namespace: kpack
subjects:
- kind: ServiceAccount
  name: controller
  namespace: kpack
roleRef:
  kind: Role
  name: kpack-controller-local-config
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: custombuilders.experimental.kpack.pivotal.io
spec:
  group: experimental.kpack.pivotal.io
  version: v1alpha1
  names:
    kind: CustomBuilder
    singular: custombuilder
    plural: custombuilders
    shortNames:
    - custmbldr
    categories:
    - kpack
  scope: Namespaced
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: LatestImage
    type: string
    JSONPath: .status.latestImage
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: customclusterbuilders.experimental.kpack.pivotal.io
spec:
  group: experimental.kpack.pivotal.io
  version: v1alpha1
  names:
    kind: CustomClusterBuilder
    singular: customclusterbuilder
    plural: customclusterbuilders
    shortNames:
    - ccb
    categories:
    - kpack
  scope: Cluster
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: LatestImage
    type: string
    JSONPath: .status.latestImage
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: images.build.pivotal.io
spec:
  group: build.pivotal.io
  version: v1alpha1
  names:
    kind: Image
    singular: image
    plural: images
    shortNames:
    - cnbimage
    - cnbimages
    - img
    - imgs
    categories:
    - kpack
  scope: Namespaced
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: LatestImage
    type: string
    JSONPath: .status.latestImage
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: v1
kind: Service
metadata:
  name: kpack-webhook
  namespace: kpack
spec:
  ports:
  - port: 443
    targetPort: 8443
  selector:
    role: webhook
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: sourceresolvers.build.pivotal.io
spec:
  group: build.pivotal.io
  version: v1alpha1
  names:
    kind: SourceResolver
    singular: sourceresolver
    plural: sourceresolvers
    categories:
    - kpack
  scope: Namespaced
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: stacks.experimental.kpack.pivotal.io
spec:
  group: experimental.kpack.pivotal.io
  version: v1alpha1
  names:
    kind: Stack
    singular: stack
    plural: stacks
    categories:
    - kpack
  scope: Cluster
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: stores.experimental.kpack.pivotal.io
spec:
  group: experimental.kpack.pivotal.io
  version: v1alpha1
  names:
    kind: Store
    singular: store
    plural: stores
    categories:
    - kpack
  scope: Cluster
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  name: defaults.webhook.kpack.pivotal.io
webhooks:
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    service:
      name: kpack-webhook
      namespace: kpack
  failurePolicy: Fail
  sideEffects: None
  name: defaults.webhook.kpack.pivotal.io
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  name: validation.webhook.kpack.pivotal.io
webhooks:
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    service:
      name: kpack-webhook
      namespace: kpack
  failurePolicy: Fail
  sideEffects: None
  name: validation.webhook.kpack.pivotal.io
---
apiVersion: v1
kind: Secret
metadata:
  name: webhook-certs
  namespace: kpack
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kpack-webhook
  namespace: kpack
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kpack-webhook
  template:
    metadata:
      labels:
        app: kpack-webhook
        role: webhook
        version: dev
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      serviceAccountName: webhook
      containers:
      - name: webhook
        image: gcr.io/cf-build-service-public/kpack/webhook@sha256:8abb7c72856ee1276a9586dd687a31e0d2ae12d54c98432ee749cd1e33c0d331
        ports:
        - name: https-webhook
          containerPort: 8443
        env:
        - name: CONFIG_LOGGING_NAME
          value: config-logging
        - name: CONFIG_OBSERVABILITY_NAME
          value: config-observability
        - name: METRICS_DOMAIN
          value: kpack.io
        - name: SYSTEM_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: webhook
  namespace: kpack
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kpack-webhook-certs-admin
  namespace: kpack
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - secrets
  resourceNames:
  - webhook-certs
  verbs:
  - update
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kpack-webhook-certs-admin-binding
  namespace: kpack
subjects:
- kind: ServiceAccount
  name: webhook
  namespace: kpack
roleRef:
  kind: Role
  name: kpack-webhook-certs-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kpack-webhook-mutatingwebhookconfiguration-admin
rules:
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  resourceNames:
  - defaults.webhook.kpack.pivotal.io
  verbs:
  - update
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - validatingwebhookconfigurations
  resourceNames:
  - validation.webhook.kpack.pivotal.io
  verbs:
  - update
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - validatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - storage.k8s.io
  resources:
  - storageclasses
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kpack-webhook-certs-mutatingwebhookconfiguration-admin-binding
subjects:
- kind: ServiceAccount
  name: webhook
  namespace: kpack
roleRef:
  kind: ClusterRole
  name: kpack-webhook-mutatingwebhookconfiguration-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: cf-blobstore-allow-plaintext
  namespace: cf-blobstore
spec:
  selector:
    matchLabels:
      app: minio
  mtls:
    mode: PERMISSIVE
---
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: kpack-webhook-allow-plaintext
  namespace: kpack
spec:
  selector:
    matchLabels:
      app: kpack-webhook
  mtls:
    mode: PERMISSIVE
---
kind: ServiceAccount
apiVersion: v1
metadata:
  name: fluentd-service-account
  namespace: cf-system
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: pod-namespace-read
  namespace: cf-system
rules:
- apiGroups:
  - '*'
  resources:
  - pods
  - namespaces
  verbs:
  - get
  - watch
  - list
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: fluentd-service-account-pod-namespace-read
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: pod-namespace-read
subjects:
- kind: ServiceAccount
  name: fluentd-service-account
  namespace: cf-system
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluentd-config
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  fluentd.conf: |
    # Inputs
    <source>
      @type forward
      tag forwarded.test
      port 24224
    </source>

    <source>
      @type tail
      @id in_tail_container_logs
      path /var/log/containers/*.log
      pos_file /var/log/fluentd-containers.log.pos
      tag kubernetes.*
      refresh_interval 1
      <parse>
        @type multi_format
        <pattern>
          format json
          time_key time
          time_format %Y-%m-%dT%H:%M:%S.%NZ
        </pattern>
        <pattern>
          format /^(?<time>.+) (?<stream>stdout|stderr) [^ ]* (?<log>.*)$/
          time_format %Y-%m-%dT%H:%M:%S.%N%:z
        </pattern>
      </parse>
      read_from_head true
    </source>

    # Filters
    <match kubernetes.var.log.containers.fluentd**>
      @type null
    </match>

    <filter kubernetes.**>
      @type kubernetes_metadata
    </filter>

    <filter kubernetes.**>
      @type record_transformer
      enable_ruby
      <record>
        app_id ${record.dig("kubernetes", "labels", "cloudfoundry_org/app_guid")}
        instance_id ${record.dig("kubernetes", "pod_id")}
        structured_data \[tags@47450 source_type="${record.dig("kubernetes", "labels", "cloudfoundry_org/source_type")}"\]
      </record>
    </filter>

    <filter forwarded.**>
      @type record_transformer
      enable_ruby
      <record>
        structured_data \[tags@47450 source_type="${record.dig("source_type")}"\]
      </record>
    </filter>

    <filter **>
      @type grep
      <regexp>
        key $.app_id
        pattern /.+/
      </regexp>
    </filter>

    <match **>
      @type syslog_rfc5424
      host log-cache-syslog
      port 8082
      transport tls
      trusted_ca_path /ca/tls.crt
      <format>
        @type syslog_rfc5424
        proc_id_field instance_id
        app_name_field app_id
        structured_data_field structured_data
      </format>

      <buffer>
        @type memory
        flush_mode immediate
      </buffer>
    </match>
---
apiVersion: v1
kind: Service
metadata:
  name: fluentd-forwarder-ingress
  namespace: cf-system
spec:
  selector:
    app: fluentd
  ports:
  - protocol: TCP
    port: 24224
---
apiVersion: v1
kind: Service
metadata:
  name: log-cache
  namespace: cf-system
spec:
  selector:
    app: log-cache
  ports:
  - protocol: TCP
    port: 8083
    name: http
---
apiVersion: v1
kind: Service
metadata:
  name: log-cache-syslog
  namespace: cf-system
spec:
  selector:
    app: log-cache
  ports:
  - protocol: TCP
    port: 8082
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: log-cache-external-virtual-service
  namespace: cf-system
spec:
  gateways:
  - cf-system/istio-ingressgateway
  hosts:
  - log-cache.vcap.me
  http:
  - route:
    - destination:
        host: log-cache.cf-system.svc.cluster.local
        port:
          number: 8083
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: log-cache-ca
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVhRENDQXRDZ0F3SUJBZ0lSQU1aMzJ6alZ4K1pGT2p6RVdMaUViVG93RFFZSktvWklodmNOQVFFTEJRQXcKUFRFTU1Bb0dBMVVFQmhNRFZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1SVXdFd1lEVlFRRApFd3hzYjJjdFkyRmphR1V0WTJFd0hoY05NakF3TnpFM01qRXdOREUyV2hjTk1qRXdOekUzTWpFd05ERTJXakE5Ck1Rd3dDZ1lEVlFRR0V3TlZVMEV4RmpBVUJnTlZCQW9URFVOc2IzVmtJRVp2ZFc1a2Nua3hGVEFUQmdOVkJBTVQKREd4dlp5MWpZV05vWlMxallUQ0NBYUl3RFFZSktvWklodmNOQVFFQkJRQURnZ0dQQURDQ0FZb0NnZ0dCQU0xTgpXQ2VIZTJ4b2VlN2NvYnhIR2tOdXlEWEVSWXZpcWxhWEFVbXA4TWxkMXRkaFkwRzNqVUNNbDJTb1ZVWHovZTNmCmU4cVZyY3NQdEd3VnhQTjNELzFLOEtQSmpYcm1wZXRjU0orVmZDeG11aittL1JzU0FBQ2EwaGN0bXdsQUtZYTkKMmFTUWt3aE1zZ0ZPZ2ZYVXJjRG5DOWE3V1pzeUttbWlEVVRqc1RXMzcwN0JkdFZuNWgxK1JQaldJUUxUNWZ0TgpDRDRrUDhRU0xXNzl1eE1zZnQzekRNcEMvdm9QUWFYUzZINjE0ZHRoRnZvWGRjT0RFVVdGWGc5aFl3dUpTZDhhCkJyWmRhT3JwV0kya2pSeHZQeGJyd1FVaW9hc240bHhiSWtYMFh0ZkUreWRtRjhjc1BCTmh0VXdCWllQK2hmYTkKdEx5eG9WZ1ZJaEMyZGlhTVdETTFHSjFNQlF4cDNucVhqTFBPcUZMWDZSZFQrNmc0SWVCZzdjQjdXRlVYVmd0UQo1U3dkWmc3ZE5mSW9tQ2k3QWZ2NDJyd2RPMG42ODFRK1h4R2I1MndPUkt1cFlqcFREdUhvT0RzS0pvcGM1SC9lCkFUMkRVR2Z1ODNwZk5VOGZMQWpMVDFJSlVJWjV4aHVoUHBOMGpFeDh2MFVaSnZpcWtNcnRGOWRRbWcwNC93SUQKQVFBQm8yTXdZVEFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RQpGZ1FVeFFFbWxDUUZ3bkkzWjhyNkRtMmZUd1FMZEMwd0h3WURWUjBqQkJnd0ZvQVV4UUVtbENRRnduSTNaOHI2CkRtMmZUd1FMZEMwd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFFenFIQVRzd0VuNjlUakduSlErQWcyYVBlclYKZncreUlMSW05L29qVWJMckVNQWNoUENrR0Y1VGRxYU80WGZ4TFN0WXRNNEp0SnltZStoY3ExcitJVFE3WlFLaQpDU3U5QWVZNVIranlBS2tTeFpPNlFFMWZDMHV3STg0b3BpRStUQm5XUCtmeDJPTndid0dNUXcxU25GRzdJN2xzCkI3WEk4Z1hKVGNvMWxRem1JZlNseEFIYVdQUE9hS2RONkxGZmNzSFBSSmpUV1NCMmFtMzJraG5xSC82RkFRWHEKd012NXpLcWpFVCs2SFo5RUh4Ylh6TkR0RktPdUVoSzM3OVB3b3JKVzZnN2FxVktzY0UzUThkdVZEcUhvcWZ3OApZcWxBT2tWU05UVWtYaW5QYXNSeldHdk5udVhnRVk5Y21MczI2RUh0RisrQVVwR2ZEcmx0WnVzL08xNzFJdFhvCnZiQUtabGxkdEdNMmRhd0dFNkhBelo0UUpSUVN4SWhra1hXODFETlA2azh3ejlGdjF5ekxhdGIremM5ejhaTDIKWkY3cGMrY2JJb3FENjlSRDdSQ1FVdHVZTXZPN0lWZnN0YXRXdnZNU0NINFA0QzkyS0NPYnk5S1dYSzhheVpXegpKTVRkTnhsdzhXakFjc1cwL3BkWjZubjM3dnc0THM1a2k1L0hoZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNVFJQkFBS0NBWUVBelUxWUo0ZDdiR2g1N3R5aHZFY2FRMjdJTmNSRmkrS3FWcGNCU2Fud3lWM1cxMkZqClFiZU5RSXlYWktoVlJmUDk3ZDk3eXBXdHl3KzBiQlhFODNjUC9VcndvOG1OZXVhbDYxeEluNVY4TEdhNlA2YjkKR3hJQUFKclNGeTJiQ1VBcGhyM1pwSkNUQ0V5eUFVNkI5ZFN0d09jTDFydFpteklxYWFJTlJPT3hOYmZ2VHNGMgoxV2ZtSFg1RStOWWhBdFBsKzAwSVBpUS94Qkl0YnYyN0V5eCszZk1NeWtMKytnOUJwZExvZnJYaDIyRVcraGQxCnc0TVJSWVZlRDJGakM0bEozeG9HdGwxbzZ1bFlqYVNOSEc4L0Z1dkJCU0tocXlmaVhGc2lSZlJlMThUN0oyWVgKeHl3OEUyRzFUQUZsZy82RjlyMjB2TEdoV0JVaUVMWjJKb3hZTXpVWW5Vd0ZER25lZXBlTXM4Nm9VdGZwRjFQNwpxRGdoNEdEdHdIdFlWUmRXQzFEbExCMW1EdDAxOGlpWUtMc0IrL2phdkIwN1NmcnpWRDVmRVp2bmJBNUVxNmxpCk9sTU80ZWc0T3dvbWlsemtmOTRCUFlOUVorN3plbDgxVHg4c0NNdFBVZ2xRaG5uR0c2RStrM1NNVEh5L1JSa20KK0txUXl1MFgxMUNhRFRqL0FnTUJBQUVDZ2dHQkFNbzNiS1ZDNVdjYVlUL05RZUZaaDV6eitYQThLdVJtRnJIRApleGs3c2xnbGZnQVhoTlN1SHd0OWI0Rk43UEJDSzlPcFZSMXQ0UWtxSnVSdmJOY0NaMVZ1QXlqUTFmSkFUUjFPCmdKbnZlNmVnWjhOYWorT2lEeTZKVUhaVURXbEhNWi91VC9td0RhTVhLQjN4WGtEdGcxZUdQRHI5dm4wSEpJOTMKZHVwcis1aVYyN2tQQmlXZGVTT0R4QnYxamY1akNSeEYrK0I1Zy9WMGtodkpBQU1heUx1Rk13dm1nWTk4aDRUMgpBTnNOKzdGQ0tJZWRvL2szbUVPSjRlUDBZTUowTGZNdFlmZmsvUHprM0p1L0tTNVlYRDVKd3R3c1VqR0xFM3RLCm9RTW9pdFVDbWlVbHF0OFpwMHVNNzBXU1dzQzkxYzU3d3c0a1gzOXZBZzF5WDJHVVc4UTdwR1E1WW9Jb3FxNFgKZEMyOGZRNkNoem1KUUczRGkrL1N4NTNaNVZ4YXJUa2FvWHJ4aXlGRHIxREtMZ2VnS0sxQVNlRk1adXdmWmxBRAoxY2hQQytXT3Rha1RQWkJnaS9YOHV3cFRrQ0dmczA4bWxTQ3JUN05SR0RWQmszWnFqQ3NoZjIxeTNsT0N1ZXRwCnpBV2xqc3o3Ymg2MGVZeFc3VS8vVU9FSXdXTlpRUUtCd1FEcng2T2phNHd1b05lNjQvT0ViQUhvUStJV3Z6TS8KSXVGUWE1OVprdE4xdmtjdzcxREVnaHRVbU9HdGk1QkdtNjdUS211MkQxanNYcnpMdmtLT3VjbXgybnFWaGt3dApqS1M1UWFTalEyYk9wYk45YlZZOVByVytiNUJYKzJPQWlheThmNWkycWt6QlY3N0VLMUhTditwbHZaUWR1N09sCk5FczlRSTZzb3FEdUJmSU5BWXNVOWZRMlJkYUxLakpoUnh5ZDhTUFk3Y01SR1VONmduRmEyMmhKUUs2bm4wY1gKSndJSXg0V2NFV1VWZ2FPYVpUU0d6amZtQnhaK3ZOWktDSk1DZ2NFQTN1aVhSbEJiRC9oVElvZDVGWXc1SUdzawpXMDdwTGdGZUN3WGtwanBXc2ZSKzBuU09kSU0wdm5OUUduREJaZ1oxZi9UT1ZTQ1FLN0hTTXplS09ObkU0Y1hSCmRaWUszb0NwSHFKanh0OXFOWnlRcStOT25sTFNEbGROeTl4Y3pmUkNGa2dpcHk4K2FWbWVEdlI5d1REK2VFY3QKT3pZUVdiZlVxdXhITVhaemJpaXozS1UyWithL1prY1p6SDllZEhlelZCRzJ3TStjSVE0dG5GUm5GMVNKb24xSwoyWjBxTHRIRzExbEw1TEc0dythSmZyaEs1UWFKYUhNR2hCbHJFaTFsQW9IQWFhamdleWFCL285VHZjdlRZQjlxCngyUk1XRGM4eHVsaG9VRnBlcUdpbzV3dW1RNVYyb29YcDFTUHBjN3FTOG9Pa1ZEc1RmMFlzMnhOSE56WlJNNmIKUlZtTUg1KzhXWmt5WkZhM2FmYVZocnVZOFBkamN6UzhDMmhCZmp3SXZoeDBUVkM4NWZieFNKK0N2TFJSQ2FtNQpaL2lKL0wwVjUwM0UvZUVGVHZYZU9teHRxVWhzeEdyb0VyNC9ROFFZS2FITmdEWUZBM3loTXZOb1d1bEQxUnlICjRuUGJFUUQrd2JCWWFBakpwa1BoVWI3enl3ZlpmeVBBeHhPY0VCV2R6aldEQW9IQkFJTUNoTlpvcC95czRIK3MKeTdla1lIYnpRYjBBbGYvYUFlSE1wdVFqNll4UnZMQUluU2xSYkJCN1Nac2dwaXBHcFl4ODMwQWRFVjc4OWlQdwpBcWNESnJualFBWXlGMVZLblJ0S0tnWmFqTnZSbHgzUFRRZTBlWXpBTnhNWUF0dHhNZDVTcXp0RGd4VDcvTytoCk5yL3pBYnpEYUl3aWJGMnVzNmw1a1NZN0RnQ3luM09SRG5ibW9adUZNbDZFaFlsQ1NQMmlJNTBTNkJwdGNOVXUKcmlDQ0tScDlOUjdOUmx1YUk1bXgrKzcvblM1V01uMXQ1MmJQL3JhSzFFdVRmT0NFR1FLQndRQ2FMSjZuc0RrYgp4ZlErNGp5UFpsdHhlZUtHbzUwUTRLaG1EQUloVk5MWHRobzNXclRJcEoza3Q3ZDFCYmt0V2VpakRiSTRSY2dOCmU0N1BRbElHckZ3YUJZNUF5dXhvWjdiZWZKTnVqaXlSbjVkRmpRWUdIUFdaVUk5U3ZwcmRILzlPRlJyS0lUWk0KVE1Pa0lKbVhSakxMa2hOcTZaa1pCSlV2WEpKMTF4VHFQUmVROERBdzZ5VFlPVjZpNmV2ZFAyaWVzSmJ3RnUyUwpUK2hnNU56dFlueUJwUEpuTFFvbCthVkxZeklITjFXcm05c0hiM29SZjZzSlRDMjliL1A0MUhRPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: log-cache
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVnVENDQXVtZ0F3SUJBZ0lSQU5IbGQxWmd2U3g1VTVOSmVVVjBNZE13RFFZSktvWklodmNOQVFFTEJRQXcKUFRFTU1Bb0dBMVVFQmhNRFZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1SVXdFd1lEVlFRRApFd3hzYjJjdFkyRmphR1V0WTJFd0hoY05NakF3TnpFM01qRXdOREUzV2hjTk1qRXdOekUzTWpFd05ERTNXakE2Ck1Rd3dDZ1lEVlFRR0V3TlZVMEV4RmpBVUJnTlZCQW9URFVOc2IzVmtJRVp2ZFc1a2Nua3hFakFRQmdOVkJBTVQKQ1d4dlp5MWpZV05vWlRDQ0FhSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnR1BBRENDQVlvQ2dnR0JBT3BBSnZQcwpvSkNZRWJEZ0sxT1d4elV2eXd4Rk41UnpBekVWZzlyRmdPOWJ3Sy9FT3N5cmV6UitSS0lDWnRuN2RRWDVsOTZtCmZ6ci82ZWprOVA2OWRzMlhKSk9Qd2cxU29PanhoTEthYUxVM0duWjBMWnZWSjhHV3dmMWpwVWpUNEdpUzVyVWEKQVhhSjZzb1I1UmNkVENQWk8wOHNmUFR1MWxEWG9YVEJYNVdtQUlFS3NWWS84dmJVREo1cG41c0FoZnliaVBIRQpZT29ia2xHRGlWSDBsUmUyKzhKSVYxZ2lhNnhVcXRTaWRicUNPM3lPTVVWV1BWbnhFWFYzRnRFQ0ZycFRLOFhECkxUTnBJaWQwazdiSzNWdjFLcFJCWkkwNS9yN3llNExUcGx1Yk1FRmV3ZWRTcENHOFkyVXBJNGNla2Nna200ekkKeC9oMXBEekIvMDZuRzc5M3FjcWpxeHIvd1ZOUWRqbDl2dXFZNDFtNGNTUHV4U2pSMjErMGw4WUlZa1A4aDJBbwpaVW83MEI1RWdPREwzQnowNStsQkdBRjlKWHBYbVNiNDVaTjV1MWtyVStLR1NRVkJUUXlJNnpRM0p4djFEdVpPCmpQN1BHSmtiUEtURlQzaDVIQ282OUlwRmVyZ3MwWFdZMmFOc2JPbUNOTXB1MmgveitPNWZleFRBaXdJREFRQUIKbzM4d2ZUQU9CZ05WSFE4QkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUdDQ3NHQVFVRgpCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdIUVlEVlIwT0JCWUVGSk9wMjdtWGdNZUhnbEpKaVJ5OWxlRmpDR051Ck1COEdBMVVkSXdRWU1CYUFGTVVCSnBRa0JjSnlOMmZLK2c1dG4wOEVDM1F0TUEwR0NTcUdTSWIzRFFFQkN3VUEKQTRJQmdRQ0tZeVlVVjZ1VFhqOWJJYy96R21xWE9JeTNzWlR4cHdORHdoQnA3UHRVeFBKVzNyK0ZJN2tPUmJjTwpxL0t1RUVHcVhpWXpTcDVzb2U5VkE5eWFsU3Vyd3hMVzhqaDNKTnVreVBYc1lyYVdSNnh1V0xDMlczL1JzcVVjCkNRMmNZb2FkSEZGeE9QdWtWQ2lhYnUvZjJwanpXSytuMFk0VW8yMmVEb2k4MlRhR0N2TENSRFlRaVMxWExYUTAKREVLZVBjN1c2bVZFci9SZm9lRW9pMkZjTlgreVozZUUwL1dvd0pzVzE3L0ZpYU9JdVlqaVdHR3pPTGpIQS9OegpMOFEyazdQK0wxQ3B0QkJhZVVwZ29nVlQvd000VTBDSTVuTWcwbEprY0I3VkJQcWU2RXVlbFE3dnh3NEg4MUNGCjV0NFlEa3NYWkxvaWV0Uk5aR2RUOWk2R1ZTQnpzai9xTHo1aUNJRm5BdXp1WDlCNG1YVmhpTkJ0OTVRdkFuZHcKajREQ2IwWlh0NTY1VTZ3MmJCVUdmMytpWk41SXgzd1dMWkZDY1R0QW9KWk1ON3RGTXVGV3I3cktoZnA0NllEZQplaUtjcXBkMHpUNTVRNlJQcVp0U1NlUlQyWDdsbEczQzQwNTBzWTRzNk9Sd2NyTjdrempvSmM3UlV0azI5Ym4zCnYwNzRIeFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNUFJQkFBS0NBWUVBNmtBbTgreWdrSmdSc09BclU1YkhOUy9MREVVM2xITURNUldEMnNXQTcxdkFyOFE2CnpLdDdOSDVFb2dKbTJmdDFCZm1YM3FaL092L3A2T1QwL3IxMnpaY2trNC9DRFZLZzZQR0VzcHBvdFRjYWRuUXQKbTlVbndaYkIvV09sU05QZ2FKTG10Um9CZG9ucXloSGxGeDFNSTlrN1R5eDg5TzdXVU5laGRNRmZsYVlBZ1FxeApWai95OXRRTW5tbWZtd0NGL0p1SThjUmc2aHVTVVlPSlVmU1ZGN2I3d2toWFdDSnJyRlNxMUtKMXVvSTdmSTR4ClJWWTlXZkVSZFhjVzBRSVd1bE1yeGNNdE0ya2lKM1NUdHNyZFcvVXFsRUZralRuK3Z2SjdndE9tVzVzd1FWN0IKNTFLa0lieGpaU2tqaHg2UnlDU2JqTWpIK0hXa1BNSC9UcWNidjNlcHlxT3JHdi9CVTFCMk9YMis2cGpqV2JoeApJKzdGS05IYlg3U1h4Z2hpUS95SFlDaGxTanZRSGtTQTRNdmNIUFRuNlVFWUFYMGxlbGVaSnZqbGszbTdXU3RUCjRvWkpCVUZORElqck5EY25HL1VPNWs2TS9zOFltUnM4cE1WUGVIa2NLanIwaWtWNnVDelJkWmpabzJ4czZZSTAKeW03YUgvUDQ3bDk3Rk1DTEFnTUJBQUVDZ2dHQkFOcXNkbkNBdGNjbFhtWnFiYWZEZWtWSlQxZ3VDVnQ0SGtPawozUWpPRkxYZFJqd09pQUZtRjBhQ2xSbFQrcVdFMnRKd0ZIalJuclg2RG1iTnpYTThkUG9wSFFqdlMyeGFkVUhmCnJFdDZYMExEcE4xdFNPSlBFcVRpVWtkenpPajJlV2ZGc3I3ZS92eWtkTnliNWVzMCswMy96U0QwMjlWZVhBenQKcnBncXFFc3Z3d3F6YTZhalhmRlRORkJ4TTRCajliQkJsWTUwRHpDYituUkR3VjRUWDFiYkI1eHZJYkp4dDJnUgpSY1Bud05VU0crd0RaVFZmOHpmU0ZjVTlIYnlSSDlNako3VkxIMEpVcUlONGozSVBvSTU0aWZIMzRTVjA5UlpGCm5kbTZNWXZROWxHcTJGcjBZVHdNTlNOcHk5cXM0UEJ3WFcrdWRkWks0dTBpK3FZZkJ6c3NmTmFqR1dSQUV5aHcKZ0FtVEZoU1NyM0lueWFsKzBIYVNaOXk1emxIWVFaY3BvTEczelhDYzZUQ3RqUkVOS2VIckhySUNlZTZlWExhawpiOWtpdEFRV3A4eXNRZlNwVTFqQVoyRUlqbkNxdVpHQkZlTjdHNCtRTWVsWUpoeC84ZFpPd3RCNlNqK2UwZ2RVCm8vK2ZiWXBCaGZETTNZSjIvcERMZkF6aEJ6WkNHUUtCd1FEeHNaYWM4SFJnLzdGdk4zbFhWVGtJQmZUeTR2aDIKVitJRW5rcjd3SFpJcElMYVhJbnBBNE1heXZPejllN0N6NGJZR2d3alpEeDBGM1JpM3NLaXFRQVFPWUxScjQwTQoyVjYwZ2R4SEVXYnFZL1hGN052QzVKSFZsNnhKVC9JVFA0ZHN5dUxNbmN5d2M5dW9LMnFWcU4rSElqVHdyYTBZCk85WHZuN1labTlRT0s1V0RzR0xuME1La29BREhYM05MVXBXdFdrNmFDKzFhRm03cEFZVmxUZjRmL3JTQkp0a0wKMVlhbUY1dTI0anhFSkJqNlBDWGFwV3Y2UDIvQ1FrNzNrSzBDZ2NFQStCM0hEWWwrLzlqT1F5bHZ2Y1NvaUdjWgpzNFdNNjBzaGprU1c1Z2xZUnpWWjh3eDRjNDNaVE1BVWZFaXBycTlITkhGc05URTRlMlhMRnZPY2t4ei9DR2JoCkhldFJRVENYOC8yOHNzMXNuRkVVdE9zV3hPcVRIQXd1dXpMazRHV1R2c09ra2htUXRoZHZYMmNVL0VXQ01zWHAKdnF1NnZ1aEc1WlFqSGloWUJXV0g2blgyb1BCbVpUdm5keEh5RnlCRlRzWmZVUjloenFBWUVCZGY4d2w1aUMyawpES0ZUT2hOblEzWHRnZ0lDWStCMDVmb0ZoQitLc2Nab2djMTVuT1VYQW9IQkFOeXRKelY0SHVxSnk3b2VUbjQ4CjQrdTlkSjlvT1Mva29ndFJkR2xVbXl0TWVlVmlaTkVLVWVSZXRoRDBWZUl0bFpNdWhUS3pUTGM2eXh1VEJPZDcKb3dFdFlaS08xUnlNUS9wUUw0MzhCNW12VnpJMlI1azFGU3FPWjlJd1dualVvcFBrMHh1OFlLNGp1c1ZianQvQwo1d1Q5YUpUd0hvRm44TGZ2ZlZiNGZxL0pmNlJUb3ByQ2MxWFllWjJRT3piazJxRURPWTFSb28rRXVCT3JQZDczClRUWnRXdVlwVURlTDZIc3lSd3krbUFRbmFWN2hHRGNBbnd4SWE0UlZBc0RycVFLQndDYnJSTlh5dzJFT2VRdy8KNjY4d3NkN3pqU3lEdmw4S0lmRlhBUFNFY3J4NHVldE9BWGJld1Q4d3dnWGN3QUVPclhTa2RmekNBOElYYll2awpHcU5ZNFFoSVd2ZCtlZmhuenU0TzF4S1U5bnh1bTNqbGgyVE1CdGRYY2QwYlZwdDhVM2lRNTdlakd2ZjFKUnNwCjZEaktEbW80Y1RuZlppT2IrOEwzUWFyeFdSMC9sOXBITnJCNEJSZk1GYnF2cmZIQ3RoeHRNWFpnSGM5emZWTEkKMTl3Zm1GaXNFQmVMRnFyOWNDMDh5a3lpVkEybW42K1RVRm94T0dnNlh4bzlTTjQ3Y1FLQndIOGc5eEt2akJWbgpxY3VEbmxBUXFjNEpOdnMxdUtPeDQ4VThYMFE4S0g1bCt6eDFVM2dkbFUxMHBXQlNDVGJ4Wk1DSlVIVWRIQWYvCldJSmM0R2VDZ21zUndDcnpxSGdiK1JzSlNHcFhBMHV0b1B3Y2hpRmkrY2Q5VWcxSXhLUHhUWUlHNzFndlVoRlEKRzg0amo2cXFDWEdKWkZ2VDhSMzNZL0pCYlRPY055eCs3RUJCL2VjdDJYRG9pODhjaHZLV2VVR0lwOG5UK0FEbwpDcy9qZklrTWt6ZnJuQk0vYk1WT1RiVFhaR1NuekU1N3R2L25rY0lrSUFuY21LdElSd1o4aHc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: log-cache-metrics
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVpVENDQXZHZ0F3SUJBZ0lSQUwzSWpmVlhvbDVQS2QxN3ZDWTN2Tm93RFFZSktvWklodmNOQVFFTEJRQXcKUFRFTU1Bb0dBMVVFQmhNRFZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1SVXdFd1lEVlFRRApFd3hzYjJjdFkyRmphR1V0WTJFd0hoY05NakF3TnpFM01qRXdOREU0V2hjTk1qRXdOekUzTWpFd05ERTRXakJDCk1Rd3dDZ1lEVlFRR0V3TlZVMEV4RmpBVUJnTlZCQW9URFVOc2IzVmtJRVp2ZFc1a2Nua3hHakFZQmdOVkJBTVQKRVd4dlp5MWpZV05vWlMxdFpYUnlhV056TUlJQm9qQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FZOEFNSUlCaWdLQwpBWUVBdm5kdXpsaWRtalJNeFFxQ0h6dXdEeG8rUnFjbkFnUDhBYXZZY0M2N2M1MTlBc3JSQnhJc3NXR2pBTkQvCkVobWJRL2gzeWMwQmR3WWZnemZTQUptSjlZeWdQbjY3MGF1Q3VKbmM2UUtvKzVINEJPR1pLdUgzYk1iY1dPZTUKZXpmbW9rZDBLOUd6S0dUZVM1b0ZUWXk4N1NVaGVqSFJnblJ5OS9KV3lkSkxUczNKL1czVGRVbUpCQmZRS2l0RgpXbGl2WEM3Mk9Ib2F4S0UyVHNTVU44V09ja2JNTms0WTE3VDVzZDJFaDZCV3dYZGE2RjlnekpFTmlMcjh0VDAvClBldEFDamRGOHpvZGFFQU9KQ3ViKzRqYzlEQlg2dHdmUVdoNVpyL29xRHlKNFpFRFlGemdHZ3MxWHVIaXZXVEwKUkZZWUI5T09YLzBoNUhndTZrSlNWNTBKWWVCNzFrRk8xRWFGNEVFcnhHM1ZJMStjRm9pblhUOENIeXpPN0NBdAptV3lFd0dnNDBEaXZQdmVJMUxhRXJNTWxJOGlQS0VaQWpwK1ZCSDJLTzdTR09rVklXYmhQcXB0RXNLcndtTllCCjNwWGdjNWhuRWxZa01WdmZxVy90QitSRk8wYzltWnVBcmlnUWtYZlZxL2R2OEdhbDlTUU5pMmVLZFJkQ0lYWHgKUkhPVkFnTUJBQUdqZnpCOU1BNEdBMVVkRHdFQi93UUVBd0lGb0RBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjRApBZ1lJS3dZQkJRVUhBd0V3REFZRFZSMFRBUUgvQkFJd0FEQWRCZ05WSFE0RUZnUVV2Z0pjdjdJWFBwZlJtclRSClNuTDFJN0hKcS80d0h3WURWUjBqQkJnd0ZvQVV4UUVtbENRRnduSTNaOHI2RG0yZlR3UUxkQzB3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dHQkFHcmkxSlBNU1ByMU9EZ1k4N3E3SG50Z2ZsMDNyQkxHMDVnTTdpVkx0QjZDVFNqVgpnK3MxbFcwZUg4YkNpWkh4OFVjUyttN24xYlNVVEpENWZKUCtKQXhBcW1INXREOU1VZ1FDYjVsWWhiTEpEcHE2CndOdURnWHBYQ1hqcGpod29vWVZWb0FGVzg4YTkvUE5XWkFydGljamFuODJXZ003blJkQTlPdDA5Q2tLWXUwcTQKbEd4YUpGdVFhWmdhN0VUNngrcjJudXNHc0tsb3dteXhJZ0JraXIxMGJsQk94aGs0dHUyaHhnQW1XbjgvZE1rego1LytlVjVXd1VVdWdGSjNESXpJY2F6c3FmaXFkWS94Q0djUC8yOWR4czU2S0pTNjZDeFVCa2lZOXgvTmFWRFR0CmN2ajA1Y3VublpjZGErbHdnMkpLQXg4YjVVNzdiWmNCU3JPVzEwM3VoTTZxdUZEZCtTSzlaeXhsTG1CaStJMWgKRUkwQ0NxbC9UZWFNcVVJNVZBN1JteHhJQ3I2RFUwQlljdzByVjkxZS82TXNuNXQxM0tDLzJiQm5DWnF4QjNDNgpwdTJmeHlYMHhkcmFsM3U5ZmRkaWljNlBwM0ZNTk1QU2VDZmV6Z0g1Z3Fqa1d5RnFwNjZtWXowOXdaV2FzUDE4CmRzL2phTFNtUmlVMzZpYzZXZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNUFJQkFBS0NBWUVBdm5kdXpsaWRtalJNeFFxQ0h6dXdEeG8rUnFjbkFnUDhBYXZZY0M2N2M1MTlBc3JSCkJ4SXNzV0dqQU5EL0VobWJRL2gzeWMwQmR3WWZnemZTQUptSjlZeWdQbjY3MGF1Q3VKbmM2UUtvKzVINEJPR1oKS3VIM2JNYmNXT2U1ZXpmbW9rZDBLOUd6S0dUZVM1b0ZUWXk4N1NVaGVqSFJnblJ5OS9KV3lkSkxUczNKL1czVApkVW1KQkJmUUtpdEZXbGl2WEM3Mk9Ib2F4S0UyVHNTVU44V09ja2JNTms0WTE3VDVzZDJFaDZCV3dYZGE2RjlnCnpKRU5pTHI4dFQwL1BldEFDamRGOHpvZGFFQU9KQ3ViKzRqYzlEQlg2dHdmUVdoNVpyL29xRHlKNFpFRFlGemcKR2dzMVh1SGl2V1RMUkZZWUI5T09YLzBoNUhndTZrSlNWNTBKWWVCNzFrRk8xRWFGNEVFcnhHM1ZJMStjRm9pbgpYVDhDSHl6TzdDQXRtV3lFd0dnNDBEaXZQdmVJMUxhRXJNTWxJOGlQS0VaQWpwK1ZCSDJLTzdTR09rVklXYmhQCnFwdEVzS3J3bU5ZQjNwWGdjNWhuRWxZa01WdmZxVy90QitSRk8wYzltWnVBcmlnUWtYZlZxL2R2OEdhbDlTUU4KaTJlS2RSZENJWFh4UkhPVkFnTUJBQUVDZ2dHQUVoT3J4SkhNZzNJclJ4ZzBPVnFrM3dvU2x3b09QYmE3R0QyRApFVUtlTDk3bW1uazlWWHA0RzIyMDFzTC9NbXlUdStPOUdyNEdRWkduTkFEOFFXcFJHYWo3SEhOU3lCZUxGSklsCjBVZWJXaVVFY1JJb1ExV204Zi85c2NKc2JERm1Ca2paMGI3WlRpQWtxUEE1U0o3dTMyTUN4bUlzREVHWkY4YzgKVFhOVUNtcWxuUlByV2RwYzByS2Y0eUN3T0Y3cVpjbGZQUVQ1dldlL2k4SkVmdmFWQ211RnZqR3pVZVd2UFI1VgpFYm82QWFxZVNpZWpQRWNZRGI0UmRmSVdLbjVGTDJFVWx3ZTdIQzZyZzhpNTdTOWVIY2pBelZDOStJRGFrVk9XCkI0WWZtazBXVkkvbHkyWHdWc3pqTVVlakx6VDQzNHMrSEJCWGdxakw3TTRrY0RCUUJRWExGR2Fuc3Byc1pKOWgKbzlSSVF2bnRVczlZeFdWSU9qdm1vSkRNZVpZcGFxeDJEbFp3WGxpcnN0ajhtN1ZmcjA0UGVhdlEzSy9lL1poTApGSitNY1JVdmttVmt2S0hKUkZ4a0U5eDVMZC9PakthMFhIQ0JFNnlwRlJaalh2TmkxQlM4ZG5uV0Q2UnpjWWgzCkR3dG9odGU4V0pQNklwelVwMUwydUJ6Z2wvVVJBb0hCQVAyNUhYVkJwMk82U0J5NGtpNWlNM1NwTXRuZTFhWVIKMS9JeUpsRFlmTlhzWkxVQmxLSVJUY0l1ZTFRdzZoK1FSNW1xQ3hldVZqWlBxb2JjRVBkdTE1Ykd6Nlpsc2x5aworTjRicXI4QkpNbklJekw4cDRVSVBzR3V0VHM0N3k0ZUx1YWVjSGVJWk56L3hEK1RBUVZrNlBFY2VPazdwekUyCnh5Rmx3R0FEdEFsUUdxY2xrOFhhYVUvWWFSR3N4eFFUWS9VZndkdUtwMlB3dXNKYWVXWlhiM1QvNXFQbmpsdDgKd3cxbFpMUUVsalVhckt6UnZOTm5jb1JINkhUcmwyRlVxd0tCd1FEQUxQOHFVeit4ZWNTY2JnZHErbWZEWnU5NQo5YjV4Wi9TQStoekNqdzR1TDk3NHprWTZ2cVlQRVgyTC9OKzFwQS9LcmZqYll1WGx5bWdycTFsUTFzUnNoeVhDCkpJblA3ZnNBQS8ydHd4Mng2SFU4bFpDd1NmVkVvTTFJalNYMHFla3BFQXkzcU85NWQ1bjJrbFV6RHI1a2U3eGUKZzlQSnRMWkkzU2NBUzRlV2Q3UU5rdThzd2U1akR4aGtac0l2WXpCcWY5anhjeTdzeXBrNWE3TDFaZWk2bTV1awpuRGU4YkVsN3JmNFRxMnNzRHNQRHgrb01LMEhBR0Z5czR1U2kyTDhDZ2NFQTl4ZGdhT0VYY3pmbklwRmRTMjYzClRkVzVnQlJUWFBmanBpclF4Y3NQU0FaL3pRZE5DTWh4UWJxaXdNc2lOcnI3LzlwcUV4WGxQOTgxNDBCT0Jhb2MKcXVuVEwrbTZXaDhQZnI3UytsRFMwdS9sMTdIV011aGt0WnEvUkgyZDhQdlVFU1FidzAxQmJUaG9sc0ZETFUybwp6YWM4MldjTzNBN012dW1vLzlpYmJMWm1Qb0dKK0JWTW1rWFhqUzhHY2Jhd2tmZnJnekwwOFk5dlVmZHFZeENqCnF2M01UN01pSUZiUVhpdHdkeUJBYUZjaDh1d1BTSkptSkEwamhUb3FvczhoQW9IQWM1QWJlV1pLWFAwdW9Dc0MKUnZDQnlWMXpFTklZVGJZSHNDKzNiNy82OVFkUWZDbit6WUNyOTArN1FaMDFJZE9nczI3ZXdYNjlaT3ZNck1ZRApsYnN3cjFxdCtBdGszQ2J0MDFxVENCVFhISTcvUVFsbjByc0d4TmcxMmpVVzZBUHM5QVowdjFUVmZTUFE4QmViCktITHJSeDJwYnVTelRRNWd0M3hWNGJXSnVaQU9ORU54bEdhaVpldEQ3Y3hsWlgydU5iemZ4b0pQYTVHQmhxZ2YKRzdiR3RzQ3dYZEtiS2JHc2xyVlFucDlzZVRmL3ZSSFF5clNRZTJXckJVUUQzWEdkQW9IQkFORlYxM2FwRWhGLwo3S3J5WWlwN1o0VnpxdlpLN3UwSEJYSmNWaFUwK1VpMUl0ZmVNbEFUWldjQVd0WXdDUFd1UWFJRUtqaC8vTmpkCm13MVZTdnBFWThCT2JZYWNYSlZRcGh6RFFJNW9YUTI4TkhiVFUvVUZJZ0NHT1VXTEU1anByN0UwVlQxNmMwbGkKV0FNOXpFODJDRGFoeWxzZkxmblRxejdQV241SnFCcXE0cHp1UVEvQU1sODA5eUQ1UTcxcVRxT2p4OWhCSXZ2awpBSUxQcGVzYXVnUW1Yem9MQWQrQ2JuM2I3dHBna0xZZWVTNjd5WXVyUkNnU0c4bm00a3RrN1E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: log-cache-gateway
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVvRENDQXdpZ0F3SUJBZ0lRVkZqb3k0UDBkSGdPeFNKSG5yRW9wakFOQmdrcWhraUc5dzBCQVFzRkFEQTkKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEZUQVRCZ05WQkFNVApER3h2WnkxallXTm9aUzFqWVRBZUZ3MHlNREEzTVRjeU1UQTBNakJhRncweU1UQTNNVGN5TVRBME1qQmFNRUl4CkREQUtCZ05WQkFZVEExVlRRVEVXTUJRR0ExVUVDaE1OUTJ4dmRXUWdSbTkxYm1SeWVURWFNQmdHQTFVRUF4TVIKYkc5bkxXTmhZMmhsTFdkaGRHVjNZWGt3Z2dHaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQmp3QXdnZ0dLQW9JQgpnUUM1ZG9OS3Y2YUtJVHl3RGtQZTE5MUtUNDhrbXlSaHRGU2lTZllINXdZUS9zejdNN3hoYUZKLzNpT0pXWDVsClhLWVE3TCtZZU5uaHRSbHBwYjR2Sk1wQjV0ZXAxUkNPbk8rbEN0Mzg3bkV2UFRTbGtaRlpFZDhGSHArUFd0VEkKRzBzMUxTNVdmWFBnMStCNk11dnc4TlU5Wkd1WmVSMXhNOXpMZHNHMEszNWlPN2tkdHRIcGFoRkVFUG9CVVhkNgoyQ243S3RIU2tOOUViR0VWZWdTOVYxTDZ3RlkxQXJqQTBDN2NRbnpBRjJIT1FLbC95WmJSWExLa2xoTmhVVkoyCkxxSXlYRTlxcFJ3eXVhZnVkTU9CeitDZmR1ajRXSGhmeGpjRmJvTTM5dTJ5dzgyZDZDSlhkWDFGZXRhbGtMZU8KMlB1TUdRcVp3cUZOZ0JkODB5bnBoaDRTbHRkdUdrVFVFdm44ekE1QldXNXU2ejh3N2dIK0w1dXF0MjI0T2RERAp3R2JhSS9rL0x2NnFzWGJWNGxRdzB2RlJFL05WZ2l0endlVmZFWmtqQjJUMGZ2UENLNVZDU3hlRHpZRDJqSTNHCmtERnJCREhkeG5COVRqSHpFM3dpNzdiMkFkZ1grMkRzeUg3b1ovRGJpaDlKeUhEd2lDdktKNnJoQVc4UCtYQngKVmQ4Q0F3RUFBYU9CbGpDQmt6QU9CZ05WSFE4QkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSApBd0lHQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdIUVlEVlIwT0JCWUVGQktZdVM5OVo0aEJaMzRmCnBYWDhTcmtQUWttcU1COEdBMVVkSXdRWU1CYUFGTVVCSnBRa0JjSnlOMmZLK2c1dG4wOEVDM1F0TUJRR0ExVWQKRVFRTk1BdUNDV3h2WTJGc2FHOXpkREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBWUVBdmNmZGxjd0NOQnRUYjlVKwpWa3phRjkrbXVRS0hydTVIVlFvS1NCOWwrcmk1MEtjRVFqaDVqaHJKYWpKZlFsN0Q0Ni9IMERZdE15UlY1RUl1Cks4SWJVcWZiTmE4TnNTbWxpSEpMK0d3aUtXK0hSdTc4VHJiY2h1TFFLUlovTzhUUmpQVEVQZmh4b2lvWkNBWG4KUFR5TVlLbmZhanFJajA2RWN3T0VFTHZsRmJlcEZNN0RaUHFrSFFOalByb2JLUUxQbktPVzFlUnZEa1lWdkFrZgpNTnRyQ1dmUVgvdEVaVDFyQ1Bvcmh3Mm91L29rQ1JScmkyOGtFWnhYNE5DYUx4Vk9Vb05CUncvSkNrTWZaWldJCjVFdmIzZDc0cHZ6bHNZeThBZ0lOeWtncGlNYmJNSkdZbEM4ZWQ4a0lHRXdHb0Rid0w2NGdZSlZ1d3A3ZmtQVkwKbWFpdEk3OU9MUW9KUWtCK3ROb1VoZXVaQzBQNEVmVDNtdm8zcXZGZUNOZ28rU2RQUXIyQWc4VVVkUWpYbmRXbAp4eGhMY0M2aFJETm1URmY1ZVZSL25nYVFWUkdxUlRpWGpuc2pWbkdxVXZVdDc4cURhNFZ1RW1FNEMvV0YxZkhYCkcvZVVpVXhPWDVPUDlML3RicUxaREtPNFd1NUQ4cndxSGwyblp4Y21OTWdDTWhFLwotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCgo=
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNUFJQkFBS0NBWUVBdVhhRFNyK21paUU4c0E1RDN0ZmRTaytQSkpza1liUlVva24yQitjR0VQN00rek84CllXaFNmOTRqaVZsK1pWeW1FT3kvbUhqWjRiVVphYVcrTHlUS1FlYlhxZFVRanB6dnBRcmQvTzV4THowMHBaR1IKV1JIZkJSNmZqMXJVeUJ0TE5TMHVWbjF6NE5mZ2VqTHI4UERWUFdScm1Ya2RjVFBjeTNiQnRDdCtZanU1SGJiUgo2V29SUkJENkFWRjNldGdwK3lyUjBwRGZSR3hoRlhvRXZWZFMrc0JXTlFLNHdOQXUzRUo4d0JkaHprQ3BmOG1XCjBWeXlwSllUWVZGU2RpNmlNbHhQYXFVY01ybW43blREZ2MvZ24zYm8rRmg0WDhZM0JXNkROL2J0c3NQTm5lZ2kKVjNWOVJYcldwWkMzanRqN2pCa0ttY0toVFlBWGZOTXA2WVllRXBiWGJocEUxQkw1L013T1FWbHVidXMvTU80QgovaSticXJkdHVEblF3OEJtMmlQNVB5NytxckYyMWVKVU1OTHhVUlB6VllJcmM4SGxYeEdaSXdkazlIN3p3aXVWClFrc1hnODJBOW95TnhwQXhhd1F4M2Nad2ZVNHg4eE44SXUrMjlnSFlGL3RnN01oKzZHZncyNG9mU2NodzhJZ3IKeWllcTRRRnZEL2x3Y1ZYZkFnTUJBQUVDZ2dHQWJGdFRwZzZITE5qeWJpSkhnU0U1eHpyb2RRaTNudVlQTktwbAp0b1JCeFJnNWh1TFpRMGdDTzNiNzZEbURZWkZaN1RXRlUzMzRQcWppYWhsT0hwa3VHb2JXcGdFNEpUcUh3VE95Ck14N1V2amJTVlpIUkMrc25GQVNxVU1WTzRJTWgwN1hNQnZoUkJhTGJJa295RTVtQjNOYVpEeGYySGJlaFhyYkoKd1l4UDBQRDMzT1o5aWhSUWRpWTlDeHdmNUlQN015WDNaVUVEVVNUSkxCVVlROCtMU2JtcUpGcXN1dXBuRm9VNgpBYmtuaWF1NTNGRlpib1RzVXNEa0hjMjNraGozNTJwSTNyb3RCdXEzMWQzNjVQMm5CNzJ3bTRzVVRYMFVhcU5mClY4bzJsa05LL1crTTVaVWhFbzNWcGdKbi9XQklIWmZEZy9hY1dZQmV1RTd2NW1OL2hKdit3NnI4clp5RmhoS2oKanBVZVNHbzJvZXRDd2J4NWZiaW5GOE1RNDJVMzh1bHVuT2J3MXZ5aG5TQlFFS2RmeHE3ZkNSK3dYVFN2dytuWgp5eXFOUWFxUXM2dnoyd1lSRjlqbjMwWldYUGVrRklMNm83UEJyK25CdEhqYXdiSVJ6Qko4bUdjUDVMakRvZXpnCnordnpoWXNic1hZV1o4eHJaUVFKSFNmbjVwc0JBb0hCQU93TW9VSy80Smt6NmlCUFM5WU5rOStOc0ZmRHNSWUYKQkd0NTFnWGpKVk9qeGVXOWZ6dVBMMUhRSnVGRCs1SjdIRGRHenUrVlh3c25QNkYremFTWnNNQ09takZiN2dreQp3Y0lLVEluMW0xN0Z2TGtqWlI2anhPc2Ezb3hkSTkzb1E4d0JabTBhbFd6ZkQzWCtUZlMvTUs0Um10TGFHODgvCmdtdWFzM09tbG1LMk1waW5tWUNFUktqWExPSi8zQ3NsUjBibFYwa1BoWEhHcU55RVRkWENqRzFkZHdzcjQ2VmcKellidVhtNTN4ejZEeWtaOWxydkMwRyt2VExtcVc0eURRUUtCd1FESkkxbjJGRC9IR0R4dVJlQU9pNFFjdnRnYQpRSFU4Wm9uaFJLT1pzbkt5UWVSaS9GREpIWnJ2T0tiam1qV240Z09wdEliNXc1RTdOeFFOSkNRU241dUxvL1RECjU5c01IeFhqSGpsYmpJeDJ4VURyVmlRc2xkd0FrZXhoMndvcGMxaU41RTRUSml1Y3NudFFOTTdOZ3NZNXlJNHYKSlZFUVplWUFuK3hnb1ZsV3YrWnArZEZFeXQvZDB1SFJCQ05xOGdjcmZwMGlPVktMTVRLSU1BOW95SWpiT1ROeQpZajI1bUMwVHdXbXcwaFZqeU1FcHVvT0cyb0NhTnhHdWRoZk9NUjhDZ2NFQXRWN3UrWTdkVUZvblp6UUduUzVKCmxOZ1Z5eG0rRTZFL1NDV1JZV3lxM1oxVkRiV1E4WDZQYVZsNnhsT3FGVjhxeXY1Sk9xV1hKY2EraWFRWTlvUncKMzBPekRvSUlZR0R6cDlpcC9zY00zc0VveFVpQkJnM24zSTRFdWUxSEJkYlZZUWNpWUdxd3JicW04bzYzNzNxSQpPUGVsOHFWTUFPNVhrNzZHYkRKd0V1RFQ5NSt2dnFQaTdhaUlBSEVtQnJEYUY0dFlpZmEzSGpqNnZwV2FDTWszCmhVRHZtMUhaMU5TUWwwRElwakM2a3pwSVRlbHB6Rk5nUExDQlQ1ZXFTRWtCQW9IQkFJYml6RHU0aktUSjNnemQKazBwdHlhVTFYdHNNQ3hMOGVNNjNKemUxY2pHVStzSmZEeFl3WW15M0EwUnpjRFFyMytUNUNlT0pnV1hDcEJIRQpBT1QwWUcyZkFGQTR0cTlFVVh0RUU1Y1BoRXRLTVNVaFdaVUUwc3NYRVB6MjFiUENoTXB6SnVDMG9sNnRXd0VJCnlQOE5DajVKL3dBaStHQVUxYy9wYjYzRnhwSGtrM0xTYzhLOGdyRFI4Vm9vZWxBSUMwTGg0Q0xKYWsrcUtJY28KSTgxVFhtUVYwaWlOTlhPM1Y5Tjl5NUVtOGUwKy9qc3J0M1RDSjZoRDhmbWJmSTlzWlFLQndDS0VoNnplWWUwTwowUkdIbzVvMTlwTDVaU2syZFhBSkc4T3R6YzB0T1JDc2gzb2VSQ0VRODJaNzBqWXRpWGJUSEtTYTg5VlgwemMxClIza3lDSlFscWVxNi9VUDlhTXNrZE84cW5CMzgzS3RPM2t3UnNvbzR2TVV4eVJsOWlvUXlXWXk2NXE1d2hPekoKdzVxL1pEV2JWRXFmN0o3bmN3RU5qNGVZNDNSa2Zla3lHc0tEYjd5dzM1RVpLRzkzZWRONUxpcTl1Skl2RUo3agpkeTJEWVRnYVJ5TTVHMnZFbGtTMGZzUStXTm9hYVE4TWYvRVlJYzNpYzRkSEFXTUtNMURlUHc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: log-cache-syslog
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVpRENDQXZDZ0F3SUJBZ0lSQU9Xb0ZwZU0wMlhUNFVJTmtxWUVyRFl3RFFZSktvWklodmNOQVFFTEJRQXcKUFRFTU1Bb0dBMVVFQmhNRFZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1SVXdFd1lEVlFRRApFd3hzYjJjdFkyRmphR1V0WTJFd0hoY05NakF3TnpFM01qRXdOREUzV2hjTk1qRXdOekUzTWpFd05ERTNXakJCCk1Rd3dDZ1lEVlFRR0V3TlZVMEV4RmpBVUJnTlZCQW9URFVOc2IzVmtJRVp2ZFc1a2Nua3hHVEFYQmdOVkJBTVQKRUd4dlp5MWpZV05vWlMxemVYTnNiMmN3Z2dHaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQmp3QXdnZ0dLQW9JQgpnUUN6ZEhPRU9NSWxBTzhFaUxvWVdCNVNnWXVvQ2JLakQxTUdZcnpSRkE0MlVPbkhJUnQ1ZlFEM0UxTzFySHFnCm1wVVRDZmtlUllNaDhZbXJqcWIrZG5xeFhwT3pPUWQyQWVkQkRTY0Y2K1RJdFZGR0NZZXozUUFQNVFxSm5GYTMKY1JpUnVnRE05NmtzcWlTdXd3eUJOaG1OeVRoTDZOSkJYVDg1MEE2emdRemQ3djJ4TGtVd2hxVXN6UjhRbXdvUQpMeS9jdi9aYUJkVEpBeTF3Z0k0dUlwVXpRL2I0Z3JkRFFHM205MmdhTHh0Z3QxOW9XWDBNa0xoYTltVnNhTmV4ClRNNitGTmVpbU9rUUY1c2VwaWxhcGc3NlNQc3ZnTlJvcVJmaDdZNWk1RVVtaWdFQlpXUVNGTmFrdWw5NjJOaDUKY1NsY2RjajRqQ0V2cWl0dDgvWEZXMEVNNU9jY3FFUU9DYU11RWlCZHMwb1VqWVcxQnRBUG4zWDFlaXJDVXRyMQp1clllYXE1RDhCVnFsdmN1N2o4RGRlNHVZemVvTXdFTjBzQjdSdnZoTHhZQ0lkTm9PUlpCaWUxWmR2UWNpY3QvCkFudDZVM2lJb3ltam42VWNRak10MEs0N3BuUXQxdUwzQlhRajNubnBKSitkWVRLaXJmKzVVRmg3SHZNWkxtaTgKWUYwQ0F3RUFBYU4vTUgwd0RnWURWUjBQQVFIL0JBUURBZ1dnTUIwR0ExVWRKUVFXTUJRR0NDc0dBUVVGQndNQwpCZ2dyQmdFRkJRY0RBVEFNQmdOVkhSTUJBZjhFQWpBQU1CMEdBMVVkRGdRV0JCUXBRN2VnVjFPYUhUMEVMMDI3CkhCUWp5VDZHVERBZkJnTlZIU01FR0RBV2dCVEZBU2FVSkFYQ2NqZG55dm9PYlo5UEJBdDBMVEFOQmdrcWhraUcKOXcwQkFRc0ZBQU9DQVlFQWZBTitsc3BodzE5WlNPNXg3czNGQytZczZJR2RWRElCa2VrVno4cWVkUTBFMjBMagowb0FvOENFcmdTcmd3TTJwREJtS0RoemZ2TlNYbk1QZ2NCQ2xsT0lQYlRFMlRLcE10WmNOS2VIK3hiYzJCRnJkCkR4N3JwenBYU0VtYXVTVDRqVlVlZklyVGJkL1d0RE1xUlExQ29rSVhPV0NhUVBHMTVhQkU3R0l0d3ppTURGT3gKdTl0UGVuYjdmbU9ocGszSCs0T0x2c25sVjNuYkVWTGhZaCswTlBZMTFCdUZ0aTNpckgzV3kwb3RKNkYrdDBJRQpHN2FVdEFUcnZjMEZQRTRwRWVHdGxCaU9CSGZJbm9TS0ptNU1VQlU3bTl5ajduNDQyZW5tVE10OWE3SnFGd09MCnVzSkM5K1ZxWkFlSkxNanovSnZhM1pybExVZmNlSlQwTThOdVVKS1dDQ1R0UEd2WitUbytacW9WWUF4OG1YeGEKeEJydnloVjk1dXdjVEtVemNKY3J1MWM3SkdtdHc1V0pYdDhKREtCenEzZVY5Ny9kNy9oMWw2SWhqaWxyeUc0WQpodDVQa1IzQ0VPWWVaSlAwdUZCTGRhN0VaSFJQc2ZJVUVkZEJjRkMzN0RhSFJSK1l2bktJK2lkUytjdUZNd1FNCi9vMlpka0RNck9zZHNqanYKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNUFJQkFBS0NBWUVBczNSemhEakNKUUR2QklpNkdGZ2VVb0dMcUFteW93OVRCbUs4MFJRT05sRHB4eUViCmVYMEE5eE5UdGF4Nm9KcVZFd241SGtXRElmR0pxNDZtL25aNnNWNlRzemtIZGdIblFRMG5CZXZreUxWUlJnbUgKczkwQUQrVUtpWnhXdDNFWWtib0F6UGVwTEtva3JzTU1nVFlaamNrNFMralNRVjAvT2RBT3M0RU0zZTc5c1M1RgpNSWFsTE0wZkVKc0tFQzh2M0wvMldnWFV5UU10Y0lDT0xpS1ZNMFAyK0lLM1EwQnQ1dmRvR2k4YllMZGZhRmw5CkRKQzRXdlpsYkdqWHNVek92aFRYb3BqcEVCZWJIcVlwV3FZTytrajdMNERVYUtrWDRlMk9ZdVJGSm9vQkFXVmsKRWhUV3BMcGZldGpZZVhFcFhIWEkrSXdoTDZvcmJmUDF4VnRCRE9UbkhLaEVEZ21qTGhJZ1hiTktGSTJGdFFiUQpENTkxOVhvcXdsTGE5YnEySG1xdVEvQVZhcGIzTHU0L0EzWHVMbU0zcURNQkRkTEFlMGI3NFM4V0FpSFRhRGtXClFZbnRXWGIwSEluTGZ3SjdlbE40aUtNcG81K2xIRUl6TGRDdU82WjBMZGJpOXdWMEk5NTU2U1NmbldFeW9xMy8KdVZCWWV4N3pHUzVvdkdCZEFnTUJBQUVDZ2dHQUZZdFpndm85ZEt2VUJqdFQvREE0RTdleHlJN0JmNG9MY2F6UQo5bGp1Qzk5UzhiRXIxejRHcTZNS1hibERUNXkvWVBYRmpyalJzWFdLRGFxbXFjNFhsTXZCOTdaVkN2blhoWnZLCm40OWVmQ29vZzd3SktyTFJteGJvV1BVSUJDWHp5U3NIaFpRR0gzS2R6TTFsNXUxVHpBM29VRlMzU1Zta2laQk0KODRmK3YzWTl4dFBEUXJ3bmdHVnY0Vko3dHMyemRWRW1obEJFNTQwV0czZVRtajVVb3o3NW00UTE5RUQ3OE1xcgpHTm1tODhtUURyc1BwRDZMbzRBSlZTYVJIcHdWMG5ScVkra2UxdkRBN3lLODljZDgrbmhsZVFZREtXZWtRbEtLClppbnBNTjNFK0NIdDV6ZjIvbjFBSXJXZlF6QjVxUDhvckNIaUdBeWhtbkpsaklmdVhLb0lxeTZJQkxBZnJDNnYKVk9rTWxZUWQrWnJkaERGTTN6K0VNMzYxK1FpRmV0aFpYS2pqS1ZSS3lRV2c1M2pyOXFTS3cxVFVuVm83eDdOcAphU2VHeUZISW1UTTh1YWpTRGlLQ2lUMFUydTg0TzdnZUloeDhkQVY4a1NjYll1bG9OdWgrOGMwMUFsUCtBOWV3CkgwQysrbzVDVDdPUUtZaGFyMG9vRlYzWUprT1JBb0hCQU9QaWpPRkUxK3J2dklmY05HSy9BYStTL2VkcUQrRzMKaGI4a3p1VmdmSHkyWXlFdjVKN3prZ3l2OFJnU09CV0NaZ2JFcDNRL0NMKzlwL3MrTHorYTljeWllZ1FMbFlzUgpEYWtEVEl2bjRHMSsxd2hvUlkrckJ1OHRxU1FGUERXNGVHWmpNTEpYMlRxQnZSY1prRGZpRmZLT29DRVBkRXdXCkVnZEZHbmtRbitHOEFsbVhCa1pzUzdYVVUzYTh1SU53UEwzWG01ZHh4Q0k1Z2xLcEJGNm5xRDZmVHNMRDYwSksKaEMyaVZyVytRbGhGd1pIV2toSHZ6UXdDMldPVjRtVlkyd0tCd1FESm1FelRzZkdsd1MvdlRNQ0Fpdkt0bEFYVApPN2s1SjRjanUvaFhnR3ZISk1UYnNJMFQ3bkErWEhnRW4wSUJ6MTZ1MFBaMkNDek90bkxSdDdwUzBMcUIrSmJWCmUyUFZGdVdNNjVMQ1MyM2RMUVh5ZXl0a2lEOGN6VDEwQ21xUnVhck5rd0IyMTF6SVg0bVNCcGpEdFpJNmd6UTYKd1d1ZzJPTDRRM0JLU09ROGZidmdUbENpa0xEbWd6MTd4cUQ1R0pXVVFjSE1pVXJ3V2dOV0NiNHFmM2cvWVVjdQpqUFJXVnp1MmlaT05id0w0YVBzMzlIU2xhSG9CZjQydnJTczd0U2NDZ2NCUVZ6RzF4YkNkdWxGc1VIMERoeldQCjhiR2tJV2RoKzNLaXRkWmZWY250cWR0KytzU09LVzhISEF4U29URzJtNWRlc1h3YjVwRXVFQzRseklHWjJnYm8KVXl2VE8wWklsZ1dMM1liaUdDaXVVYlo3MTA4VzNJUUFWTWU1MUVLcTZkTkF2WjJRY3BvNkh6MUw1STVNdFY5cAplVkVJOXNyWWZEdDA1cTd6bWFIVVVwVTlncG9LditsZFBITUVmSHBNbEloRm9iclFCS0xTTWhZNUVDOWpNNWFFCkpXUCtGRlpmczZldjh2akE4RWV4bVQ0cUxVeW9HRFBoRlN3UkNPbWRNMXNDZ2NFQXZEeFRjRS8xUFRxWUVhL3YKQjVlMlpkR1RadHViWmZ5OHVPY3BTanNGYUJ1ekhSZExnOUxlUjd4NzdJVHdVMVJZS28rL3NoS01GREJVSWZLVwpMZ0hzUkxQajAwNjF0eUQ4RW90Y3E4Tld3SERyM3JDWG9mVitTTnh6aDBpNm5YdHFPeTRKL3UyMUd2dnFMc211CkZ3QVJuRVVxbmJwQlR4MTFRUzluU0ZXcmw3Z25sNWhJdnFLd0syMWNHWmtzY2FzODhBUStlMGV2QzZKZy94TjEKMTZUU21RdXlOWXMwRXZLOU5RSmRIbkVMcXZ3THB3SEJjVG1Pd3B0aHB5bmc5bzE5QW9IQkFKODN5eDc2TzlDcQpObE11TmcxMkpvaTZ2NVhBbU0vSUdsVWtKN0hLNUtuU0VaU1JCczZiZkVEQ0dkWm5EamJvT09xK1NNS2tVeml3CkoyV3pqUlVlbzNXMDJnaDVXWGtKbVkrK0pObmsrQUw2Tlp5VjhYUTZzTlB0VGdVVFRDT08yaDRiazBqdGZvVUEKS05qV2RDMHNCSnZEWFJFWDdTUXRMR1Q4Um5XMmhFVHZBWW9SNUFPS1Jkbm1qVVh4R0NsWHBCRFlDWm91VlVnWgplYXk1c3FrVDNla1BuSEVQOG10SS9SWnJTc0pINm5pbXNoYUFSYnJkREZwVUhhMzRhTHMydWc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: fluentd
  namespace: cf-system
  labels:
    app: fluentd
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  selector:
    matchLabels:
      app: fluentd
  template:
    metadata:
      labels:
        app: fluentd
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      serviceAccountName: fluentd-service-account
      tolerations:
      - key: node-role.kubernetes.io/master
        effect: NoSchedule
      containers:
      - name: fluentd
        image: logcache/cf-k8s-logging@sha256:71fd09077b70fb43dfe91e4445b6528580355003255c8860f7238aaab7b5370b
        ports:
        - containerPort: 24224
        resources: {}
        volumeMounts:
        - name: fluentd-config
          mountPath: /fluentd/etc
        - name: varlog
          mountPath: /var/log
        - name: varvcapstore
          mountPath: /var/vcap/store
        - name: dockercontainers
          mountPath: /var/lib/docker/containers
        - mountPath: /ca
          name: ca
          readOnly: true
      terminationGracePeriodSeconds: 30
      volumes:
      - name: fluentd-config
        configMap:
          name: fluentd-config
      - name: varlog
        hostPath:
          path: /var/log
      - name: varvcapstore
        hostPath:
          path: /var/vcap/store
      - name: dockercontainers
        hostPath:
          path: /var/lib/docker/containers
      - name: ca
        secret:
          secretName: log-cache-ca
      priorityClassName: slightly-above-normal
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: log-cache
  namespace: cf-system
  labels:
    app: log-cache
  annotations:
    kapp.k14s.io/change-rule: upsert after upserting cf-for-k8s.cloudfoundry.org/uaa
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: log-cache
  template:
    metadata:
      labels:
        app: log-cache
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - name: cf-auth-proxy
        image: logcache/log-cache-cf-auth-proxy@sha256:df8ad4406febf47e8276be1df9cc376798faf34a5714f220cb481ada822c5e88
        ports:
        - containerPort: 8083
        env:
        - name: LOG_CACHE_GATEWAY_ADDR
          value: https://localhost:8081
        - name: CAPI_ADDR
          value: http://capi.cf-system.svc.cluster.local:80
        - name: UAA_ADDR
          value: http://uaa.cf-system.svc.cluster.local:8080
        volumeMounts:
        - mountPath: /ca
          name: ca
          readOnly: true
        - mountPath: /metrics-certs
          name: metrics-certs
          readOnly: true
      - name: syslog-server
        image: logcache/syslog-server@sha256:d859988406fc8ff1c1315cd00f5b1095d494ecb30387ab79d2fb8196d2787184
        ports:
        - containerPort: 8082
        env:
        - name: LOG_CACHE_ADDR
          value: localhost:8080
        volumeMounts:
        - mountPath: /ca
          name: ca
          readOnly: true
        - mountPath: /log-cache-certs
          name: log-cache-certs
          readOnly: true
        - mountPath: /syslog-server-certs
          name: syslog-server-certs
          readOnly: true
        - mountPath: /metrics-certs
          name: metrics-certs
          readOnly: true
      - name: log-cache
        image: logcache/log-cache@sha256:b964e0d786827994b363700fd5beacb7335d783c878fdbe623c3d3f06feda220
        volumeMounts:
        - mountPath: /ca
          name: ca
          readOnly: true
        - mountPath: /log-cache-certs
          name: log-cache-certs
          readOnly: true
        - mountPath: /metrics-certs
          name: metrics-certs
          readOnly: true
      - name: gateway
        image: logcache/log-cache-gateway@sha256:4ecda071c49886930fd5ab733c3caf97ae9b1db5ecd7da5d3e9eea13ff7082b9
        ports:
        - containerPort: 8081
        env:
        - name: LOG_CACHE_ADDR
          value: localhost:8080
        volumeMounts:
        - mountPath: /ca
          name: ca
          readOnly: true
        - mountPath: /log-cache-certs
          name: log-cache-certs
          readOnly: true
        - mountPath: /gateway-certs
          name: gateway-certs
          readOnly: true
        - mountPath: /metrics-certs
          name: metrics-certs
          readOnly: true
      volumes:
      - name: ca
        secret:
          secretName: log-cache-ca
      - name: log-cache-certs
        secret:
          secretName: log-cache
      - name: syslog-server-certs
        secret:
          secretName: log-cache-syslog
      - name: gateway-certs
        secret:
          secretName: log-cache-gateway
      - name: metrics-certs
        secret:
          secretName: log-cache-metrics
---
kind: ServiceAccount
apiVersion: v1
metadata:
  name: metric-proxy
  namespace: cf-system
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: metric-proxy
  namespace: cf-system
rules:
- apiGroups:
  - '*'
  resources:
  - pods
  - namespaces
  verbs:
  - get
  - watch
  - list
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: metric-proxy
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: metric-proxy
subjects:
- kind: ServiceAccount
  name: metric-proxy
  namespace: cf-system
---
apiVersion: v1
kind: Service
metadata:
  name: metric-proxy
  namespace: cf-system
spec:
  selector:
    app: metric-proxy
  ports:
  - protocol: TCP
    port: 8080
    name: https
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: metric-proxy-cert
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVoekNDQXUrZ0F3SUJBZ0lSQU5XS2t2UVFqZ1NEdkQ5OHFMaG5SenN3RFFZSktvWklodmNOQVFFTEJRQXcKUURFTU1Bb0dBMVVFQmhNRFZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1SZ3dGZ1lEVlFRRApFdzl0WlhSeWFXTXRjSEp2ZUhrdFkyRXdIaGNOTWpBd056RTNNakV3TkRJeVdoY05NakV3TnpFM01qRXdOREl5CldqQTlNUXd3Q2dZRFZRUUdFd05WVTBFeEZqQVVCZ05WQkFvVERVTnNiM1ZrSUVadmRXNWtjbmt4RlRBVEJnTlYKQkFNVERHMWxkSEpwWXkxd2NtOTRlVENDQWFJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dHUEFEQ0NBWW9DZ2dHQgpBTWFGeWcrV1doU0ppa0FrcllndGlNdFAwcGY1bmtJRmRDcHd0U2V4V1pQZndmVVRaS1ozclJuODgwV2pMK0t3Cm00aDNEdUhaTzRTUTZWS2ttNjljcTZ0SGdPb3VQdnJtSDlFTXB6WFdjT1NWMCtyeTlka1dUbE42QXgyaXBGZVYKTjdZdlFIQkRqMzR0RExGRjBSZlIzQTZUSnAwcVRoYmxzNHZjbnB1UnRwaDFjcGluWjFSdjBxOXhRUCs1UEZsRwpRMjhhbzE4K09sOHlYbjhLNnZTMlNXUmZjTE00QVREQ2VldHpIbUJSb1VLcVFoMXhRSXQzaE10RGRPYnI4REFGCm9NdEhVV2hSamthMDlWZ1Vhb1JVSHFxYTZDbG8ydVdCR0FQeGk3MG9VRVM5bmt2bS90WjZOb3RjUkZFV2t0bk8KaFduZjEwVThvdFhWSVBhdGtRZFZIU1VBYU1MZk00dTd3RTBuT1UwQ2RGNFNkbVQ2RWRoQ2k0bFN1ZEo4ZnJzWAowNXBqQXJ3ZWxlZkNjeXU4ZE5LM0pxVk9icEp5RXVTYXp4MXB2bDBDREoxck9CNUhYbGczTExaMXRmVFRiUlc1ClNrMDRwbk56L09PRUpRa3ZjcDNnSHpqN2gyVFNkOWxFc2RUb2FFdVBKTXhJV2YxYk9UcGc3aGNtaGJhRXF2WksKTVFJREFRQUJvMzh3ZlRBT0JnTlZIUThCQWY4RUJBTUNCYUF3SFFZRFZSMGxCQll3RkFZSUt3WUJCUVVIQXdJRwpDQ3NHQVFVRkJ3TUJNQXdHQTFVZEV3RUIvd1FDTUFBd0hRWURWUjBPQkJZRUZEWjRpeGhXbGdiZlNPQWF4ZDZKClBMWUw3RkphTUI4R0ExVWRJd1FZTUJhQUZCdnpKQ2tXVW5MUjJnNGJsZllQQXRzRFFhSkZNQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCZ1FBVGtuSDBEdW5NS3hxWnRFdEVZSXR5cmx5b2doUVlyOU1GZlNLUm1aT0VXZC9QWlIzVQpJVHhBUjZOdjNIRnhYT1Z5RkJ3bVFMbUJweTFkQkNzMENJbHQ3U2xlWUd4ZDl1ZGtJSkVVMG5NZUNZRU54OVI2CmJrRzFrcUtROHFvUTdwNDF0TFJsSDQrWEkvZ3QrUm9nUjFkRm9QamxNM3Zpc0k5UzM5NndUKzJGTXQwRUVZNTMKMkhsNUFmUitxU2tkOWdhRHE1ZzlGaURaRHJRVkpJM0tDRU9mWnZlMjE3djNFZU1NUi9XUGxmN3FYSXlKY0pzdApqQVVua0ZMU0dxZ05BMnlLdEkrbUFrRkIxaUgxc2YxNDVZZ3RuVFVDKzF3RjhsRURkRm11WXQyZmJhMGprVXhFCnRsZG8wb1VJNnZvc1dINTNqNlVmWThkc0hWKzRxNmx3ZDZhdTEraXFNR3hXL2l5QjQ3UEVvcW5zRlVXTEk3RTcKVWM0blFCdTBKWWcwQUtZUEhJNXpkSEZqYk5qZEFOV080YXpXRWQrMnU4c3g0MXNLSlBBN2FYclc3Q2JDYy9CNgpLVFBiRXZTWGtHdzhoaGVRaWovOGdzd0pjVU4vQld3VDhiUktaNVBPUWZic0VoZjRvbGhlbjh5SEFZaElDTHdlCmpmdmZxeGFtYVNQcmJVWT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNHdJQkFBS0NBWUVBeG9YS0Q1WmFGSW1LUUNTdGlDMkl5MC9TbC9tZVFnVjBLbkMxSjdGWms5L0I5Uk5rCnBuZXRHZnp6UmFNdjRyQ2JpSGNPNGRrN2hKRHBVcVNicjF5cnEwZUE2aTQrK3VZZjBReW5OZFp3NUpYVDZ2TDEKMlJaT1Uzb0RIYUtrVjVVM3RpOUFjRU9QZmkwTXNVWFJGOUhjRHBNbW5TcE9GdVd6aTl5ZW01RzJtSFZ5bUtkbgpWRy9TcjNGQS83azhXVVpEYnhxalh6NDZYekplZndycTlMWkpaRjl3c3pnQk1NSjU2M01lWUZHaFFxcENIWEZBCmkzZUV5ME4wNXV2d01BV2d5MGRSYUZHT1JyVDFXQlJxaEZRZXFwcm9LV2phNVlFWUEvR0x2U2hRUkwyZVMrYisKMW5vMmkxeEVVUmFTMmM2RmFkL1hSVHlpMWRVZzlxMlJCMVVkSlFCb3d0OHppN3ZBVFNjNVRRSjBYaEoyWlBvUgoyRUtMaVZLNTBueCt1eGZUbW1NQ3ZCNlY1OEp6Szd4MDByY21wVTV1a25JUzVKclBIV20rWFFJTW5XczRIa2RlCldEY3N0blcxOU5OdEZibEtUVGltYzNQODQ0UWxDUzl5bmVBZk9QdUhaTkozMlVTeDFPaG9TNDhrekVoWi9WczUKT21EdUZ5YUZ0b1NxOWtveEFnTUJBQUVDZ2dHQVZxdXFYOHZBWUI3OElLemlwZ1ZiSjRnZDVRT3h1Qmt4Y2lYcQpzUDJZb2hxYVR5aThWSUVETGNsbFhBMjJwajE4YWNPdzE2RkRmc2pWVktOUTVPcU1lQ2FyZlpIYkpTYTYxVVcwCjZxaEllVU9BVlo3ay9uWGlsRWM4ZlArNHlCUDVVcXltY1Z6TmxNU09PZ2JGRnFVa2NhaUV2ekR0RHNvUjdRblEKcFJLa3FVTDlXUEFkQ0p3WlcwY1NuWko5YW14bW5HY0ExR0FTaytVbHBFbGI4cUp5d0VONnJJUFM0VHJHaDZpbQpwbDU5RE9IUUk1S0NIMkY2dEZNckFuWVhVcC9ob1pyTHp1alZGczVtWDk5bHFxUXpHS0lMZCtNN0RLVzArQjFKCjNQU0RibEVkNGRCcGFTY1o0cEE1aVh0d1owd2R6djdUc1o1MDh2YUZ3b0FBZlBTK0VkWjlRYk03TENOOXNESGgKMkZjZkw2YW9pNWNKT0JwUHF1alA2dmlYaEZML0loYXRKWWI4UkUxclBEZWdmOVFsVFQrUkdCQXE2V0cvaWdMVAo3U3ZvKzdFSkdmK1Fuc0gvcXV4NFJ1c0JZRGVXc1pLYWF3YmNTM0dvNGhoQk1LNENJZWhNczZEK3UxSDRib0F5CmswR2V0aWNqSUtXZHJab3RXd2oybVVsOEkwYlJBb0hCQVBoSVJRZ2xJNHFXZzJmblVsS1E3YTc2Y0g5VW50dFEKTnNvdjRvdWFjSzN1SDVtVTNrMmxrOG1vdGhscmVZRXV6UGxXMVl2RXVLUFFrTDkzb2xjMHVYYnlOc0wxa1FGKwpDZ3I2OGl2YjdWcURoOFlzQTZvN2ZXbEYzNlZYTFVQOE5TWGJaVGFsVUNJVC9kUStUMFdzQVFFTDd5b3k0TkVNCjR6VE44ZHI0UHN2ZE1zTnArTWFyV3dHaGpxVVdaTzdwQkQzdmhHekxLUTYwcEtXU3MwY0hOYWxJYjljTTZ1TXUKcDFLSFlOSUM4UGg4Mmg4SGhlVHVDeEVVWTVoLzE4MUVxd0tCd1FETXNZMVlPUHFjVHBJcDliY0NMcFJCTU5jUApuK1MzSGhOMUV5S2JMcjRIZ1hrRUFjbU5nN0J5OGtIZEpoYnNnQW1Da1RiVTVrUURkZmtJZEVsREI3UWNZM1FICmJJcy9NLzhwOHBGRHlTaGN6TTlTQ25YVlBTSjZjd3AxT0hxZFdCSmQyK2ZhaXgyRUIyODFDYmZUZ2JUYmdxNjUKVEUyNlFTVSt1MklrZktIV1ZSdnBLQm5qc2RkamVvdHJWcG0vdTJzWFU1NkZvTWZ0dlBXMVR3NDEwakhTQit6QQpKYzFxTGc3TXZrbENuQW9aWTJuQXI5WThOL3kxb2IyWjRtc3ZsSk1DZ2NFQTdVRVNSbUJIQUU0b01BZ0swTCtSCmdaM3NGcUVrVkdyb2tIa0Z3V1hKdTB0TGd4V1JBUjN5aGNma2k1SDZRQW9hOFVHYk9yNjN1a0s1cjEyQkVsaGQKeWw1WEdpSlRlTnVhZVRlb1oyVDRBWUNqSkNvM0xscyswblJrN0xqTGxxWFJtK1YxYUt5OFVIUk9JSjJTWHYrbwp6Zms3aUZXcUk5cHUyNnpaS3VnQ0Nnbk1VcFJYbUhGeXU3SklmMVZSQ2tROU8zcEFUejRzYzlNSGF2a3V1L2NWCnZqaHNOMUl1dXYyQUF3cys2RERMV0lqbVhyUnZySDRVc1RPTW9OTzV3bnVWQW9IQUMwZ04zanJsdFErdmhwaUEKU2FKL2tVZzcwaVNoMm1YUjlMWGxSbUJCSVBERjFxNnlpUllrOTNEYXFIR2MrZFBrc2ttR21CMUl5bGdLTGFrYgpFSkt3SHBCc3FLd1cwSmp4QzBMUE5za3piRW50Y3p3WVduUlFIaWVRLy96bzVSc2hpQUxDdUl6S1I2aVJQSDhZCm5wT2JnQzJucTViRkFlcnRQcFBkU04yRm5lWjY3MUxDZW9ZbXROamdMajVMb3dHVldXZkdhTjcvcGQ2d1BCbnIKVXBRUEl1QkU4Q0lsUENEbHQrc1U1cExyQzVNckZPK2NBeDJpMCsvaUgwVVhXenY1QW9IQUtreUJzTVlSN2d5dApmY2dhL2F5dVQrOFRTNVB0VmtWWW1kY3Zsb0NzblprdG41eUpBZDREbG1vODRTMWN5ZXh4YW11dldPdnBsUDlHCm5HditmdU1VeERWZXRuMmcvMGpUN3YwOFZiTVdCUDdZRmNTNjNGVlRBY0NGZDFjWkpyTEtwTVdjek1IcTlydUcKc1lVbDFiYUFXM0lVdFlVYjM5Q01ZRzZoRTVGRVNqUllLRklhbXNVMTVzemUzM2VFbmJ1Y1FrcThFWlVlRDkyTQp2SmJsK1duL2ZueThHR0xHOVlaOW1QdWUzc21Ra1hpU2lCcE9LN21udWRmdXFucVcrTzErCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCgo=
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: metric-proxy-ca
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUViVENDQXRXZ0F3SUJBZ0lRSytiMUNQNlVqS29pUWU3ZXMxRVNPekFOQmdrcWhraUc5dzBCQVFzRkFEQkEKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEdEQVdCZ05WQkFNVApEMjFsZEhKcFl5MXdjbTk0ZVMxallUQWVGdzB5TURBM01UY3lNVEEwTWpGYUZ3MHlNVEEzTVRjeU1UQTBNakZhCk1FQXhEREFLQmdOVkJBWVRBMVZUUVRFV01CUUdBMVVFQ2hNTlEyeHZkV1FnUm05MWJtUnllVEVZTUJZR0ExVUUKQXhNUGJXVjBjbWxqTFhCeWIzaDVMV05oTUlJQm9qQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FZOEFNSUlCaWdLQwpBWUVBdFhTT0JvOHZDS20xald1bVhMczE1RFMrUTBYeW1FeFJTMVIxUGwxRDRJQVoxaUtFLzR6ZENVaUhaZjF1CkpYQXdNQkpWVVVvWE9QWVNhTUxSc0Z4V0ZKRURYTnFZZFNmQ3ZGc2Q3d2kxNWM0MHBVNW5zYTF0enlvcXoxa0IKaVBkcjZTakJrOFJDL283ZU1zOFR2Z013UE53OTZPSjc1bVNDTVFMMDNwdGI5MHJiWWZXbHZSL0I4Z2N0Rnh5YQpyUk50RlpyMUxEY0ZpMDJUUkxQMU1kRmVNWjY4dHowc1NVTTYraUZXYWtzS3d2Q1dmZUNyQ09VOWg2TG56SWNnCmlWYzJZSEJ6emdYelM0SWI2SlYrNWJibzlJbEZuS2NvRW5ENGdTQmY3WE9jTGQ3WnVpQkRoMWQ2cGhOd2EranEKd2FLV1dTQkFsTDd6cEdpaDdEME5xaEdNSFdEZFBWa3k3QzFJckU2MkoxamoyMjljNWltR3NSbHZpRGkzakFYMwoydmFhUjh4dG5aSDNGN1g5bCtZOFN2YWNkejNuQ1ZSMFVoRElpTlE2YVdBcG9YMWlZZTNJQW5ac1Q1ZnMweEhUCk5yZUUwRjlRRHBTSTBrcmh2UG5mY3NsajRmWXpSOEhxN1dNajVaeUhuNmkwNkRkMUt6M0JmRERtNEtZVll0NlkKR3g2akFnTUJBQUdqWXpCaE1BNEdBMVVkRHdFQi93UUVBd0lCQmpBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUIwRwpBMVVkRGdRV0JCUWI4eVFwRmxKeTBkb09HNVgyRHdMYkEwR2lSVEFmQmdOVkhTTUVHREFXZ0JRYjh5UXBGbEp5CjBkb09HNVgyRHdMYkEwR2lSVEFOQmdrcWhraUc5dzBCQVFzRkFBT0NBWUVBYmVGNUl6VFIySmRzNE55T1RNbk4Kb1JDbjZEazV5bjlLeUZOdDNBTGxwY2pPVW9GTFRMMUFBZGNzS1YzQ1V2ZnlJb1RISE8wRlBES3lFNXV2ZG5TdgpLN2FXSGNINmR0cnJrVnBTZjhibkxhZmpGNDdKOTVjREFrNnNiL0VMMkVyNTNtNnFmOGlsTWxITzBzVEE1YlNTCjdxZ2N4VkNUTXhEdU1oOEFKK3c3QUVlZ2ROR2daYkx2SlA3UzRJMTEyL05JTTViTmlGSTdERHJ6bmxhdGdySTIKVGpIN3FaQzkzY2JYZ3NRWWdPS1RsYTkrelEwOXZid0JCb1lJMlR4b05XUjYxUFFxSXR3TnkxYjBES0Z1VE5iWgpoRC8wZzNKNFhNcFJoSzhjZFIxcW45SHhJVjlsQVE0elJaV1VVK0svN1J2cWk5K0VFc3hRUHBoMkxDWG52WjJLCkpkRnRZQWRPbmFCSUNrMUs1cWVqZkVLMHRRWnl4NXhrWDJ4czg2cHEwZXVBVkxzYzhDVnNyV2M4Q1NJNGRSNDgKNW1TZi9IVUJFMHpJdzNMWHM1K3NvRVFFeXlSL1hNQWxCWGNYdUlkTEdBcW1VK1Z5bDhKNXVXVXVzTlF1cTNuTApkd015SHVwMXpOTW01UVBGS0dJaVg4K0t1QTNmWHBCVUNGRUptbXhseTM1VQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCgo=
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNHdJQkFBS0NBWUVBdFhTT0JvOHZDS20xald1bVhMczE1RFMrUTBYeW1FeFJTMVIxUGwxRDRJQVoxaUtFCi80emRDVWlIWmYxdUpYQXdNQkpWVVVvWE9QWVNhTUxSc0Z4V0ZKRURYTnFZZFNmQ3ZGc2Q3d2kxNWM0MHBVNW4Kc2ExdHp5b3F6MWtCaVBkcjZTakJrOFJDL283ZU1zOFR2Z013UE53OTZPSjc1bVNDTVFMMDNwdGI5MHJiWWZXbAp2Ui9COGdjdEZ4eWFyUk50RlpyMUxEY0ZpMDJUUkxQMU1kRmVNWjY4dHowc1NVTTYraUZXYWtzS3d2Q1dmZUNyCkNPVTloNkxuekljZ2lWYzJZSEJ6emdYelM0SWI2SlYrNWJibzlJbEZuS2NvRW5ENGdTQmY3WE9jTGQ3WnVpQkQKaDFkNnBoTndhK2pxd2FLV1dTQkFsTDd6cEdpaDdEME5xaEdNSFdEZFBWa3k3QzFJckU2MkoxamoyMjljNWltRwpzUmx2aURpM2pBWDMydmFhUjh4dG5aSDNGN1g5bCtZOFN2YWNkejNuQ1ZSMFVoRElpTlE2YVdBcG9YMWlZZTNJCkFuWnNUNWZzMHhIVE5yZUUwRjlRRHBTSTBrcmh2UG5mY3NsajRmWXpSOEhxN1dNajVaeUhuNmkwNkRkMUt6M0IKZkREbTRLWVZZdDZZR3g2akFnTUJBQUVDZ2dHQVdESVVyaDkrTHVtOThzVDJFWEIxR3p4L2xkY3p1TTZ2WEx2cQpXS3VnU0VnN1JwZDBxWGxnSGhrQXBwUHRxNGpDQXp1RitJTFlrcmtYN1k5enVCTEpUQ25IeHFRQklrQjNLSEhwCk5MdTVIYitDV3k2bXUvZWR2ZW15OFNGRDI3elcySGNVejZ1L0hGZDRySjExN1E5RHJQRW5ya0FYRkw2WmdSVDgKekE0YlB6RkZQSEhYWXZ0Q20wN2RuYlFyZ2lCRkR4RklSWHRnMkhxV0wvaUFIdnl5bWMrYnpqeVBmL1NMZi9RZwpPbjNLOTBGVkJFM2xFK2ZJWmxySjYrRnA4UmRQNWVGa2Y0WGNRNU5yWjFQOXRFWndhaU10YTBOYmVJUG1TbUxSCnV1aUVrUi9YbWJtOGlnRjVDbUt1cEZjd2tJVGMzMDJPcU9MNHY5RUV4S1FCbVlhdkVVa3pYQTdtbEkxMDA5Vm0KQUl1Q1p5TkR1dWU2azl6eEZiK3R1Q0w5YWNIb1lka1ZpZjVvMTEzVWdvalVpcDJyWE1MVXp2aVFyamZWNU92Mwp1d1hVT3ZmaDlBMlordXJIVmVCU0oxWGFZVWVYQ3NJQ2EzUnBIT1VKUWRLSklYdFhUNTQybXRqSmcyYVRZRTBGCm4xaGxucDZHeGU0UnI1VE5kb3BEZ3V5MnFnblJBb0hCQVBHY0V2UEIwSW1qWXVNN3piRGIxRXpUem80UzRROFUKNlNyNWFmdktKWmM0Q2krRVJwRTBWcWM4c3NjWWg0WnFkSmVJZ3dFSGx2UkoxckdyNURXUk9RZUx4YmpkMkIwNgp6RnllNXNEY2hQZjJZWWRrcGtXTzArZk5HcitZZXdkdHdWdWJpK1NWWDJLNWJTVTdhcFZjMy9FampUSFlpeTNCCnpydWlFVFVwbVgzeTdDTXIrcnJHaEtpKzN2RytRUU5temhNL2pJaExUbWRNZXpyemYrekgvWFB2MXFjeG9EemUKWGFEeVM5ZjNHL2xqWHZsL0ZyQnFtNWNvNEk1ZGFZcDdwd0tCd1FEQVEwZ0REckdTeXpPcnBtTElVOVdIem5xTwpzWXFCam5GK2ZNSmQ2ZlFqNG53MFpiVFRrRHp0SlBJRXdkRmlYTWl4U25udjFlTmthcS84dWdqVWVRMzhlNHJKCkRIR09lZzJXZU03N25qN2hvSGVWWS8yZzdNS1pVMjBvbmw3SGZDb1VMNGxYdmxGYkZVRCtsMGdMdENVa1IzQ3EKM3BaMFRTUjhlZzArbFgrSFZ0dnM4b1VYSy9UMGlIWlg4cFk5NkdsUGl6QS90Nm5jSmhtdndWU2NDY2kxNUg1WApMWHh2VzB5Tnk2SnYvMW81QVhkelRSaVlnMGFscS83VWlQTFl0S1VDZ2NBWEFET3hydTdLVzVxTFpXTVVoaWowCjAya2pqMXFMbEFNS2kwbnlwWERrcjNvUXdmZngxTmkyL1FsTCtPTFdBZ1p0Y3BwK0c1bmNVYmMxbk5hUjN1eGQKOG9sMUt2RnEvdkQ3bEVrRmJUamZYajQwcEhsTHYrZ2VkaUVvd2p4Y0hhKzlwOVl1Z2FYZUFTY0oxMWt6Tk85QQp4cENuZ1NUbXl6K0NEMUN5RGU3RjFiMXpMN21qMUVoR3hEejNLSlNKM1Z5YTZuN1hic3ZjKzZQem5jQzg2dUVQCkMzTVU0WjJPamVDOTlMTVJzVDJoaFR0Q1p6M2l0NU51Vlg3akxyTmdjcHNDZ2NCUkg5S1IzN0JUdFVRUEtIekQKOUlQRDh2N0ptT1pOZGxJelFlY3RnMXNOalRKRlZhandJQXRsTU5LaDZUbzFXOXNlMjhNSnpPRk83S2xuWlFQMgp5MEY0aUpSdDhyOHpsQktKckY0QjA2ckt2MC9XREVQbmxCOGtYUXhST0VuYnVHdDA2djN6dFExVTltbmZRdXdXCmJDUEQ1QlVKTkRTZHpETWFCdEh4MTFqaFBXZzgyYlFJcS9hRys5R2JtSE9HbWJ0ZDRlZ3c2b2xVcUFyc214SGQKYVU5MFdINXF3SG1oN3c4bFFZZy80Nm9wSlpKR1o0QjZVZUlNWTc5NTVITTd0elVDZ2NFQWxCa3V3M2s5bVU5OApEdFAyZmhtclRKYURTWVJaTU9RMC9jTTdoZEZ6ZzlSYkFWM2haRVJjRUdQdnAwcmxRdkg5WUhYSEZKY0tTcjBMCkJJZjEwVUdFb2VFWjV1WVUxWnh6MS91a2c2N0lIWkN5K0k3R0syZS9zelV5dytwaFpqSi9vK1NGMDZmZ3B6NnQKNmxWdGRJUWhTQW1UaTE3RVBWTHgrc3NrN3ZxZlhScnVyMFNzbi9QSTA4SENQN0FkS3g2RVBpcGM0akRkYTN3ZApNOWYvWG8wWkh2MjlqZ2tnUDBQTy8zQ1djUUQ0dlM3S0ZnNGJKRFd6TFh6b2QxVTcwOHNECi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCgo=
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: metric-proxy
  namespace: cf-system
  labels:
    app: metric-proxy
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: metric-proxy
  template:
    metadata:
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9090"
        prometheus.io/path: /metrics
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: metric-proxy
    spec:
      serviceAccountName: metric-proxy
      containers:
      - name: metric-proxy
        image: oratos/metric-proxy@sha256:938ac36f0f1ede38b1ed7b2451b918345709848fc807a11500fd9b1b05fd239d
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
        - containerPort: 9090
        env:
        - name: ADDR
          value: :8080
        - name: APP_SELECTOR
          value: cloudfoundry.org/guid
        - name: NAMESPACE
          value: cf-workloads
        - name: QUERY_TIMEOUT
          value: "5"
        - name: CA_PATH
          value: /ca/tls.crt
        - name: CERT_PATH
          value: /metric-proxy-certs/tls.crt
        - name: KEY_PATH
          value: /metric-proxy-certs/tls.key
        volumeMounts:
        - mountPath: /ca
          name: ca
          readOnly: true
        - mountPath: /metric-proxy-certs
          name: metric-proxy-certs
          readOnly: true
      volumes:
      - name: ca
        secret:
          secretName: metric-proxy-ca
      - name: metric-proxy-certs
        secret:
          secretName: metric-proxy-cert
---
apiVersion: v1
kind: Namespace
metadata:
  name: cf-blobstore
  labels:
    istio-injection: enabled
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: minio-update-prometheus-secret
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-blobstore-minio
  namespace: cf-blobstore
---
apiVersion: v1
data:
  accesskey: YWRtaW4=
  secretkey: ZXV1aDgyN3Y2MXo3MXgxYWZiM28=
kind: Secret
metadata:
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
type: Opaque
---
apiVersion: v1
data:
  initialize: |-
    #!/bin/sh
    set -e ; # Have script exit in the event of a failed command.
    MC_CONFIG_DIR="/etc/minio/mc/"
    MC="/usr/bin/mc --config-dir ${MC_CONFIG_DIR}"

    # connectToMinio
    # Use a check-sleep-check loop to wait for Minio service to be available
    connectToMinio() {
      SCHEME=$1
      ATTEMPTS=0 ; LIMIT=29 ; # Allow 30 attempts
      set -e ; # fail if we can't read the keys.
      ACCESS=$(cat /config/accesskey) ; SECRET=$(cat /config/secretkey) ;
      set +e ; # The connections to minio are allowed to fail.
      echo "Connecting to Minio server: $SCHEME://$MINIO_ENDPOINT:$MINIO_PORT" ;
      MC_COMMAND="${MC} config host add myminio $SCHEME://$MINIO_ENDPOINT:$MINIO_PORT $ACCESS $SECRET" ;
      $MC_COMMAND ;
      STATUS=$? ;
      until [ $STATUS = 0 ]
      do
        ATTEMPTS=`expr $ATTEMPTS + 1` ;
        echo \"Failed attempts: $ATTEMPTS\" ;
        if [ $ATTEMPTS -gt $LIMIT ]; then
          exit 1 ;
        fi ;
        sleep 2 ; # 1 second intervals between attempts
        $MC_COMMAND ;
        STATUS=$? ;
      done ;
      set -e ; # reset `e` as active
      return 0
    }

    # checkBucketExists ($bucket)
    # Check if the bucket exists, by using the exit code of `mc ls`
    checkBucketExists() {
      BUCKET=$1
      CMD=$(${MC} ls myminio/$BUCKET > /dev/null 2>&1)
      return $?
    }

    # createBucket ($bucket, $policy, $purge)
    # Ensure bucket exists, purging if asked to
    createBucket() {
      BUCKET=$1
      POLICY=$2
      PURGE=$3

      # Purge the bucket, if set & exists
      # Since PURGE is user input, check explicitly for `true`
      if [ $PURGE = true ]; then
        if checkBucketExists $BUCKET ; then
          echo "Purging bucket '$BUCKET'."
          set +e ; # don't exit if this fails
          ${MC} rm -r --force myminio/$BUCKET
          set -e ; # reset `e` as active
        else
          echo "Bucket '$BUCKET' does not exist, skipping purge."
        fi
      fi

      # Create the bucket if it does not exist
      if ! checkBucketExists $BUCKET ; then
        echo "Creating bucket '$BUCKET'"
        ${MC} mb myminio/$BUCKET
      else
        echo "Bucket '$BUCKET' already exists."
      fi

      # At this point, the bucket should exist, skip checking for existence
      # Set policy on the bucket
      echo "Setting policy of bucket '$BUCKET' to '$POLICY'."
      ${MC} policy set $POLICY myminio/$BUCKET
    }

    # Try connecting to Minio instance
    scheme=http
    connectToMinio $scheme
kind: ConfigMap
metadata:
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app: minio-update-prometheus-secret
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
rules:
- apiGroups:
  - ""
  resourceNames:
  - cf-blobstore-minio-prometheus
  resources:
  - secrets
  verbs:
  - get
  - create
  - update
  - patch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
- apiGroups:
  - monitoring.coreos.com
  resourceNames:
  - cf-blobstore-minio
  resources:
  - servicemonitors
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app: minio-update-prometheus-secret
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: cf-blobstore-minio-update-prometheus-secret
subjects:
- kind: ServiceAccount
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
spec:
  ports:
  - name: http
    port: 9000
    protocol: TCP
    targetPort: 9000
  selector:
    app: minio
    release: cf-blobstore
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: RELEASE.2020-06-14T18-32-17Z
          Type: resolved
          URL: minio/minio:RELEASE.2020-06-14T18-32-17Z
        URL: index.docker.io/minio/minio@sha256:35d654988af3b5761162d5ce06243c1517ec34beeae271c8b5983b5082968858
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
spec:
  selector:
    matchLabels:
      app: minio
      release: cf-blobstore
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 1
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/config: 6f2dbe8a0c3f59cb8d9e7051cd9370791c2df5ec3cbe0bad179295559a282d2f
        checksum/secrets: debfe7f1d286d311ff318bdae05da710f2c6b260e296564745e6e261a630dccb
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: minio
        release: cf-blobstore
      name: cf-blobstore-minio
    spec:
      containers:
      - command:
        - /bin/sh
        - -ce
        - /usr/bin/docker-entrypoint.sh minio -S /etc/minio/certs/ server /export
        env:
        - name: MINIO_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              key: accesskey
              name: cf-blobstore-minio
        - name: MINIO_SECRET_KEY
          valueFrom:
            secretKeyRef:
              key: secretkey
              name: cf-blobstore-minio
        - name: MINIO_API_READY_DEADLINE
          value: 5s
        image: index.docker.io/minio/minio@sha256:35d654988af3b5761162d5ce06243c1517ec34beeae271c8b5983b5082968858
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 1
          httpGet:
            path: /minio/health/live
            port: http
            scheme: HTTP
          initialDelaySeconds: 5
          periodSeconds: 5
          successThreshold: 1
          timeoutSeconds: 1
        name: minio
        ports:
        - containerPort: 9000
          name: http
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /minio/health/ready
            port: http
          initialDelaySeconds: 30
          periodSeconds: 5
          successThreshold: 1
          timeoutSeconds: 6
        resources: {}
        volumeMounts:
        - mountPath: /export
          name: export
      securityContext:
        fsGroup: 1000
        runAsGroup: 1000
        runAsUser: 1000
      serviceAccountName: cf-blobstore-minio
      volumes:
      - name: export
        persistentVolumeClaim:
          claimName: cf-blobstore-minio
      - name: minio-user
        secret:
          secretName: cf-blobstore-minio
---
apiVersion: v1
kind: Secret
metadata:
  name: cf-system-cert
  namespace: istio-system
  annotations:
    kapp.k14s.io/change-rule.istio-ingressgateway: upsert before upserting istio.io/ingressgateway
    kapp.k14s.io/versioned: ""
data:
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNUFJQkFBS0NBWUVBbjc2bHREa0NBZFIrVStUakdvV0RGQlJoSmp4aGZXNm9UVm5iejF0OVU4RzZKR210CnpLbVA1T1ZjZVhwYUVkTXl3MjJicFRWeDZ5MFdWOFcrSFZRcVVKbUF5UG5OL1pBV3JHZEs2anNoZnZ1OXdIOFcKZmpSNkhyMkl6VW5mdWR4bnFaVmpWeWdPNitUeWhSTU5vWmxsWFNPR2F4ZnJ3Y3dzWEw4TkVOekZOVnpBYk0xYQpNQ1EzcnNMbGdzOWd2cVpRR0xwWGpaMGR1MWJiYnp3N3pMSFRaaWFHNmI4eFZqbTg5Z3dXTldFTXlVcElNR2ZvCjdmQ2kvL0J0QnoySUVxK2Q2THF0U2xVWlhHOURMczRUZkpXcHM5NXdOU0Zsci9vZ0pmVzFuVUpjOEpYMVFxMXIKWUFWem9adGNQYWsxa3EyMGJoWEZ5Nml2MHZBZ2ZoWEc4UE03Ty8vMlBCdEdPVGkwNVB2TUlRNjlXU3poWUdXdwpCWlgrSmxFc05Fa3c0TlpISjNwSUZDZ3JzOWJHTjRZUkRpRVFIQVpsWUVTS0prV3pNa0tiTTNhbHBDZmdNNFIwCjIzYlFXcE9kS0NRVWtOd2NDL0Zva3p3eGltNmlwVFkvSmhad082ek9XMzlDOU5qdXNzcjhFZGdqRW5PRGFsd28KQzY0STl3OWR6Q3BrQ0VPdEFnTUJBQUVDZ2dHQWI3MFpoNUVBMkdyYzJxNFdOVzBDblQ4TUhZVEs1TVJNc1o2VApaTjRvTWpnbWptWGxqbTFsRzhWY0JCVVRmN2h0bjhuQnY3UTh0VFphbEpiYlB3U3FmS3FETFJHZmh5Z00xQmVFCmpZZERET0htZndubW4renhKeU9JMTZBL0FIRXRpYS9YUnhYY0tpR0JpcGdqUnRCWDJPaUtrOHF0dkdlbStGRWoKUUpKTTErRERNTmdMcC9VTmhnOEtINUFUcWdnSHF1UmRiYzlqQnJIZzJGUVh1RDBERkVjS3crSmJEbWRneC9MNApiZW91MlhZK1BLM1NmdTE5OXUwa05wWlI0bEE0VjV4TVhMRVUwNFg4UGcwNnNzbytXakZibmVSSFI0ZTBnM3pWClQyWmp1SUNTYTFuWjlHNGdjZCtGenI0c2kyak1yby9kZm4yWkNMNFVZbDM0US9GRWt0Z2tEbHZwVXovZjk1VmcKVzdqT2NKOWd4NG0xSUw5alJ3Q2JGcVhWSjlxUjQwNW9nUW1iSjluT2d1d0owU0NIRFcwckJqZXhFNUFPNnBWNgpucXVtK2l5U05ySGJLOU5CWXRFbGswQzkwUnAvdENaTjdZc21hcithVEU1aVBZNVhkc1F4WlBXbWVEMWxVYjBSCi9LdFY2SFVEcng1eHJ6L2oydHRBYjZRNmlGOEJBb0hCQU05eUNEb0JhSkg4TXJPempTUXFJNkRLWGtGbmk3Sk0KMFJsRlZmMGZKS1ZhTVlpMTlVSytWeEwvNUlyaHlhZUR0R2F4V2pZWTJqWmhMTS84T0wzd1NtVlJJQzFNNnJRMApxSXI4SjZ1SFJpTDJaamhzNjJTOTBYV2FBNCtvK2dyRGN1bGw4SmNIV010Q0Q0a0xRRDNEcjl5OC9mMURBdTdQCmxNL0phK2xsekJBb2JjU0ZGK09mNmhDQ3NGK2NiSmVCQXFmcllENy8rbHVPWG4xMTJnZ2dmMmhMNCtTUjYyOVgKRWVLSzBQK09YM1h3OC9EaUp1ZU1qR1NXTWdGNWh3bEtqUUtCd1FERkltemhFeWp6MlFEWUoyQTU1czlJbHZndwptTFVJMFdVWjdYazcrancrSHFHVmR5dFdjMDAxVmRUM3JlMWJLeDNSMHR0a29CQzU0YWFJNGllYWFqR0VPRUNFCkdkbGlyUjFkV2xnMEhrRXo0U3A5YnNOQWdydXVwbDhlRWZneE00aGlmUE1qNW12UCtINWRTbXJLcDlOL2o5cW0KOC9Oc2t1aS9ubkxDV2l6UEdDOElzNzF2VDBnQk5ZWGNVYm9yTytPWklaTUpBZUdUS1Jwd3VZTVBtQ2xzU0FVTgpFRHlFRnU5WTY4b2QxeWhwTWdWK2xIc3ZMZHNBQzFHWDJNZVNKYUVDZ2NCeTl0OVlSaStOdUJiaFFFQ1lLa0pVCmVkS0NyTC9lc0hPeGJadWFEQWhqR3ZrWXFyNmhucHJqREsyN3lpWFhrRVlLSTMrN08wcXptR2NkWE1xVmVQWEIKOEpQRWh6d0xZcU9GWXZrWk5uN0lJWVhFLzVmMDNMMllUeUpxRzF0M1c1bnpmMnMyUi93TnFTNnk1R2xWMFgxRQo5L2hLd3poODRNMjMyZ2pUOEhhRy9lRFhhR3MwMndyODIzQ2pqQzBpU1gwUFVvS2taM2g0QlE2WXVSZDhLWVp5ClpweUZyOWlxZTdhTnRpRGRnQ21uVTBIZDNYZHlHNUl5cklwS0J1K3ZWb0VDZ2NFQXRJM3dQVUdvTzVkZ3Y1bG8KOS85ZmtQTzlRLzFKcWxibkM1VkdlZG1hZmFiZWhpQU0wSFJ3bmM0TWJnR2VLT2RYdTRzdHFIODJjcG1yUnlvago3YmtmdXlNdWJBK2szRTBFWFRGWElmMG42UlZ0TGs5WmcrZDVjT0F1dEVMdkdGbERyRGtYRktXQno0eWdhRisxCmFnSEdvOG9sRU03VkFIZVp0NCt2T2pVUFgycWVBWkZtaXVHSmFKb1dEWkhKT3JueW5wbHlxMGhPeTlOVXhUUVUKUng4dHFXQlpSL3E4QXB0akF3V0xMRU9aWHFnVEFqbUtqYzZwQytSU0Nncmgxd2loQW9IQkFJbGFnQit1WFJIMQpWbzFVdmZuY013WlZDaHdrVlgwZzhlUmZxQWl4ZUZRV2hhakFOWmxqZzcraDdrSEJaYXlGcHVpdWxBTVRjbXJlCmgrQks2RllnK01ZT0J3amUwRU8rclFBVkRFUndrYy80R2ZuMDRuYjhWQW1jcmpIMnFwTU4yQWV5TWtkbkpMT0sKUGIyU0o5Vm9yL2plYkF3bk9DNjFnWkUza1RBbHhGVU1MZHRuWVgvK2lyR1F6Y1Bma21XbkhiNUQ2TGc2aW5lZgpWNyszVUhZb2wwT1p6bjA3cW9HbXFDYzJhSG4wSm9WWkVXdFVEc2J4OUN2N1YzT1I0Zjd6OXc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVwRENDQXd5Z0F3SUJBZ0lRTHowdG16c3JlOGVVSGVtbEhIUEdSakFOQmdrcWhraUc5dzBCQVFzRkFEQXoKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEN6QUpCZ05WQkFNVApBbU5oTUI0WERUSXdNRGN4TnpJeE1EUXhORm9YRFRJeE1EY3hOekl4TURReE5Gb3dPakVNTUFvR0ExVUVCaE1EClZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1SSXdFQVlEVlFRRERBa3FMblpqWVhBdWJXVXcKZ2dHaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQmp3QXdnZ0dLQW9JQmdRQ2Z2cVcwT1FJQjFINVQ1T01haFlNVQpGR0VtUEdGOWJxaE5XZHZQVzMxVHdib2thYTNNcVkvazVWeDVlbG9SMHpMRGJadWxOWEhyTFJaWHhiNGRWQ3BRCm1ZREkrYzM5a0Jhc1owcnFPeUYrKzczQWZ4WitOSG9ldllqTlNkKzUzR2VwbFdOWEtBN3I1UEtGRXcyaG1XVmQKSTRackYrdkJ6Q3hjdncwUTNNVTFYTUJzelZvd0pEZXV3dVdDejJDK3BsQVl1bGVOblIyN1Z0dHZQRHZNc2RObQpKb2JwdnpGV09iejJEQlkxWVF6SlNrZ3daK2p0OEtMLzhHMEhQWWdTcjUzb3VxMUtWUmxjYjBNdXpoTjhsYW16CjNuQTFJV1d2K2lBbDliV2RRbHp3bGZWQ3JXdGdCWE9obTF3OXFUV1NyYlJ1RmNYTHFLL1M4Q0IrRmNidzh6czcKLy9ZOEcwWTVPTFRrKzh3aERyMVpMT0ZnWmJBRmxmNG1VU3cwU1REZzFrY25la2dVS0N1ejFzWTNoaEVPSVJBYwpCbVZnUklvbVJiTXlRcHN6ZHFXa0orQXpoSFRiZHRCYWs1MG9KQlNRM0J3TDhXaVRQREdLYnFLbE5qOG1GbkE3CnJNNWJmMEwwMk82eXl2d1IyQ01TYzROcVhDZ0xyZ2ozRDEzTUttUUlRNjBDQXdFQUFhT0JyRENCcVRBT0JnTlYKSFE4QkFmOEVCQU1DQmFBd0V3WURWUjBsQkF3d0NnWUlLd1lCQlFVSEF3RXdEQVlEVlIwVEFRSC9CQUl3QURBZApCZ05WSFE0RUZnUVVia1VjbDZJMVFtSEZKRHVFaXJwMkR3NEFMR0l3SHdZRFZSMGpCQmd3Rm9BVStkWWdnSlJiCnJ1Y1UzeEZCWnJaaVRESktjWUV3TkFZRFZSMFJCQzB3SzRJUEtpNXNiMmRwYmk1MlkyRndMbTFsZ2drcUxuWmoKWVhBdWJXV0NEU291ZFdGaExuWmpZWEF1YldVd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFMVzdmTzYxYldhZApwSE1qR1ptazRBVFBMVXlUVVk4Nlp6ZmR4SUh5bTB1N0c4WW9QNjMzVGJac095Uk5VUWU3T29hS1Z1eCtVNnJECmZOK3BrcDhzUmdTZklMQlNaamJhT3RZNXh1MnVzVHU5S0tCL284bmpJQ1pNcDd5a3UvdVY4VjkvdlRXWHpJT3UKeHNHUUQvZ2lBSTZseUdERXEzMDBQM25LKzI1S2hna3NWNnViRy9taFZXRVhiZjkzNGFSTkVOeXNrR2VJMnpRZQpiUTlrU2g2aVJIZUxENWJLU3VFd3Jza3V5L3MyZmZFaVhBZW5nV201SjNlVjRSN1FRSlJpcm9sbU1VejNPditTCnRadDRWWDJsV1RoMXdUbGdsOEdPZUdwbXZwYTFkc2RmeDJacVVCZmRmYjdkd2JXK1QrVzEvWTJ1THoySXNvNGQKSHFCa1RPOHZoczR0azNoZlM2U0cyUW8xc3pHV3hsQ0VlNThQbWdJa2dzdlhmdHdJOVhvZThqcXliWXZ1NFJoUgpVRDFGMFROcmVBcHpWVEZqcloySW5KS1puaWFJS2p6MkR1TmtseDQvNU4xaCtpd2kydk54TW0rcW44R2VPSGVHCmVrQ1hmVDBXK3c2WVIwVTM4Y09mMXpJOElxRUVVS0NlOGN4UGtZaEUwYmVsZU1sSWkxbG0xUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
---
apiVersion: v1
kind: Secret
metadata:
  name: cf-workloads-cert
  namespace: istio-system
  annotations:
    kapp.k14s.io/change-rule.istio-ingressgateway: upsert before upserting istio.io/ingressgateway
    kapp.k14s.io/versioned: ""
data:
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNUFJQkFBS0NBWUVBMjVaQ0xlWitKZTVsVkV3Z2lLZ0ZkZk8zditjL2lGbFhPNEhibEY2SXRVZ2s2bDNNCnlGK0o3UUowcEJIVXVqeENJa3NaTkEzeUowdzRCR0dLdVp2Tm5CMGZhOXNOL1BLMXFJcFlTQ1Z4UElVRlFPRVUKeUIwRW1qdFkrZkhtUnYyV3pQMk9PZTBlanJBcUErdVNSMTg3aDdNdFZ0dERQV0RDSG5GM3FRd0lndVZtUjAwWgpmbnErenM1QWpYZzBzVlQwSzlJbUNiVGhqeS9acnlSM3FaTExlblpzQXZLcWVKemMwcE9nNTUvV0NWenRQS0R2CkJtTmdkUXV4Q3ZZRzZmaVQ2RXUvYlpSVlhWY3VYNWQwaTYxYXdFY1NLYktveE1YUjJlWVV1OExHOTBzVGZudlMKVm9YZ0NBSThhT0dhTVovRjZVYXJBaFpWR2lESkYwMkNjTXhSRndjaHJzMUdsckNZd3hVL3NsemhDWExjZlJXcQpsVU5rREo2ejJqOCtRQXBHV1NHb205OVJPcTJOTnNGN0NZMjIvVGNxdWpMc0Y3OWgyZzQvODFTR0puRThJV3F6ClUvdG9SSkxVQUtudVdSdHpuY1ZYWTg0eXZmVng3ME84WlhJMnoxRHJsUnBzWU05SEpxYzliWnFjWEhZbTFLQXAKbjhUMFpsaUV5NEl2aGM2bkFnTUJBQUVDZ2dHQkFLcENmSGZZa3hGWUlrdFZaNWh1SnlYSTNqMjIwU1VvbUtHMApVNHhjTEVYYmRYd2ZWTXc4ZjlZOHBESWUvVUdWdlhXWG95Z2dkQlVTWFJEUWpON1R0bjRJZXJlSE52WmRQb3M3CkVhNkhFYURxUnlPQ0lqbnpmZ0VVYVM0TDZSQThTalFSbWJqQ2FZSWJoOGhZWEtob1orRVZCZCtselNJSEp4eXgKd0NWY0JqRndLM2kzaUQvd2JvZ3RsaEhiRllnMkpjamdmY3ZpNjAyNXZXQzJ0dTNOdTJYdDhsdnF5bEVRMTR1VApHaHplYXZnQmpKVUk5NnlOVzFvRndiV05BOWxnZWVaMVJsZDllWUFkM0hJVEM2SlVaeDMxVlRTcWJCMUhhS2NxClBmTm9rWmQ0QjV5T1MrQ2IrTTBTaVJCV2xhNVkwaVQwdVdoeGpDYWlUYW1kVUQ1TjNDYkJ0YlRIUlJHOHZMYkIKTUFnb3BONWNGUmxhTnB2YmtzRnlWcXlxOHZLZXhQLzZFb1VKc1lyS0JWaUdtWTRZWDQyT2NxeU9RQ2VNTXJKRAp4YWYxaC9CTytlTFhEMlJvT0FKejVXeHJnRzhtdERPK0lYRmVTNHlIa3d2TWMyc0puSmc0ck4zTU5taThpVTRZCm0vcFA5QWhYbnNONlRibFpBODFmd0d0Qmx3azJ3UUtCd1FENDN4c3ZUUGFrTlBuMXgzZURuUytzdjhxZzRoZW8KR1BtYURDdEFoRTBUNFBNMkdvdjNXc3dSc1RHYUNBNHBObUtHNzZrU2kvdnpKZUFpbFVqTmlYVUIxQ0pxMEtYYQpkUmNjNE8yRXVueFpKN1h1ZlJ1SEhFZGtxbmNKanZSUGZqKzFla2FrWFZuc3F3T3ZydXRBbGtGdFJCMGpGUjBYCmx5OU5hVzdSNGpvTnhSdENud3FrdkNGNGJRRVFPNzFHYnhqUUlXYUZPWll4WWtJQ2RiRmhNNUV0b1RKaHpOQjEKWk9tWG5UTitaMnZVWCtZS2dRMjdTK0RsMkpnWGlzR1czdUVDZ2NFQTRlQnJES1EybEE3WjlWNlJKZnp0Sk01Ywo5ZWJnTFpSbGJ1VS9Kd0lPaW51VHNWQ0MvTzl6MjZqUkNndnpiNHk1K3o3TWQ4S01RWEViZDFaQkVNVGo0MitLClFoOTRlNGwwa0RsKytTNTUvbXZaWlFXUmxzZDhHOVcvYURyalVLcUppak84VDRTMnUxUkJpeW5kMHNmaUc5OGYKUDRERTZTYjdhdUh5YldnZkNkSTFjaWl1cURud2VFN0s3QjBFVzhNZE0rMkowNzdQS21WbEhqNS9YOFNNL0xNTwozZ0dodCt4dTdSb1paV0pOVjN6OExFODhIZFNmc3dCdWxhaVlYUWFIQW9IQWQrVmNQbVJ3cWxsUFZzWWE0TkJZClNIdzVqVnAvRlIrN0dDam1xWFZUZ05FdHVwSDlmbFJDM2Y4a3ExVllKU2lyUE9DMjdsVjhNdjY3UlUzd1BmMEwKM3E2cFNoWnM0SnJxWUtKSUsxcUFUNTllK1o5U0pMeE45TVJmQnI3VkducnpER1gxSkhoSXUwa0VSSjRiZmdrbApTaE8zaWRCQkxMMU1MNW9zcG5hN2l5aTdZbFFtbDRoL0EzcFlPYzdkOTlITC9YRXA1K0wvWlprMXZlT2ZhZm1pCjVuMnpQUVNrSlBwUnd4WWIyYmpQYlFncVZrTW9MMlIxMjZXR1dFa2p6S0JoQW9IQVlxMmZOc09hMEczNGpIaUcKNHRpdlpXLytMck54WnBnNUJBeUUzVzdKbVhoSldxSjR4elY1SVJLTVdGNUdPSXA3U2FieXZyTXdnUHAvN0UregpWemNjOCtScnUxMXlUazRMcldKZzlVMTNvRTNQaUpHNU8remtiR2lpR1UvNHRPbjc4bk9OcGhPdG5RTS9LeVBjCk05UjlGSDRTY2JTNDBiN2xBWm02UmsvQmw1SE5KWlZlVUVJWHF3ZUpJVU8vL3JLcjFGN0c0c211U2JCSVQ4RXYKOWsrdzVFajVpc1dkdC9ORHRyTzdPbzZLaVZraDlkMmJ2dENBQUR5RkV6NjNhWlNMQW9IQkFPOFVRbE85YWUxSQpLVWIwTU4xTDhpYjFiL0R2UzQyanVicXNITlJYUTdQRVFQRVJNRlRpVXFDeHFWNzg3bGhHWDk4aGhGaWhwMnJrClRlWGFPaWxmZEtJTklsZ2Z2YVR2dHVwcDZkcXd5dTZOVEZsUFhxV0RPbSsyRWtIL3BweVFEa1E1UVBwL3hVUkcKcjBOd1J0WmlDbm8vL2loc21PWWRkZkl5SU5JeG1yZVZjSkR5Z3FuTS95Nk02TWpQTE5vTjlUU0dZV1B3OGcyWQpoYU45SVdSNUhBZG5CWGUvbXU4RkNlbmxCdjAvTG5nUVFhYWRkOEZISDZVWk9GM2FjK0tlY2c9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVjVENDQXRtZ0F3SUJBZ0lRTlU5VFYvQlZjUkdJWU9VNHFscUkwREFOQmdrcWhraUc5dzBCQVFzRkFEQXoKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEN6QUpCZ05WQkFNVApBbU5oTUI0WERUSXdNRGN4TnpJeE1EUXhOVm9YRFRJeE1EY3hOekl4TURReE5Wb3dQekVNTUFvR0ExVUVCaE1EClZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1SY3dGUVlEVlFRRERBNHFMbUZ3Y0hNdWRtTmgKY0M1dFpUQ0NBYUl3RFFZSktvWklodmNOQVFFQkJRQURnZ0dQQURDQ0FZb0NnZ0dCQU51V1FpM21maVh1WlZSTQpJSWlvQlhYenQ3L25QNGhaVnp1QjI1UmVpTFZJSk9wZHpNaGZpZTBDZEtRUjFMbzhRaUpMR1RRTjhpZE1PQVJoCmlybWJ6WndkSDJ2YkRmenl0YWlLV0VnbGNUeUZCVURoRk1nZEJKbzdXUG54NWtiOWxzejlqam50SG82d0tnUHIKa2tkZk80ZXpMVmJiUXoxZ3doNXhkNmtNQ0lMbFprZE5HWDU2dnM3T1FJMTROTEZVOUN2U0pnbTA0WTh2MmE4awpkNm1TeTNwMmJBTHlxbmljM05LVG9PZWYxZ2xjN1R5Zzd3WmpZSFVMc1FyMkJ1bjRrK2hMdjIyVVZWMVhMbCtYCmRJdXRXc0JIRWlteXFNVEYwZG5tRkx2Q3h2ZExFMzU3MGxhRjRBZ0NQR2pobWpHZnhlbEdxd0lXVlJvZ3lSZE4KZ25ETVVSY0hJYTdOUnBhd21NTVZQN0pjNFFseTNIMFZxcFZEWkF5ZXM5by9Qa0FLUmxraHFKdmZVVHF0alRiQgpld21OdHYwM0tyb3k3QmUvWWRvT1AvTlVoaVp4UENGcXMxUDdhRVNTMUFDcDdsa2JjNTNGVjJQT01yMzFjZTlECnZHVnlOczlRNjVVYWJHRFBSeWFuUFcyYW5GeDJKdFNnS1ovRTlHWlloTXVDTDRYT3B3SURBUUFCbzNVd2N6QU8KQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0V3REFZRFZSMFRBUUgvQkFJdwpBREFkQmdOVkhRNEVGZ1FVVkRqYWFjM3YrUHBqRkFoTmV0RDZWcklrcWdRd0h3WURWUjBqQkJnd0ZvQVUrZFlnCmdKUmJydWNVM3hGQlpyWmlUREpLY1lFd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFGcGRwN0szTEtYWDhZZTUKZ3IvSVNxU2E0aGJieDkraXFMdHUzRUpMRDNpN2ZYcTl3NzlVOXFTUkNxMXFCZlpocFJSME96ZllPeExqWEczUgpLbW9ndGg1Z0VpcUhEZUk5VkZtTitTTUtickRwQWIrd3BZd2RXNWZLSm9DY0RnTzZXUkFhSjNzRUlUZjloUUlMCitMd2hQK0E3bzBKQytOV0Yycmh0YU5qUndiUDBvR0dxbXMvZytWL3lOWXV1SFFBTnVQVnZKaExYYU1JWUZpL0UKS2daRnBhcS9aNkV3Rlo1elhpOWdVRUVoT05icXlXaEZNN05LbkdXYk5ldXd2NmptMThqQlRLVUhPMklQOFk3eQpDSWV4b0lSbGdkbVY3aldnWjhmRlJzS2Z3R2tSRmFYUVlmbXpkVGljRkgwQytubTlBbGpIbWhnSUtpdkRGOGtnCkRzeFh0NGtRQllvQjVCWUNqSVhaZlRqVlhXYXA2UThhaXlvaERUcTRNTFQ3NE8yVVBmcWgzemlhejRxZFBIK3AKcXk1S2dUeDVXakdCVHdpeGV1RGM1a01SWlNjNWIzWEZEc1JjSndTSWFpM3hiVkZoeHRrU3VJaFdGU0ZxTjFmawo2c29LcVRaeTROVlRJNnZ4bjFvSnBBL3Z2aGs4OFdNbGV2NWFTbFRjR2VOZVF4b25xQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
---
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: istio-ingressgateway
  namespace: cf-system
spec:
  selector:
    istio: ingressgateway
  servers:
  - hosts:
    - '*'
    port:
      name: http
      number: 80
      protocol: HTTP
  - hosts:
    - '*/*.vcap.me'
    port:
      name: https-system
      number: 443
      protocol: HTTPS
    tls:
      mode: SIMPLE
      credentialName: cf-system-cert
  - hosts:
    - cf-workloads/*.apps.vcap.me
    port:
      name: https-workloads
      number: 443
      protocol: HTTPS
    tls:
      credentialName: cf-workloads-cert
      mode: SIMPLE
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.2.4
  creationTimestamp: null
  name: routes.networking.cloudfoundry.org
spec:
  group: networking.cloudfoundry.org
  names:
    kind: Route
    listKind: RouteList
    plural: routes
    singular: route
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      description: Route is the Schema for the routes API
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: RouteSpec defines the desired state of Route
          properties:
            destinations:
              items:
                properties:
                  app:
                    properties:
                      guid:
                        type: string
                      process:
                        properties:
                          type:
                            type: string
                        required:
                        - type
                        type: object
                    required:
                    - guid
                    - process
                    type: object
                  guid:
                    type: string
                  port:
                    type: integer
                  selector:
                    properties:
                      matchLabels:
                        additionalProperties:
                          type: string
                        type: object
                    required:
                    - matchLabels
                    type: object
                  weight:
                    type: integer
                required:
                - app
                - guid
                - port
                - selector
                type: object
              type: array
            domain:
              properties:
                internal:
                  type: boolean
                name:
                  type: string
              required:
              - internal
              - name
              type: object
            host:
              type: string
            path:
              type: string
            url:
              type: string
          required:
          - destinations
          - domain
          - host
          - url
          type: object
        status:
          description: RouteStatus defines the observed state of Route
          properties:
            conditions:
              items:
                properties:
                  status:
                    type: boolean
                  type:
                    type: string
                required:
                - status
                - type
                type: object
              type: array
          required:
          - conditions
          type: object
      type: object
  version: v1alpha1
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: networking.istio.io/v1alpha3
kind: Sidecar
metadata:
  name: default
  namespace: cf-workloads
spec:
  egress:
  - hosts:
    - cf-system/*
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: pilot-network-policy
  namespace: istio-system
spec:
  podSelector:
    matchLabels:
      app: pilot
  policyTypes:
  - Ingress
  ingress:
  - ports:
    - port: 15004
    - port: 15010
    - port: 15011
    - port: 15014
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: citadel-network-policy
  namespace: istio-system
spec:
  podSelector:
    matchLabels:
      app: citadel
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
    ports:
    - port: 8060
    - port: 8080
  - ports:
    - port: 15014
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: mixer-network-policy
  namespace: istio-system
spec:
  podSelector:
    matchLabels:
      app: mixer
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
    ports:
    - port: 9091
    - port: 15004
    - port: 15090
    - port: 42422
  - ports:
    - port: 15014
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: sidecar-injector-network-policy
  namespace: istio-system
spec:
  podSelector:
    matchLabels:
      app: sidecarInjectorWebhook
  policyTypes:
  - Ingress
  ingress:
  - ports:
    - port: 9443
    - port: 15014
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: ingressgateway-network-policy-pilot
  namespace: istio-system
spec:
  podSelector:
    matchLabels:
      app: istio-ingressgateway
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
    ports:
    - port: 15443
    - port: 15020
  - ports:
    - port: 80
    - port: 443
    - port: 8080
    - port: 8443
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: istiod
    release: istio
  name: istiod-istio-system
rules:
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
  - patch
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - validatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
  - update
- apiGroups:
  - networking.istio.io
  resources:
  - gateways
  verbs:
  - create
- apiGroups:
  - config.istio.io
  - rbac.istio.io
  - security.istio.io
  - networking.istio.io
  - authentication.istio.io
  resources:
  - '*'
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - extensions
  - apps
  resources:
  - deployments
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - pods
  - nodes
  - services
  - namespaces
  - endpoints
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - discovery.k8s.io
  resources:
  - endpointslices
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses
  - ingressclasses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses/status
  verbs:
  - '*'
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - create
  - get
  - list
  - watch
  - update
- apiGroups:
  - certificates.k8s.io
  resources:
  - certificatesigningrequests
  - certificatesigningrequests/approval
  - certificatesigningrequests/status
  verbs:
  - update
  - create
  - get
  - delete
  - watch
- apiGroups:
  - certificates.k8s.io
  resourceNames:
  - kubernetes.io/legacy-unknown
  resources:
  - signers
  verbs:
  - approve
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - get
  - watch
  - list
  - update
  - delete
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - networking.x.k8s.io
  resources:
  - '*'
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: istio-reader
    release: istio
  name: istio-reader-istio-system
rules:
- apiGroups:
  - config.istio.io
  - rbac.istio.io
  - security.istio.io
  - networking.istio.io
  - authentication.istio.io
  resources:
  - '*'
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - endpoints
  - pods
  - services
  - nodes
  - replicationcontrollers
  - namespaces
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - replicasets
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app: istio-reader
    release: istio
  name: istio-reader-istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istio-reader-istio-system
subjects:
- kind: ServiceAccount
  name: istio-reader-service-account
  namespace: istio-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app: pilot
    release: istio
  name: istiod-pilot-istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istiod-istio-system
subjects:
- kind: ServiceAccount
  name: istiod-service-account
  namespace: istio-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: istio-reader
    release: istio
  name: istio-reader-service-account
  namespace: istio-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: istiod
    release: istio
  name: istiod-service-account
  namespace: istio-system
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  labels:
    app: istiod
    istio: istiod
    release: istio
  name: istiod-istio-system
webhooks:
- clientConfig:
    caBundle: ""
    service:
      name: istiod
      namespace: istio-system
      path: /validate
  failurePolicy: Ignore
  name: validation.istio.io
  rules:
  - apiGroups:
    - config.istio.io
    - rbac.istio.io
    - security.istio.io
    - authentication.istio.io
    - networking.istio.io
    apiVersions:
    - '*'
    operations:
    - CREATE
    - UPDATE
    resources:
    - '*'
  sideEffects: None
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-mixer
    chart: istio
    heritage: Tiller
    release: istio
  name: httpapispecs.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: HTTPAPISpec
    listKind: HTTPAPISpecList
    plural: httpapispecs
    singular: httpapispec
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          properties:
            api_keys:
              items:
                oneOf:
                - not:
                    anyOf:
                    - required:
                      - query
                    - required:
                      - header
                    - required:
                      - cookie
                - required:
                  - query
                - required:
                  - header
                - required:
                  - cookie
                properties:
                  cookie:
                    format: string
                    type: string
                  header:
                    description: API key is sent in a request header.
                    format: string
                    type: string
                  query:
                    description: API Key is sent as a query parameter.
                    format: string
                    type: string
                type: object
              type: array
            apiKeys:
              items:
                oneOf:
                - not:
                    anyOf:
                    - required:
                      - query
                    - required:
                      - header
                    - required:
                      - cookie
                - required:
                  - query
                - required:
                  - header
                - required:
                  - cookie
                properties:
                  cookie:
                    format: string
                    type: string
                  header:
                    description: API key is sent in a request header.
                    format: string
                    type: string
                  query:
                    description: API Key is sent as a query parameter.
                    format: string
                    type: string
                type: object
              type: array
            attributes:
              properties:
                attributes:
                  additionalProperties:
                    oneOf:
                    - not:
                        anyOf:
                        - required:
                          - stringValue
                        - required:
                          - int64Value
                        - required:
                          - doubleValue
                        - required:
                          - boolValue
                        - required:
                          - bytesValue
                        - required:
                          - timestampValue
                        - required:
                          - durationValue
                        - required:
                          - stringMapValue
                    - required:
                      - stringValue
                    - required:
                      - int64Value
                    - required:
                      - doubleValue
                    - required:
                      - boolValue
                    - required:
                      - bytesValue
                    - required:
                      - timestampValue
                    - required:
                      - durationValue
                    - required:
                      - stringMapValue
                    properties:
                      boolValue:
                        type: boolean
                      bytesValue:
                        format: binary
                        type: string
                      doubleValue:
                        format: double
                        type: number
                      durationValue:
                        type: string
                      int64Value:
                        format: int64
                        type: integer
                      stringMapValue:
                        properties:
                          entries:
                            additionalProperties:
                              format: string
                              type: string
                            description: Holds a set of name/value pairs.
                            type: object
                        type: object
                      stringValue:
                        format: string
                        type: string
                      timestampValue:
                        format: dateTime
                        type: string
                    type: object
                  description: A map of attribute name to its value.
                  type: object
              type: object
            patterns:
              description: List of HTTP patterns to match.
              items:
                oneOf:
                - not:
                    anyOf:
                    - required:
                      - uriTemplate
                    - required:
                      - regex
                - required:
                  - uriTemplate
                - required:
                  - regex
                properties:
                  attributes:
                    properties:
                      attributes:
                        additionalProperties:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - stringValue
                              - required:
                                - int64Value
                              - required:
                                - doubleValue
                              - required:
                                - boolValue
                              - required:
                                - bytesValue
                              - required:
                                - timestampValue
                              - required:
                                - durationValue
                              - required:
                                - stringMapValue
                          - required:
                            - stringValue
                          - required:
                            - int64Value
                          - required:
                            - doubleValue
                          - required:
                            - boolValue
                          - required:
                            - bytesValue
                          - required:
                            - timestampValue
                          - required:
                            - durationValue
                          - required:
                            - stringMapValue
                          properties:
                            boolValue:
                              type: boolean
                            bytesValue:
                              format: binary
                              type: string
                            doubleValue:
                              format: double
                              type: number
                            durationValue:
                              type: string
                            int64Value:
                              format: int64
                              type: integer
                            stringMapValue:
                              properties:
                                entries:
                                  additionalProperties:
                                    format: string
                                    type: string
                                  description: Holds a set of name/value pairs.
                                  type: object
                              type: object
                            stringValue:
                              format: string
                              type: string
                            timestampValue:
                              format: dateTime
                              type: string
                          type: object
                        description: A map of attribute name to its value.
                        type: object
                    type: object
                  httpMethod:
                    format: string
                    type: string
                  regex:
                    format: string
                    type: string
                  uriTemplate:
                    format: string
                    type: string
                type: object
              type: array
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-mixer
    chart: istio
    heritage: Tiller
    release: istio
  name: httpapispecbindings.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: HTTPAPISpecBinding
    listKind: HTTPAPISpecBindingList
    plural: httpapispecbindings
    singular: httpapispecbinding
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          properties:
            api_specs:
              items:
                properties:
                  name:
                    description: The short name of the HTTPAPISpec.
                    format: string
                    type: string
                  namespace:
                    description: Optional namespace of the HTTPAPISpec.
                    format: string
                    type: string
                type: object
              type: array
            apiSpecs:
              items:
                properties:
                  name:
                    description: The short name of the HTTPAPISpec.
                    format: string
                    type: string
                  namespace:
                    description: Optional namespace of the HTTPAPISpec.
                    format: string
                    type: string
                type: object
              type: array
            services:
              description: One or more services to map the listed HTTPAPISpec onto.
              items:
                properties:
                  domain:
                    description: Domain suffix used to construct the service FQDN in implementations that support such specification.
                    format: string
                    type: string
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    description: Optional one or more labels that uniquely identify the service version.
                    type: object
                  name:
                    description: The short name of the service such as "foo".
                    format: string
                    type: string
                  namespace:
                    description: Optional namespace of the service.
                    format: string
                    type: string
                  service:
                    description: The service FQDN.
                    format: string
                    type: string
                type: object
              type: array
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-mixer
    chart: istio
    heritage: Tiller
    release: istio
  name: quotaspecs.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: QuotaSpec
    listKind: QuotaSpecList
    plural: quotaspecs
    singular: quotaspec
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: Determines the quotas used for individual requests.
          properties:
            rules:
              description: A list of Quota rules.
              items:
                properties:
                  match:
                    description: If empty, match all request.
                    items:
                      properties:
                        clause:
                          additionalProperties:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          description: Map of attribute names to StringMatch type.
                          type: object
                      type: object
                    type: array
                  quotas:
                    description: The list of quotas to charge.
                    items:
                      properties:
                        charge:
                          format: int32
                          type: integer
                        quota:
                          format: string
                          type: string
                      type: object
                    type: array
                type: object
              type: array
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-mixer
    chart: istio
    heritage: Tiller
    release: istio
  name: quotaspecbindings.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: QuotaSpecBinding
    listKind: QuotaSpecBindingList
    plural: quotaspecbindings
    singular: quotaspecbinding
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          properties:
            quotaSpecs:
              items:
                properties:
                  name:
                    description: The short name of the QuotaSpec.
                    format: string
                    type: string
                  namespace:
                    description: Optional namespace of the QuotaSpec.
                    format: string
                    type: string
                type: object
              type: array
            services:
              description: One or more services to map the listed QuotaSpec onto.
              items:
                properties:
                  domain:
                    description: Domain suffix used to construct the service FQDN in implementations that support such specification.
                    format: string
                    type: string
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    description: Optional one or more labels that uniquely identify the service version.
                    type: object
                  name:
                    description: The short name of the service such as "foo".
                    format: string
                    type: string
                  namespace:
                    description: Optional namespace of the service.
                    format: string
                    type: string
                  service:
                    description: The service FQDN.
                    format: string
                    type: string
                type: object
              type: array
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: destinationrules.networking.istio.io
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.host
    description: The name of a service from the service registry
    name: Host
    type: string
  - JSONPath: .metadata.creationTimestamp
    description: 'CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
    name: Age
    type: date
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: DestinationRule
    listKind: DestinationRuleList
    plural: destinationrules
    shortNames:
    - dr
    singular: destinationrule
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration affecting load balancing, outlier detection, etc. See more details at: https://istio.io/docs/reference/config/networking/destination-rule.html'
          properties:
            exportTo:
              description: A list of namespaces to which this destination rule is exported.
              items:
                format: string
                type: string
              type: array
            host:
              description: The name of a service from the service registry.
              format: string
              type: string
            subsets:
              items:
                properties:
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                  name:
                    description: Name of the subset.
                    format: string
                    type: string
                  trafficPolicy:
                    description: Traffic policies that apply to this subset.
                    properties:
                      connectionPool:
                        properties:
                          http:
                            description: HTTP connection pool settings.
                            properties:
                              h2UpgradePolicy:
                                description: Specify if http1.1 connection should be upgraded to http2 for the associated destination.
                                enum:
                                - DEFAULT
                                - DO_NOT_UPGRADE
                                - UPGRADE
                                type: string
                              http1MaxPendingRequests:
                                description: Maximum number of pending HTTP requests to a destination.
                                format: int32
                                type: integer
                              http2MaxRequests:
                                description: Maximum number of requests to a backend.
                                format: int32
                                type: integer
                              idleTimeout:
                                description: The idle timeout for upstream connection pool connections.
                                type: string
                              maxRequestsPerConnection:
                                description: Maximum number of requests per connection to a backend.
                                format: int32
                                type: integer
                              maxRetries:
                                format: int32
                                type: integer
                            type: object
                          tcp:
                            description: Settings common to both HTTP and TCP upstream connections.
                            properties:
                              connectTimeout:
                                description: TCP connection timeout.
                                type: string
                              maxConnections:
                                description: Maximum number of HTTP1 /TCP connections to a destination host.
                                format: int32
                                type: integer
                              tcpKeepalive:
                                description: If set then set SO_KEEPALIVE on the socket to enable TCP Keepalives.
                                properties:
                                  interval:
                                    description: The time duration between keep-alive probes.
                                    type: string
                                  probes:
                                    type: integer
                                  time:
                                    type: string
                                type: object
                            type: object
                        type: object
                      loadBalancer:
                        description: Settings controlling the load balancer algorithms.
                        oneOf:
                        - not:
                            anyOf:
                            - required:
                              - simple
                            - properties:
                                consistentHash:
                                  oneOf:
                                  - not:
                                      anyOf:
                                      - required:
                                        - httpHeaderName
                                      - required:
                                        - httpCookie
                                      - required:
                                        - useSourceIp
                                      - required:
                                        - httpQueryParameterName
                                  - required:
                                    - httpHeaderName
                                  - required:
                                    - httpCookie
                                  - required:
                                    - useSourceIp
                                  - required:
                                    - httpQueryParameterName
                              required:
                              - consistentHash
                        - required:
                          - simple
                        - properties:
                            consistentHash:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - httpHeaderName
                                  - required:
                                    - httpCookie
                                  - required:
                                    - useSourceIp
                                  - required:
                                    - httpQueryParameterName
                              - required:
                                - httpHeaderName
                              - required:
                                - httpCookie
                              - required:
                                - useSourceIp
                              - required:
                                - httpQueryParameterName
                          required:
                          - consistentHash
                        properties:
                          consistentHash:
                            properties:
                              httpCookie:
                                description: Hash based on HTTP cookie.
                                properties:
                                  name:
                                    description: Name of the cookie.
                                    format: string
                                    type: string
                                  path:
                                    description: Path to set for the cookie.
                                    format: string
                                    type: string
                                  ttl:
                                    description: Lifetime of the cookie.
                                    type: string
                                type: object
                              httpHeaderName:
                                description: Hash based on a specific HTTP header.
                                format: string
                                type: string
                              httpQueryParameterName:
                                description: Hash based on a specific HTTP query parameter.
                                format: string
                                type: string
                              minimumRingSize:
                                type: integer
                              useSourceIp:
                                description: Hash based on the source IP address.
                                type: boolean
                            type: object
                          localityLbSetting:
                            properties:
                              distribute:
                                description: 'Optional: only one of distribute or failover can be set.'
                                items:
                                  properties:
                                    from:
                                      description: Originating locality, '/' separated, e.g.
                                      format: string
                                      type: string
                                    to:
                                      additionalProperties:
                                        type: integer
                                      description: Map of upstream localities to traffic distribution weights.
                                      type: object
                                  type: object
                                type: array
                              enabled:
                                description: enable locality load balancing, this is DestinationRule-level and will override mesh wide settings in entirety.
                                type: boolean
                              failover:
                                description: 'Optional: only failover or distribute can be set.'
                                items:
                                  properties:
                                    from:
                                      description: Originating region.
                                      format: string
                                      type: string
                                    to:
                                      format: string
                                      type: string
                                  type: object
                                type: array
                            type: object
                          simple:
                            enum:
                            - ROUND_ROBIN
                            - LEAST_CONN
                            - RANDOM
                            - PASSTHROUGH
                            type: string
                        type: object
                      outlierDetection:
                        properties:
                          baseEjectionTime:
                            description: Minimum ejection duration.
                            type: string
                          consecutive5xxErrors:
                            description: Number of 5xx errors before a host is ejected from the connection pool.
                            type: integer
                          consecutiveErrors:
                            format: int32
                            type: integer
                          consecutiveGatewayErrors:
                            description: Number of gateway errors before a host is ejected from the connection pool.
                            type: integer
                          interval:
                            description: Time interval between ejection sweep analysis.
                            type: string
                          maxEjectionPercent:
                            format: int32
                            type: integer
                          minHealthPercent:
                            format: int32
                            type: integer
                        type: object
                      portLevelSettings:
                        description: Traffic policies specific to individual ports.
                        items:
                          properties:
                            connectionPool:
                              properties:
                                http:
                                  description: HTTP connection pool settings.
                                  properties:
                                    h2UpgradePolicy:
                                      description: Specify if http1.1 connection should be upgraded to http2 for the associated destination.
                                      enum:
                                      - DEFAULT
                                      - DO_NOT_UPGRADE
                                      - UPGRADE
                                      type: string
                                    http1MaxPendingRequests:
                                      description: Maximum number of pending HTTP requests to a destination.
                                      format: int32
                                      type: integer
                                    http2MaxRequests:
                                      description: Maximum number of requests to a backend.
                                      format: int32
                                      type: integer
                                    idleTimeout:
                                      description: The idle timeout for upstream connection pool connections.
                                      type: string
                                    maxRequestsPerConnection:
                                      description: Maximum number of requests per connection to a backend.
                                      format: int32
                                      type: integer
                                    maxRetries:
                                      format: int32
                                      type: integer
                                  type: object
                                tcp:
                                  description: Settings common to both HTTP and TCP upstream connections.
                                  properties:
                                    connectTimeout:
                                      description: TCP connection timeout.
                                      type: string
                                    maxConnections:
                                      description: Maximum number of HTTP1 /TCP connections to a destination host.
                                      format: int32
                                      type: integer
                                    tcpKeepalive:
                                      description: If set then set SO_KEEPALIVE on the socket to enable TCP Keepalives.
                                      properties:
                                        interval:
                                          description: The time duration between keep-alive probes.
                                          type: string
                                        probes:
                                          type: integer
                                        time:
                                          type: string
                                      type: object
                                  type: object
                              type: object
                            loadBalancer:
                              description: Settings controlling the load balancer algorithms.
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - simple
                                  - properties:
                                      consistentHash:
                                        oneOf:
                                        - not:
                                            anyOf:
                                            - required:
                                              - httpHeaderName
                                            - required:
                                              - httpCookie
                                            - required:
                                              - useSourceIp
                                            - required:
                                              - httpQueryParameterName
                                        - required:
                                          - httpHeaderName
                                        - required:
                                          - httpCookie
                                        - required:
                                          - useSourceIp
                                        - required:
                                          - httpQueryParameterName
                                    required:
                                    - consistentHash
                              - required:
                                - simple
                              - properties:
                                  consistentHash:
                                    oneOf:
                                    - not:
                                        anyOf:
                                        - required:
                                          - httpHeaderName
                                        - required:
                                          - httpCookie
                                        - required:
                                          - useSourceIp
                                        - required:
                                          - httpQueryParameterName
                                    - required:
                                      - httpHeaderName
                                    - required:
                                      - httpCookie
                                    - required:
                                      - useSourceIp
                                    - required:
                                      - httpQueryParameterName
                                required:
                                - consistentHash
                              properties:
                                consistentHash:
                                  properties:
                                    httpCookie:
                                      description: Hash based on HTTP cookie.
                                      properties:
                                        name:
                                          description: Name of the cookie.
                                          format: string
                                          type: string
                                        path:
                                          description: Path to set for the cookie.
                                          format: string
                                          type: string
                                        ttl:
                                          description: Lifetime of the cookie.
                                          type: string
                                      type: object
                                    httpHeaderName:
                                      description: Hash based on a specific HTTP header.
                                      format: string
                                      type: string
                                    httpQueryParameterName:
                                      description: Hash based on a specific HTTP query parameter.
                                      format: string
                                      type: string
                                    minimumRingSize:
                                      type: integer
                                    useSourceIp:
                                      description: Hash based on the source IP address.
                                      type: boolean
                                  type: object
                                localityLbSetting:
                                  properties:
                                    distribute:
                                      description: 'Optional: only one of distribute or failover can be set.'
                                      items:
                                        properties:
                                          from:
                                            description: Originating locality, '/' separated, e.g.
                                            format: string
                                            type: string
                                          to:
                                            additionalProperties:
                                              type: integer
                                            description: Map of upstream localities to traffic distribution weights.
                                            type: object
                                        type: object
                                      type: array
                                    enabled:
                                      description: enable locality load balancing, this is DestinationRule-level and will override mesh wide settings in entirety.
                                      type: boolean
                                    failover:
                                      description: 'Optional: only failover or distribute can be set.'
                                      items:
                                        properties:
                                          from:
                                            description: Originating region.
                                            format: string
                                            type: string
                                          to:
                                            format: string
                                            type: string
                                        type: object
                                      type: array
                                  type: object
                                simple:
                                  enum:
                                  - ROUND_ROBIN
                                  - LEAST_CONN
                                  - RANDOM
                                  - PASSTHROUGH
                                  type: string
                              type: object
                            outlierDetection:
                              properties:
                                baseEjectionTime:
                                  description: Minimum ejection duration.
                                  type: string
                                consecutive5xxErrors:
                                  description: Number of 5xx errors before a host is ejected from the connection pool.
                                  type: integer
                                consecutiveErrors:
                                  format: int32
                                  type: integer
                                consecutiveGatewayErrors:
                                  description: Number of gateway errors before a host is ejected from the connection pool.
                                  type: integer
                                interval:
                                  description: Time interval between ejection sweep analysis.
                                  type: string
                                maxEjectionPercent:
                                  format: int32
                                  type: integer
                                minHealthPercent:
                                  format: int32
                                  type: integer
                              type: object
                            port:
                              properties:
                                number:
                                  type: integer
                              type: object
                            tls:
                              description: TLS related settings for connections to the upstream service.
                              properties:
                                caCertificates:
                                  format: string
                                  type: string
                                clientCertificate:
                                  description: REQUIRED if mode is `MUTUAL`.
                                  format: string
                                  type: string
                                mode:
                                  enum:
                                  - DISABLE
                                  - SIMPLE
                                  - MUTUAL
                                  - ISTIO_MUTUAL
                                  type: string
                                privateKey:
                                  description: REQUIRED if mode is `MUTUAL`.
                                  format: string
                                  type: string
                                sni:
                                  description: SNI string to present to the server during TLS handshake.
                                  format: string
                                  type: string
                                subjectAltNames:
                                  items:
                                    format: string
                                    type: string
                                  type: array
                              type: object
                          type: object
                        type: array
                      tls:
                        description: TLS related settings for connections to the upstream service.
                        properties:
                          caCertificates:
                            format: string
                            type: string
                          clientCertificate:
                            description: REQUIRED if mode is `MUTUAL`.
                            format: string
                            type: string
                          mode:
                            enum:
                            - DISABLE
                            - SIMPLE
                            - MUTUAL
                            - ISTIO_MUTUAL
                            type: string
                          privateKey:
                            description: REQUIRED if mode is `MUTUAL`.
                            format: string
                            type: string
                          sni:
                            description: SNI string to present to the server during TLS handshake.
                            format: string
                            type: string
                          subjectAltNames:
                            items:
                              format: string
                              type: string
                            type: array
                        type: object
                    type: object
                type: object
              type: array
            trafficPolicy:
              properties:
                connectionPool:
                  properties:
                    http:
                      description: HTTP connection pool settings.
                      properties:
                        h2UpgradePolicy:
                          description: Specify if http1.1 connection should be upgraded to http2 for the associated destination.
                          enum:
                          - DEFAULT
                          - DO_NOT_UPGRADE
                          - UPGRADE
                          type: string
                        http1MaxPendingRequests:
                          description: Maximum number of pending HTTP requests to a destination.
                          format: int32
                          type: integer
                        http2MaxRequests:
                          description: Maximum number of requests to a backend.
                          format: int32
                          type: integer
                        idleTimeout:
                          description: The idle timeout for upstream connection pool connections.
                          type: string
                        maxRequestsPerConnection:
                          description: Maximum number of requests per connection to a backend.
                          format: int32
                          type: integer
                        maxRetries:
                          format: int32
                          type: integer
                      type: object
                    tcp:
                      description: Settings common to both HTTP and TCP upstream connections.
                      properties:
                        connectTimeout:
                          description: TCP connection timeout.
                          type: string
                        maxConnections:
                          description: Maximum number of HTTP1 /TCP connections to a destination host.
                          format: int32
                          type: integer
                        tcpKeepalive:
                          description: If set then set SO_KEEPALIVE on the socket to enable TCP Keepalives.
                          properties:
                            interval:
                              description: The time duration between keep-alive probes.
                              type: string
                            probes:
                              type: integer
                            time:
                              type: string
                          type: object
                      type: object
                  type: object
                loadBalancer:
                  description: Settings controlling the load balancer algorithms.
                  oneOf:
                  - not:
                      anyOf:
                      - required:
                        - simple
                      - properties:
                          consistentHash:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - httpHeaderName
                                - required:
                                  - httpCookie
                                - required:
                                  - useSourceIp
                                - required:
                                  - httpQueryParameterName
                            - required:
                              - httpHeaderName
                            - required:
                              - httpCookie
                            - required:
                              - useSourceIp
                            - required:
                              - httpQueryParameterName
                        required:
                        - consistentHash
                  - required:
                    - simple
                  - properties:
                      consistentHash:
                        oneOf:
                        - not:
                            anyOf:
                            - required:
                              - httpHeaderName
                            - required:
                              - httpCookie
                            - required:
                              - useSourceIp
                            - required:
                              - httpQueryParameterName
                        - required:
                          - httpHeaderName
                        - required:
                          - httpCookie
                        - required:
                          - useSourceIp
                        - required:
                          - httpQueryParameterName
                    required:
                    - consistentHash
                  properties:
                    consistentHash:
                      properties:
                        httpCookie:
                          description: Hash based on HTTP cookie.
                          properties:
                            name:
                              description: Name of the cookie.
                              format: string
                              type: string
                            path:
                              description: Path to set for the cookie.
                              format: string
                              type: string
                            ttl:
                              description: Lifetime of the cookie.
                              type: string
                          type: object
                        httpHeaderName:
                          description: Hash based on a specific HTTP header.
                          format: string
                          type: string
                        httpQueryParameterName:
                          description: Hash based on a specific HTTP query parameter.
                          format: string
                          type: string
                        minimumRingSize:
                          type: integer
                        useSourceIp:
                          description: Hash based on the source IP address.
                          type: boolean
                      type: object
                    localityLbSetting:
                      properties:
                        distribute:
                          description: 'Optional: only one of distribute or failover can be set.'
                          items:
                            properties:
                              from:
                                description: Originating locality, '/' separated, e.g.
                                format: string
                                type: string
                              to:
                                additionalProperties:
                                  type: integer
                                description: Map of upstream localities to traffic distribution weights.
                                type: object
                            type: object
                          type: array
                        enabled:
                          description: enable locality load balancing, this is DestinationRule-level and will override mesh wide settings in entirety.
                          type: boolean
                        failover:
                          description: 'Optional: only failover or distribute can be set.'
                          items:
                            properties:
                              from:
                                description: Originating region.
                                format: string
                                type: string
                              to:
                                format: string
                                type: string
                            type: object
                          type: array
                      type: object
                    simple:
                      enum:
                      - ROUND_ROBIN
                      - LEAST_CONN
                      - RANDOM
                      - PASSTHROUGH
                      type: string
                  type: object
                outlierDetection:
                  properties:
                    baseEjectionTime:
                      description: Minimum ejection duration.
                      type: string
                    consecutive5xxErrors:
                      description: Number of 5xx errors before a host is ejected from the connection pool.
                      type: integer
                    consecutiveErrors:
                      format: int32
                      type: integer
                    consecutiveGatewayErrors:
                      description: Number of gateway errors before a host is ejected from the connection pool.
                      type: integer
                    interval:
                      description: Time interval between ejection sweep analysis.
                      type: string
                    maxEjectionPercent:
                      format: int32
                      type: integer
                    minHealthPercent:
                      format: int32
                      type: integer
                  type: object
                portLevelSettings:
                  description: Traffic policies specific to individual ports.
                  items:
                    properties:
                      connectionPool:
                        properties:
                          http:
                            description: HTTP connection pool settings.
                            properties:
                              h2UpgradePolicy:
                                description: Specify if http1.1 connection should be upgraded to http2 for the associated destination.
                                enum:
                                - DEFAULT
                                - DO_NOT_UPGRADE
                                - UPGRADE
                                type: string
                              http1MaxPendingRequests:
                                description: Maximum number of pending HTTP requests to a destination.
                                format: int32
                                type: integer
                              http2MaxRequests:
                                description: Maximum number of requests to a backend.
                                format: int32
                                type: integer
                              idleTimeout:
                                description: The idle timeout for upstream connection pool connections.
                                type: string
                              maxRequestsPerConnection:
                                description: Maximum number of requests per connection to a backend.
                                format: int32
                                type: integer
                              maxRetries:
                                format: int32
                                type: integer
                            type: object
                          tcp:
                            description: Settings common to both HTTP and TCP upstream connections.
                            properties:
                              connectTimeout:
                                description: TCP connection timeout.
                                type: string
                              maxConnections:
                                description: Maximum number of HTTP1 /TCP connections to a destination host.
                                format: int32
                                type: integer
                              tcpKeepalive:
                                description: If set then set SO_KEEPALIVE on the socket to enable TCP Keepalives.
                                properties:
                                  interval:
                                    description: The time duration between keep-alive probes.
                                    type: string
                                  probes:
                                    type: integer
                                  time:
                                    type: string
                                type: object
                            type: object
                        type: object
                      loadBalancer:
                        description: Settings controlling the load balancer algorithms.
                        oneOf:
                        - not:
                            anyOf:
                            - required:
                              - simple
                            - properties:
                                consistentHash:
                                  oneOf:
                                  - not:
                                      anyOf:
                                      - required:
                                        - httpHeaderName
                                      - required:
                                        - httpCookie
                                      - required:
                                        - useSourceIp
                                      - required:
                                        - httpQueryParameterName
                                  - required:
                                    - httpHeaderName
                                  - required:
                                    - httpCookie
                                  - required:
                                    - useSourceIp
                                  - required:
                                    - httpQueryParameterName
                              required:
                              - consistentHash
                        - required:
                          - simple
                        - properties:
                            consistentHash:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - httpHeaderName
                                  - required:
                                    - httpCookie
                                  - required:
                                    - useSourceIp
                                  - required:
                                    - httpQueryParameterName
                              - required:
                                - httpHeaderName
                              - required:
                                - httpCookie
                              - required:
                                - useSourceIp
                              - required:
                                - httpQueryParameterName
                          required:
                          - consistentHash
                        properties:
                          consistentHash:
                            properties:
                              httpCookie:
                                description: Hash based on HTTP cookie.
                                properties:
                                  name:
                                    description: Name of the cookie.
                                    format: string
                                    type: string
                                  path:
                                    description: Path to set for the cookie.
                                    format: string
                                    type: string
                                  ttl:
                                    description: Lifetime of the cookie.
                                    type: string
                                type: object
                              httpHeaderName:
                                description: Hash based on a specific HTTP header.
                                format: string
                                type: string
                              httpQueryParameterName:
                                description: Hash based on a specific HTTP query parameter.
                                format: string
                                type: string
                              minimumRingSize:
                                type: integer
                              useSourceIp:
                                description: Hash based on the source IP address.
                                type: boolean
                            type: object
                          localityLbSetting:
                            properties:
                              distribute:
                                description: 'Optional: only one of distribute or failover can be set.'
                                items:
                                  properties:
                                    from:
                                      description: Originating locality, '/' separated, e.g.
                                      format: string
                                      type: string
                                    to:
                                      additionalProperties:
                                        type: integer
                                      description: Map of upstream localities to traffic distribution weights.
                                      type: object
                                  type: object
                                type: array
                              enabled:
                                description: enable locality load balancing, this is DestinationRule-level and will override mesh wide settings in entirety.
                                type: boolean
                              failover:
                                description: 'Optional: only failover or distribute can be set.'
                                items:
                                  properties:
                                    from:
                                      description: Originating region.
                                      format: string
                                      type: string
                                    to:
                                      format: string
                                      type: string
                                  type: object
                                type: array
                            type: object
                          simple:
                            enum:
                            - ROUND_ROBIN
                            - LEAST_CONN
                            - RANDOM
                            - PASSTHROUGH
                            type: string
                        type: object
                      outlierDetection:
                        properties:
                          baseEjectionTime:
                            description: Minimum ejection duration.
                            type: string
                          consecutive5xxErrors:
                            description: Number of 5xx errors before a host is ejected from the connection pool.
                            type: integer
                          consecutiveErrors:
                            format: int32
                            type: integer
                          consecutiveGatewayErrors:
                            description: Number of gateway errors before a host is ejected from the connection pool.
                            type: integer
                          interval:
                            description: Time interval between ejection sweep analysis.
                            type: string
                          maxEjectionPercent:
                            format: int32
                            type: integer
                          minHealthPercent:
                            format: int32
                            type: integer
                        type: object
                      port:
                        properties:
                          number:
                            type: integer
                        type: object
                      tls:
                        description: TLS related settings for connections to the upstream service.
                        properties:
                          caCertificates:
                            format: string
                            type: string
                          clientCertificate:
                            description: REQUIRED if mode is `MUTUAL`.
                            format: string
                            type: string
                          mode:
                            enum:
                            - DISABLE
                            - SIMPLE
                            - MUTUAL
                            - ISTIO_MUTUAL
                            type: string
                          privateKey:
                            description: REQUIRED if mode is `MUTUAL`.
                            format: string
                            type: string
                          sni:
                            description: SNI string to present to the server during TLS handshake.
                            format: string
                            type: string
                          subjectAltNames:
                            items:
                              format: string
                              type: string
                            type: array
                        type: object
                    type: object
                  type: array
                tls:
                  description: TLS related settings for connections to the upstream service.
                  properties:
                    caCertificates:
                      format: string
                      type: string
                    clientCertificate:
                      description: REQUIRED if mode is `MUTUAL`.
                      format: string
                      type: string
                    mode:
                      enum:
                      - DISABLE
                      - SIMPLE
                      - MUTUAL
                      - ISTIO_MUTUAL
                      type: string
                    privateKey:
                      description: REQUIRED if mode is `MUTUAL`.
                      format: string
                      type: string
                    sni:
                      description: SNI string to present to the server during TLS handshake.
                      format: string
                      type: string
                    subjectAltNames:
                      items:
                        format: string
                        type: string
                      type: array
                  type: object
              type: object
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
  - name: v1beta1
    served: true
    storage: false
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: envoyfilters.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: EnvoyFilter
    listKind: EnvoyFilterList
    plural: envoyfilters
    singular: envoyfilter
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Customizing Envoy configuration generated by Istio. See more details at: https://istio.io/docs/reference/config/networking/envoy-filter.html'
          properties:
            configPatches:
              description: One or more patches with match conditions.
              items:
                properties:
                  applyTo:
                    enum:
                    - INVALID
                    - LISTENER
                    - FILTER_CHAIN
                    - NETWORK_FILTER
                    - HTTP_FILTER
                    - ROUTE_CONFIGURATION
                    - VIRTUAL_HOST
                    - HTTP_ROUTE
                    - CLUSTER
                    type: string
                  match:
                    description: Match on listener/route configuration/cluster.
                    oneOf:
                    - not:
                        anyOf:
                        - required:
                          - listener
                        - required:
                          - routeConfiguration
                        - required:
                          - cluster
                    - required:
                      - listener
                    - required:
                      - routeConfiguration
                    - required:
                      - cluster
                    properties:
                      cluster:
                        description: Match on envoy cluster attributes.
                        properties:
                          name:
                            description: The exact name of the cluster to match.
                            format: string
                            type: string
                          portNumber:
                            description: The service port for which this cluster was generated.
                            type: integer
                          service:
                            description: The fully qualified service name for this cluster.
                            format: string
                            type: string
                          subset:
                            description: The subset associated with the service.
                            format: string
                            type: string
                        type: object
                      context:
                        description: The specific config generation context to match on.
                        enum:
                        - ANY
                        - SIDECAR_INBOUND
                        - SIDECAR_OUTBOUND
                        - GATEWAY
                        type: string
                      listener:
                        description: Match on envoy listener attributes.
                        properties:
                          filterChain:
                            description: Match a specific filter chain in a listener.
                            properties:
                              applicationProtocols:
                                description: Applies only to sidecars.
                                format: string
                                type: string
                              filter:
                                description: The name of a specific filter to apply the patch to.
                                properties:
                                  name:
                                    description: The filter name to match on.
                                    format: string
                                    type: string
                                  subFilter:
                                    properties:
                                      name:
                                        description: The filter name to match on.
                                        format: string
                                        type: string
                                    type: object
                                type: object
                              name:
                                description: The name assigned to the filter chain.
                                format: string
                                type: string
                              sni:
                                description: The SNI value used by a filter chain's match condition.
                                format: string
                                type: string
                              transportProtocol:
                                description: Applies only to SIDECAR_INBOUND context.
                                format: string
                                type: string
                            type: object
                          name:
                            description: Match a specific listener by its name.
                            format: string
                            type: string
                          portName:
                            format: string
                            type: string
                          portNumber:
                            type: integer
                        type: object
                      proxy:
                        description: Match on properties associated with a proxy.
                        properties:
                          metadata:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          proxyVersion:
                            format: string
                            type: string
                        type: object
                      routeConfiguration:
                        description: Match on envoy HTTP route configuration attributes.
                        properties:
                          gateway:
                            format: string
                            type: string
                          name:
                            description: Route configuration name to match on.
                            format: string
                            type: string
                          portName:
                            description: Applicable only for GATEWAY context.
                            format: string
                            type: string
                          portNumber:
                            type: integer
                          vhost:
                            properties:
                              name:
                                format: string
                                type: string
                              route:
                                description: Match a specific route within the virtual host.
                                properties:
                                  action:
                                    description: Match a route with specific action type.
                                    enum:
                                    - ANY
                                    - ROUTE
                                    - REDIRECT
                                    - DIRECT_RESPONSE
                                    type: string
                                  name:
                                    format: string
                                    type: string
                                type: object
                            type: object
                        type: object
                    type: object
                  patch:
                    description: The patch to apply along with the operation.
                    properties:
                      operation:
                        description: Determines how the patch should be applied.
                        enum:
                        - INVALID
                        - MERGE
                        - ADD
                        - REMOVE
                        - INSERT_BEFORE
                        - INSERT_AFTER
                        - INSERT_FIRST
                        type: string
                      value:
                        description: The JSON config of the object being patched.
                        type: object
                    type: object
                type: object
              type: array
            workloadSelector:
              properties:
                labels:
                  additionalProperties:
                    format: string
                    type: string
                  type: object
              type: object
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: gateways.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: Gateway
    listKind: GatewayList
    plural: gateways
    shortNames:
    - gw
    singular: gateway
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration affecting edge load balancer. See more details at: https://istio.io/docs/reference/config/networking/gateway.html'
          properties:
            selector:
              additionalProperties:
                format: string
                type: string
              type: object
            servers:
              description: A list of server specifications.
              items:
                properties:
                  bind:
                    format: string
                    type: string
                  defaultEndpoint:
                    format: string
                    type: string
                  hosts:
                    description: One or more hosts exposed by this gateway.
                    items:
                      format: string
                      type: string
                    type: array
                  port:
                    properties:
                      name:
                        description: Label assigned to the port.
                        format: string
                        type: string
                      number:
                        description: A valid non-negative integer port number.
                        type: integer
                      protocol:
                        description: The protocol exposed on the port.
                        format: string
                        type: string
                    type: object
                  tls:
                    description: Set of TLS related options that govern the server's behavior.
                    properties:
                      caCertificates:
                        description: REQUIRED if mode is `MUTUAL`.
                        format: string
                        type: string
                      cipherSuites:
                        description: 'Optional: If specified, only support the specified cipher list.'
                        items:
                          format: string
                          type: string
                        type: array
                      credentialName:
                        format: string
                        type: string
                      httpsRedirect:
                        type: boolean
                      maxProtocolVersion:
                        description: 'Optional: Maximum TLS protocol version.'
                        enum:
                        - TLS_AUTO
                        - TLSV1_0
                        - TLSV1_1
                        - TLSV1_2
                        - TLSV1_3
                        type: string
                      minProtocolVersion:
                        description: 'Optional: Minimum TLS protocol version.'
                        enum:
                        - TLS_AUTO
                        - TLSV1_0
                        - TLSV1_1
                        - TLSV1_2
                        - TLSV1_3
                        type: string
                      mode:
                        enum:
                        - PASSTHROUGH
                        - SIMPLE
                        - MUTUAL
                        - AUTO_PASSTHROUGH
                        - ISTIO_MUTUAL
                        type: string
                      privateKey:
                        description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                        format: string
                        type: string
                      serverCertificate:
                        description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                        format: string
                        type: string
                      subjectAltNames:
                        items:
                          format: string
                          type: string
                        type: array
                      verifyCertificateHash:
                        items:
                          format: string
                          type: string
                        type: array
                      verifyCertificateSpki:
                        items:
                          format: string
                          type: string
                        type: array
                    type: object
                type: object
              type: array
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
  - name: v1beta1
    served: true
    storage: false
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: serviceentries.networking.istio.io
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.hosts
    description: The hosts associated with the ServiceEntry
    name: Hosts
    type: string
  - JSONPath: .spec.location
    description: Whether the service is external to the mesh or part of the mesh (MESH_EXTERNAL or MESH_INTERNAL)
    name: Location
    type: string
  - JSONPath: .spec.resolution
    description: Service discovery mode for the hosts (NONE, STATIC, or DNS)
    name: Resolution
    type: string
  - JSONPath: .metadata.creationTimestamp
    description: 'CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
    name: Age
    type: date
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: ServiceEntry
    listKind: ServiceEntryList
    plural: serviceentries
    shortNames:
    - se
    singular: serviceentry
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration affecting service registry. See more details at: https://istio.io/docs/reference/config/networking/service-entry.html'
          properties:
            addresses:
              description: The virtual IP addresses associated with the service.
              items:
                format: string
                type: string
              type: array
            endpoints:
              description: One or more endpoints associated with the service.
              items:
                properties:
                  address:
                    format: string
                    type: string
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    description: One or more labels associated with the endpoint.
                    type: object
                  locality:
                    description: The locality associated with the endpoint.
                    format: string
                    type: string
                  network:
                    format: string
                    type: string
                  ports:
                    additionalProperties:
                      type: integer
                    description: Set of ports associated with the endpoint.
                    type: object
                  serviceAccount:
                    format: string
                    type: string
                  weight:
                    description: The load balancing weight associated with the endpoint.
                    type: integer
                type: object
              type: array
            exportTo:
              description: A list of namespaces to which this service is exported.
              items:
                format: string
                type: string
              type: array
            hosts:
              description: The hosts associated with the ServiceEntry.
              items:
                format: string
                type: string
              type: array
            location:
              enum:
              - MESH_EXTERNAL
              - MESH_INTERNAL
              type: string
            ports:
              description: The ports associated with the external service.
              items:
                properties:
                  name:
                    description: Label assigned to the port.
                    format: string
                    type: string
                  number:
                    description: A valid non-negative integer port number.
                    type: integer
                  protocol:
                    description: The protocol exposed on the port.
                    format: string
                    type: string
                type: object
              type: array
            resolution:
              description: Service discovery mode for the hosts.
              enum:
              - NONE
              - STATIC
              - DNS
              type: string
            subjectAltNames:
              items:
                format: string
                type: string
              type: array
            workloadSelector:
              description: Applicable only for MESH_INTERNAL services.
              properties:
                labels:
                  additionalProperties:
                    format: string
                    type: string
                  type: object
              type: object
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
  - name: v1beta1
    served: true
    storage: false
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: sidecars.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: Sidecar
    listKind: SidecarList
    plural: sidecars
    singular: sidecar
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration affecting network reachability of a sidecar. See more details at: https://istio.io/docs/reference/config/networking/sidecar.html'
          properties:
            egress:
              items:
                properties:
                  bind:
                    format: string
                    type: string
                  captureMode:
                    enum:
                    - DEFAULT
                    - IPTABLES
                    - NONE
                    type: string
                  hosts:
                    items:
                      format: string
                      type: string
                    type: array
                  localhostServerTls:
                    properties:
                      caCertificates:
                        description: REQUIRED if mode is `MUTUAL`.
                        format: string
                        type: string
                      cipherSuites:
                        description: 'Optional: If specified, only support the specified cipher list.'
                        items:
                          format: string
                          type: string
                        type: array
                      credentialName:
                        format: string
                        type: string
                      httpsRedirect:
                        type: boolean
                      maxProtocolVersion:
                        description: 'Optional: Maximum TLS protocol version.'
                        enum:
                        - TLS_AUTO
                        - TLSV1_0
                        - TLSV1_1
                        - TLSV1_2
                        - TLSV1_3
                        type: string
                      minProtocolVersion:
                        description: 'Optional: Minimum TLS protocol version.'
                        enum:
                        - TLS_AUTO
                        - TLSV1_0
                        - TLSV1_1
                        - TLSV1_2
                        - TLSV1_3
                        type: string
                      mode:
                        enum:
                        - PASSTHROUGH
                        - SIMPLE
                        - MUTUAL
                        - AUTO_PASSTHROUGH
                        - ISTIO_MUTUAL
                        type: string
                      privateKey:
                        description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                        format: string
                        type: string
                      serverCertificate:
                        description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                        format: string
                        type: string
                      subjectAltNames:
                        items:
                          format: string
                          type: string
                        type: array
                      verifyCertificateHash:
                        items:
                          format: string
                          type: string
                        type: array
                      verifyCertificateSpki:
                        items:
                          format: string
                          type: string
                        type: array
                    type: object
                  port:
                    description: The port associated with the listener.
                    properties:
                      name:
                        description: Label assigned to the port.
                        format: string
                        type: string
                      number:
                        description: A valid non-negative integer port number.
                        type: integer
                      protocol:
                        description: The protocol exposed on the port.
                        format: string
                        type: string
                    type: object
                type: object
              type: array
            ingress:
              items:
                properties:
                  bind:
                    description: The IP to which the listener should be bound.
                    format: string
                    type: string
                  captureMode:
                    enum:
                    - DEFAULT
                    - IPTABLES
                    - NONE
                    type: string
                  defaultEndpoint:
                    format: string
                    type: string
                  localhostClientTls:
                    properties:
                      caCertificates:
                        format: string
                        type: string
                      clientCertificate:
                        description: REQUIRED if mode is `MUTUAL`.
                        format: string
                        type: string
                      mode:
                        enum:
                        - DISABLE
                        - SIMPLE
                        - MUTUAL
                        - ISTIO_MUTUAL
                        type: string
                      privateKey:
                        description: REQUIRED if mode is `MUTUAL`.
                        format: string
                        type: string
                      sni:
                        description: SNI string to present to the server during TLS handshake.
                        format: string
                        type: string
                      subjectAltNames:
                        items:
                          format: string
                          type: string
                        type: array
                    type: object
                  port:
                    description: The port associated with the listener.
                    properties:
                      name:
                        description: Label assigned to the port.
                        format: string
                        type: string
                      number:
                        description: A valid non-negative integer port number.
                        type: integer
                      protocol:
                        description: The protocol exposed on the port.
                        format: string
                        type: string
                    type: object
                type: object
              type: array
            localhost:
              properties:
                clientTls:
                  properties:
                    caCertificates:
                      format: string
                      type: string
                    clientCertificate:
                      description: REQUIRED if mode is `MUTUAL`.
                      format: string
                      type: string
                    mode:
                      enum:
                      - DISABLE
                      - SIMPLE
                      - MUTUAL
                      - ISTIO_MUTUAL
                      type: string
                    privateKey:
                      description: REQUIRED if mode is `MUTUAL`.
                      format: string
                      type: string
                    sni:
                      description: SNI string to present to the server during TLS handshake.
                      format: string
                      type: string
                    subjectAltNames:
                      items:
                        format: string
                        type: string
                      type: array
                  type: object
                serverTls:
                  properties:
                    caCertificates:
                      description: REQUIRED if mode is `MUTUAL`.
                      format: string
                      type: string
                    cipherSuites:
                      description: 'Optional: If specified, only support the specified cipher list.'
                      items:
                        format: string
                        type: string
                      type: array
                    credentialName:
                      format: string
                      type: string
                    httpsRedirect:
                      type: boolean
                    maxProtocolVersion:
                      description: 'Optional: Maximum TLS protocol version.'
                      enum:
                      - TLS_AUTO
                      - TLSV1_0
                      - TLSV1_1
                      - TLSV1_2
                      - TLSV1_3
                      type: string
                    minProtocolVersion:
                      description: 'Optional: Minimum TLS protocol version.'
                      enum:
                      - TLS_AUTO
                      - TLSV1_0
                      - TLSV1_1
                      - TLSV1_2
                      - TLSV1_3
                      type: string
                    mode:
                      enum:
                      - PASSTHROUGH
                      - SIMPLE
                      - MUTUAL
                      - AUTO_PASSTHROUGH
                      - ISTIO_MUTUAL
                      type: string
                    privateKey:
                      description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                      format: string
                      type: string
                    serverCertificate:
                      description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                      format: string
                      type: string
                    subjectAltNames:
                      items:
                        format: string
                        type: string
                      type: array
                    verifyCertificateHash:
                      items:
                        format: string
                        type: string
                      type: array
                    verifyCertificateSpki:
                      items:
                        format: string
                        type: string
                      type: array
                  type: object
              type: object
            outboundTrafficPolicy:
              description: Configuration for the outbound traffic policy.
              properties:
                egressProxy:
                  properties:
                    host:
                      description: The name of a service from the service registry.
                      format: string
                      type: string
                    port:
                      description: Specifies the port on the host that is being addressed.
                      properties:
                        number:
                          type: integer
                      type: object
                    subset:
                      description: The name of a subset within the service.
                      format: string
                      type: string
                  type: object
                mode:
                  enum:
                  - REGISTRY_ONLY
                  - ALLOW_ANY
                  type: string
              type: object
            workloadSelector:
              properties:
                labels:
                  additionalProperties:
                    format: string
                    type: string
                  type: object
              type: object
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
  - name: v1beta1
    served: true
    storage: false
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: virtualservices.networking.istio.io
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.gateways
    description: The names of gateways and sidecars that should apply these routes
    name: Gateways
    type: string
  - JSONPath: .spec.hosts
    description: The destination hosts to which traffic is being sent
    name: Hosts
    type: string
  - JSONPath: .metadata.creationTimestamp
    description: 'CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
    name: Age
    type: date
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: VirtualService
    listKind: VirtualServiceList
    plural: virtualservices
    shortNames:
    - vs
    singular: virtualservice
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration affecting label/content routing, sni routing, etc. See more details at: https://istio.io/docs/reference/config/networking/virtual-service.html'
          properties:
            exportTo:
              description: A list of namespaces to which this virtual service is exported.
              items:
                format: string
                type: string
              type: array
            gateways:
              description: The names of gateways and sidecars that should apply these routes.
              items:
                format: string
                type: string
              type: array
            hosts:
              description: The destination hosts to which traffic is being sent.
              items:
                format: string
                type: string
              type: array
            http:
              description: An ordered list of route rules for HTTP traffic.
              items:
                properties:
                  corsPolicy:
                    description: Cross-Origin Resource Sharing policy (CORS).
                    properties:
                      allowCredentials:
                        type: boolean
                      allowHeaders:
                        items:
                          format: string
                          type: string
                        type: array
                      allowMethods:
                        description: List of HTTP methods allowed to access the resource.
                        items:
                          format: string
                          type: string
                        type: array
                      allowOrigin:
                        description: The list of origins that are allowed to perform CORS requests.
                        items:
                          format: string
                          type: string
                        type: array
                      allowOrigins:
                        description: String patterns that match allowed origins.
                        items:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                          - required:
                            - exact
                          - required:
                            - prefix
                          - required:
                            - regex
                          properties:
                            exact:
                              format: string
                              type: string
                            prefix:
                              format: string
                              type: string
                            regex:
                              description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                              format: string
                              type: string
                          type: object
                        type: array
                      exposeHeaders:
                        items:
                          format: string
                          type: string
                        type: array
                      maxAge:
                        type: string
                    type: object
                  delegate:
                    properties:
                      name:
                        description: Name specifies the name of the delegate VirtualService.
                        format: string
                        type: string
                      namespace:
                        description: Namespace specifies the namespace where the delegate VirtualService resides.
                        format: string
                        type: string
                    type: object
                  fault:
                    description: Fault injection policy to apply on HTTP traffic at the client side.
                    properties:
                      abort:
                        oneOf:
                        - not:
                            anyOf:
                            - required:
                              - httpStatus
                            - required:
                              - grpcStatus
                            - required:
                              - http2Error
                        - required:
                          - httpStatus
                        - required:
                          - grpcStatus
                        - required:
                          - http2Error
                        properties:
                          grpcStatus:
                            format: string
                            type: string
                          http2Error:
                            format: string
                            type: string
                          httpStatus:
                            description: HTTP status code to use to abort the Http request.
                            format: int32
                            type: integer
                          percentage:
                            description: Percentage of requests to be aborted with the error code provided.
                            properties:
                              value:
                                format: double
                                type: number
                            type: object
                        type: object
                      delay:
                        oneOf:
                        - not:
                            anyOf:
                            - required:
                              - fixedDelay
                            - required:
                              - exponentialDelay
                        - required:
                          - fixedDelay
                        - required:
                          - exponentialDelay
                        properties:
                          exponentialDelay:
                            type: string
                          fixedDelay:
                            description: Add a fixed delay before forwarding the request.
                            type: string
                          percent:
                            description: Percentage of requests on which the delay will be injected (0-100).
                            format: int32
                            type: integer
                          percentage:
                            description: Percentage of requests on which the delay will be injected.
                            properties:
                              value:
                                format: double
                                type: number
                            type: object
                        type: object
                    type: object
                  headers:
                    properties:
                      request:
                        properties:
                          add:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          remove:
                            items:
                              format: string
                              type: string
                            type: array
                          set:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                        type: object
                      response:
                        properties:
                          add:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          remove:
                            items:
                              format: string
                              type: string
                            type: array
                          set:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                        type: object
                    type: object
                  match:
                    items:
                      properties:
                        authority:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                          - required:
                            - exact
                          - required:
                            - prefix
                          - required:
                            - regex
                          properties:
                            exact:
                              format: string
                              type: string
                            prefix:
                              format: string
                              type: string
                            regex:
                              description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                              format: string
                              type: string
                          type: object
                        gateways:
                          description: Names of gateways where the rule should be applied.
                          items:
                            format: string
                            type: string
                          type: array
                        headers:
                          additionalProperties:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          type: object
                        ignoreUriCase:
                          description: Flag to specify whether the URI matching should be case-insensitive.
                          type: boolean
                        method:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                          - required:
                            - exact
                          - required:
                            - prefix
                          - required:
                            - regex
                          properties:
                            exact:
                              format: string
                              type: string
                            prefix:
                              format: string
                              type: string
                            regex:
                              description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                              format: string
                              type: string
                          type: object
                        name:
                          description: The name assigned to a match.
                          format: string
                          type: string
                        port:
                          description: Specifies the ports on the host that is being addressed.
                          type: integer
                        queryParams:
                          additionalProperties:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          description: Query parameters for matching.
                          type: object
                        scheme:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                          - required:
                            - exact
                          - required:
                            - prefix
                          - required:
                            - regex
                          properties:
                            exact:
                              format: string
                              type: string
                            prefix:
                              format: string
                              type: string
                            regex:
                              description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                              format: string
                              type: string
                          type: object
                        sourceLabels:
                          additionalProperties:
                            format: string
                            type: string
                          type: object
                        sourceNamespace:
                          description: Source namespace constraining the applicability of a rule to workloads in that namespace.
                          format: string
                          type: string
                        uri:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                          - required:
                            - exact
                          - required:
                            - prefix
                          - required:
                            - regex
                          properties:
                            exact:
                              format: string
                              type: string
                            prefix:
                              format: string
                              type: string
                            regex:
                              description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                              format: string
                              type: string
                          type: object
                        withoutHeaders:
                          additionalProperties:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          description: withoutHeader has the same syntax with the header, but has opposite meaning.
                          type: object
                      type: object
                    type: array
                  mirror:
                    properties:
                      host:
                        description: The name of a service from the service registry.
                        format: string
                        type: string
                      port:
                        description: Specifies the port on the host that is being addressed.
                        properties:
                          number:
                            type: integer
                        type: object
                      subset:
                        description: The name of a subset within the service.
                        format: string
                        type: string
                    type: object
                  mirror_percent:
                    description: Percentage of the traffic to be mirrored by the `mirror` field.
                    type: integer
                  mirrorPercent:
                    description: Percentage of the traffic to be mirrored by the `mirror` field.
                    type: integer
                  mirrorPercentage:
                    description: Percentage of the traffic to be mirrored by the `mirror` field.
                    properties:
                      value:
                        format: double
                        type: number
                    type: object
                  name:
                    description: The name assigned to the route for debugging purposes.
                    format: string
                    type: string
                  redirect:
                    description: A HTTP rule can either redirect or forward (default) traffic.
                    properties:
                      authority:
                        format: string
                        type: string
                      redirectCode:
                        type: integer
                      uri:
                        format: string
                        type: string
                    type: object
                  retries:
                    description: Retry policy for HTTP requests.
                    properties:
                      attempts:
                        description: Number of retries for a given request.
                        format: int32
                        type: integer
                      perTryTimeout:
                        description: Timeout per retry attempt for a given request.
                        type: string
                      retryOn:
                        description: Specifies the conditions under which retry takes place.
                        format: string
                        type: string
                      retryRemoteLocalities:
                        description: Flag to specify whether the retries should retry to other localities.
                        type: boolean
                    type: object
                  rewrite:
                    description: Rewrite HTTP URIs and Authority headers.
                    properties:
                      authority:
                        description: rewrite the Authority/Host header with this value.
                        format: string
                        type: string
                      uri:
                        format: string
                        type: string
                    type: object
                  route:
                    description: A HTTP rule can either redirect or forward (default) traffic.
                    items:
                      properties:
                        destination:
                          properties:
                            host:
                              description: The name of a service from the service registry.
                              format: string
                              type: string
                            port:
                              description: Specifies the port on the host that is being addressed.
                              properties:
                                number:
                                  type: integer
                              type: object
                            subset:
                              description: The name of a subset within the service.
                              format: string
                              type: string
                          type: object
                        headers:
                          properties:
                            request:
                              properties:
                                add:
                                  additionalProperties:
                                    format: string
                                    type: string
                                  type: object
                                remove:
                                  items:
                                    format: string
                                    type: string
                                  type: array
                                set:
                                  additionalProperties:
                                    format: string
                                    type: string
                                  type: object
                              type: object
                            response:
                              properties:
                                add:
                                  additionalProperties:
                                    format: string
                                    type: string
                                  type: object
                                remove:
                                  items:
                                    format: string
                                    type: string
                                  type: array
                                set:
                                  additionalProperties:
                                    format: string
                                    type: string
                                  type: object
                              type: object
                          type: object
                        weight:
                          format: int32
                          type: integer
                      type: object
                    type: array
                  timeout:
                    description: Timeout for HTTP requests.
                    type: string
                type: object
              type: array
            tcp:
              description: An ordered list of route rules for opaque TCP traffic.
              items:
                properties:
                  match:
                    items:
                      properties:
                        destinationSubnets:
                          description: IPv4 or IPv6 ip addresses of destination with optional subnet.
                          items:
                            format: string
                            type: string
                          type: array
                        gateways:
                          description: Names of gateways where the rule should be applied.
                          items:
                            format: string
                            type: string
                          type: array
                        port:
                          description: Specifies the port on the host that is being addressed.
                          type: integer
                        sourceLabels:
                          additionalProperties:
                            format: string
                            type: string
                          type: object
                        sourceNamespace:
                          description: Source namespace constraining the applicability of a rule to workloads in that namespace.
                          format: string
                          type: string
                        sourceSubnet:
                          description: IPv4 or IPv6 ip address of source with optional subnet.
                          format: string
                          type: string
                      type: object
                    type: array
                  route:
                    description: The destination to which the connection should be forwarded to.
                    items:
                      properties:
                        destination:
                          properties:
                            host:
                              description: The name of a service from the service registry.
                              format: string
                              type: string
                            port:
                              description: Specifies the port on the host that is being addressed.
                              properties:
                                number:
                                  type: integer
                              type: object
                            subset:
                              description: The name of a subset within the service.
                              format: string
                              type: string
                          type: object
                        weight:
                          format: int32
                          type: integer
                      type: object
                    type: array
                type: object
              type: array
            tls:
              items:
                properties:
                  match:
                    items:
                      properties:
                        destinationSubnets:
                          description: IPv4 or IPv6 ip addresses of destination with optional subnet.
                          items:
                            format: string
                            type: string
                          type: array
                        gateways:
                          description: Names of gateways where the rule should be applied.
                          items:
                            format: string
                            type: string
                          type: array
                        port:
                          description: Specifies the port on the host that is being addressed.
                          type: integer
                        sniHosts:
                          description: SNI (server name indicator) to match on.
                          items:
                            format: string
                            type: string
                          type: array
                        sourceLabels:
                          additionalProperties:
                            format: string
                            type: string
                          type: object
                        sourceNamespace:
                          description: Source namespace constraining the applicability of a rule to workloads in that namespace.
                          format: string
                          type: string
                      type: object
                    type: array
                  route:
                    description: The destination to which the connection should be forwarded to.
                    items:
                      properties:
                        destination:
                          properties:
                            host:
                              description: The name of a service from the service registry.
                              format: string
                              type: string
                            port:
                              description: Specifies the port on the host that is being addressed.
                              properties:
                                number:
                                  type: integer
                              type: object
                            subset:
                              description: The name of a subset within the service.
                              format: string
                              type: string
                          type: object
                        weight:
                          format: int32
                          type: integer
                      type: object
                    type: array
                type: object
              type: array
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
  - name: v1beta1
    served: true
    storage: false
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: workloadentries.networking.istio.io
spec:
  additionalPrinterColumns:
  - JSONPath: .metadata.creationTimestamp
    description: 'CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
    name: Age
    type: date
  - JSONPath: .spec.address
    description: Address associated with the network endpoint.
    name: Address
    type: string
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: WorkloadEntry
    listKind: WorkloadEntryList
    plural: workloadentries
    shortNames:
    - we
    singular: workloadentry
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration affecting VMs onboarded into the mesh. See more details at: https://istio.io/docs/reference/config/networking/workload-entry.html'
          properties:
            address:
              format: string
              type: string
            labels:
              additionalProperties:
                format: string
                type: string
              description: One or more labels associated with the endpoint.
              type: object
            locality:
              description: The locality associated with the endpoint.
              format: string
              type: string
            network:
              format: string
              type: string
            ports:
              additionalProperties:
                type: integer
              description: Set of ports associated with the endpoint.
              type: object
            serviceAccount:
              format: string
              type: string
            weight:
              description: The load balancing weight associated with the endpoint.
              type: integer
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
  - name: v1beta1
    served: true
    storage: false
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: core
    package: istio.io.mixer
    release: istio
  name: attributemanifests.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: attributemanifest
    listKind: attributemanifestList
    plural: attributemanifests
    singular: attributemanifest
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Describes the rules used to configure Mixer''s policy and telemetry features. See more details at: https://istio.io/docs/reference/config/policy-and-telemetry/istio.policy.v1beta1.html'
          properties:
            attributes:
              additionalProperties:
                properties:
                  description:
                    description: A human-readable description of the attribute's purpose.
                    format: string
                    type: string
                  valueType:
                    description: The type of data carried by this attribute.
                    enum:
                    - VALUE_TYPE_UNSPECIFIED
                    - STRING
                    - INT64
                    - DOUBLE
                    - BOOL
                    - TIMESTAMP
                    - IP_ADDRESS
                    - EMAIL_ADDRESS
                    - URI
                    - DNS_NAME
                    - DURATION
                    - STRING_MAP
                    type: string
                type: object
              description: The set of attributes this Istio component will be responsible for producing at runtime.
              type: object
            name:
              description: Name of the component producing these attributes.
              format: string
              type: string
            revision:
              description: The revision of this document.
              format: string
              type: string
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: mixer-handler
    package: handler
    release: istio
  name: handlers.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: handler
    listKind: handlerList
    plural: handlers
    singular: handler
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: Handler allows the operator to configure a specific adapter implementation.
          properties:
            adapter:
              description: The name of a specific adapter implementation.
              format: string
              type: string
            compiledAdapter:
              description: The name of the compiled in adapter this handler instantiates.
              format: string
              type: string
            connection:
              description: Information on how to connect to the out-of-process adapter.
              properties:
                address:
                  description: The address of the backend.
                  format: string
                  type: string
                authentication:
                  description: Auth config for the connection to the backend.
                  oneOf:
                  - not:
                      anyOf:
                      - properties:
                          tls:
                            allOf:
                            - oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - tokenPath
                                  - required:
                                    - oauth
                              - required:
                                - tokenPath
                              - required:
                                - oauth
                            - oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - authHeader
                                  - required:
                                    - customHeader
                              - required:
                                - authHeader
                              - required:
                                - customHeader
                        required:
                        - tls
                      - required:
                        - mutual
                  - properties:
                      tls:
                        allOf:
                        - oneOf:
                          - not:
                              anyOf:
                              - required:
                                - tokenPath
                              - required:
                                - oauth
                          - required:
                            - tokenPath
                          - required:
                            - oauth
                        - oneOf:
                          - not:
                              anyOf:
                              - required:
                                - authHeader
                              - required:
                                - customHeader
                          - required:
                            - authHeader
                          - required:
                            - customHeader
                    required:
                    - tls
                  - required:
                    - mutual
                  properties:
                    mutual:
                      properties:
                        caCertificates:
                          format: string
                          type: string
                        clientCertificate:
                          description: The path to the file holding client certificate for mutual TLS.
                          format: string
                          type: string
                        privateKey:
                          description: The path to the file holding the private key for mutual TLS.
                          format: string
                          type: string
                        serverName:
                          description: Used to configure mixer mutual TLS client to supply server name for SNI.
                          format: string
                          type: string
                      type: object
                    tls:
                      properties:
                        authHeader:
                          description: Access token is passed as authorization header.
                          enum:
                          - PLAIN
                          - BEARER
                          type: string
                        caCertificates:
                          format: string
                          type: string
                        customHeader:
                          description: Customized header key to hold access token, e.g.
                          format: string
                          type: string
                        oauth:
                          description: Oauth config to fetch access token from auth provider.
                          properties:
                            clientId:
                              description: OAuth client id for mixer.
                              format: string
                              type: string
                            clientSecret:
                              description: The path to the file holding the client secret for oauth.
                              format: string
                              type: string
                            endpointParams:
                              additionalProperties:
                                format: string
                                type: string
                              description: Additional parameters for requests to the token endpoint.
                              type: object
                            scopes:
                              description: List of requested permissions.
                              items:
                                format: string
                                type: string
                              type: array
                            tokenUrl:
                              description: The Resource server's token endpoint URL.
                              format: string
                              type: string
                          type: object
                        serverName:
                          format: string
                          type: string
                        tokenPath:
                          format: string
                          type: string
                      type: object
                  type: object
                timeout:
                  description: Timeout for remote calls to the backend.
                  type: string
              type: object
            name:
              description: Must be unique in the entire Mixer configuration.
              format: string
              type: string
            params:
              description: Depends on adapter implementation.
              type: object
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: mixer-instance
    package: instance
    release: istio
  name: instances.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: instance
    listKind: instanceList
    plural: instances
    singular: instance
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: An Instance tells Mixer how to create instances for particular template.
          properties:
            attributeBindings:
              additionalProperties:
                format: string
                type: string
              type: object
            compiledTemplate:
              description: The name of the compiled in template this instance creates instances for.
              format: string
              type: string
            name:
              format: string
              type: string
            params:
              description: Depends on referenced template.
              type: object
            template:
              description: The name of the template this instance creates instances for.
              format: string
              type: string
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: core
    package: istio.io.mixer
    release: istio
  name: rules.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: rule
    listKind: ruleList
    plural: rules
    singular: rule
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Describes the rules used to configure Mixer''s policy and telemetry features. See more details at: https://istio.io/docs/reference/config/policy-and-telemetry/istio.policy.v1beta1.html'
          properties:
            actions:
              description: The actions that will be executed when match evaluates to `true`.
              items:
                properties:
                  handler:
                    description: Fully qualified name of the handler to invoke.
                    format: string
                    type: string
                  instances:
                    items:
                      format: string
                      type: string
                    type: array
                  name:
                    description: A handle to refer to the results of the action.
                    format: string
                    type: string
                type: object
              type: array
            match:
              description: Match is an attribute based predicate.
              format: string
              type: string
            requestHeaderOperations:
              items:
                properties:
                  name:
                    description: Header name literal value.
                    format: string
                    type: string
                  operation:
                    description: Header operation type.
                    enum:
                    - REPLACE
                    - REMOVE
                    - APPEND
                    type: string
                  values:
                    description: Header value expressions.
                    items:
                      format: string
                      type: string
                    type: array
                type: object
              type: array
            responseHeaderOperations:
              items:
                properties:
                  name:
                    description: Header name literal value.
                    format: string
                    type: string
                  operation:
                    description: Header operation type.
                    enum:
                    - REPLACE
                    - REMOVE
                    - APPEND
                    type: string
                  values:
                    description: Header value expressions.
                    items:
                      format: string
                      type: string
                    type: array
                type: object
              type: array
            sampling:
              properties:
                random:
                  description: Provides filtering of actions based on random selection per request.
                  properties:
                    attributeExpression:
                      description: Specifies an attribute expression to use to override the numerator in the `percent_sampled` field.
                      format: string
                      type: string
                    percentSampled:
                      description: The default sampling rate, expressed as a percentage.
                      properties:
                        denominator:
                          description: Specifies the denominator.
                          enum:
                          - HUNDRED
                          - TEN_THOUSAND
                          type: string
                        numerator:
                          description: Specifies the numerator.
                          type: integer
                      type: object
                    useIndependentRandomness:
                      description: By default sampling will be based on the value of the request header `x-request-id`.
                      type: boolean
                  type: object
                rateLimit:
                  properties:
                    maxUnsampledEntries:
                      description: Number of entries to allow during the `sampling_duration` before sampling is enforced.
                      format: int64
                      type: integer
                    samplingDuration:
                      description: Window in which to enforce the sampling rate.
                      type: string
                    samplingRate:
                      description: The rate at which to sample entries once the unsampled limit has been reached.
                      format: int64
                      type: integer
                  type: object
              type: object
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    istio: rbac
    release: istio
  name: clusterrbacconfigs.rbac.istio.io
spec:
  group: rbac.istio.io
  names:
    categories:
    - istio-io
    - rbac-istio-io
    kind: ClusterRbacConfig
    listKind: ClusterRbacConfigList
    plural: clusterrbacconfigs
    singular: clusterrbacconfig
  preserveUnknownFields: false
  scope: Cluster
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'See more details at:'
          properties:
            enforcementMode:
              enum:
              - ENFORCED
              - PERMISSIVE
              type: string
            exclusion:
              description: A list of services or namespaces that should not be enforced by Istio RBAC policies.
              properties:
                namespaces:
                  description: A list of namespaces.
                  items:
                    format: string
                    type: string
                  type: array
                services:
                  description: A list of services.
                  items:
                    format: string
                    type: string
                  type: array
              type: object
            inclusion:
              description: A list of services or namespaces that should be enforced by Istio RBAC policies.
              properties:
                namespaces:
                  description: A list of namespaces.
                  items:
                    format: string
                    type: string
                  type: array
                services:
                  description: A list of services.
                  items:
                    format: string
                    type: string
                  type: array
              type: object
            mode:
              description: Istio RBAC mode.
              enum:
              - "OFF"
              - "ON"
              - ON_WITH_INCLUSION
              - ON_WITH_EXCLUSION
              type: string
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: rbac
    package: istio.io.mixer
    release: istio
  name: rbacconfigs.rbac.istio.io
spec:
  group: rbac.istio.io
  names:
    categories:
    - istio-io
    - rbac-istio-io
    kind: RbacConfig
    listKind: RbacConfigList
    plural: rbacconfigs
    singular: rbacconfig
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'See more details at:'
          properties:
            enforcementMode:
              enum:
              - ENFORCED
              - PERMISSIVE
              type: string
            exclusion:
              description: A list of services or namespaces that should not be enforced by Istio RBAC policies.
              properties:
                namespaces:
                  description: A list of namespaces.
                  items:
                    format: string
                    type: string
                  type: array
                services:
                  description: A list of services.
                  items:
                    format: string
                    type: string
                  type: array
              type: object
            inclusion:
              description: A list of services or namespaces that should be enforced by Istio RBAC policies.
              properties:
                namespaces:
                  description: A list of namespaces.
                  items:
                    format: string
                    type: string
                  type: array
                services:
                  description: A list of services.
                  items:
                    format: string
                    type: string
                  type: array
              type: object
            mode:
              description: Istio RBAC mode.
              enum:
              - "OFF"
              - "ON"
              - ON_WITH_INCLUSION
              - ON_WITH_EXCLUSION
              type: string
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: rbac
    package: istio.io.mixer
    release: istio
  name: serviceroles.rbac.istio.io
spec:
  group: rbac.istio.io
  names:
    categories:
    - istio-io
    - rbac-istio-io
    kind: ServiceRole
    listKind: ServiceRoleList
    plural: serviceroles
    singular: servicerole
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'See more details at:'
          properties:
            rules:
              description: The set of access rules (permissions) that the role has.
              items:
                properties:
                  constraints:
                    description: Optional.
                    items:
                      properties:
                        key:
                          description: Key of the constraint.
                          format: string
                          type: string
                        values:
                          description: List of valid values for the constraint.
                          items:
                            format: string
                            type: string
                          type: array
                      type: object
                    type: array
                  hosts:
                    items:
                      format: string
                      type: string
                    type: array
                  methods:
                    description: Optional.
                    items:
                      format: string
                      type: string
                    type: array
                  notHosts:
                    items:
                      format: string
                      type: string
                    type: array
                  notMethods:
                    items:
                      format: string
                      type: string
                    type: array
                  notPaths:
                    items:
                      format: string
                      type: string
                    type: array
                  notPorts:
                    items:
                      format: int32
                      type: integer
                    type: array
                  paths:
                    description: Optional.
                    items:
                      format: string
                      type: string
                    type: array
                  ports:
                    items:
                      format: int32
                      type: integer
                    type: array
                  services:
                    description: A list of service names.
                    items:
                      format: string
                      type: string
                    type: array
                type: object
              type: array
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: rbac
    package: istio.io.mixer
    release: istio
  name: servicerolebindings.rbac.istio.io
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.roleRef.name
    description: The name of the ServiceRole object being referenced
    name: Reference
    type: string
  - JSONPath: .metadata.creationTimestamp
    description: 'CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
    name: Age
    type: date
  group: rbac.istio.io
  names:
    categories:
    - istio-io
    - rbac-istio-io
    kind: ServiceRoleBinding
    listKind: ServiceRoleBindingList
    plural: servicerolebindings
    singular: servicerolebinding
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'See more details at:'
          properties:
            actions:
              items:
                properties:
                  constraints:
                    description: Optional.
                    items:
                      properties:
                        key:
                          description: Key of the constraint.
                          format: string
                          type: string
                        values:
                          description: List of valid values for the constraint.
                          items:
                            format: string
                            type: string
                          type: array
                      type: object
                    type: array
                  hosts:
                    items:
                      format: string
                      type: string
                    type: array
                  methods:
                    description: Optional.
                    items:
                      format: string
                      type: string
                    type: array
                  notHosts:
                    items:
                      format: string
                      type: string
                    type: array
                  notMethods:
                    items:
                      format: string
                      type: string
                    type: array
                  notPaths:
                    items:
                      format: string
                      type: string
                    type: array
                  notPorts:
                    items:
                      format: int32
                      type: integer
                    type: array
                  paths:
                    description: Optional.
                    items:
                      format: string
                      type: string
                    type: array
                  ports:
                    items:
                      format: int32
                      type: integer
                    type: array
                  services:
                    description: A list of service names.
                    items:
                      format: string
                      type: string
                    type: array
                type: object
              type: array
            mode:
              enum:
              - ENFORCED
              - PERMISSIVE
              type: string
            role:
              format: string
              type: string
            roleRef:
              description: Reference to the ServiceRole object.
              properties:
                kind:
                  description: The type of the role being referenced.
                  format: string
                  type: string
                name:
                  description: The name of the ServiceRole object being referenced.
                  format: string
                  type: string
              type: object
            subjects:
              description: List of subjects that are assigned the ServiceRole object.
              items:
                properties:
                  group:
                    format: string
                    type: string
                  groups:
                    items:
                      format: string
                      type: string
                    type: array
                  ips:
                    items:
                      format: string
                      type: string
                    type: array
                  names:
                    items:
                      format: string
                      type: string
                    type: array
                  namespaces:
                    items:
                      format: string
                      type: string
                    type: array
                  notGroups:
                    items:
                      format: string
                      type: string
                    type: array
                  notIps:
                    items:
                      format: string
                      type: string
                    type: array
                  notNames:
                    items:
                      format: string
                      type: string
                    type: array
                  notNamespaces:
                    items:
                      format: string
                      type: string
                    type: array
                  properties:
                    additionalProperties:
                      format: string
                      type: string
                    description: Optional.
                    type: object
                  user:
                    description: Optional.
                    format: string
                    type: string
                type: object
              type: array
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    istio: security
    release: istio
  name: authorizationpolicies.security.istio.io
spec:
  group: security.istio.io
  names:
    categories:
    - istio-io
    - security-istio-io
    kind: AuthorizationPolicy
    listKind: AuthorizationPolicyList
    plural: authorizationpolicies
    singular: authorizationpolicy
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration for access control on workloads. See more details at: https://istio.io/docs/reference/config/security/authorization-policy.html'
          properties:
            action:
              description: Optional.
              enum:
              - ALLOW
              - DENY
              type: string
            rules:
              description: Optional.
              items:
                properties:
                  from:
                    description: Optional.
                    items:
                      properties:
                        source:
                          description: Source specifies the source of a request.
                          properties:
                            ipBlocks:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            namespaces:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            notIpBlocks:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            notNamespaces:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            notPrincipals:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            notRequestPrincipals:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            principals:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            requestPrincipals:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                          type: object
                      type: object
                    type: array
                  to:
                    description: Optional.
                    items:
                      properties:
                        operation:
                          description: Operation specifies the operation of a request.
                          properties:
                            hosts:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            methods:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            notHosts:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            notMethods:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            notPaths:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            notPorts:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            paths:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            ports:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                          type: object
                      type: object
                    type: array
                  when:
                    description: Optional.
                    items:
                      properties:
                        key:
                          description: The name of an Istio attribute.
                          format: string
                          type: string
                        notValues:
                          description: Optional.
                          items:
                            format: string
                            type: string
                          type: array
                        values:
                          description: Optional.
                          items:
                            format: string
                            type: string
                          type: array
                      type: object
                    type: array
                type: object
              type: array
            selector:
              description: Optional.
              properties:
                matchLabels:
                  additionalProperties:
                    format: string
                    type: string
                  type: object
              type: object
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1beta1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    istio: security
    release: istio
  name: peerauthentications.security.istio.io
spec:
  group: security.istio.io
  names:
    categories:
    - istio-io
    - security-istio-io
    kind: PeerAuthentication
    listKind: PeerAuthenticationList
    plural: peerauthentications
    shortNames:
    - pa
    singular: peerauthentication
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: PeerAuthentication defines how traffic will be tunneled (or not) to the sidecar.
          properties:
            mtls:
              description: Mutual TLS settings for workload.
              properties:
                mode:
                  description: Defines the mTLS mode used for peer authentication.
                  enum:
                  - UNSET
                  - DISABLE
                  - PERMISSIVE
                  - STRICT
                  type: string
              type: object
            portLevelMtls:
              additionalProperties:
                properties:
                  mode:
                    description: Defines the mTLS mode used for peer authentication.
                    enum:
                    - UNSET
                    - DISABLE
                    - PERMISSIVE
                    - STRICT
                    type: string
                type: object
              description: Port specific mutual TLS settings.
              type: object
            selector:
              description: The selector determines the workloads to apply the ChannelAuthentication on.
              properties:
                matchLabels:
                  additionalProperties:
                    format: string
                    type: string
                  type: object
              type: object
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1beta1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    istio: security
    release: istio
  name: requestauthentications.security.istio.io
spec:
  group: security.istio.io
  names:
    categories:
    - istio-io
    - security-istio-io
    kind: RequestAuthentication
    listKind: RequestAuthenticationList
    plural: requestauthentications
    shortNames:
    - ra
    singular: requestauthentication
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: RequestAuthentication defines what request authentication methods are supported by a workload.
          properties:
            jwtRules:
              description: Define the list of JWTs that can be validated at the selected workloads' proxy.
              items:
                properties:
                  audiences:
                    items:
                      format: string
                      type: string
                    type: array
                  forwardOriginalToken:
                    description: If set to true, the orginal token will be kept for the ustream request.
                    type: boolean
                  fromHeaders:
                    description: List of header locations from which JWT is expected.
                    items:
                      properties:
                        name:
                          description: The HTTP header name.
                          format: string
                          type: string
                        prefix:
                          description: The prefix that should be stripped before decoding the token.
                          format: string
                          type: string
                      type: object
                    type: array
                  fromParams:
                    description: List of query parameters from which JWT is expected.
                    items:
                      format: string
                      type: string
                    type: array
                  issuer:
                    description: Identifies the issuer that issued the JWT.
                    format: string
                    type: string
                  jwks:
                    description: JSON Web Key Set of public keys to validate signature of the JWT.
                    format: string
                    type: string
                  jwks_uri:
                    format: string
                    type: string
                  jwksUri:
                    format: string
                    type: string
                  outputPayloadToHeader:
                    format: string
                    type: string
                type: object
              type: array
            selector:
              description: The selector determines the workloads to apply the RequestAuthentication on.
              properties:
                matchLabels:
                  additionalProperties:
                    format: string
                    type: string
                  type: object
              type: object
          type: object
        status:
          type: object
          x-kubernetes-preserve-unknown-fields: true
      type: object
  versions:
  - name: v1beta1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: mixer-adapter
    package: adapter
    release: istio
  name: adapters.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: adapter
    plural: adapters
    singular: adapter
  scope: Namespaced
  subresources:
    status: {}
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: mixer-template
    package: template
    release: istio
  name: templates.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: template
    plural: templates
    singular: template
  scope: Namespaced
  subresources:
    status: {}
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    release: istio
  name: istiooperators.install.istio.io
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.revision
    description: Istio control plane revision
    name: Revision
    type: string
  - JSONPath: .metadata.creationTimestamp
    description: 'CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
    name: Age
    type: date
  group: install.istio.io
  names:
    kind: IstioOperator
    plural: istiooperators
    shortNames:
    - iop
    singular: istiooperator
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        spec:
          description: 'Specification of the desired state of the istio control plane resource. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status'
          type: object
        status:
          description: 'Status describes each of istio control plane component status at the current time. 0 means NONE, 1 means UPDATING, 2 means HEALTHY, 3 means ERROR, 4 means RECONCILING. More info: https://github.com/istio/api/blob/master/operator/v1alpha1/istio.operator.v1alpha1.pb.html & https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status'
          type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: istio-ingressgateway
    istio: ingressgateway
    release: istio
  name: istio-ingressgateway
  namespace: istio-system
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: istio-ingressgateway
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: 1.6.0
          Type: resolved
          URL: gcr.io/cf-routing/proxyv2:1.6.0
        URL: gcr.io/cf-routing/proxyv2@sha256:0671300037c5d706f20f01ebc4e403f44fff648245b5e121851c81a389b9ea0f
    kapp.k14s.io/change-group: istio.io/ingressgateway
  labels:
    app: istio-ingressgateway
    istio: ingressgateway
    release: istio
  name: istio-ingressgateway
  namespace: istio-system
spec:
  selector:
    matchLabels:
      app: istio-ingressgateway
      istio: ingressgateway
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: istio-ingressgateway
        chart: gateways
        heritage: Tiller
        istio: ingressgateway
        release: istio
        service.istio.io/canonical-name: istio-ingressgateway
        service.istio.io/canonical-revision: latest
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - ppc64le
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - s390x
            weight: 2
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
                - ppc64le
                - s390x
      containers:
      - args:
        - proxy
        - router
        - --domain
        - $(POD_NAMESPACE).svc.cluster.local
        - --proxyLogLevel=warning
        - --proxyComponentLogLevel=misc:error
        - --log_output_level=default:info
        - --serviceCluster
        - istio-ingressgateway
        - --trust-domain=cluster.local
        env:
        - name: JWT_POLICY
          value: third-party-jwt
        - name: PILOT_CERT_PROVIDER
          value: istiod
        - name: CA_ADDR
          value: istiod.istio-system.svc:15012
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.nodeName
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: INSTANCE_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: SERVICE_ACCOUNT
          valueFrom:
            fieldRef:
              fieldPath: spec.serviceAccountName
        - name: CANONICAL_SERVICE
          valueFrom:
            fieldRef:
              fieldPath: metadata.labels['service.istio.io/canonical-name']
        - name: CANONICAL_REVISION
          valueFrom:
            fieldRef:
              fieldPath: metadata.labels['service.istio.io/canonical-revision']
        - name: ISTIO_META_WORKLOAD_NAME
          value: istio-ingressgateway
        - name: ISTIO_META_OWNER
          value: kubernetes://apis/apps/v1/namespaces/istio-system/deployments/istio-ingressgateway
        - name: ISTIO_META_MESH_ID
          value: cluster.local
        - name: ISTIO_META_ROUTER_MODE
          value: sni-dnat
        - name: ISTIO_META_CLUSTER_ID
          value: Kubernetes
        image: gcr.io/cf-routing/proxyv2@sha256:0671300037c5d706f20f01ebc4e403f44fff648245b5e121851c81a389b9ea0f
        name: istio-proxy
        ports:
        - containerPort: 15021
        - containerPort: 8080
          hostPort: 80
        - containerPort: 8443
          hostPort: 443
        - containerPort: 15443
        - containerPort: 15011
        - containerPort: 15012
        - containerPort: 8060
        - containerPort: 853
        - containerPort: 15090
          name: http-envoy-prom
          protocol: TCP
        readinessProbe:
          failureThreshold: 30
          httpGet:
            path: /healthz/ready
            port: 15021
            scheme: HTTP
          initialDelaySeconds: 1
          periodSeconds: 2
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        volumeMounts:
        - mountPath: /etc/istio/proxy
          name: istio-envoy
        - mountPath: /etc/istio/config
          name: config-volume
        - mountPath: /var/run/secrets/istio
          name: istiod-ca-cert
        - mountPath: /var/run/secrets/tokens
          name: istio-token
          readOnly: true
        - mountPath: /var/run/ingress_gateway
          name: ingressgatewaysdsudspath
        - mountPath: /etc/istio/pod
          name: podinfo
        - mountPath: /etc/istio/ingressgateway-certs
          name: ingressgateway-certs
          readOnly: true
        - mountPath: /etc/istio/ingressgateway-ca-certs
          name: ingressgateway-ca-certs
          readOnly: true
      serviceAccountName: istio-ingressgateway-service-account
      volumes:
      - configMap:
          name: istio-ca-root-cert
        name: istiod-ca-cert
      - downwardAPI:
          items:
          - fieldRef:
              fieldPath: metadata.labels
            path: labels
          - fieldRef:
              fieldPath: metadata.annotations
            path: annotations
        name: podinfo
      - emptyDir: {}
        name: istio-envoy
      - emptyDir: {}
        name: ingressgatewaysdsudspath
      - name: istio-token
        projected:
          sources:
          - serviceAccountToken:
              audience: istio-ca
              expirationSeconds: 43200
              path: istio-token
      - configMap:
          name: istio
          optional: true
        name: config-volume
      - name: ingressgateway-certs
        secret:
          optional: true
          secretName: istio-ingressgateway-certs
      - name: ingressgateway-ca-certs
        secret:
          optional: true
          secretName: istio-ingressgateway-ca-certs
      priorityClassName: slightly-above-normal
  updateStrategy:
    rollingUpdate:
      maxUnavailable: 1
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
  labels:
    app: istio-ingressgateway
    istio: ingressgateway
    release: istio
  name: istio-ingressgateway
  namespace: istio-system
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: istio-ingressgateway
      istio: ingressgateway
      release: istio
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    release: istio
  name: istio-ingressgateway-sds
  namespace: istio-system
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    release: istio
  name: istio-ingressgateway-sds
  namespace: istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: istio-ingressgateway-sds
subjects:
- kind: ServiceAccount
  name: istio-ingressgateway-service-account
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: istio-ingressgateway
    istio: ingressgateway
    release: istio
  name: istio-ingressgateway
  namespace: istio-system
spec:
  externalTrafficPolicy: Local
  ports:
  - name: status-port
    port: 15021
    targetPort: 15021
  - name: http2
    port: 80
    targetPort: 8080
  - name: https
    port: 443
    targetPort: 8443
  - name: tls
    port: 15443
    targetPort: 15443
  selector:
    app: istio-ingressgateway
    istio: ingressgateway
  type: LoadBalancer
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: istio-ingressgateway
    istio: ingressgateway
    release: istio
  name: istio-ingressgateway-service-account
  namespace: istio-system
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: istiod
    istio.io/rev: default
    release: istio
  name: istiod
  namespace: istio-system
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: istiod
---
apiVersion: v1
data:
  mesh: |-
    accessLogEncoding: JSON
    accessLogFile: /dev/stdout
    accessLogFormat: |-
      {
        "app_id": "%REQ(CF-APP-ID)%",
        "authority": "%REQ(:AUTHORITY)%",
        "bytes_received": "%BYTES_RECEIVED%",
        "bytes_sent": "%BYTES_SENT%",
        "downstream_local_address": "%DOWNSTREAM_LOCAL_ADDRESS%",
        "downstream_remote_address": "%DOWNSTREAM_REMOTE_ADDRESS%",
        "duration": "%DURATION%",
        "method": "%REQ(:METHOD)%",
        "organization_id": "%REQ(CF-ORGANIZATION-ID)%",
        "path": "%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%",
        "process_type": "%REQ(APP-PROCESS-TYPE)%",
        "protocol": "%PROTOCOL%",
        "referer": "%REQ(REFERER)%",
        "request_id": "%REQ(X-REQUEST-ID)%",
        "requested_server_name": "%REQUESTED_SERVER_NAME%",
        "response_code": "%RESPONSE_CODE%",
        "response_duration": "%RESPONSE_DURATION%",
        "response_flags": "%RESPONSE_FLAGS%",
        "response_tx_duration": "%RESPONSE_TX_DURATION%",
        "space_id": "%REQ(CF-SPACE-ID)%",
        "start_time": "%START_TIME%",
        "upstream_cluster": "%UPSTREAM_CLUSTER%",
        "upstream_host": "%UPSTREAM_HOST%",
        "upstream_local_address": "%UPSTREAM_LOCAL_ADDRESS%",
        "upstream_service_time": "%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%",
        "upstream_transport_failure_reason": "%UPSTREAM_TRANSPORT_FAILURE_REASON%",
        "user_agent": "%REQ(USER-AGENT)%",
        "x_b3_parentspanid": "%REQ(X-B3-PARENTSPANID)%",
        "x_b3_spanid": "%REQ(X-B3-SPANID)%",
        "x_b3_traceid": "%REQ(X-B3-TRACEID)%",
        "x_forwarded_for": "%REQ(X-FORWARDED-FOR)%",
        "x_forwarded_proto": "%REQ(X-FORWARDED-PROTO)%"
      }
    defaultConfig:
      concurrency: 2
      configPath: ./etc/istio/proxy
      connectTimeout: 10s
      controlPlaneAuthPolicy: NONE
      discoveryAddress: istiod.istio-system.svc:15012
      drainDuration: 45s
      parentShutdownDuration: 1m0s
      proxyAdminPort: 15000
      proxyMetadata:
        DNS_AGENT: ""
      serviceCluster: istio-proxy
      tracing:
        zipkin:
          address: zipkin.istio-system:9411
    disableMixerHttpReports: true
    disablePolicyChecks: true
    enableAutoMtls: true
    enablePrometheusMerge: false
    ingressClass: istio
    ingressControllerMode: STRICT
    ingressService: istio-ingressgateway
    protocolDetectionTimeout: 100ms
    reportBatchMaxEntries: 100
    reportBatchMaxTime: 1s
    sdsUdsPath: unix:/etc/istio/proxy/SDS
    trustDomain: cluster.local
    trustDomainAliases: null
  meshNetworks: 'networks: {}'
kind: ConfigMap
metadata:
  labels:
    istio.io/rev: default
    release: istio
  name: istio
  namespace: istio-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: 1.6.0
          Type: resolved
          URL: gcr.io/cf-routing/pilot:1.6.0
        URL: gcr.io/cf-routing/pilot@sha256:b952b244c0de5151ccf14457187f41dd16b1e1da617ca2a429e2d0771ae743cb
  labels:
    app: istiod
    istio: pilot
    istio.io/rev: default
    release: istio
  name: istiod
  namespace: istio-system
spec:
  selector:
    matchLabels:
      istio: pilot
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 25%
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: istiod
        istio: pilot
        istio.io/rev: default
    spec:
      containers:
      - args:
        - discovery
        - --monitoringAddr=:15014
        - --log_output_level=default:info
        - --domain
        - cluster.local
        - --trust-domain=cluster.local
        - --keepaliveMaxServerConnectionAge
        - 30m
        env:
        - name: REVISION
          value: default
        - name: JWT_POLICY
          value: third-party-jwt
        - name: PILOT_CERT_PROVIDER
          value: istiod
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: SERVICE_ACCOUNT
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.serviceAccountName
        - name: PILOT_TRACE_SAMPLING
          value: "1"
        - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_OUTBOUND
          value: "true"
        - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_INBOUND
          value: "true"
        - name: INJECTION_WEBHOOK_CONFIG_NAME
          value: istio-sidecar-injector
        - name: ISTIOD_ADDR
          value: istiod.istio-system.svc:15012
        - name: PILOT_ENABLE_ANALYSIS
          value: "false"
        - name: CLUSTER_ID
          value: Kubernetes
        - name: CENTRAL_ISTIOD
          value: "false"
        image: gcr.io/cf-routing/pilot@sha256:b952b244c0de5151ccf14457187f41dd16b1e1da617ca2a429e2d0771ae743cb
        name: discovery
        ports:
        - containerPort: 8080
        - containerPort: 15010
        - containerPort: 15017
        - containerPort: 15053
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 1
          periodSeconds: 3
          timeoutSeconds: 5
        resources: {}
        securityContext:
          capabilities:
            drop:
            - ALL
          runAsGroup: 1337
          runAsNonRoot: true
          runAsUser: 1337
        volumeMounts:
        - mountPath: /etc/istio/config
          name: config-volume
        - mountPath: /var/run/secrets/tokens
          name: istio-token
          readOnly: true
        - mountPath: /var/run/secrets/istio-dns
          name: local-certs
        - mountPath: /etc/cacerts
          name: cacerts
          readOnly: true
        - mountPath: /var/lib/istio/inject
          name: inject
          readOnly: true
      securityContext:
        fsGroup: 1337
      serviceAccountName: istiod-service-account
      volumes:
      - emptyDir:
          medium: Memory
        name: local-certs
      - name: istio-token
        projected:
          sources:
          - serviceAccountToken:
              audience: istio-ca
              expirationSeconds: 43200
              path: istio-token
      - name: cacerts
        secret:
          optional: true
          secretName: cacerts
      - configMap:
          name: istio-sidecar-injector
          optional: true
        name: inject
      - configMap:
          name: istio
        name: config-volume
---
apiVersion: v1
data:
  config: |-
    policy: enabled
    alwaysInjectSelector:
      []
    neverInjectSelector:
      []
    injectedAnnotations:

    template: |
      rewriteAppHTTPProbe: {{ valueOrDefault .Values.sidecarInjectorWebhook.rewriteAppHTTPProbe false }}
      initContainers:
      {{ if ne (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `NONE` }}
      {{ if .Values.istio_cni.enabled -}}
      - name: istio-validation
      {{ else -}}
      - name: istio-init
      {{ end -}}
      {{- if contains "/" .Values.global.proxy_init.image }}
        image: "{{ .Values.global.proxy_init.image }}"
      {{- else }}
        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy_init.image }}:{{ .Values.global.tag }}"
      {{- end }}
        args:
        - istio-iptables
        - "-p"
        - 15001
        - "-z"
        - "15006"
        - "-u"
        - 1337
        - "-m"
        - "{{ annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode }}"
        - "-i"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundIPRanges` .Values.global.proxy.includeIPRanges }}"
        - "-x"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundIPRanges` .Values.global.proxy.excludeIPRanges }}"
        - "-b"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` `*` }}"
        - "-d"
        - "15090,15021,{{ excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}"
        {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/excludeOutboundPorts`) (ne (valueOrDefault .Values.global.proxy.excludeOutboundPorts "") "") -}}
        - "-o"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundPorts` .Values.global.proxy.excludeOutboundPorts }}"
        {{ end -}}
        {{ if (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces`) -}}
        - "-k"
        - "{{ index .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces` }}"
        {{ end -}}
        {{ if .Values.istio_cni.enabled -}}
        - "--run-validation"
        - "--skip-rule-apply"
        {{ end -}}
        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
      {{- if .Values.global.proxy_init.resources }}
        env:
        {{- range $key, $value := .ProxyConfig.ProxyMetadata }}
        - name: {{ $key }}
          value: "{{ $value }}"
        {{- end }}
        resources:
          {{ toYaml .Values.global.proxy_init.resources | indent 4 }}
      {{- else }}
        resources: {}
      {{- end }}
        securityContext:
          allowPrivilegeEscalation: {{ .Values.global.proxy.privileged }}
          privileged: {{ .Values.global.proxy.privileged }}
          capabilities:
        {{- if not .Values.istio_cni.enabled }}
            add:
            - NET_ADMIN
            - NET_RAW
        {{- end }}
            drop:
            - ALL
        {{- if not .Values.istio_cni.enabled }}
          readOnlyRootFilesystem: false
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
        {{- else }}
          readOnlyRootFilesystem: true
          runAsGroup: 1337
          runAsUser: 1337
          runAsNonRoot: true
        {{- end }}
        restartPolicy: Always
      {{ end -}}
      {{- if eq .Values.global.proxy.enableCoreDump true }}
      - name: enable-core-dump
        args:
        - -c
        - sysctl -w kernel.core_pattern=/var/lib/istio/data/core.proxy && ulimit -c unlimited
        command:
          - /bin/sh
      {{- if contains "/" .Values.global.proxy_init.image }}
        image: "{{ .Values.global.proxy_init.image }}"
      {{- else }}
        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy_init.image }}:{{ .Values.global.tag }}"
      {{- end }}
        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
        resources: {}
        securityContext:
          allowPrivilegeEscalation: true
          capabilities:
            add:
            - SYS_ADMIN
            drop:
            - ALL
          privileged: true
          readOnlyRootFilesystem: false
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
      {{ end }}
      containers:
      - name: istio-proxy
      {{- if contains "/" (annotation .ObjectMeta `sidecar.istio.io/proxyImage` .Values.global.proxy.image) }}
        image: "{{ annotation .ObjectMeta `sidecar.istio.io/proxyImage` .Values.global.proxy.image }}"
      {{- else }}
        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy.image }}:{{ .Values.global.tag }}"
      {{- end }}
        ports:
        - containerPort: 15090
          protocol: TCP
          name: http-envoy-prom
        args:
        - proxy
        - sidecar
        - --domain
        - $(POD_NAMESPACE).svc.{{ .Values.global.proxy.clusterDomain }}
        - --serviceCluster
        {{ if ne "" (index .ObjectMeta.Labels "app") -}}
        - "{{ index .ObjectMeta.Labels `app` }}.$(POD_NAMESPACE)"
        {{ else -}}
        - "{{ valueOrDefault .DeploymentMeta.Name `istio-proxy` }}.{{ valueOrDefault .DeploymentMeta.Namespace `default` }}"
        {{ end -}}
        - --proxyLogLevel={{ annotation .ObjectMeta `sidecar.istio.io/logLevel` .Values.global.proxy.logLevel}}
        - --proxyComponentLogLevel={{ annotation .ObjectMeta `sidecar.istio.io/componentLogLevel` .Values.global.proxy.componentLogLevel}}
      {{- if .Values.global.sts.servicePort }}
        - --stsPort={{ .Values.global.sts.servicePort }}
      {{- end }}
      {{- if .Values.global.trustDomain }}
        - --trust-domain={{ .Values.global.trustDomain }}
      {{- end }}
      {{- if .Values.global.logAsJson }}
        - --log_as_json
      {{- end }}
      {{- if gt .ProxyConfig.Concurrency 0 }}
        - --concurrency
        - "{{ .ProxyConfig.Concurrency }}"
      {{- end -}}
      {{- if .Values.global.proxy.lifecycle }}
        lifecycle:
          {{ toYaml .Values.global.proxy.lifecycle | indent 4 }}
        {{- end }}
        env:
        - name: JWT_POLICY
          value: {{ .Values.global.jwtPolicy }}
        - name: PILOT_CERT_PROVIDER
          value: {{ .Values.global.pilotCertProvider }}
        # Temp, pending PR to make it default or based on the istiodAddr env
        - name: CA_ADDR
        {{- if .Values.global.caAddress }}
          value: {{ .Values.global.caAddress }}
        {{- else }}
          value: istiod{{- if not (eq .Values.revision "") }}-{{ .Values.revision }}{{- end }}.{{ .Values.global.istioNamespace }}.svc:15012
        {{- end }}
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: INSTANCE_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: SERVICE_ACCOUNT
          valueFrom:
            fieldRef:
              fieldPath: spec.serviceAccountName
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: CANONICAL_SERVICE
          valueFrom:
            fieldRef:
              fieldPath: metadata.labels['service.istio.io/canonical-name']
        - name: CANONICAL_REVISION
          valueFrom:
            fieldRef:
              fieldPath: metadata.labels['service.istio.io/canonical-revision']
        - name: PROXY_CONFIG
          value: |
                 {{ protoToJSON .ProxyConfig }}
        - name: ISTIO_META_POD_PORTS
          value: |-
            [
            {{- $first := true }}
            {{- range $index1, $c := .Spec.Containers }}
              {{- range $index2, $p := $c.Ports }}
                {{- if (structToJSON $p) }}
                {{if not $first}},{{end}}{{ structToJSON $p }}
                {{- $first = false }}
                {{- end }}
              {{- end}}
            {{- end}}
            ]
        - name: ISTIO_META_APP_CONTAINERS
          value: |-
            [
              {{- range $index, $container := .Spec.Containers }}
                {{- if ne $index 0}},{{- end}}
                {{ $container.Name }}
              {{- end}}
            ]
        - name: ISTIO_META_CLUSTER_ID
          value: "{{ valueOrDefault .Values.global.multiCluster.clusterName `Kubernetes` }}"
        - name: ISTIO_META_INTERCEPTION_MODE
          value: "{{ or (index .ObjectMeta.Annotations `sidecar.istio.io/interceptionMode`) .ProxyConfig.InterceptionMode.String }}"
        {{- if .Values.global.network }}
        - name: ISTIO_META_NETWORK
          value: "{{ .Values.global.network }}"
        {{- end }}
        {{ if .ObjectMeta.Annotations }}
        - name: ISTIO_METAJSON_ANNOTATIONS
          value: |
                 {{ toJSON .ObjectMeta.Annotations }}
        {{ end }}
        {{- if .DeploymentMeta.Name }}
        - name: ISTIO_META_WORKLOAD_NAME
          value: {{ .DeploymentMeta.Name }}
        {{ end }}
        {{- if and .TypeMeta.APIVersion .DeploymentMeta.Name }}
        - name: ISTIO_META_OWNER
          value: kubernetes://apis/{{ .TypeMeta.APIVersion }}/namespaces/{{ valueOrDefault .DeploymentMeta.Namespace `default` }}/{{ toLower .TypeMeta.Kind}}s/{{ .DeploymentMeta.Name }}
        {{- end}}
        {{- if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
        - name: ISTIO_BOOTSTRAP_OVERRIDE
          value: "/etc/istio/custom-bootstrap/custom_bootstrap.json"
        {{- end }}
        {{- if .Values.global.meshID }}
        - name: ISTIO_META_MESH_ID
          value: "{{ .Values.global.meshID }}"
        {{- else if .Values.global.trustDomain }}
        - name: ISTIO_META_MESH_ID
          value: "{{ .Values.global.trustDomain }}"
        {{- end }}
        {{- if and (eq .Values.global.proxy.tracer "datadog") (isset .ObjectMeta.Annotations `apm.datadoghq.com/env`) }}
        {{- range $key, $value := fromJSON (index .ObjectMeta.Annotations `apm.datadoghq.com/env`) }}
        - name: {{ $key }}
          value: "{{ $value }}"
        {{- end }}
        {{- end }}
        {{- range $key, $value := .ProxyConfig.ProxyMetadata }}
        - name: {{ $key }}
          value: "{{ $value }}"
        {{- end }}
        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
        {{ if ne (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) `0` }}
        readinessProbe:
          httpGet:
            path: /healthz/ready
            port: 15021
          initialDelaySeconds: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/initialDelaySeconds` .Values.global.proxy.readinessInitialDelaySeconds }}
          periodSeconds: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/periodSeconds` .Values.global.proxy.readinessPeriodSeconds }}
          failureThreshold: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/failureThreshold` .Values.global.proxy.readinessFailureThreshold }}
        {{ end -}}
        securityContext:
          allowPrivilegeEscalation: {{ .Values.global.proxy.privileged }}
          capabilities:
            {{ if or (eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY`) (eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true`) -}}
            add:
            {{ if eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY` -}}
            - NET_ADMIN
            {{- end }}
            {{ if eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true` -}}
            - NET_BIND_SERVICE
            {{- end }}
            {{- end }}
            drop:
            - ALL
          privileged: {{ .Values.global.proxy.privileged }}
          readOnlyRootFilesystem: {{ not .Values.global.proxy.enableCoreDump }}
          runAsGroup: 1337
          fsGroup: 1337
          {{ if or (eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY`) (eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true`) -}}
          runAsNonRoot: false
          runAsUser: 0
          {{- else -}}
          runAsNonRoot: true
          runAsUser: 1337
          {{- end }}
        resources:
      {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) }}
        {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) }}
          requests:
            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) -}}
            cpu: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU` }}"
            {{ end }}
            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) -}}
            memory: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory` }}"
            {{ end }}
        {{- end }}
        {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) }}
          limits:
            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) -}}
            cpu: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit` }}"
            {{ end }}
            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) -}}
            memory: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit` }}"
            {{ end }}
        {{- end }}
      {{- else }}
        {{- if .Values.global.proxy.resources }}
          {{ toYaml .Values.global.proxy.resources | indent 4 }}
        {{- end }}
      {{- end }}
        volumeMounts:
        {{- if eq .Values.global.pilotCertProvider "istiod" }}
        - mountPath: /var/run/secrets/istio
          name: istiod-ca-cert
        {{- end }}
        - mountPath: /var/lib/istio/data
          name: istio-data
        {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
        - mountPath: /etc/istio/custom-bootstrap
          name: custom-bootstrap-volume
        {{- end }}
        # SDS channel between istioagent and Envoy
        - mountPath: /etc/istio/proxy
          name: istio-envoy
        {{- if eq .Values.global.jwtPolicy "third-party-jwt" }}
        - mountPath: /var/run/secrets/tokens
          name: istio-token
        {{- end }}
        {{- if .Values.global.mountMtlsCerts }}
        # Use the key and cert mounted to /etc/certs/ for the in-cluster mTLS communications.
        - mountPath: /etc/certs/
          name: istio-certs
          readOnly: true
        {{- end }}
        - name: istio-podinfo
          mountPath: /etc/istio/pod
         {{- if and (eq .Values.global.proxy.tracer "lightstep") .ProxyConfig.GetTracing.GetTlsSettings }}
        - mountPath: {{ directory .ProxyConfig.GetTracing.GetTlsSettings.GetCaCertificates }}
          name: lightstep-certs
          readOnly: true
        {{- end }}
          {{- if isset .ObjectMeta.Annotations `sidecar.istio.io/userVolumeMount` }}
          {{ range $index, $value := fromJSON (index .ObjectMeta.Annotations `sidecar.istio.io/userVolumeMount`) }}
        - name: "{{  $index }}"
          {{ toYaml $value | indent 4 }}
          {{ end }}
          {{- end }}
      volumes:
      {{- if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
      - name: custom-bootstrap-volume
        configMap:
          name: {{ annotation .ObjectMeta `sidecar.istio.io/bootstrapOverride` "" }}
      {{- end }}
      # SDS channel between istioagent and Envoy
      - emptyDir:
          medium: Memory
        name: istio-envoy
      - name: istio-data
        emptyDir: {}
      - name: istio-podinfo
        downwardAPI:
          items:
            - path: "labels"
              fieldRef:
                fieldPath: metadata.labels
            - path: "annotations"
              fieldRef:
                fieldPath: metadata.annotations
      {{- if eq .Values.global.jwtPolicy "third-party-jwt" }}
      - name: istio-token
        projected:
          sources:
          - serviceAccountToken:
              path: istio-token
              expirationSeconds: 43200
              audience: {{ .Values.global.sds.token.aud }}
      {{- end }}
      {{- if eq .Values.global.pilotCertProvider "istiod" }}
      - name: istiod-ca-cert
        configMap:
          name: istio-ca-root-cert
      {{- end }}
      {{- if .Values.global.mountMtlsCerts }}
      # Use the key and cert mounted to /etc/certs/ for the in-cluster mTLS communications.
      - name: istio-certs
        secret:
          optional: true
          {{ if eq .Spec.ServiceAccountName "" }}
          secretName: istio.default
          {{ else -}}
          secretName: {{  printf "istio.%s" .Spec.ServiceAccountName }}
          {{  end -}}
      {{- end }}
        {{- if isset .ObjectMeta.Annotations `sidecar.istio.io/userVolume` }}
        {{range $index, $value := fromJSON (index .ObjectMeta.Annotations `sidecar.istio.io/userVolume`) }}
      - name: "{{ $index }}"
        {{ toYaml $value | indent 2 }}
        {{ end }}
        {{ end }}
      {{- if and (eq .Values.global.proxy.tracer "lightstep") .ProxyConfig.GetTracing.GetTlsSettings }}
      - name: lightstep-certs
        secret:
          optional: true
          secretName: lightstep.cacert
      {{- end }}
      {{- if .Values.global.podDNSSearchNamespaces }}
      dnsConfig:
        searches:
          {{- range .Values.global.podDNSSearchNamespaces }}
          - {{ render . }}
          {{- end }}
      {{- end }}
      podRedirectAnnot:
        sidecar.istio.io/interceptionMode: "{{ annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode }}"
        traffic.sidecar.istio.io/includeOutboundIPRanges: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundIPRanges` .Values.global.proxy.includeIPRanges }}"
        traffic.sidecar.istio.io/excludeOutboundIPRanges: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundIPRanges` .Values.global.proxy.excludeIPRanges }}"
        traffic.sidecar.istio.io/includeInboundPorts: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` (includeInboundPorts .Spec.Containers) }}"
        traffic.sidecar.istio.io/excludeInboundPorts: "{{ excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}"
      {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/excludeOutboundPorts`) (ne .Values.global.proxy.excludeOutboundPorts "") }}
        traffic.sidecar.istio.io/excludeOutboundPorts: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundPorts` .Values.global.proxy.excludeOutboundPorts }}"
      {{- end }}
        traffic.sidecar.istio.io/kubevirtInterfaces: "{{ index .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces` }}"
  values: |-
    {
      "global": {
        "arch": {
          "amd64": 2,
          "ppc64le": 2,
          "s390x": 2
        },
        "configNamespace": "istio-system",
        "configValidation": true,
        "controlPlaneSecurityEnabled": true,
        "defaultNodeSelector": {},
        "defaultPodDisruptionBudget": {
          "enabled": true
        },
        "defaultResources": {
          "requests": {
            "cpu": "10m"
          }
        },
        "enableHelmTest": false,
        "enabled": true,
        "hub": "gcr.io/cf-routing",
        "imagePullPolicy": "",
        "imagePullSecrets": [],
        "istioNamespace": "istio-system",
        "istiod": {
          "enableAnalysis": false,
          "enabled": true
        },
        "jwtPolicy": "third-party-jwt",
        "logAsJson": false,
        "logging": {
          "level": "default:info"
        },
        "meshExpansion": {
          "enabled": false,
          "useILB": false
        },
        "meshNetworks": {},
        "mountMtlsCerts": false,
        "multiCluster": {
          "clusterName": "",
          "enabled": false
        },
        "namespace": "istio-system",
        "network": "",
        "omitSidecarInjectorConfigMap": false,
        "oneNamespace": false,
        "operatorManageWebhooks": false,
        "pilotCertProvider": "istiod",
        "policyNamespace": "istio-system",
        "priorityClassName": "",
        "prometheusNamespace": "istio-system",
        "proxy": {
          "accessLogEncoding": "JSON",
          "autoInject": "enabled",
          "clusterDomain": "cluster.local",
          "componentLogLevel": "misc:error",
          "enableCoreDump": false,
          "envoyStatsd": {
            "enabled": false
          },
          "excludeIPRanges": "",
          "excludeInboundPorts": "",
          "excludeOutboundPorts": "",
          "image": "proxyv2",
          "includeIPRanges": "*",
          "logLevel": "warning",
          "privileged": false,
          "readinessFailureThreshold": 30,
          "readinessInitialDelaySeconds": 1,
          "readinessPeriodSeconds": 2,
          "resources": {
            "limits": {
              "cpu": "2000m",
              "memory": "1024Mi"
            },
            "requests": {
              "cpu": "100m",
              "memory": "128Mi"
            }
          },
          "statusPort": 15020,
          "tracer": "zipkin"
        },
        "proxy_init": {
          "image": "proxyv2",
          "resources": {
            "limits": {
              "cpu": "100m",
              "memory": "50Mi"
            },
            "requests": {
              "cpu": "10m",
              "memory": "10Mi"
            }
          }
        },
        "sds": {
          "token": {
            "aud": "istio-ca"
          }
        },
        "securityNamespace": "istio-system",
        "sts": {
          "servicePort": 0
        },
        "tag": "1.6.0",
        "telemetryNamespace": "istio-system",
        "tracer": {
          "datadog": {
            "address": "$(HOST_IP):8126"
          },
          "lightstep": {
            "accessToken": "",
            "address": ""
          },
          "stackdriver": {
            "debug": false,
            "maxNumberOfAnnotations": 200,
            "maxNumberOfAttributes": 200,
            "maxNumberOfMessageEvents": 200
          },
          "zipkin": {
            "address": ""
          }
        },
        "trustDomain": "cluster.local",
        "useMCP": false
      },
      "istio_cni": {
        "enabled": false
      },
      "revision": "",
      "sidecarInjectorWebhook": {
        "alwaysInjectSelector": [],
        "enableNamespacesByDefault": false,
        "enabled": false,
        "injectLabel": "istio-injection",
        "injectedAnnotations": {},
        "namespace": "istio-system",
        "neverInjectSelector": [],
        "objectSelector": {
          "autoInject": true,
          "enabled": false
        },
        "rewriteAppHTTPProbe": true
      }
    }
kind: ConfigMap
metadata:
  labels:
    istio.io/rev: default
    release: istio
  name: istio-sidecar-injector
  namespace: istio-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  labels:
    app: sidecar-injector
    istio.io/rev: default
    release: istio
  name: istio-sidecar-injector
  annotations:
    kapp.k14s.io/change-group: cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
webhooks:
- clientConfig:
    service:
      name: istiod
      namespace: istio-system
      path: /inject
  failurePolicy: Fail
  name: sidecar-injector.istio.io
  namespaceSelector:
    matchLabels:
      istio-injection: enabled
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - pods
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
  labels:
    app: istiod
    istio: pilot
    istio.io/rev: default
    release: istio
  name: istiod
  namespace: istio-system
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: istiod
      istio: pilot
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: istiod
    istio: pilot
    istio.io/rev: default
    release: istio
  name: istiod
  namespace: istio-system
spec:
  ports:
  - name: grpc-xds
    port: 15010
  - name: https-dns
    port: 15012
  - name: https-webhook
    port: 443
    targetPort: 15017
  - name: http-monitoring
    port: 15014
  - name: dns
    port: 53
    protocol: UDP
    targetPort: 15053
  - name: dns-tls
    port: 853
    protocol: TCP
    targetPort: 15053
  selector:
    app: istiod
    istio: pilot
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    istio.io/rev: default
  name: metadata-exchange-1.4
  namespace: istio-system
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: ANY
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
      proxy:
        proxyVersion: ^1\.4.*
    patch:
      operation: INSERT_BEFORE
      value:
        config:
          config:
            configuration: envoy.wasm.metadata_exchange
            vm_config:
              code:
                inline_string: envoy.wasm.metadata_exchange
              runtime: envoy.wasm.runtime.null
        name: envoy.filters.http.wasm
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    istio.io/rev: default
  name: stats-filter-1.4
  namespace: istio-system
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_OUTBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.4.*
    patch:
      operation: INSERT_BEFORE
      value:
        config:
          config:
            configuration: |
              {
                "debug": "false",
                "stat_prefix": "istio",
              }
            root_id: stats_outbound
            vm_config:
              code:
                inline_string: envoy.wasm.stats
              runtime: envoy.wasm.runtime.null
              vm_id: stats_outbound
        name: envoy.filters.http.wasm
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_INBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.4.*
    patch:
      operation: INSERT_BEFORE
      value:
        config:
          config:
            configuration: |
              {
                "debug": "false",
                "stat_prefix": "istio",
              }
            root_id: stats_inbound
            vm_config:
              code:
                inline_string: envoy.wasm.stats
              runtime: envoy.wasm.runtime.null
              vm_id: stats_inbound
        name: envoy.filters.http.wasm
  - applyTo: HTTP_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.4.*
    patch:
      operation: INSERT_BEFORE
      value:
        config:
          config:
            configuration: |
              {
                "debug": "false",
                "stat_prefix": "istio",
                "disable_host_header_fallback": true,
              }
            root_id: stats_outbound
            vm_config:
              code:
                inline_string: envoy.wasm.stats
              runtime: envoy.wasm.runtime.null
              vm_id: stats_outbound
        name: envoy.filters.http.wasm
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    istio.io/rev: default
  name: metadata-exchange-1.5
  namespace: istio-system
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: ANY
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
      proxy:
        proxyVersion: ^1\.5.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: envoy.filters.http.wasm
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.config.filter.http.wasm.v2.Wasm
          value:
            config:
              configuration: envoy.wasm.metadata_exchange
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.metadata_exchange
                runtime: envoy.wasm.runtime.null
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    istio.io/rev: default
  name: tcp-metadata-exchange-1.5
  namespace: istio-system
spec:
  configPatches:
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_INBOUND
      listener: {}
      proxy:
        proxyVersion: ^1\.5.*
    patch:
      operation: INSERT_BEFORE
      value:
        config:
          protocol: istio-peer-exchange
        name: envoy.filters.network.metadata_exchange
  - applyTo: CLUSTER
    match:
      cluster: {}
      context: SIDECAR_OUTBOUND
      proxy:
        proxyVersion: ^1\.5.*
    patch:
      operation: MERGE
      value:
        filters:
        - name: envoy.filters.network.upstream.metadata_exchange
          typed_config:
            '@type': type.googleapis.com/udpa.type.v1.TypedStruct
            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
            value:
              protocol: istio-peer-exchange
  - applyTo: CLUSTER
    match:
      cluster: {}
      context: GATEWAY
      proxy:
        proxyVersion: ^1\.5.*
    patch:
      operation: MERGE
      value:
        filters:
        - name: envoy.filters.network.upstream.metadata_exchange
          typed_config:
            '@type': type.googleapis.com/udpa.type.v1.TypedStruct
            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
            value:
              protocol: istio-peer-exchange
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    istio.io/rev: default
  name: stats-filter-1.5
  namespace: istio-system
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_OUTBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.5.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: envoy.filters.http.wasm
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.config.filter.http.wasm.v2.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio",
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_outbound
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_INBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.5.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: envoy.filters.http.wasm
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.config.filter.http.wasm.v2.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio",
                }
              root_id: stats_inbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_inbound
  - applyTo: HTTP_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.5.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: envoy.filters.http.wasm
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.config.filter.http.wasm.v2.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio",
                  "disable_host_header_fallback": true,
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_outbound
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    istio.io/rev: default
  name: tcp-stats-filter-1.5
  namespace: istio-system
spec:
  configPatches:
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_INBOUND
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.5.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: envoy.filters.network.wasm
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.config.filter.network.wasm.v2.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio",
                }
              root_id: stats_inbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_inbound
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_OUTBOUND
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.5.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: envoy.filters.network.wasm
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.config.filter.network.wasm.v2.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio",
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_outbound
  - applyTo: NETWORK_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.5.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: envoy.filters.network.wasm
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.config.filter.network.wasm.v2.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio",
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_outbound
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    istio.io/rev: default
  name: metadata-exchange-1.6
  namespace: istio-system
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: ANY
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.metadata_exchange
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {}
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.metadata_exchange
                runtime: envoy.wasm.runtime.null
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    istio.io/rev: default
  name: tcp-metadata-exchange-1.6
  namespace: istio-system
spec:
  configPatches:
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_INBOUND
      listener: {}
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.metadata_exchange
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
          value:
            protocol: istio-peer-exchange
  - applyTo: CLUSTER
    match:
      cluster: {}
      context: SIDECAR_OUTBOUND
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: MERGE
      value:
        filters:
        - name: istio.metadata_exchange
          typed_config:
            '@type': type.googleapis.com/udpa.type.v1.TypedStruct
            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
            value:
              protocol: istio-peer-exchange
  - applyTo: CLUSTER
    match:
      cluster: {}
      context: GATEWAY
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: MERGE
      value:
        filters:
        - name: istio.metadata_exchange
          typed_config:
            '@type': type.googleapis.com/udpa.type.v1.TypedStruct
            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
            value:
              protocol: istio-peer-exchange
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    istio.io/rev: default
  name: stats-filter-1.6
  namespace: istio-system
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_OUTBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio"
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_outbound
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_INBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio"
                }
              root_id: stats_inbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_inbound
  - applyTo: HTTP_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio",
                  "disable_host_header_fallback": true
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_outbound
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    istio.io/rev: default
  name: tcp-stats-filter-1.6
  namespace: istio-system
spec:
  configPatches:
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_INBOUND
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio"
                }
              root_id: stats_inbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_inbound
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_OUTBOUND
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio"
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_outbound
  - applyTo: NETWORK_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio"
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_outbound
---
apiVersion: v1
kind: Namespace
metadata:
  name: istio-system
  labels:
    cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
---
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
  namespace: istio-system
spec:
  mtls:
    mode: STRICT
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: routecontroller
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: routecontroller
subjects:
- kind: ServiceAccount
  name: routecontroller
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: routecontroller
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
rules:
- apiGroups:
  - networking.cloudfoundry.org
  resources:
  - routes
  - routes/status
  verbs:
  - create
  - delete
  - get
  - update
  - list
  - watch
- apiGroups:
  - networking.istio.io
  resources:
  - virtualservices
  verbs:
  - create
  - delete
  - get
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - create
  - delete
  - get
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: routecontroller-config
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
    kapp.k14s.io/num-versions: "2"
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
data:
  ISTIO_GATEWAY_NAME: cf-system/istio-ingressgateway
  RESYNC_INTERVAL: "900"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: routecontroller
  namespace: cf-system
  labels:
    app: routecontroller
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
spec:
  replicas: 1
  selector:
    matchLabels:
      app: routecontroller
  template:
    metadata:
      namespace: cf-system
      labels:
        app: routecontroller
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - name: routecontroller
        image: gcr.io/cf-networking-images/cf-k8s-networking/routecontroller@sha256:ed4b3e351a31313ebf974439e4fb43210281a02f0a9125cb8ea880c572385b5f
        resources: {}
        envFrom:
        - configMapRef:
            name: routecontroller-config
      terminationGracePeriodSeconds: 10
      serviceAccountName: routecontroller
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: routecontroller
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
---
apiVersion: v1
kind: Namespace
metadata:
  name: cf-db
  labels:
    istio-injection: enabled
---
apiVersion: v1
kind: Secret
metadata:
  name: cf-db-admin-secret
  namespace: cf-db
data:
  postgresql-password: dmg4aDlhZmhuZXExbDBkOGVuY2c=
---
apiVersion: v1
kind: Secret
metadata:
  name: cf-db-credentials
  namespace: cf-db
data:
  ccdb-username: Y2xvdWRfY29udHJvbGxlcg==
  ccdb-password: MXA5dmo5b2V6eDluem5nNHFxNHQ=
  uaadb-username: dWFh
  uaadb-password: ajJhdzBrZnFhaGtncTJsY2E1N2w=
---
apiVersion: v1
data:
  init.sh: |
    #!/bin/bash
    CCDB_USERNAME=$(cat /docker-entrypoint-initdb.d/secret/ccdb-username)
    CCDB_PASSWORD=$(cat /docker-entrypoint-initdb.d/secret/ccdb-password)
    UAADB_USERNAME=$(cat /docker-entrypoint-initdb.d/secret/uaadb-username)
    UAADB_PASSWORD=$(cat /docker-entrypoint-initdb.d/secret/uaadb-password)
    cat > /tmp/setup_db.sql <<EOT
    CREATE DATABASE cloud_controller;
    CREATE ROLE ${CCDB_USERNAME} LOGIN PASSWORD '${CCDB_PASSWORD}';
    CREATE DATABASE uaa;
    CREATE ROLE ${UAADB_USERNAME} LOGIN PASSWORD '${UAADB_PASSWORD}';
    EOT
    psql -U postgres -f /tmp/setup_db.sql
    psql -U postgres -d cloud_controller -c "CREATE EXTENSION citext"
    psql -U postgres -d uaa -c "CREATE EXTENSION citext"
kind: ConfigMap
metadata:
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql-init-scripts
  namespace: cf-db
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql-headless
  namespace: cf-db
spec:
  clusterIP: None
  ports:
  - name: tcp-postgresql
    port: 5432
    targetPort: tcp-postgresql
  selector:
    app: postgresql
    release: cf-db
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql
  namespace: cf-db
spec:
  ports:
  - name: tcp-postgresql
    port: 5432
    targetPort: tcp-postgresql
  selector:
    app: postgresql
    release: cf-db
    role: master
  type: ClusterIP
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: 11.8.0-debian-10-r33
          Type: resolved
          URL: docker.io/bitnami/postgresql:11.8.0-debian-10-r33
        URL: index.docker.io/bitnami/postgresql@sha256:0f76a419cfd9996036e3a53672f50cf69ed7699f1241cbf8e20af17bbbdf0683
    kapp.k14s.io/change-group.cf-db-postgresql: cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql
  namespace: cf-db
spec:
  replicas: 1
  selector:
    matchLabels:
      app: postgresql
      release: cf-db
      role: master
  serviceName: cf-db-postgresql-headless
  template:
    metadata:
      labels:
        app: postgresql
        chart: postgresql-8.10.6
        heritage: Helm
        release: cf-db
        role: master
      name: cf-db-postgresql
    spec:
      containers:
      - env:
        - name: BITNAMI_DEBUG
          value: "false"
        - name: POSTGRESQL_PORT_NUMBER
          value: "5432"
        - name: POSTGRESQL_VOLUME_DIR
          value: /bitnami/postgresql
        - name: PGDATA
          value: /bitnami/postgresql/data
        - name: POSTGRES_USER
          value: postgres
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              key: postgresql-password
              name: cf-db-admin-secret
        - name: POSTGRESQL_ENABLE_LDAP
          value: "no"
        image: index.docker.io/bitnami/postgresql@sha256:0f76a419cfd9996036e3a53672f50cf69ed7699f1241cbf8e20af17bbbdf0683
        imagePullPolicy: IfNotPresent
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - exec pg_isready -U "postgres" -h 127.0.0.1 -p 5432
          failureThreshold: 6
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        name: cf-db-postgresql
        ports:
        - containerPort: 5432
          name: tcp-postgresql
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - -e
            - |
              exec pg_isready -U "postgres" -h 127.0.0.1 -p 5432
              [ -f /opt/bitnami/postgresql/tmp/.initialized ] || [ -f /bitnami/postgresql/.initialized ]
          failureThreshold: 6
          initialDelaySeconds: 5
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          requests:
            cpu: 250m
            memory: 256Mi
        securityContext:
          runAsUser: 1001
        volumeMounts:
        - mountPath: /docker-entrypoint-initdb.d/
          name: custom-init-scripts
        - mountPath: /docker-entrypoint-initdb.d/secret
          name: custom-init-scripts-secret
        - mountPath: /dev/shm
          name: dshm
        - mountPath: /bitnami/postgresql
          name: data
          subPath: null
      securityContext:
        fsGroup: 1001
      volumes:
      - configMap:
          name: cf-db-postgresql-init-scripts
        name: custom-init-scripts
      - name: custom-init-scripts-secret
        secret:
          secretName: cf-db-credentials
      - emptyDir:
          medium: Memory
          sizeLimit: 1Gi
        name: dshm
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 8Gi
---
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: slightly-above-normal
description: Useful for DaemonSets which don't really have higher priority but should move other pods to other nodes
value: 1
---
apiVersion: v1
kind: Namespace
metadata:
  name: cf-system
  labels:
    cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
    istio-injection: enabled
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: uaa-config
  annotations:
    kapp.k14s.io/versioned: ""
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
data:
  uaa.yml: |
    issuer:
      uri: https://uaa.vcap.me
    encryption:
      active_key_label: default_encryption_key
    login:
      url: https://login.vcap.me
      entityBaseURL: https://uaa.vcap.me
      entityID: cloudfoundry-saml-login
    database:
      maxactive: 100
      maxidle: 10
      minidle: 0
      removeabandoned: false
      logabandoned: true
      abandonedtimeout: 300
      url: jdbc:postgresql://cf-db-postgresql.cf-db.svc.cluster.local:5432/uaa?sslmode=disable
    smtp:
      host: null
      port: 25
      starttls: null
      from_address: null
    oauth:
      client:
        override: true
      clients:
        admin:
          authorized-grant-types: client_credentials
          authorities: clients.read,clients.write,clients.secret,uaa.admin,scim.read,scim.write,password.write,openid
          autoapprove:
          - openid
          id: admin
        cf:
          id: cf
          override: true
          authorized-grant-types: password,refresh_token
          scope: cloud_controller.read,cloud_controller.write,openid,password.write,cloud_controller.admin,scim.read,scim.write,doppler.firehose,uaa.user,routing.router_groups.read,routing.router_groups.write
          authorities: uaa.none
          access-token-validity: 600
          refresh-token-validity: 2592000
          secret: ""
        cloud_controller_username_lookup:
          authorities: scim.userids
          authorized-grant-types: client_credentials
        cf_api_controllers:
          authorities: cloud_controller.write,cloud_controller.update_build_state
          authorized-grant-types: client_credentials
      user:
        authorities:
        - openid
        - scim.me
        - scim.userids
        - cloud_controller.read
        - cloud_controller.write
        - cloud_controller_service_permissions.read
        - password.write
        - uaa.user
        - approvals.me
        - oauth.approvals
        - profile
        - roles
        - user_attributes
        - uaa.offline_token
    scim:
      userids_enabled: true
      user:
        override: true
      groups:
        zones.read: Read identity zones
        zones.write: Create and update identity zones
        idps.read: Retrieve identity providers
        idps.write: Create and update identity providers
        clients.admin: Create, modify and delete OAuth clients
        clients.write: Create and modify OAuth clients
        clients.read: Read information about OAuth clients
        clients.secret: Change the password of an OAuth client
        scim.write: Create, modify and delete SCIM entities, i.e. users and groups
        scim.read: Read all SCIM entities, i.e. users and groups
        scim.create: Create users
        scim.userids: Read user IDs and retrieve users by ID
        scim.zones: Control a user's ability to manage a zone
        scim.invite: Send invitations to users
        password.write: Change your password
        oauth.approval: Manage approved scopes
        oauth.login: Authenticate users outside of the UAA
        openid: Access profile information, i.e. email, first and last name, and phone number
        groups.update: Update group information and memberships
        uaa.user: Act as a user in the UAA
        uaa.resource: Serve resources protected by the UAA
        uaa.admin: Act as an administrator throughout the UAA
        uaa.none: Forbid acting as a user
        uaa.offline_token: Allow offline access
    zones:
      internal:
        hostnames:
        - uaa.cf-system.svc.cluster.local
    uaa:
      url: https://uaa.vcap.me
      token:
        url: https://uaa.vcap.me/oauth/token
      approvals:
        url: https://uaa.vcap.me/approvals
      login:
        url: https://uaa.vcap.me/authenticate
      limitedFunctionality:
        enabled: false
        whitelist:
          endpoints:
          - /oauth/authorize/**
          - /oauth/token/**
          - /check_token/**
          - /login/**
          - /login.do
          - /logout/**
          - /logout.do
          - /saml/**
          - /autologin/**
          - /authenticate/**
          - /idp_discovery/**
          methods:
          - GET
          - HEAD
          - OPTIONS
  log4j2.properties: |-
    status = error
    dest = err
    name = UaaLog

    property.log_pattern=[%d{yyyy-MM-dd HH:mm:ss.SSS}] uaa%X{context} - %pid [%t] .... %5p --- %c{1}: %replace{%m}{(?<=password=|client_secret=)([^&]*)}{<redacted>}%n

    appender.uaaDefaultAppender.type = Console
    appender.uaaDefaultAppender.name = UaaDefaultAppender
    appender.uaaDefaultAppender.layout.type = PatternLayout
    appender.uaaDefaultAppender.layout.pattern = [UAA] ${log_pattern}

    appender.uaaAuditAppender.type = Console
    appender.uaaAuditAppender.name = UaaAuditAppender
    appender.uaaAuditAppender.layout.type = PatternLayout
    appender.uaaAuditAppender.layout.pattern = [UAA_AUDIT] ${log_pattern}

    rootLogger.level = info
    rootLogger.appenderRef.uaaDefaultAppender.ref = UaaDefaultAppender

    logger.UAAAudit.name = UAA.Audit
    logger.UAAAudit.level = info
    logger.UAAAudit.additivity = true
    logger.UAAAudit.appenderRef.auditEventLog.ref = UaaAuditAppender

    logger.cfIdentity.name = org.cloudfoundry.identity
    logger.cfIdentity.level = info
    logger.cfIdentity.additivity = false
    logger.cfIdentity.appenderRef.uaaDefaultAppender.ref = UaaDefaultAppender
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: uaa
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
  annotations:
    kapp.k14s.io/change-group: cf-for-k8s.cloudfoundry.org/uaa
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  selector:
    matchLabels:
      app: uaa-deployment
  replicas: 1
  template:
    metadata:
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9102"
        prometheus.io/path: /metrics
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: uaa-deployment
        app.kubernetes.io/name: uaa
        app.kubernetes.io/instance: uaa-standalone
        app.kubernetes.io/version: 74.12.0
        app.kubernetes.io/component: authorization_server
        app.kubernetes.io/part-of: uaa
        app.kubernetes.io/managed-by: kubectl
      namespace: cf-system
    spec:
      serviceAccountName: uaa
      initContainers:
      - name: build-uaa-truststore
        image: index.docker.io/cfidentity/uaa@sha256:491c8861b9b7a793714f5ad59dfd13b852b511c14483e9e0f446e72ac50337a7
        command:
        - sh
        - -c
        - |
          find_keytool_or_fail_fast() {
            local has_keytool
            ls "${JAVA_HOME}"/bin/keytool
            has_keytool=$?

            if [ ${has_keytool} -ne 0 ]; then
              exit ${has_keytool}
            fi
          }

          import_cert() {
            local pemfile="${1}"
            local alias="${2}"

            echo "Adding ${pemfile} to truststore"

            # Have to use cat instead of -file
            # because keytool won't understand all of the filenames!
            cat "${pemfile}" | "${JAVA_HOME}"/bin/keytool \
              -noprompt \
              -import \
              -trustcacerts \
              -alias "${alias}" \
              -keystore "${TRUSTSTORE_FILE}" \
              -storepass "${TRUSTSTORE_PASSWORD}"
          }

          get_alias() {
            local pemfile="${1}"
            basename "${pemfile}" .pem
          }

          add_ca_certs() {
            local has_ca_certs
            ls ${SECRETS_DIR}/ca_certs/*.pem
            has_ca_certs=$?

            if [ ${has_ca_certs} -eq 0 ]; then
              for cert in ${SECRETS_DIR}/ca_certs/*.pem; do
                import_cert "${cert}" "$(get_alias $cert)"
              done
            fi
          }

          add_system_certs() {
            for cert in $OS_CERTS_DIR/*.pem; do
              import_cert "${cert}" "$(get_alias $cert)"
            done
          }

          main() {
            find_keytool_or_fail_fast
            add_ca_certs
            add_system_certs
          }

          main
        env:
        - name: SECRETS_DIR
          value: /etc/secrets
        - name: TRUSTSTORE_FILE
          value: /etc/truststore/uaa.pkcs12.truststore
        - name: TRUSTSTORE_PASSWORD
          value: changeit
        - name: JAVA_HOME
          value: /layers/paketo-buildpacks_bellsoft-liberica/jre
        - name: OS_CERTS_DIR
          value: /etc/ssl/certs
        volumeMounts:
        - name: ca-certs-files
          mountPath: /etc/secrets/ca_certs
          readOnly: true
        - name: truststore-file
          mountPath: /etc/truststore
      containers:
      - name: uaa
        image: index.docker.io/cfidentity/uaa@sha256:491c8861b9b7a793714f5ad59dfd13b852b511c14483e9e0f446e72ac50337a7
        resources: {}
        ports:
        - name: http-uaa
          containerPort: 8080
          protocol: TCP
        env:
        - name: BPL_TOMCAT_ACCESS_LOGGING
          value: "y"
        - name: JAVA_OPTS
          value: -Dspring_profiles=postgresql -Djava.security.egd=file:/dev/./urandom -Dlogging.config=/etc/config/log4j2.properties -Dlog4j.configurationFile=/etc/config/log4j2.properties -DCLOUDFOUNDRY_CONFIG_PATH=/etc/config -DSECRETS_DIR=/etc/secrets -Djavax.net.ssl.trustStore=/etc/truststore/uaa.pkcs12.truststore -Djavax.net.ssl.trustStoreType=PKCS12 -Djavax.net.ssl.trustStorePassword=changeit -Dstatsd.enabled=true
        volumeMounts:
        - name: uaa-config
          mountPath: /etc/config
        - name: smtp-credentials-file
          mountPath: /etc/secrets/smtp_credentials.yml
          subPath: smtp_credentials.yml
          readOnly: true
        - name: database-credentials-file
          mountPath: /etc/secrets/database_credentials.yml
          subPath: database_credentials.yml
          readOnly: true
        - name: admin-client-credentials-file
          mountPath: /etc/secrets/admin_client_credentials.yml
          subPath: admin_client_credentials.yml
          readOnly: true
        - name: jwt-policy-signing-keys-file
          mountPath: /etc/secrets/jwt_policy_signing_keys.yml
          subPath: jwt_policy_signing_keys.yml
          readOnly: true
        - name: truststore-file
          mountPath: /etc/truststore
          readOnly: true
        - name: cf-admin-user-credentials-file
          mountPath: /etc/secrets/cf_admin_user_credentials.yml
          subPath: cf_admin_user_credentials.yml
          readOnly: true
        - name: cc-admin-client-credentials-file
          mountPath: /etc/secrets/cf_client_credentials.yml
          subPath: client_credentials.yml
          readOnly: true
        - name: cloud-controller-username-lookup-client-credentials-file
          mountPath: /etc/secrets/cloud_controller_username_lookup_client_credentials.yml
          subPath: client_credentials.yml
          readOnly: true
        - name: cf-api-controllers-client-credentials-file
          mountPath: /etc/secrets/cf_api_controllers_client_credentials.yml
          subPath: client_credentials.yml
          readOnly: true
        - name: login-secret-config-file
          mountPath: /etc/secrets/login_secret_config.yml
          subPath: login_secret_config.yml
          readOnly: true
        - name: encryption-key-config-file
          mountPath: /etc/secrets/encryption_key_config.yml
          subPath: encryption_key_config.yml
          readOnly: true
      - name: statsd-exporter
        image: oratos/statsd_exporter:v0.15.0@sha256:10a64dc4ad0a3e3fe88372f0481dea5c02595c38d168617836a99a649d3ac407
        imagePullPolicy: Always
        args:
        - --statsd.listen-udp=:8125
        ports:
        - name: metrics-uaa
          containerPort: 9102
          protocol: TCP
      volumes:
      - name: uaa-config
        configMap:
          name: uaa-config
      - name: smtp-credentials-file
        secret:
          optional: true
          secretName: uaa-smtp-credentials
      - name: database-credentials-file
        secret:
          optional: true
          secretName: uaa-database-credentials
      - name: admin-client-credentials-file
        secret:
          secretName: uaa-admin-client-credentials
      - name: jwt-policy-signing-keys-file
        secret:
          secretName: uaa-jwt-policy-signing-keys
      - name: ca-certs-files
        secret:
          optional: true
          secretName: uaa-ca-certs
      - name: truststore-file
        emptyDir: {}
      - name: cf-admin-user-credentials-file
        secret:
          secretName: uaa-cf-admin-user-credentials
      - name: cc-admin-client-credentials-file
        secret:
          secretName: uaa-cf-client-secret
      - name: cloud-controller-username-lookup-client-credentials-file
        secret:
          secretName: uaa-cloud-controller-username-lookup-client-secret
      - name: cf-api-controllers-client-credentials-file
        secret:
          secretName: uaa-cf-api-controllers-client-secret
      - name: login-secret-config-file
        secret:
          secretName: uaa-login-secret-config
      - name: encryption-key-config-file
        secret:
          secretName: uaa-encryption-key-config
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-admin-client-credentials
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  admin_client_credentials.yml: |
    oauth:
      clients:
        admin:
          secret: q30wr9rx6fj66carrcya
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-database-credentials
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
type: Opaque
stringData:
  database_credentials.yml: |
    database:
      username: uaa
      password: j2aw0kfqahkgq2lca57l
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-jwt-policy-signing-keys
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  jwt_policy_signing_keys.yml: |
    jwt:
      token:
        policy:
          activeKeyId: default_jwt_policy_key
          keys:
            default_jwt_policy_key:
              signingKey: |
                -----BEGIN RSA PRIVATE KEY-----
                MIIG5QIBAAKCAYEAy0GeddAQwmdBgCl3Z7tjPjFUq0PAWAyHw9sdv545Hkr2SCaa
                zHC2CZawLGizIJcvQAp0ls2ep7xMisTIc+diTKHFo2Miq4xp70QVG2Qc0GK7SWge
                SagZ2G81gdsCUJesQxV63aNJxC26N1LiSqloQWZ3+Vc/MT+IKc2a6DxTFCDuIxVd
                ArRfCZkjfQgPX95S+IEfqioU6q8K5cPMn7FZ24v7+MeDQLB5890lnJA46jL3Rwrh
                2VL0QzFMT+E0SmTqoUYDfb590fZJdRHBAg2FKPprl5a+zPv/OXGfqQVsHQhVk2v3
                qeyZIscCIAAHeM7fYJVX3ct4mYV0kTj9PfSBXxriLy1A5pNh9tI+YiasNxx+0wL4
                MZbLe5SSKpKo2BoG4Emd74X8OFKE5yL2+Iu++OXt5X6pN1DXfDxE5l/DE8Mb70qj
                DuJARRlc4XeuKQXp/eMRerGOFj4QX3h+xBKRXR/zoFNDjcwTvPM67QExYmoD4ww7
                fPKBp0eXKoLshZJLAgMBAAECggGBALeP/H7juK8JN6N6T4cUOc2qGZBOsMAUGOyt
                z9EFIQqVopSIoNavmAdS2qpQqC1vvFF239JtwrIzoWDV1T6vohwZIXesiVwqhGV8
                tB83q7oa4I+sA2Z79VN9I/Kxiwaj5AP1uy+9T1pn/bwHE61gD3K5CvLZc42TlfJC
                6HqCOHl+P/LZUVWm9gmiDuXVSKVJEN+zJZi1RoyoJwxYZ011ivR3GMmVzZi3iHvP
                pi8eJPiFrMKxNkTh4Q1p0UR225WwSoWYO1Mp64C+lquTkNzyJwR4q6jRokHeC4xn
                2qPblTxkJ885/0jRd7GsN50/tWGofY9XgIFunm+gx2Y2305zFiUBKsibwhbY9G8D
                m3lQ2+f9vI0g7qLyiEiTmbqxf6nXfZbza6QfT0GwpgsGwL7R97PPZkbUb4vMOcxP
                ZarRaDS2QVUyfE8hGPIUPmkd+cxw1gdMI1vngA0dVshVLTHX6rMbPyaYM+lUzZ5+
                PK357vDFmo2wBDB9kv4IfgrLi7ovIQKBwQDawh4AMwaMyjpKlFiIf94nywX52Qy2
                px34YuEsxjvfCPem8vITPgNNGsBOxn21EsHnO+7cKJZZ/32w2u7GbqejHEs5qF7d
                qKkHY58HvjvApDVQ8fMtsavwl8OeB9Sb0EIDSnn13p/BQnZPzQHXUCIb9LBjr2ZW
                gN7GsEz2ry9kNlkpCmKLiO05g+yqC0PGK998/+WYh2Q5cX2DXLgIDGH5C+1FtQR4
                0nUWn7PI8Qq4VXlNnd07DSNbZVLCQc2vC/sCgcEA7dvmGTtiiC7lE3YKTpuMtEqx
                dBMJjP6Am7auafMwS1A35yUUOv7yWOtckkgvZAaVGmneVqCa3NzkwyCcApVCR7ib
                j+cvTIVOdcvs2Fh02oPXiIoRVqQfOyS6UGgzCQ8XKImaXCUQo4J4Zb0dxrkx38Da
                YSNCwYzgEwy4Ept8nCG25S+mP+CRFhJb2f7zr5M0OFxH1DC6v3Rrsz9ws0p7sWfc
                SXv1MOMmb6Nc8UyMrV+tuJJOs5dVgCGN5qvDHPHxAoHAItFoswFsFnaNhpdL7BXm
                BxFiVxz70AqTU5hxXI4Es4Aa4sCiVPu2zMvoNeGT2oEsyaAZaYMwQwzONZrzDDRK
                jESRmJC64K7akGmDw1i86/F25vZLjUdNJZMSOJHofhBMoXd2J/MSHFF2wUbQ9zMy
                6p4sgQFG2ZfTXW5sIYtKkLmxwT1859aYY2IjBgGa/Oy4uo2EPp22DwqIPqNAS0+l
                PF1wm3qvRofAySQMGnx7B1HbZ8Yrkx2JNh/PZ0nP8f+HAoHBAOcz42LNVYZYRvT2
                vSgRjOBG5lyUkKkLTUmOddSovV3HmL9GTHbYEAuco7vRDLemqlIlbCg6Lq3WzUpa
                LStZmDaM3DExn8k6nrxjv1HAEb3Bf8TJp/bWy0C6/5te3ZTFpVYTAwbkRFsbXBpQ
                jFv48eCz3dGj66SlYb1ClL4Jg0Nkhhoaiff3OjABImUwrAATDyRllrBLuYqWCIYQ
                eWTdVoRoFzkak4e0lEzZt2MZbHit0vfgxz1MMaC9fOgmNx6wkQKBwQDW94/OKqUI
                lcSHRXyunbtiZ94Z5+lUX8NWX/pj2cQEbcs+33OQwvKlThdqCcouQESF0dmsjraK
                TyXeDKfGzrV5kvAC6tCDj5kmjxnj3J4qh2m0IOmo9WP6TldRR/j70wOlGmaTh+i0
                o2wPUHuBF6OPd/l6FNkO96ZM2tny8hsBhtHDd+UKJkxr2UTdzAIrHcoyRZu24LbO
                pA9OA0+YgqeiNDltc3EbHtWosshS80f5ydNdQ0v/GVo1mwh6siwXqqU=
                -----END RSA PRIVATE KEY-----
---
apiVersion: v1
kind: Service
metadata:
  name: uaa
  labels:
    app: uaa-deployment
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
  namespace: cf-system
spec:
  type: ClusterIP
  ports:
  - port: 8080
    name: http-uaa
    targetPort: 8080
    protocol: TCP
  selector:
    app: uaa-deployment
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: uaa
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
automountServiceAccountToken: false
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: uaa-external-virtual-service
  namespace: cf-system
spec:
  hosts:
  - uaa.vcap.me
  - '*.uaa.vcap.me'
  - login.vcap.me
  - '*.login.vcap.me'
  gateways:
  - cf-system/istio-ingressgateway
  http:
  - route:
    - destination:
        host: uaa.cf-system.svc.cluster.local
        port:
          number: 8080
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-certs
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
data:
  uaa.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNGdJQkFBS0NBWUVBbXJQOUhRdFZGVlFsT0haaTROeUdJL2lSb3JUWnloakRvR0R0bUdwSkl0RzJ2RmtZCkNERjNPNTlCZzYyS1laZVd6SEpsM0lUL1Rkb3NtczV3cGtBblZ0T2FFNWJyajhVOWYydHh6eEpUaGtOaERsN3oKZHc2QUJ3TVlGMDlnL0V6NVJXMUNobkZnbG1Wc3hxOTBnT1Q2a2tWRk4yVHZSVldBVmJZeng1dEozNmtreEI5ZApsMFk5QXJhR0tydDVVRi80aU9xTnc2L0loOUd6ODNXSWpJOGxWRXk2Ylg2R1NkR0t2U2FueHBSK2k1WjdzUTNBCnFIT0o0R0JoVWFaMDE4c3h5V0wyN09VRDBHV3I1a3lOcXlvZHJTSWthN2FhZUQ5d2l5L1VubWJ3ZVlXcDRqK0wKaEg0YXEwM0VpRWtENS9UTmRHcHdjMkVkOUZxY3lxTXFlWFlMRDd6L0tlY2c5d3p0M2ROckcydGxzNVpuR3hjYgpNY293Y0hWZ1AzM3JwWlZ4N2V5M2Q2aHhuZ3lCbUpiVHNpTDgzclVrcXFQeHpmYkNRNWwvTWU0TWt6WlFNK1JkCmpFZFF2UGdSc25FdzlsdVNabW9yOHdHTVd2SDhuTmRobURXNWdrNXVKaVRhRnpobnd5UFFCNlRnQ3JCMkkwbTIKaVc1UlhRVUEySmhpYTN4UEFnTUJBQUVDZ2dHQVNKMTNqNnlFRVhEZno3THlFcTR3WUs0S1hoOFpvMTBnWmlWWgpJUk95cEo5ZmNPVTQvSStMY2ZiODMzd1QybDgzTDF2N0tCbGRaUU9sc0R4NmIrN3BDRDVtc2c5REhzYnNhT1RjCkZPQjdTQ2hVWkZSNVgwYjFIVlY4ZDJTUkY1eGgzUTYrRFRFbXJ6R0liM0puOHlDSDVTU1Nxcis3K0FWOEtiOU8KYXNFZldkYWhKVlc3cm9nUGx6aHBuYUZGL2s0dDhNWjRLSVJZVWpoQ2lXSi81OHBCTVdLYWwwNnVaZlB2ZFgyeApmdXF3dzRDdEtweFQ5RDNYVi9TbGVaZnlmR0Fwa1ljcnF6aHZKa1o0eFQ4TGZXVFM4SlNQRm41akZEdzVTN2UyCjF5bFp0L0FyNVRybS8xaU5vZjE5N24vdXpXWHNmV2hPWEN1ZVRwQ1M0RzF4anBTazBoVVlRZTFSZjNpTGJkZlQKUnQ1dlJCZ3FGdU1RSWhZMXZCcGVRTG1YaEt0NlZ3UkdxeTl2MURkYktSRG4rQ2JvN0JFQXJ5K1haREc1dkR1cwpKNTVwNDdGMWgrZ1hxSVAwS2JIVzhSeS94UDRVcGxWV1Q0RnVnOCsvSTF0ZHBhc2NUbXY0ekViNlR0azFjM200CmpSL25sK1RMS2dyMnR0VnVFNG9qS09qenpDTVJBb0hCQU1KUjJ6RFB3ZTR4MlIwSTZvOEtFa01pcU91cmJ1cTgKbXVnaHlQQjVPbjFwdmtFbk5XL1NJV1N5SUVZSEszSnV4MWlscHZhRXlRa0lnR3E4a2hGaFdTajJQeVR4QU8vcApRdGtkaUFrM1piRi9XRElFbkRKUlhtQnJRdzVvVnhJYWtVcTEyLytyVGV1VVdQL0VEZ0FaNldGSUZIQUEwNUlzClBHQU9lNjIrNVRrbll2dFhQMTVaZ1JCbFRGd0pEY09rYy9zeGhLU0FKYUFpRWhMYXFLV1lZVEJJL21YdGF0TFcKOEZSRFJUS29vSVhKUWt3cktOY05zVUNpaXZYb2RZK3hsUUtCd1FETHp2QlhQSm01YVU3bTlWOFEzd3dlT1BDaAptaVVXK3B1bWFKVjNrV1Y3NzJwK2dKdkVTUkZGbFZXUkJHOXhDaytEZ09wRnMvTVo5MTkxT0F6L09QZU0yWnJVCkVLMUxlcGQ1cUNWOXZla05RMHZWeGJuVEdLL1Mwb1U1Umo3Q0JsUVRXeGY5amlxQjVIKzlzR1RhTk4rOFkveDQKbmVkY1FRdDlaMzRPQWZnM0lNOEVlYjk4dFRNYmxwTzJ6NWExZ1NFREI5Q2dZUWRaaXdDaUNKQ0hGcklyQ2ZRWgo1Vk5LUnRWeTZXNFFjME5FQlo1bmdSUkR0ZndHOGdxc1lJK3BCVk1DZ2NBVlhua1RRaFdhZ3lMVUhaSGx6djY1CklVdWdOd2NJaTFzaG9lMTkvR2JoT2NxeFVZVi8yWVRRbFFJVmtWNUd4RVhweXJXMHNGK0hQY2NaZGNrK1hnMDMKQXZWb3M1UWR6ZklLL0VOa2VCSVgxZUEyQituQllzOVZIUmFQdEF1M012SzlXNGhvOGthc1hIRDVGMjlPdFlyRApwdkNRYkpiWG9VTzJjSUZMVnczUUhqTzFYaC9hMlU3bkpheWpCbC9jSHU2ZU5oRFhJanlCQXA0b01xR1BMRldyCndLc3hQRTJlQ0FMLzBUSC80eWxiN1FqOFpWYWxaNTBSZFk2QWdtTERQWTBDZ2NBY2ZmK25rbmRETG0relpoWTIKTzVoc0dUVzZ3ZHZ4akhONkhpRFhLR0p4b3hUV1BwQ0lMbGJWelh5NjIwM2hGYm5yL25mQjZ0aFBodiszV1hDbgp0WVVXRWMzTlc4OStQOU14Vk1wNCs3VzYvdTk1SVQxTFA2WkU2TjFyRm1EcnF3clI4ZWcyc0V0TkFXN0NUQWl0CllMcnVrV1BZVU9ycFFNYWtiM1YxNjl5UmlHcW9pNFN6b0hsV29BUmlpRDdmZlAvcWRvczZBSmFRZEJoUWpyWDEKekx4M3U5cCtURXNLbFVCOTRoaGJBR0lrL2t3WTJEakhCb2dIU0lzcGNnNWphTFVDZ2NCOUx6TXBWRkZTYVMxVgpjU1FqTnJUcVpjRjhvOVpmWDZtYUdQUDN6ODlHSmNrQnZ6NDVjTTlCM0svT0pESnNacjNjNkhDRWFqTUlwQVFuCk9laVV4Zy94OW1nZGFYZCtwT1B6T3BPeitMdm5FTTh3WkRxaXErVVhWSXV3Mm5CL1ZnbzkxMThxNlFUcEtwSEwKSDJ1bU4wbWgraUZZMS93RW4vU2dhVHRUUmFZSnlRdS8wK29USVdPMSs3bGhUSHNIaUJtemhVVXFVOTNyaWlOMQpnTW1KZHd0M3drR1ZCSnp5cldxRzI5My8vSVFGbm1iWVJZa3RPQVowL1U2SDZDelZteHc9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCgo=
  uaa.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVpakNDQXZLZ0F3SUJBZ0lRSzhXcUdUQTl0SG9SQWZ6TVNYWWt2VEFOQmdrcWhraUc5dzBCQVFzRkFEQXoKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEN6QUpCZ05WQkFNVApBbU5oTUI0WERUSXdNRGN4TnpJeE1EUXhOVm9YRFRJeE1EY3hOekl4TURReE5Wb3dUakVNTUFvR0ExVUVCaE1EClZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1TWXdKQVlEVlFRRERCMHFMbU5tTFhONWMzUmwKYlM1emRtTXVZMngxYzNSbGNpNXNiMk5oYkRDQ0FhSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnR1BBRENDQVlvQwpnZ0dCQUpxei9SMExWUlZVSlRoMll1RGNoaVA0a2FLMDJjb1l3NkJnN1pocVNTTFJ0cnhaR0FneGR6dWZRWU90CmltR1hsc3h5WmR5RS8wM2FMSnJPY0taQUoxYlRtaE9XNjQvRlBYOXJjYzhTVTRaRFlRNWU4M2NPZ0FjREdCZFAKWVB4TStVVnRRb1p4WUpabGJNYXZkSURrK3BKRlJUZGs3MFZWZ0ZXMk04ZWJTZCtwSk1RZlhaZEdQUUsyaGlxNwplVkJmK0lqcWpjT3Z5SWZScy9OMWlJeVBKVlJNdW0xK2hrblJpcjBtcDhhVWZvdVdlN0VOd0toemllQmdZVkdtCmROZkxNY2xpOXV6bEE5QmxxK1pNamFzcUhhMGlKR3UybW5nL2NJc3YxSjVtOEhtRnFlSS9pNFIrR3F0TnhJaEoKQStmMHpYUnFjSE5oSGZSYW5NcWpLbmwyQ3crOC95bm5JUGNNN2QzVGF4dHJaYk9XWnhzWEd6SEtNSEIxWUQ5OQo2NldWY2Uzc3QzZW9jWjRNZ1ppVzA3SWkvTjYxSktxajhjMzJ3a09aZnpIdURKTTJVRFBrWFl4SFVMejRFYkp4Ck1QWmJrbVpxSy9NQmpGcngvSnpYWVpnMXVZSk9iaVlrMmhjNFo4TWowQWVrNEFxd2RpTkp0b2x1VVYwRkFOaVkKWW10OFR3SURBUUFCbzM4d2ZUQU9CZ05WSFE4QkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSApBd0lHQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdIUVlEVlIwT0JCWUVGTWJ5ZlVUbzJWUjducjI5CjAvSUJnYW1OSHhpVE1COEdBMVVkSXdRWU1CYUFGUG5XSUlDVVc2N25GTjhSUVdhMllrd3lTbkdCTUEwR0NTcUcKU0liM0RRRUJDd1VBQTRJQmdRQlE2TUNVYnBaYlZBd0hZbWo3NWRXVUk4UUFmcU82K1pUb2lQb2JuL1d1YjAwWQpQbWFIWnh2M1dYWGVZb2ltTkVxcmYvZzdiaG50QUdpV2RTa0lzOUoxUGpmVDVkR3hRZkIvOUNHVllHeDd4K0c5ClZXWWhNN2xqKzdFYmI0YlBSZFZEU0hyMkZISllIWUxZcmp6cDBEUHFDZTQ2QlVkeDJtZ3hYeklteWx2RjF2dTAKYWl5S1NxcDd3RVRmcG5NSERGRkh0S3FMUzVaQjR1eGhVUU0vL2h3bGNsdnhGZVBkMkV2b2F4bGF5MVgrTjYyVgowbjk2WnRmS05WczRzV3UvRTVUemVHT09zZ0NGSWhMM21IL1dJTkJ0WGpNZ0FlRG1XSFNSZGIvdEtFMTFQZ1c5CkVyek9yWWlQQi95M3kzL2lROFJHL2dhVWxsMWZxMlVlZHllUUVTVXFkNUQ0L290SU9JYlg5azJyWEg4MmxsQU4KbytEL0lTcWVvZUdxdTh6aG95ZUl2UDBlaFBrMWRNWVRNbjFVRDZOcTB2ZksrV2oxQzlDVjdlb2t2blZUeEhXdQpMRzJaZU5ZMWNudmpDQVBRUTNmOGJ6RWZuUFVRUzdUb0FDclFiT3pYTGUvMWpTNFg2RFdTdlZPaWZkb3grMmI5CnRjY3pCTHlPY1Npa3JLRzRNSVE9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-encryption-key-config
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  encryption_key_config.yml: |
    encryption:
      encryption_keys:
      - label: default_encryption_key
        passphrase: 9ryaxlu86q79iponzeat
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-login-secret-config
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  login_secret_config.yml: |
    login:
      serviceProviderKey: ""
      serviceProviderKeyPassword: ""
      serviceProviderCertificate: ""
    LOGIN_SECRET: ""
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-cf-client-secret
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  client_credentials.yml: |
    oauth:
      clients:
        cf:
          secret: ""
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-cloud-controller-username-lookup-client-secret
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  client_credentials.yml: |
    oauth:
      clients:
        cloud_controller_username_lookup:
          secret: ""
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-cf-api-controllers-client-secret
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  client_credentials.yml: |
    oauth:
      clients:
        cf_api_controllers:
          secret: ""
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-cf-admin-user-credentials
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  cf_admin_user_credentials.yml: |
    scim:
      users:
      - admin|ynv19qmq99cl5njd5au8|admin@admin.tld|first|last|clients.read,cloud_controller.admin,doppler.firehose,network.admin,openid,routing.router_groups.read,routing.router_groups.write,scim.read,scim.write|uaa
---
apiVersion: v1
kind: Namespace
metadata:
  name: cf-workloads
  annotations:
    kapp.k14s.io/change-rule.cf-workloads-namespace: delete before deleting cf-k8s-networking/routecontroller
  labels:
    istio-injection: enabled
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: system:aggregated-metrics-reader
  labels:
    rbac.authorization.k8s.io/aggregate-to-view: "true"
    rbac.authorization.k8s.io/aggregate-to-edit: "true"
    rbac.authorization.k8s.io/aggregate-to-admin: "true"
rules:
- apiGroups:
  - metrics.k8s.io
  resources:
  - pods
  - nodes
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: metrics-server:system:auth-delegator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:auth-delegator
subjects:
- kind: ServiceAccount
  name: metrics-server
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: metrics-server-auth-reader
  namespace: kube-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: extension-apiserver-authentication-reader
subjects:
- kind: ServiceAccount
  name: metrics-server
  namespace: kube-system
---
apiVersion: apiregistration.k8s.io/v1beta1
kind: APIService
metadata:
  name: v1beta1.metrics.k8s.io
spec:
  service:
    name: metrics-server
    namespace: kube-system
  group: metrics.k8s.io
  version: v1beta1
  insecureSkipTLSVerify: true
  groupPriorityMinimum: 100
  versionPriority: 100
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: metrics-server
  namespace: kube-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: metrics-server
  namespace: kube-system
  labels:
    k8s-app: metrics-server
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  selector:
    matchLabels:
      k8s-app: metrics-server
  template:
    metadata:
      name: metrics-server
      labels:
        k8s-app: metrics-server
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      serviceAccountName: metrics-server
      volumes:
      - name: tmp-dir
        emptyDir: {}
      containers:
      - name: metrics-server
        image: oratos/metrics-server:v0.3.6@sha256:a37da13de7b74c373e8698dee7836ce5fdbd102c3c1c8b9953a95e7f20138ab6
        imagePullPolicy: IfNotPresent
        args:
        - --cert-dir=/tmp
        - --secure-port=4443
        - --kubelet-insecure-tls
        - --kubelet-preferred-address-types=InternalIP
        ports:
        - name: main-port
          containerPort: 4443
          protocol: TCP
        securityContext:
          readOnlyRootFilesystem: true
          runAsNonRoot: true
          runAsUser: 1000
        volumeMounts:
        - name: tmp-dir
          mountPath: /tmp
      nodeSelector:
        kubernetes.io/os: linux
        kubernetes.io/arch: amd64
---
apiVersion: v1
kind: Service
metadata:
  name: metrics-server
  namespace: kube-system
  labels:
    kubernetes.io/name: Metrics-server
    kubernetes.io/cluster-service: "true"
spec:
  selector:
    k8s-app: metrics-server
  ports:
  - port: 443
    protocol: TCP
    targetPort: main-port
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: system:metrics-server
rules:
- apiGroups:
  - ""
  resources:
  - pods
  - nodes
  - nodes/stats
  - namespaces
  - configmaps
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: system:metrics-server
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:metrics-server
subjects:
- kind: ServiceAccount
  name: metrics-server
  namespace: kube-system

---
apiVersion: kapp.k14s.io/v1alpha1
kind: Config
metadata:
  name: kapp-version
minimumRequiredVersion: 0.33.0
---
apiVersion: kapp.k14s.io/v1alpha1
kind: Config
metadata:
  name: kapp-istio-gateway-rules
templateRules:
- affectedResources:
    objectReferences:
    - nameKey: credentialName
      path:
      - spec
      - servers
      - allIndexes: true
      - tls
      resourceMatchers:
      - apiVersionKindMatcher:
          apiVersion: networking.istio.io/v1alpha3
          kind: Gateway
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: Secret
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  name: cf-api-server
  namespace: cf-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-server
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  template:
    metadata:
      annotations:
        prometheus.io/port: "9102"
        prometheus.io/scrape: "true"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: cf-api-server
        app.kubernetes.io/name: cf-api-server
    spec:
      containers:
      - command:
        - /cnb/process/web
        env:
        - name: CLOUD_CONTROLLER_NG_CONFIG
          value: /config/cloud_controller_ng.yml
        - name: CLOUD_CONTROLLER_NG_SECRETS
          value: /config/secrets.yml
        image: index.docker.io/cloudfoundry/cloud-controller-ng@sha256:dc63bd5ab08319ae39f2fd4b41229e0c8636c31c327f2d91208f5ab54fa65b6c
        imagePullPolicy: Always
        name: cf-api-server
        volumeMounts:
        - mountPath: /config/cloud_controller_ng.yml
          name: cloud-controller-ng-yaml
          subPath: cloud_controller_ng.yml
        - mountPath: /config/secrets.yml
          name: cloud-controller-ng-secrets-yaml
          subPath: secrets.yml
        - mountPath: /etc/cf-api/ccdb_password
          name: cf-api-db-password
        - mountPath: /etc/cf-api/ccdb_encryption_key
          name: cf-api-db-encryption-key
        - mountPath: /etc/cf-api/username-lookup-client-secret
          name: cf-api-username-lookup-client-secret
        - mountPath: /etc/cf-api/blobstore/secret-access-key
          name: cf-api-blobstore-secret-access-key
        - mountPath: /data/cloud_controller_ng
          name: server-sock
        - mountPath: /tmp/uploads
          name: nginx-uploads
      - command:
        - /cnb/process/local-worker
        env:
        - name: CLOUD_CONTROLLER_NG_CONFIG
          value: /config/cloud_controller_ng.yml
        - name: CLOUD_CONTROLLER_NG_SECRETS
          value: /config/secrets.yml
        image: index.docker.io/cloudfoundry/cloud-controller-ng@sha256:dc63bd5ab08319ae39f2fd4b41229e0c8636c31c327f2d91208f5ab54fa65b6c
        imagePullPolicy: Always
        name: cf-api-local-worker
        volumeMounts:
        - mountPath: /config/cloud_controller_ng.yml
          name: cloud-controller-ng-yaml
          subPath: cloud_controller_ng.yml
        - mountPath: /config/secrets.yml
          name: cloud-controller-ng-secrets-yaml
          subPath: secrets.yml
        - mountPath: /etc/cf-api/ccdb_password
          name: cf-api-db-password
        - mountPath: /etc/cf-api/ccdb_encryption_key
          name: cf-api-db-encryption-key
        - mountPath: /etc/cf-api/username-lookup-client-secret
          name: cf-api-username-lookup-client-secret
        - mountPath: /etc/cf-api/blobstore/secret-access-key
          name: cf-api-blobstore-secret-access-key
        - mountPath: /tmp/uploads
          name: nginx-uploads
        - mountPath: /tmp/packages
          name: tmp-packages
      - env:
        - name: REGISTRY_USERNAME
          valueFrom:
            secretKeyRef:
              key: username
              name: cc-package-registry-upload-secret
        - name: REGISTRY_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: cc-package-registry-upload-secret
        image: index.docker.io/cloudfoundry/cf-api-package-registry-buddy@sha256:87a6c4d2ec14d97f8c193a6b8dd2c26926eaa78eb85052997ae55cbb34880ad0
        imagePullPolicy: Always
        name: registry-buddy
        volumeMounts:
        - mountPath: /tmp/packages
          name: tmp-packages
      - image: index.docker.io/cloudfoundry/capi-nginx@sha256:04dbaba65a3002f2225735c312788317035afc8971864ce34a91e077a90742c4
        imagePullPolicy: Always
        name: nginx
        ports:
        - containerPort: 80
        - containerPort: 9023
        readinessProbe:
          httpGet:
            path: /healthz
            port: 80
        volumeMounts:
        - mountPath: /etc/nginx
          name: nginx
          readOnly: true
        - mountPath: /data/cloud_controller_ng
          name: server-sock
        - mountPath: /cloud_controller_ng
          name: nginx-logs
        - mountPath: /tmp/uploads
          name: nginx-uploads
      - image: index.docker.io/cloudfoundry/statsd_exporter@sha256:10a64dc4ad0a3e3fe88372f0481dea5c02595c38d168617836a99a649d3ac407
        imagePullPolicy: Always
        name: statsd-exporter
        ports:
        - containerPort: 9102
      serviceAccountName: cf-api-server-service-account
      volumes:
      - configMap:
          name: cloud-controller-ng-yaml
        name: cloud-controller-ng-yaml
      - configMap:
          name: cloud-controller-ng-secrets-yaml
        name: cloud-controller-ng-secrets-yaml
      - name: cf-api-db-password
        secret:
          secretName: capi-database-password
      - name: cf-api-db-encryption-key
        secret:
          secretName: capi-database-encryption-key-secret
      - name: cf-api-username-lookup-client-secret
        secret:
          secretName: cloud-controller-username-lookup-client-secret
      - name: cf-api-blobstore-secret-access-key
        secret:
          secretName: capi-blobstore-secret-key
      - emptyDir: {}
        name: server-sock
      - configMap:
          name: nginx
        name: nginx
      - emptyDir: {}
        name: nginx-logs
      - emptyDir: {}
        name: nginx-uploads
      - emptyDir: {}
        name: tmp-packages
---
apiVersion: v1
imagePullSecrets:
- name: cc-kpack-registry-auth-secret
kind: ServiceAccount
metadata:
  name: cc-kpack-registry-service-account
  namespace: cf-workloads-staging
secrets:
- name: cc-kpack-registry-auth-secret
---
apiVersion: v1
data:
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwOi8vaGFyYm9yLmhhcmJvci5zdmMuY2x1c3Rlci5sb2NhbDo4MCI6eyJhdXRoIjoiWVdSdGFXNDZZV1J0YVc0PSIsInBhc3N3b3JkIjoiYWRtaW4iLCJ1c2VybmFtZSI6ImFkbWluIn19fQ==
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: cc-kpack-registry-auth-secret
  namespace: cf-workloads-staging
type: kubernetes.io/dockerconfigjson
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
    kpack.io/docker: http://harbor.harbor.svc.cluster.local:80
  name: cc-package-registry-upload-secret
  namespace: cf-system
stringData:
  password: admin
  username: admin
type: kubernetes.io/basic-auth
---
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kapp.k14s.io/update-strategy: fallback-on-replace
    kbld.k14s.io/images: |
      null
  name: ccdb-migrate
  namespace: cf-system
spec:
  backoffLimit: 6
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - command:
        - /cnb/process/migrate
        env:
        - name: CLOUD_CONTROLLER_NG_CONFIG
          value: /config/cloud_controller_ng.yml
        - name: CLOUD_CONTROLLER_NG_SECRETS
          value: /config/secrets.yml
        image: index.docker.io/cloudfoundry/cloud-controller-ng@sha256:dc63bd5ab08319ae39f2fd4b41229e0c8636c31c327f2d91208f5ab54fa65b6c
        imagePullPolicy: Always
        name: run-migrations
        volumeMounts:
        - mountPath: /config/cloud_controller_ng.yml
          name: cloud-controller-ng-yaml
          subPath: cloud_controller_ng.yml
        - mountPath: /config/secrets.yml
          name: cloud-controller-ng-secrets-yaml
          subPath: secrets.yml
        - mountPath: /etc/cf-api/ccdb_password
          name: cf-api-db-password
        - mountPath: /etc/cf-api/ccdb_encryption_key
          name: cf-api-db-encryption-key
        - mountPath: /etc/cf-api/username-lookup-client-secret
          name: cf-api-username-lookup-client-secret
        - mountPath: /etc/cf-api/blobstore/secret-access-key
          name: cf-api-blobstore-secret-access-key
      restartPolicy: OnFailure
      volumes:
      - configMap:
          name: cloud-controller-ng-yaml
        name: cloud-controller-ng-yaml
      - configMap:
          name: cloud-controller-ng-secrets-yaml
        name: cloud-controller-ng-secrets-yaml
      - name: cf-api-db-password
        secret:
          secretName: capi-database-password
      - name: cf-api-db-encryption-key
        secret:
          secretName: capi-database-encryption-key-secret
      - name: cf-api-username-lookup-client-secret
        secret:
          secretName: cloud-controller-username-lookup-client-secret
      - name: cf-api-blobstore-secret-access-key
        secret:
          secretName: capi-blobstore-secret-key
---
apiVersion: v1
data:
  cloud_controller_ng.yml: |
    local_route: 0.0.0.0
    external_port: 9022
    tls_port: 9023
    readiness_port:
      cloud_controller_worker: 4444
      deployment_updater: 4445
      clock: 4446
    fluent:
      host: fluentd-forwarder-ingress
      port: 24224
    internal_service_hostname: capi.cf-system.svc.cluster.local
    internal_service_port: 9023
    pid_filename: cloud_controller_ng.pid
    newrelic_enabled: false
    development_mode: false
    external_protocol: https
    external_domain: api.vcap.me
    temporary_disable_deployments: false
    temporary_use_logcache: true
    temporary_disable_v2_staging: true
    system_domain_organization: system
    system_domain: vcap.me
    app_domains:
    - apps.vcap.me
    reserved_private_domains: /dev/null
    disable_private_domain_cross_space_context_path_route_sharing: false
    jobs:
      global:
        timeout_in_seconds: 14400
    default_app_memory: 1024
    default_app_disk_in_mb: 1024
    maximum_app_disk_in_mb: 2048
    instance_file_descriptor_limit: 16384
    request_timeout_in_seconds: 900
    nginx:
      use_nginx: true
      instance_socket: /data/cloud_controller_ng/cloud_controller.sock
    index: 0
    name: ""
    route_services_enabled: true
    volume_services_enabled: true
    info:
      name: ""
      build: ""
      version: 0
      support_address: ""
      description: ""
      min_cli_version: 7.0.1
      min_recommended_cli_version: 7.0.1
      app_ssh_endpoint: ""
      app_ssh_host_key_fingerprint: ""
      app_ssh_oauth_client: ""
    directories:
      tmpdir: /tmp/
      diagnostics: /cloud_controller_ng/diagnostics/
    logging:
      file: /dev/stdout
      syslog: vcap.cloud_controller_ng
      level: info
      max_retries: 1
    logcache:
      host: metric-proxy
      port: 8080
      temporary_ignore_server_unavailable_errors: true
    log_stream:
      url: https://log-stream.vcap.me
    doppler:
      url: wss://doppler.vcap.me:443
    db:
      database:
        adapter: postgres
        host: cf-db-postgresql.cf-db.svc.cluster.local
        port: 5432
        user: cloud_controller
        database: cloud_controller
      max_connections: 25
      pool_timeout: 10
      log_level: debug2
      log_db_queries: false
      read_timeout: 3600
      connection_validation_timeout: 3600
      ssl_verify_hostname: false
    telemetry_log_path: /dev/null
    log_cache:
      url: https://log-cache.vcap.me
    threadpool_size: 20
    internal_route_vip_range: ""
    login:
      url: https://login.vcap.me
    uaa:
      url: https://uaa.vcap.me
      internal_url: http://uaa.cf-system.svc.cluster.local:8080
      resource_id: cloud_controller,cloud_controller_service_permissions
      client_timeout: 60
    credential_references:
      interpolate_service_bindings: false
    staging:
      timeout_in_seconds: 900
      minimum_staging_memory_mb: 1024
      minimum_staging_disk_mb: 4096
      minimum_staging_file_descriptor_limit: 16384
    default_health_check_timeout: 60
    maximum_health_check_timeout: 180
    stacks_file: config/stacks.yml
    shared_isolation_segment_name: shared
    quota_definitions:
      default:
        memory_limit: 102400
        non_basic_services_allowed: true
        total_routes: 1000
        total_services: -1
        total_reserved_route_ports: 100
    default_quota_definition: default
    resource_pool:
      resource_directory_key: cc-resources
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      minimum_size: 65536
      maximum_size: 536870912
      fog_aws_storage_options: {}
    packages:
      app_package_directory_key: cc-packages
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      max_valid_packages_stored: 5
      max_package_size: 1073741824
      fog_aws_storage_options: {}
      image_registry:
        base_path: harbor.harbor.svc.cluster.local:80/library
    registry_buddy:
      host: 127.0.0.1
      port: 8080
    droplets:
      droplet_directory_key: cc-droplets
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      fog_aws_storage_options: {}
      max_staged_droplets_stored: 5
    buildpacks:
      buildpack_directory_key: cc-buildpacks
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      fog_aws_storage_options: {}
    database_encryption:
      current_key_label: encryption_key_0
      pbkdf2_hmac_iterations: 2048
    disable_custom_buildpacks: true
    broker_client_timeout_seconds: 60
    broker_client_default_async_poll_interval_seconds: 60
    broker_client_max_async_poll_duration_minutes: 10080
    renderer:
      max_results_per_page: 100
      default_results_per_page: 50
      max_inline_relations_depth: 2
    cloud_controller_username_lookup_client_name: cloud_controller_username_lookup
    allow_app_ssh_access: false
    default_app_ssh_access: false
    skip_cert_verify: false
    install_buildpacks: []
    app_bits_upload_grace_period_in_seconds: 1200
    security_group_definitions:
    - name: public_networks
      rules:
      - destination: 0.0.0.0-9.255.255.255
        protocol: all
      - destination: 11.0.0.0-169.253.255.255
        protocol: all
      - destination: 169.255.0.0-172.15.255.255
        protocol: all
      - destination: 172.32.0.0-192.167.255.255
        protocol: all
      - destination: 192.169.0.0-255.255.255.255
        protocol: all
    - name: dns
      rules:
      - destination: 0.0.0.0/0
        ports: "53"
        protocol: tcp
      - destination: 0.0.0.0/0
        ports: "53"
        protocol: udp
    default_running_security_groups:
    - public_networks
    - dns
    default_staging_security_groups:
    - public_networks
    - dns
    allowed_cors_domains: []
    statsd_host: 127.0.0.1
    statsd_port: 9125
    security_event_logging:
      enabled: false
      file: /dev/null
    system_hostnames:
    - api
    - uaa
    - login
    - log-cache
    bits_service:
      enabled: false
    rate_limiter:
      enabled: false
      general_limit: 2000
      unauthenticated_limit: 100
      reset_interval_in_minutes: 60
    opi:
      url: http://eirini.cf-system.svc.cluster.local:8080
      opi_staging: true
      enabled: true
      cc_uploader_url: https://TODO.TODO
    perm:
      enabled: false
    max_labels_per_resource: 50
    max_annotations_per_resource: 200
    custom_metric_tag_prefix_list:
    - metric.tag.cloudfoundry.org
    default_app_lifecycle: kpack
    kubernetes:
      host_url: https://kubernetes.default
      service_account:
        token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
      workloads_namespace: cf-workloads
      kpack:
        builder_namespace: cf-workloads-staging
        registry_service_account_name: cc-kpack-registry-service-account
        registry_tag_base: harbor.harbor.svc.cluster.local:80/library
    perform_blob_cleanup: true
    app_usage_events:
      cutoff_age_in_days: 31
    audit_events:
      cutoff_age_in_days: 31
    failed_jobs:
      cutoff_age_in_days: 31
    completed_tasks:
      cutoff_age_in_days: 31
    service_usage_events:
      cutoff_age_in_days: 31
    max_retained_deployments_per_app: 100
    max_retained_builds_per_app: 100
    max_retained_revisions_per_app: 100
    diego_sync:
      frequency_in_seconds: 15
    pending_builds:
      frequency_in_seconds: 300
      expiration_in_seconds: 42
    pending_droplets:
      frequency_in_seconds: 300
      expiration_in_seconds: 42
    deployment_updater:
      update_frequency_in_seconds: 1
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: cloud-controller-ng-yaml
  namespace: cf-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-api-controllers-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-controllers-service-account-kpack-builds-reader
  namespace: cf-workloads-staging
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf:kpack-builds-informer
subjects:
- kind: ServiceAccount
  name: cf-api-controllers-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-controllers-service-account-service-accounts-secrets-fetcher
  namespace: cf-workloads-staging
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf:service-accounts-secrets-fetcher
subjects:
- kind: ServiceAccount
  name: cf-api-controllers-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-controllers-service-account-statefulsets-updater
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf:statefulsets-updater
subjects:
- kind: ServiceAccount
  name: cf-api-controllers-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cf-api-controllers-service-account-periodicsyncs-admin
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf:periodicsyncs-admin
subjects:
- kind: ServiceAccount
  name: cf-api-controllers-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cf-api-controllers-service-account-routes-admin
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf:routes-admin
subjects:
- kind: ServiceAccount
  name: cf-api-controllers-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:kpack-builds-informer
rules:
- apiGroups:
  - kpack.io
  resources:
  - builds
  verbs:
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:service-accounts-secrets-fetcher
rules:
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  - secrets
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:statefulsets-updater
rules:
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - list
  - update
  - patch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  creationTimestamp: null
  name: cf:periodicsyncs-admin
rules:
- apiGroups:
  - apps.cloudfoundry.org
  resources:
  - periodicsyncs
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apps.cloudfoundry.org
  resources:
  - periodicsyncs/status
  verbs:
  - get
  - patch
  - update
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-api-server-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-server-service-account-cf-routes-admin
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf:routes-admin
subjects:
- kind: ServiceAccount
  name: cf-api-server-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-server-service-account-kpack-builds-admin
  namespace: cf-workloads-staging
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf:kpack-builds-admin
subjects:
- kind: ServiceAccount
  name: cf-api-server-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-server-service-account-kpack-builder-admin
  namespace: cf-workloads-staging
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf:kpack-builder-admin
subjects:
- kind: ServiceAccount
  name: cf-api-server-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:routes-admin
rules:
- apiGroups:
  - networking.cloudfoundry.org
  resources:
  - routes
  verbs:
  - create
  - get
  - update
  - delete
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:kpack-builds-admin
rules:
- apiGroups:
  - kpack.io
  resources:
  - images
  verbs:
  - create
  - get
  - update
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:kpack-builder-admin
rules:
- apiGroups:
  - kpack.io
  resources:
  - builders
  - builders/status
  verbs:
  - get
  - create
  - update
  - delete
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-api-worker-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-worker-service-account-cf-routes-admin
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf:routes-admin
subjects:
- kind: ServiceAccount
  name: cf-api-worker-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-worker-service-account-kpack-builds-admin
  namespace: cf-workloads-staging
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf:kpack-builds-admin
subjects:
- kind: ServiceAccount
  name: cf-api-worker-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-worker-service-account-kpack-builder-admin
  namespace: cf-workloads-staging
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf:kpack-builder-admin
subjects:
- kind: ServiceAccount
  name: cf-api-worker-service-account
  namespace: cf-system
---
apiVersion: v1
kind: Namespace
metadata:
  labels:
    cf-for-k8s.cloudfoundry.org/cf-workloads-staging-ns: ""
    istio-injection: enabled
    name: cf-workloads-staging
  name: cf-workloads-staging
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  name: cf-api-clock
  namespace: cf-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-clock
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: cf-api-clock
        app.kubernetes.io/name: cf-api-clock
    spec:
      containers:
      - command:
        - /cnb/process/clock
        env:
        - name: CLOUD_CONTROLLER_NG_CONFIG
          value: /config/cloud_controller_ng.yml
        - name: CLOUD_CONTROLLER_NG_SECRETS
          value: /config/secrets.yml
        image: index.docker.io/cloudfoundry/cloud-controller-ng@sha256:dc63bd5ab08319ae39f2fd4b41229e0c8636c31c327f2d91208f5ab54fa65b6c
        imagePullPolicy: Always
        name: cf-api-clock
        ports:
        - containerPort: 4446
        readinessProbe:
          periodSeconds: 3
          tcpSocket:
            port: 4446
        volumeMounts:
        - mountPath: /config/cloud_controller_ng.yml
          name: cloud-controller-ng-yaml
          subPath: cloud_controller_ng.yml
        - mountPath: /config/secrets.yml
          name: cloud-controller-ng-secrets-yaml
          subPath: secrets.yml
        - mountPath: /etc/cf-api/ccdb_password
          name: cf-api-db-password
        - mountPath: /etc/cf-api/ccdb_encryption_key
          name: cf-api-db-encryption-key
        - mountPath: /etc/cf-api/username-lookup-client-secret
          name: cf-api-username-lookup-client-secret
        - mountPath: /etc/cf-api/blobstore/secret-access-key
          name: cf-api-blobstore-secret-access-key
      volumes:
      - configMap:
          name: cloud-controller-ng-yaml
        name: cloud-controller-ng-yaml
      - configMap:
          name: cloud-controller-ng-secrets-yaml
        name: cloud-controller-ng-secrets-yaml
      - name: cf-api-db-password
        secret:
          secretName: capi-database-password
      - name: cf-api-db-encryption-key
        secret:
          secretName: capi-database-encryption-key-secret
      - name: cf-api-username-lookup-client-secret
        secret:
          secretName: cloud-controller-username-lookup-client-secret
      - name: cf-api-blobstore-secret-access-key
        secret:
          secretName: capi-blobstore-secret-key
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  labels:
    app.kubernetes.io/instance: cf-api-controllers-0
    app.kubernetes.io/name: cf-api-controllers
  name: cf-api-controllers
  namespace: cf-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-controllers
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  template:
    metadata:
      annotations:
        pre.hook.backup.velero.io/command: '["/cnb/process/generate-metadata"]'
        pre.hook.backup.velero.io/container: backup-metadata-generator
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: cf-api-controllers
        app.kubernetes.io/name: cf-api-controllers
    spec:
      containers:
      - env:
        - name: UAA_CLIENT_SECRET_FILE
          value: /config/uaa_client_secret/password
        - name: UAA_ENDPOINT
          value: http://uaa.cf-system.svc.cluster.local:8080
        - name: UAA_CLIENT_NAME
          value: cf_api_controllers
        - name: CF_API_HOST
          value: http://capi.cf-system.svc.cluster.local
        - name: WORKLOADS_NAMESPACE
          value: cf-workloads
        image: index.docker.io/cloudfoundry/cf-api-controllers@sha256:e0bd33b8e91bb59971fc69678a994e3e2b6c1c270b43487f19b6eb54653b7740
        name: manager
        volumeMounts:
        - mountPath: /config/uaa_client_secret
          name: uaa-client-secret
      - command:
        - /cnb/process/wait
        env:
        - name: CF_API_HOST
          value: http://capi.cf-system.svc.cluster.local
        - name: CF_CLIENT
          value: cf_api_backup_metadata_generator
        - name: CF_CLIENT_SECRET
          valueFrom:
            secretKeyRef:
              key: password
              name: cf-api-backup-metadata-generator-client-secret
        image: index.docker.io/cloudfoundry/cf-api-backup-metadata-generator@sha256:9049945ede457502ef6ee89bb99bacb3dea798d48eb6b23216274c03a6355bde
        imagePullPolicy: Always
        name: backup-metadata-generator
      serviceAccountName: cf-api-controllers-service-account
      terminationGracePeriodSeconds: 10
      volumes:
      - name: uaa-client-secret
        secret:
          secretName: cf-api-controllers-client-secret
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf-api-controllers
rules:
- apiGroups:
  - kpack.io
  resources:
  - images
  - builds
  - builds/status
  - images/status
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: controllers-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cf-api-controllers
subjects:
- kind: ServiceAccount
  name: cf-api-controllers-service-account
  namespace: cf-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  name: cf-api-deployment-updater
  namespace: cf-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-deployment-updater
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: cf-api-deployment-updater
        app.kubernetes.io/name: cf-api-deployment-updater
    spec:
      containers:
      - command:
        - /cnb/process/deployment-updater
        env:
        - name: CLOUD_CONTROLLER_NG_CONFIG
          value: /config/cloud_controller_ng.yml
        - name: CLOUD_CONTROLLER_NG_SECRETS
          value: /config/secrets.yml
        image: index.docker.io/cloudfoundry/cloud-controller-ng@sha256:dc63bd5ab08319ae39f2fd4b41229e0c8636c31c327f2d91208f5ab54fa65b6c
        imagePullPolicy: Always
        name: cf-api-deployment-updater
        ports:
        - containerPort: 4445
        readinessProbe:
          periodSeconds: 3
          tcpSocket:
            port: 4445
        volumeMounts:
        - mountPath: /config/cloud_controller_ng.yml
          name: cloud-controller-ng-yaml
          subPath: cloud_controller_ng.yml
        - mountPath: /config/secrets.yml
          name: cloud-controller-ng-secrets-yaml
          subPath: secrets.yml
        - mountPath: /etc/cf-api/ccdb_password
          name: cf-api-db-password
        - mountPath: /etc/cf-api/ccdb_encryption_key
          name: cf-api-db-encryption-key
        - mountPath: /etc/cf-api/username-lookup-client-secret
          name: cf-api-username-lookup-client-secret
        - mountPath: /etc/cf-api/blobstore/secret-access-key
          name: cf-api-blobstore-secret-access-key
      volumes:
      - configMap:
          name: cloud-controller-ng-yaml
        name: cloud-controller-ng-yaml
      - configMap:
          name: cloud-controller-ng-secrets-yaml
        name: cloud-controller-ng-secrets-yaml
      - name: cf-api-db-password
        secret:
          secretName: capi-database-password
      - name: cf-api-db-encryption-key
        secret:
          secretName: capi-database-encryption-key-secret
      - name: cf-api-username-lookup-client-secret
        secret:
          secretName: cloud-controller-username-lookup-client-secret
      - name: cf-api-blobstore-secret-access-key
        secret:
          secretName: capi-blobstore-secret-key
---
apiVersion: v1
data:
  nginx.conf: |
    user cnb cnb;
    error_log stderr info;

    worker_processes auto;

    events {}

    http {
      server_tokens off;

      access_log  /cloud_controller_ng/nginx-access.log;

      tcp_nopush           on;
      tcp_nodelay          on;  #disable nagel's algorithm

      upstream cloud_controller {
        server unix:/data/cloud_controller_ng/cloud_controller.sock;
      }

      server {
          listen 80;

          # Prevent access to internal endpoints
          location ~ /(internal|staging)/ {
            return 403 'Forbidden';
          }

          # TODO: move to a separate file and `include` like capi-release?
          # proxy and log all CC traffic
          location / {
            access_log  /cloud_controller_ng/nginx-access.log;
            proxy_buffering             off;
            proxy_set_header            Host $host;
            proxy_set_header            X-Real_IP $remote_addr;
            proxy_set_header            X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_redirect              off;
            proxy_connect_timeout       10;
            proxy_pass                  http://cloud_controller;
          }
          location @cc_uploads {
            proxy_pass http://cloud_controller;
          }

          location ~ /v3/packages/.*/upload {
            if ($arg_bits_path) { return 422; }

            include public_upload.conf;
            upload_pass_form_field "^resources$";
          }

          location ~ /v2/apps/[^/]+/bits {
            if ($arg_application_path) { return 422; }

            include public_upload.conf;

            upload_pass_args on;
            upload_pass_form_field "^resources$";
          }
      }

      server {
          listen 9023;

          location /internal/ {
            access_log  /cloud_controller_ng/nginx-access.log;
            proxy_buffering             off;
            proxy_set_header            Host $host;
            proxy_set_header            X-Real_IP $remote_addr;
            proxy_set_header            X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_redirect              off;
            proxy_connect_timeout       10;
            proxy_pass http://cloud_controller;
          }
      }
    }
  public_upload.conf: |
    # Pass altered request body to this location
    upload_pass   @cc_uploads;

    # Allow large uploads
    client_max_body_size 1536M;

    # Store files to this directory
    upload_store /tmp/uploads;

    # No limit for output body forwarded to CC
    upload_max_output_body_len 0;

    # Allow uploaded files to be read only by user
    upload_store_access user:r;

    # Set specified fields in request body
    upload_set_form_field "${upload_field_name}_name" $upload_file_name;
    upload_set_form_field "${upload_field_name}_path" $upload_tmp_path;

    #forward the following fields from existing body
    upload_pass_form_field "_method";

    #on any error, delete uploaded files.
    upload_cleanup 400-505;
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: nginx
  namespace: cf-system
---
apiVersion: apps.cloudfoundry.org/v1alpha1
kind: PeriodicSync
metadata:
  name: cf-api-periodic-route-sync
  namespace: cf-system
spec:
  period_seconds: 15
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.2.5
  creationTimestamp: null
  name: periodicsyncs.apps.cloudfoundry.org
spec:
  group: apps.cloudfoundry.org
  names:
    kind: PeriodicSync
    listKind: PeriodicSyncList
    plural: periodicsyncs
    singular: periodicsync
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      description: PeriodicSync is the Schema for the periodicsyncs API
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation
            of an object. Servers should convert recognized schemas to the latest
            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this
            object represents. Servers may infer this from the endpoint the client
            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: PeriodicSyncSpec defines the desired state of PeriodicSync
          properties:
            period_seconds:
              format: int32
              type: integer
          required:
          - period_seconds
          type: object
        status:
          description: PeriodicSyncStatus defines the observed state of PeriodicSync
          properties:
            conditions:
              description: 'INSERT ADDITIONAL STATUS FIELD - define observed state
                of cluster Important: Run "make" to regenerate code after modifying
                this file'
              items:
                description: 'Loosely following this KEP: https://github.com/kubernetes/enhancements/tree/master/keps/sig-api-machinery/1623-standardize-conditions
                  Eventually we can update to use standard Kubernetes types'
                properties:
                  lastTransitionTime:
                    format: date-time
                    type: string
                  message:
                    type: string
                  reason:
                    type: string
                  status:
                    type: string
                  type:
                    type: string
                required:
                - lastTransitionTime
                - message
                - reason
                - status
                - type
                type: object
              type: array
          required:
          - conditions
          type: object
      type: object
  version: v1alpha1
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: v1
data:
  secrets.yml: |
    cloud_controller_username_lookup_client_secret: /etc/cf-api/username-lookup-client-secret/password
    db:
      database:
        password: /etc/cf-api/ccdb_password/password
    db_encryption_key: /etc/cf-api/ccdb_encryption_key/password
    database_encryption:
      keys:
        encryption_key_0: /etc/cf-api/ccdb_encryption_key/password
    resource_pool:
      fog_connection:
        aws_secret_access_key: /etc/cf-api/blobstore/secret-access-key/password
    packages:
      fog_connection:
        aws_secret_access_key: /etc/cf-api/blobstore/secret-access-key/password
    droplets:
      fog_connection:
        aws_secret_access_key: /etc/cf-api/blobstore/secret-access-key/password
    buildpacks:
      fog_connection:
        aws_secret_access_key: /etc/cf-api/blobstore/secret-access-key/password
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: cloud-controller-ng-secrets-yaml
  namespace: cf-system
---
apiVersion: v1
kind: Service
metadata:
  name: capi
  namespace: cf-system
spec:
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: 80
  - name: http-internal
    port: 9023
    protocol: TCP
    targetPort: 9023
  selector:
    app.kubernetes.io/name: cf-api-server
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  name: cf-api-worker
  namespace: cf-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-worker
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: cf-api-worker
        app.kubernetes.io/name: cf-api-worker
    spec:
      containers:
      - command:
        - /cnb/process/api-worker
        env:
        - name: CLOUD_CONTROLLER_NG_CONFIG
          value: /config/cloud_controller_ng.yml
        - name: CLOUD_CONTROLLER_NG_SECRETS
          value: /config/secrets.yml
        - name: INDEX
          value: "1"
        image: index.docker.io/cloudfoundry/cloud-controller-ng@sha256:dc63bd5ab08319ae39f2fd4b41229e0c8636c31c327f2d91208f5ab54fa65b6c
        imagePullPolicy: Always
        name: cf-api-worker
        ports:
        - containerPort: 4444
        readinessProbe:
          periodSeconds: 3
          tcpSocket:
            port: 4444
        volumeMounts:
        - mountPath: /config/cloud_controller_ng.yml
          name: cloud-controller-ng-yaml
          subPath: cloud_controller_ng.yml
        - mountPath: /config/secrets.yml
          name: cloud-controller-ng-secrets-yaml
          subPath: secrets.yml
        - mountPath: /etc/cf-api/ccdb_password
          name: cf-api-db-password
        - mountPath: /etc/cf-api/ccdb_encryption_key
          name: cf-api-db-encryption-key
        - mountPath: /etc/cf-api/username-lookup-client-secret
          name: cf-api-username-lookup-client-secret
        - mountPath: /etc/cf-api/blobstore/secret-access-key
          name: cf-api-blobstore-secret-access-key
      - env:
        - name: REGISTRY_USERNAME
          valueFrom:
            secretKeyRef:
              key: username
              name: cc-package-registry-upload-secret
        - name: REGISTRY_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: cc-package-registry-upload-secret
        image: index.docker.io/cloudfoundry/cf-api-package-registry-buddy@sha256:87a6c4d2ec14d97f8c193a6b8dd2c26926eaa78eb85052997ae55cbb34880ad0
        imagePullPolicy: Always
        name: registry-buddy
      serviceAccountName: cf-api-worker-service-account
      volumes:
      - configMap:
          name: cloud-controller-ng-yaml
        name: cloud-controller-ng-yaml
      - configMap:
          name: cloud-controller-ng-secrets-yaml
        name: cloud-controller-ng-secrets-yaml
      - name: cf-api-db-password
        secret:
          secretName: capi-database-password
      - name: cf-api-db-encryption-key
        secret:
          secretName: capi-database-encryption-key-secret
      - name: cf-api-username-lookup-client-secret
        secret:
          secretName: cloud-controller-username-lookup-client-secret
      - name: cf-api-blobstore-secret-access-key
        secret:
          secretName: capi-blobstore-secret-key
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: cf-api-external-virtual-service
  namespace: cf-system
spec:
  gateways:
  - cf-system/istio-ingressgateway
  hosts:
  - api.vcap.me
  http:
  - route:
    - destination:
        host: capi.cf-system.svc.cluster.local
        port:
          number: 80
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: capi-database-password
  namespace: cf-system
stringData:
  password: g7vfkc8qani1aq8b4hqv
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: capi-blobstore-secret-key
  namespace: cf-system
stringData:
  password: 3kh9ynzp79gcfm8jvfdh
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: cf-api-controllers-client-secret
  namespace: cf-system
stringData:
  password: f4c343xwhmsbc1lvqdnx
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: cf-api-backup-metadata-generator-client-secret
  namespace: cf-system
stringData:
  password: knxl0ak3r1x3puynlg19
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: cloud-controller-username-lookup-client-secret
  namespace: cf-system
stringData:
  password: 5f810ouud86w3lpgtct0
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: capi-database-encryption-key-secret
  namespace: cf-system
stringData:
  password: s1s3614wq8wdqaldc8h4
type: Opaque
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-app-ingress
  namespace: cf-workloads
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: cf-system
      podSelector:
        matchLabels:
          app.kubernetes.io/component: router
    - namespaceSelector:
        matchLabels:
          name: cf-system
      podSelector:
        matchLabels:
          app.kubernetes.io/component: adapter
  podSelector: {}
  policyTypes:
  - Ingress
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default,runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: eirini-app-psp
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: MustRunAsNonRoot
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: eirini-controller
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: MustRunAsNonRoot
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
  - secret
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: eirini
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: MustRunAsNonRoot
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
  - emptyDir
  - projected
  - secret
  - downwardAPI
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: eirini-events
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: RunAsAny
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
  - secret
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: eirini-instance-index-env-injector
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: MustRunAsNonRoot
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: eirini-task-reporter
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: MustRunAsNonRoot
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
  - secret
  - projected
---
apiVersion: v1
automountServiceAccountToken: true
kind: ServiceAccount
metadata:
  name: eirini
  namespace: cf-workloads
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: eirini-controller
  namespace: cf-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: eirini-events
  namespace: cf-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: eirini-instance-index-env-injector
  namespace: cf-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: opi
  namespace: cf-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: eirini-task-reporter
  namespace: cf-system
---
apiVersion: v1
data:
  eirini-controller.yml: |
    opi:
      eirini_uri: "https://eirini-opi.cf-system.svc.cluster.local:8085"
  events.yml: |
    cc_internal_api: http://capi.cf-system.svc.cluster.local:9023
    cc_tls_disabled: false
  instance-index-env-injector.yml: |
    service_name: instance-index-env-injector
    service_namespace: cf-system
    service_port: 8443
  metrics.yml: |
    loggregator_address: "doppler-doppler.cf-system.svc.cluster.local:8082"
  opi.yml: |
    opi:
      app_namespace: cf-workloads
      registry_secret_name: app-registry-credentials
      eirini_address: https://eirini-opi.cf-system.svc.cluster.local:8085
      cc_tls_disabled: false
      disk_limit_mb: 2048
      application_service_account: eirini
      allow_run_image_as_root: false
      unsafe_allow_automount_service_account_token: true
      serve_plaintext: true
      plaintext_port: 8080
  routing.yml: |
    nats_ip: "nats-nats.cf-system.svc.cluster.local"
    nats_port: 4222
  task-reporter.yml: |
    completion_callback_retry_limit: 10
    ttl_seconds: 5
    cc_tls_disabled: false
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: eirini
  namespace: cf-system
---
apiVersion: v1
data:
  instance-index-env-injector.yml: |
    service_name: instance-index-env-injector
    service_namespace: cf-system
    service_port: 8443
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: instance-index-env-injector
  namespace: cf-system
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: lrps.eirini.cloudfoundry.org
spec:
  group: eirini.cloudfoundry.org
  names:
    kind: LRP
    plural: lrps
    shortNames:
    - lrp
    singular: lrp
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            properties:
              GUID:
                type: string
              appGUID:
                type: string
              appName:
                type: string
              appRoutes:
                items:
                  properties:
                    hostname:
                      type: string
                    port:
                      format: in32
                      type: integer
                  type: object
                type: array
              command:
                items:
                  type: string
                type: array
              cpuWeight:
                format: uint8
                type: integer
              diskMB:
                format: int64
                minimum: 1
                type: integer
              env:
                additionalProperties:
                  type: string
                type: object
              health:
                properties:
                  endpoint:
                    type: string
                  port:
                    format: int32
                    type: integer
                  timeoutMs:
                    format: uint8
                    type: integer
                  type:
                    type: string
                type: object
              image:
                type: string
              instances:
                type: integer
              lastUpdated:
                type: string
              memoryMB:
                format: int64
                type: integer
              orgGUID:
                type: string
              orgName:
                type: string
              ports:
                items:
                  format: int32
                  type: integer
                type: array
              privateRegistry:
                properties:
                  password:
                    type: string
                  server:
                    type: string
                  username:
                    type: string
                type: object
              processType:
                type: string
              runsAsRoot:
                type: boolean
              spaceGUID:
                type: string
              spaceName:
                type: string
              userDefinedAnnotations:
                additionalProperties:
                  type: string
                type: object
              version:
                type: string
              volumeMounts:
                items:
                  properties:
                    claimName:
                      type: string
                    mountPath:
                      type: string
                  type: object
                type: array
            required:
            - diskMB
            type: object
          status:
            properties:
              instances:
                items:
                  properties:
                    crashCount:
                      format: uint64
                      type: integer
                    crashTimestamp:
                      format: uint64
                      type: integer
                    exitReason:
                      type: string
                    exitStatus:
                      format: uint32
                      type: integer
                    index:
                      format: uint32
                      type: integer
                    since:
                      format: uint64
                      type: integer
                    state:
                      default: Pending
                      enum:
                      - Pending
                      - Running
                      - Failed
                      type: string
                  type: object
                type: array
              replicas:
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: tasks.eirini.cloudfoundry.org
spec:
  group: eirini.cloudfoundry.org
  names:
    kind: Task
    plural: tasks
    shortNames:
    - t
    singular: task
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            properties:
              appGuid:
                type: string
              appName:
                type: string
              command:
                items:
                  type: string
                type: array
              completionCallback:
                type: string
              cpuWeight:
                format: uint8
                type: integer
              diskMB:
                format: int64
                type: integer
              env:
                additionalProperties:
                  type: string
                type: object
              guid:
                type: string
              image:
                type: string
              memoryMB:
                format: int64
                type: integer
              name:
                type: string
              orgGuid:
                type: string
              orgName:
                type: string
              privateRegistry:
                properties:
                  password:
                    type: string
                  server:
                    type: string
                  username:
                    type: string
                type: object
              spaceGuid:
                type: string
              spaceName:
                type: string
            required:
            - guid
            - image
            - command
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: eirini-controller-resource
rules:
- apiGroups:
  - eirini.cloudfoundry.org
  resources:
  - lrps
  - tasks
  verbs:
  - watch
  - list
  - get
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - list
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: eirini-cluster-role
rules:
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - list
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - list
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - list
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: eirini-events-resource-role
rules:
- apiGroups:
  - ""
  resources:
  - pods
  - events
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: eirini-instance-index-env-injector
rules:
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  verbs:
  - create
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: eirini-task-reporter
rules:
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - list
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: eirini-controller-resource
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: eirini-controller-resource
subjects:
- kind: ServiceAccount
  name: eirini-controller
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: eirini-cluster-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: eirini-cluster-role
subjects:
- kind: ServiceAccount
  name: opi
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: eirini-events-resource-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: eirini-events-resource-role
subjects:
- kind: ServiceAccount
  name: eirini-events
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
  name: eirini-events-nodes-policy
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: eirini-nodes-policy
subjects:
- kind: ServiceAccount
  name: eirini-events
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: eirini-instance-index-env-injector
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: eirini-instance-index-env-injector
subjects:
- kind: ServiceAccount
  name: eirini-instance-index-env-injector
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: eirini-task-reporter
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: eirini-task-reporter
subjects:
- kind: ServiceAccount
  name: eirini-task-reporter
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-app-role
  namespace: cf-workloads
rules:
- apiGroups:
  - policy
  resourceNames:
  - eirini-app-psp
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-controller
  namespace: cf-system
rules:
- apiGroups:
  - policy
  resourceNames:
  - eirini-controller
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-controller-namespaced-role
  namespace: cf-workloads
rules:
- apiGroups:
  - eirini.cloudfoundry.org
  resources:
  - lrps/status
  verbs:
  - update
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - create
  - update
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - create
  - update
- apiGroups:
  - policy
  resources:
  - poddisruptionbudgets
  verbs:
  - create
  - delete
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - delete
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - update
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-psp-role
  namespace: cf-system
rules:
- apiGroups:
  - policy
  resourceNames:
  - eirini
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-namespaced-role
  namespace: cf-workloads
rules:
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - create
  - delete
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - create
  - update
  - delete
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - delete
- apiGroups:
  - policy
  resources:
  - poddisruptionbudgets
  verbs:
  - create
  - delete
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-events-psp
  namespace: cf-system
rules:
- apiGroups:
  - policy
  resourceNames:
  - eirini-events
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-instance-index-env-injector-psp
  namespace: cf-system
rules:
- apiGroups:
  - policy
  resourceNames:
  - eirini-instance-index-env-injector
  resources:
  - podsecuritypolicies
  verbs:
  - use
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - delete
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-task-reporter-psp
  namespace: cf-system
rules:
- apiGroups:
  - policy
  resourceNames:
  - eirini-task-reporter
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-task-reporter-namespaced
  namespace: cf-workloads
rules:
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - list
  - delete
  - patch
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - patch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - list
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-app-rolebinding
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-app-role
subjects:
- kind: ServiceAccount
  name: eirini
  namespace: cf-workloads
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-controller
  namespace: cf-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-controller
subjects:
- kind: ServiceAccount
  name: eirini-controller
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-controller-namespaced-rolebinding
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-controller-namespaced-role
subjects:
- kind: ServiceAccount
  name: eirini-controller
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-psp-rolebinding
  namespace: cf-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-psp-role
subjects:
- kind: ServiceAccount
  name: opi
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-namespaced-rolebinding
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-namespaced-role
subjects:
- kind: ServiceAccount
  name: opi
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-events-psp
  namespace: cf-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-events-psp
subjects:
- kind: ServiceAccount
  name: eirini-events
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-instance-index-env-injector-psp
  namespace: cf-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-instance-index-env-injector-psp
subjects:
- kind: ServiceAccount
  name: eirini-instance-index-env-injector
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-task-reporter-psp
  namespace: cf-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-task-reporter-psp
subjects:
- kind: ServiceAccount
  name: eirini-task-reporter
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-task-reporter-namespaced
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-task-reporter-namespaced
subjects:
- kind: ServiceAccount
  name: eirini-task-reporter
  namespace: cf-system
---
apiVersion: v1
kind: Service
metadata:
  name: instance-index-env-injector
  namespace: cf-system
spec:
  ports:
  - name: https
    port: 8443
    protocol: TCP
    targetPort: 8443
  selector:
    name: instance-index-env-injector
---
apiVersion: v1
kind: Service
metadata:
  name: eirini
  namespace: cf-system
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
  selector:
    name: eirini
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  name: eirini
  namespace: cf-system
spec:
  selector:
    matchLabels:
      name: eirini
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        name: eirini
    spec:
      containers:
      - image: index.docker.io/cloudfoundry/eirini-opi-cf-for-k8s@sha256:1ad949284c2c1f182bbd56bd1eae8202030fdef3afced39a4105a8403ebf0beb
        imagePullPolicy: IfNotPresent
        name: opi
        ports:
        - containerPort: 8080
          name: http
        volumeMounts:
        - mountPath: /etc/eirini/config
          name: config-map-volume
        - mountPath: /etc/cf-api/certs
          name: cc-certs
        - mountPath: /etc/eirini/certs
          name: eirini-certs
      dnsPolicy: ClusterFirst
      securityContext:
        runAsNonRoot: true
      serviceAccountName: opi
      volumes:
      - configMap:
          items:
          - key: opi.yml
            path: opi.yml
          name: eirini
        name: config-map-volume
      - name: cc-certs
        projected:
          sources:
          - secret:
              items:
              - key: tls.crt
                path: tls.crt
              - key: tls.key
                path: tls.key
              name: eirini-internal-tls-certs
          - secret:
              items:
              - key: tls.ca
                path: ca.crt
              name: eirini-internal-tls-certs
      - name: eirini-certs
        projected:
          sources:
          - secret:
              items:
              - key: tls.crt
                path: tls.crt
              - key: tls.key
                path: tls.key
              name: eirini-internal-tls-certs
          - secret:
              items:
              - key: tls.ca
                path: ca.crt
              name: eirini-internal-tls-certs
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  name: eirini-controller
  namespace: cf-system
spec:
  selector:
    matchLabels:
      name: eirini-controller
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        name: eirini-controller
    spec:
      containers:
      - image: index.docker.io/cloudfoundry/eirini-eirini-controller-cf-for-k8s@sha256:8651c21931d6a13a0ec2f74c11402086b1cd30cb2e8c2c6fba400abe493c33a8
        imagePullPolicy: IfNotPresent
        name: eirini-controller
        volumeMounts:
        - mountPath: /etc/eirini/config
          name: config-map-volume
      dnsPolicy: ClusterFirst
      securityContext:
        runAsNonRoot: true
      serviceAccountName: eirini-controller
      volumes:
      - configMap:
          items:
          - key: eirini-controller.yml
            path: eirini-controller.yml
          name: eirini
        name: config-map-volume
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  name: eirini-events
  namespace: cf-system
spec:
  selector:
    matchLabels:
      name: eirini-events
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        name: eirini-events
    spec:
      containers:
      - image: index.docker.io/cloudfoundry/eirini-event-reporter-cf-for-k8s@sha256:1798ea550cfb7b1457698dc9a9766ad5333da05c1e0cd29e748b7db34e648e1b
        imagePullPolicy: IfNotPresent
        name: event-reporter
        volumeMounts:
        - mountPath: /etc/eirini-event-reporter/config
          name: config-map-volume
        - mountPath: /etc/cf-api/certs
          name: cf-secrets
      dnsPolicy: ClusterFirst
      securityContext:
        runAsNonRoot: true
      serviceAccountName: eirini-events
      volumes:
      - configMap:
          items:
          - key: events.yml
            path: events.yml
          name: eirini
        name: config-map-volume
      - name: cf-secrets
        projected:
          sources:
          - secret:
              items:
              - key: tls.crt
                path: tls.crt
              - key: tls.key
                path: tls.key
              name: eirini-internal-tls-certs
          - secret:
              items:
              - key: tls.ca
                path: ca.crt
              name: eirini-internal-tls-certs
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  name: instance-index-env-injector
  namespace: cf-system
spec:
  selector:
    matchLabels:
      name: instance-index-env-injector
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        name: instance-index-env-injector
    spec:
      containers:
      - image: index.docker.io/cloudfoundry/eirini-instance-index-env-injector-cf-for-k8s@sha256:42ab156d08756e46e7ebfa280e55c51305648aa133587d262e19fcd30ea0ae64
        imagePullPolicy: IfNotPresent
        name: instance-index-env-injector
        ports:
        - containerPort: 8443
          name: https
        volumeMounts:
        - mountPath: /etc/eirini/config
          name: config-map-volume
      securityContext:
        runAsNonRoot: true
      serviceAccountName: eirini-instance-index-env-injector
      volumes:
      - configMap:
          items:
          - key: instance-index-env-injector.yml
            path: instance-index-env-injector.yml
          name: eirini
        name: config-map-volume
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  name: eirini-task-reporter
  namespace: cf-system
spec:
  selector:
    matchLabels:
      name: eirini-task-reporter
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        name: eirini-task-reporter
    spec:
      containers:
      - image: index.docker.io/cloudfoundry/eirini-task-reporter-cf-for-k8s@sha256:2715ac192d671788f2512cf116ac9b483402e477af3d9481724cc40134363d61
        imagePullPolicy: IfNotPresent
        name: task-reporter
        volumeMounts:
        - mountPath: /etc/eirini/config
          name: config-map-volume
        - mountPath: /etc/cf-api/certs
          name: cf-secrets
      dnsPolicy: ClusterFirst
      securityContext:
        runAsNonRoot: true
      serviceAccountName: eirini-task-reporter
      volumes:
      - configMap:
          items:
          - key: task-reporter.yml
            path: task-reporter.yml
          name: eirini
        name: config-map-volume
      - name: cf-secrets
        secret:
          items:
          - key: tls.crt
            path: tls.crt
          - key: tls.key
            path: tls.key
          - key: tls.ca
            path: ca.crt
          secretName: eirini-internal-tls-certs
---
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: eirini-x-mutating-hook
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: eirini-internal-tls-certs
  namespace: cf-system
stringData:
  tls.ca: |
    -----BEGIN CERTIFICATE-----
    MIIEUzCCArugAwIBAgIQSDkSeArlTC7/Hz+PBlyZPjANBgkqhkiG9w0BAQsFADAz
    MQwwCgYDVQQGEwNVU0ExFjAUBgNVBAoTDUNsb3VkIEZvdW5kcnkxCzAJBgNVBAMT
    AmNhMB4XDTIwMTIxNDE3MTAzMFoXDTIxMTIxNDE3MTAzMFowMzEMMAoGA1UEBhMD
    VVNBMRYwFAYDVQQKEw1DbG91ZCBGb3VuZHJ5MQswCQYDVQQDEwJjYTCCAaIwDQYJ
    KoZIhvcNAQEBBQADggGPADCCAYoCggGBAM0LeKLTKHlIUmKE0uJUCd4rm+sEkTya
    KPGlOEUKmcs+k9mOxxjWRk5tzZusOVKYAH4L6rSxmWn8IiFPNHNWDWNflcLcP5lI
    swr9eeLVGEAlOpD4M7P5XYo1hJ3eGyG3ahPXpPRrt/dEvFWk3OcJttCsFDojjg/5
    +vFZIj2/bJF3M7xUVGwTDBfVLNSSs7EiHjNKT0m6H+MQBquJT6ZGMvmEufDVkifa
    oZbxhsaW2bRiD38FaXXECFXkoQsqZd3RP1X9uxB5Dacqn/LUN28VCUGl0RKhHC50
    IY/2Lq1h24nbf+MsqiMBnZohJNGGnCdVFsB9QJ6GJgazZFSYEe8oA1V9itBV6sr8
    trw+pqZquqgB2NK4AlbLx/xtj7WrSjUOzIPWR5XRd89Nj7/NNbYiZFi4gIqWvVe4
    X32Q9MIG5PdesxvI7T3ZI8rQx9ktjndXZKYiNLkRVBIQmAvn3DxpQcT3aWZLlBwz
    k1z5WQ1h0uKDBSyQi0O6aextGbD5J61qxwIDAQABo2MwYTAOBgNVHQ8BAf8EBAMC
    AQYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUvDVsa946lM4LsuGKVOiPU64W
    TdgwHwYDVR0jBBgwFoAUvDVsa946lM4LsuGKVOiPU64WTdgwDQYJKoZIhvcNAQEL
    BQADggGBAGSEbjkI/TG3K2vCCoxfd/4obhHErEcBjrRr4AtHs2vXP6HYgI1BTlN9
    uMZA5qXnQvS3Rb4kegiiD8icnl7mbtuC9xrFnUnJxzXPbH2dZnCLP8LFpsfihB1t
    VLhRE1n1AbQI+CjBfWLngPRdst9bP2yPxfAyLSfC+qRlV6cfJuMYTafOVraV//gz
    q0S8JdVSAs5jl5DRJxuhQuai4PUFV1liGPNT1jeOhHEDoBneLZSyf3GENGZ3BHFs
    AW66ZWjCOeATUkA3IznD0tNBh+xOWK/9fwc20EnsbHcYZuGd5QNouQwC24/vRIyz
    /+Ux/j0M5zGOE9FNSQCzhBucAf736LmP+qGmzYD9GBwI+P1zu8C9gBLYiHCe1h/S
    LJk+Iu4UG+R3Gh4cvVNv3mxGe1qtsktonOXunz+kCgbcZa3wlJqqc5VHATE9kbg2
    52yMTRGkK4MRrmfWttTD575lMJs5tJRwbGKgSnOfJV1QMkb3esMcew8p6rfEuyzZ
    4nAXBr3rog==
    -----END CERTIFICATE-----
  tls.crt: |
    -----BEGIN CERTIFICATE-----
    MIIEtzCCAx+gAwIBAgIRAI/lZbAdcy/8Kw+Boi4dvUwwDQYJKoZIhvcNAQELBQAw
    MzEMMAoGA1UEBhMDVVNBMRYwFAYDVQQKEw1DbG91ZCBGb3VuZHJ5MQswCQYDVQQD
    EwJjYTAeFw0yMDEyMTQxNzEwMzNaFw0yMTEyMTQxNzEwMzNaME4xDDAKBgNVBAYT
    A1VTQTEWMBQGA1UEChMNQ2xvdWQgRm91bmRyeTEmMCQGA1UEAwwdKi5jZi1zeXN0
    ZW0uc3ZjLmNsdXN0ZXIubG9jYWwwggGiMA0GCSqGSIb3DQEBAQUAA4IBjwAwggGK
    AoIBgQD19Ift7HeYQKWYxYBDSRKcv0OtS0+PyTidOyTYh1ISCXPB4aCUWZwUqyyX
    e5/RNCapNG6dnetWYviH2KQWVTh5CwiAzo5hy7L6BBmium/Tb/TeM4T4tt+kBdcP
    9AmAbr2suv7JQLYuYY+agx6dULiMVoug1AfN07VunEKzmlHTXkuB9dyY0LNVG/EZ
    qKUV691SC93Sv/h+Xj+J7y1cUeIzBA3KJ4thpz3+Bx0I6wHsi5IUJmeIGmx3BC31
    igkuF2P5pyUS/+nJcGBaamdZW5Z5Sk+rzSDKZiGd6OAkTTsMXD+KAV/oJKY8xwFc
    j1ZoL43Jh7aJBAd3aJa8IEiejMQuSEqWOtwUW//iVSr2FtEzM+s4vaLVF1kpB6DK
    KQUo+tK+FcVlgklRzXybw3LDrD71e7NJ0MxU6xNkF+qXqOib9kXYKpxOvicCiyJ4
    wkY2ywOFg+IfTo79HB/f6WEFbjPBYHB94IoAyUqxYlHOge438y35cv3Xuk1mzjfM
    Y6GSXHMCAwEAAaOBqjCBpzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYB
    BQUHAwIGCCsGAQUFBwMBMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFNTTvOy+1GX4
    nkWGJDzp50IHbURtMB8GA1UdIwQYMBaAFLw1bGveOpTOC7LhilToj1OuFk3YMCgG
    A1UdEQQhMB+CHSouY2Ytc3lzdGVtLnN2Yy5jbHVzdGVyLmxvY2FsMA0GCSqGSIb3
    DQEBCwUAA4IBgQDGmhQxV3eszsCp8Jd1hNApfZWigfer5P1gr24wTCoQdep1BAbQ
    ZTVZScq2jkB4Lc+FfonR4SAvum5nln4AxVpsePO7dDCSKsh7WKNHSv5w1qVlpaMK
    m4Rnb+rtVcJ4jg5Chv4uM5uV2raHQBPrtLkexblOaGLIxURY28dkWKTUABY7l3ZV
    17xVXpRQn/nf890N4f40+GydwXaFQHSj0DSBfqZXbZr83ljUuSbioHzuNp551zUM
    IoYzThu+LaXlf6F70lI3ajqeBtQk5c/Skmui4tI42W/szAcjZ+zeP996rX9jOJ1u
    EXX6eR731+XhY+w1xbNLqmOel2Sdz3Vgc5EN8VLneQy4sAjEcT7+CgI5bylJvlzZ
    OUKICJK6Qi+JGCZ0bWDL3vzFU7KHB6qC6+zJqSe02DeL6iK49svCvESi1FEAbvbR
    tdVnypolHpyU9yXL7F95+xu5XUv7t94Edefm11a7/t8+fi9U+L8uYCGTcdCUOBDZ
    2ou63fZQfXgKBOw=
    -----END CERTIFICATE-----
  tls.key: |
    -----BEGIN RSA PRIVATE KEY-----
    MIIG5AIBAAKCAYEA9fSH7ex3mEClmMWAQ0kSnL9DrUtPj8k4nTsk2IdSEglzweGg
    lFmcFKssl3uf0TQmqTRunZ3rVmL4h9ikFlU4eQsIgM6OYcuy+gQZorpv02/03jOE
    +LbfpAXXD/QJgG69rLr+yUC2LmGPmoMenVC4jFaLoNQHzdO1bpxCs5pR015LgfXc
    mNCzVRvxGailFevdUgvd0r/4fl4/ie8tXFHiMwQNyieLYac9/gcdCOsB7IuSFCZn
    iBpsdwQt9YoJLhdj+aclEv/pyXBgWmpnWVuWeUpPq80gymYhnejgJE07DFw/igFf
    6CSmPMcBXI9WaC+NyYe2iQQHd2iWvCBInozELkhKljrcFFv/4lUq9hbRMzPrOL2i
    1RdZKQegyikFKPrSvhXFZYJJUc18m8Nyw6w+9XuzSdDMVOsTZBfql6jom/ZF2Cqc
    Tr4nAosieMJGNssDhYPiH06O/Rwf3+lhBW4zwWBwfeCKAMlKsWJRzoHuN/Mt+XL9
    17pNZs43zGOhklxzAgMBAAECggGAMU1YJhA9lO54g1wrrtEqAvOwDD/Jbggm6hWd
    +C1//Q+Z/aZNuw8PY3FAmgj060mp6kcRWVT7hLCIIysBEVz52gGlLbS6A86CTO2f
    eegnXFnX2ua24+g8gjONfawsb2tDaCl/wzXOjxONZqqb62rv42nByXZXLiIe/1Ih
    aMEpX9ZKCn4PPy6ulAPq23rbxL4n+jdYutMya5pW4D5qeFQNpK5OWVR98xBEM/SX
    FF+PXixIFvPv0u+BCIZ09AA8gNm9EwRfLgECzfOqjD3ClC9GhV6e20guNCCSDWJS
    KmiyxSU3iOEE41Uymja36O0SWwugEo1vR94ywXrAo/9WCCj1azDNpTMAg3YizddV
    v/muKan4sCFUR0IMo9VDhhzcuzm1l1cXFgpGDHaLXVdx5R+/leAVeQmD2CXXZCzd
    3BQL0a2UGBRb0IhR9F3rPT8xkSj8dQYXJXze5hgEDN+Qqd5TR18CR1RTIbaW2jFB
    NfPYo4rfiZLtHeGHqtkQu4asU0CJAoHBAPbYOk+Tbvuo70f3g/gsJ2r+ihmt6fiB
    jY6PNRWDLr2v3BPDGaRjoS0aXe4Ty104c2xJZlslaKaBmlH78aanaIcUuC5x0ANa
    Fg07NzwHNiGeJmvbIZ7FblxiTNV8GxnrdfEM7ijhDo3+wVG2ASpKV7wT+RJBChUO
    fCnkzFY50OGF4xYp9kWB/8HLIyMmyhSBwugX3XU4sWLHXdirQQ1Scl0IAU3nTr/I
    7h7cHb2ntHDDA5CnjmYt6PgI/KHerzgg3QKBwQD/E9unVt9Wc4poKnVvc9uz1bcn
    AGBXMCAxBDUM0t9Gqh1ijPegw3T3fB0OeIRlP6aMwx63JVOLUvD7DB3rnoz4v/9+
    R7fGv+LvOwyCFgijF2iWDFXSo0vxsT872o5GCygqbBRYaULlZDgk8/07RHbPtuVl
    0uTEdPzU+r3ky3t3xDQc3ICakOR/K0zZqXXuINgMO8ji/KlW7Wp0xE0wnutQdpFm
    Xo35qkbZQn9077BUPoGpxkv7JxGqDg/fwm5PdY8CgcBE7E0jyPvVIu9k/dSIZ/O9
    qULwNqI8tBfNdWkSD6XuavsdPX2cbAEl8dXGUxqWddusobYFvyVAULHBMILh0J6c
    EQn4VekJ9o5vtVgP18eijWEW/oGdrmzJON1RQqziiN9Ophidq3F/7mEWKqaao1Vp
    +32xPh3NkVTT8cGoVc5gGh01JBRShiDegJTYDM2h+jVszrUUNPc6qIYoqHCqgpnS
    JhkPIoXXgQgT78wSF5CHZ7xIGLDnEOyazQ+VNvNfzbUCgcEA0P20Oqcy1eJUxIQF
    NAv5Np8kMRBd3xHPTlnkHV2pEnzPFq/pNA7xBtTp+bFEyLAeBbbYs7YhfUW3q/mB
    ikudtTGaZBzetjkB9oCq/uqOqRHE3yu8JZkl4CEZbjDj4P/DKP7krIuSA+DZH23J
    TYYK0qVHzuW8CjrP7LCEZbFSuA5JpFwGAp40mP0hOjVeKn0+hsd1EIVzOYXMc19i
    3zNWGdcLypQuPyEEa33QcD7yehO8qR2Po3efQXXEC9GCEBiBAoHBAKRHabAdZnNQ
    EUSBV4E8jJHSzjxE2RZ6DWtUu15CAEGK7lLE/8kLHxlqNKkpZ9gcyEsLQXZl8FcZ
    RT+e9qRJACOzKvtcyHruVqbOnIP30KK5Vv4407NsMH/kc3dVLJRLZ1ADs6a4rhWN
    VrK9YM36KtjAWLWZ/uc7EakrIqzBeAuJcwH705C/1xzWhBCDDTUB6IqwoxrYTKAH
    kkIJqkRZ+ABZn7C/nT7U1gjgThgi3NYNkDcnrXBXLXsCTljZY3g+UA==
    -----END RSA PRIVATE KEY-----
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-app-ingress-from-ingressgateway
  namespace: cf-workloads
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
      podSelector:
        matchLabels:
          istio: ingressgateway
  podSelector: {}
  policyTypes:
  - Ingress
---
apiVersion: v1
data:
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwOi8vaGFyYm9yLmhhcmJvci5zdmMuY2x1c3Rlci5sb2NhbDo4MCI6eyJhdXRoIjoiWVdSdGFXNDZZV1J0YVc0PSIsInBhc3N3b3JkIjoiYWRtaW4iLCJ1c2VybmFtZSI6ImFkbWluIn19fQ==
kind: Secret
metadata:
  name: app-registry-credentials
  namespace: cf-workloads
type: kubernetes.io/dockerconfigjson
---
apiVersion: networking.istio.io/v1alpha3
kind: Sidecar
metadata:
  name: default
  namespace: cf-workloads
spec:
  egress:
  - hosts:
    - cf-system/*
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-istio-system-ingress
  namespace: istio-system
spec:
  podSelector: {}
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-ingress-within-istio-system
  namespace: istio-system
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
  podSelector: {}
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: istiod-network-policy
  namespace: istio-system
spec:
  ingress:
  - ports:
    - port: 15010
    - port: 15012
    - port: 15017
    - port: 15014
    - port: 15053
  podSelector:
    matchLabels:
      app: istiod
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: ingressgateway-network-policy
  namespace: istio-system
spec:
  ingress:
  - ports:
    - port: 80
    - port: 443
    - port: 8080
    - port: 8443
  podSelector:
    matchLabels:
      app: istio-ingressgateway
  policyTypes:
  - Ingress
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-ingressgateway: upsert before upserting istio.io/ingressgateway
    kapp.k14s.io/versioned: ""
  name: cf-system-cert
  namespace: istio-system
stringData:
  tls.crt: |
    -----BEGIN CERTIFICATE-----
    MIIEpTCCAw2gAwIBAgIRAMOLYgtW5tXaRBKdVptV5xswDQYJKoZIhvcNAQELBQAw
    MzEMMAoGA1UEBhMDVVNBMRYwFAYDVQQKEw1DbG91ZCBGb3VuZHJ5MQswCQYDVQQD
    EwJjYTAeFw0yMDEyMTQxNzEwMzFaFw0yMTEyMTQxNzEwMzFaMDoxDDAKBgNVBAYT
    A1VTQTEWMBQGA1UEChMNQ2xvdWQgRm91bmRyeTESMBAGA1UEAwwJKi52Y2FwLm1l
    MIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEA27ihsFHHCCfWXkmtV4Wa
    j1RaW97jZT5zsfMVeHHCGHHnCvM4ynaGyuyvU8JkOk6nZv61xfyuyZni2KdRMphZ
    iYfM5+i5LnkI0k2T+rsfceHpqYwfAwts9bXJ3sllfPj5NWTXMrMEBnqZ5VAtuGoK
    Wf4GvNePSXOftnGHlbrHzIlhOqx4Tn5xIhWo6AX+yRT2z6MGbl4OecpPTFVFnWDx
    /QgTcCKKVWWtLrJrHJiW4A0l911Ncc5kOzqxvHzv9E5PKZUB9SQ2CAHp1aY1ydFl
    KeZkV+h5BHTgoe1Ci8qFb9LPHbYLOZbyUbZDNMxgCgFiG5VorO1PGKggUjb22dWm
    5h+35Akzv5T4thpnxa7n930VwTwZb9FV5dTp/tNBcfxA8xyuwjQyRGoqW3Lyb0JE
    tjZRcc5Fh7QhcUDDVBa4xW7sWelUfGY5XmHD90XYtc6OeOxQ000vlJoZ0+XBtmRT
    42JhpCUmFcR37fa/SIIqPFX3lAyNjKD6XTswDxXJmYGHAgMBAAGjgawwgakwDgYD
    VR0PAQH/BAQDAgWgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMAwGA1UdEwEB/wQCMAAw
    HQYDVR0OBBYEFCbt0TXW7MhZ3q19C4q/pd2rz9egMB8GA1UdIwQYMBaAFLw1bGve
    OpTOC7LhilToj1OuFk3YMDQGA1UdEQQtMCuCDyoubG9naW4udmNhcC5tZYIJKi52
    Y2FwLm1lgg0qLnVhYS52Y2FwLm1lMA0GCSqGSIb3DQEBCwUAA4IBgQB9sq5wpfGR
    h9oXeiMfF3xXbpATVQ+SCZ6J5q5ai4b5zzSb650s8ne5AOkslTar2T2sOL6TsJCE
    zH2oeXGu6WI+t7cW7l+ej+H9CPwqamU3O4DhcGGy+CrUyglsT76T0JyxsdQrz1Ut
    HLy99+Qh6X3qPm24mYFZri5VWwijQ/lXO0TfSIP3ysM5KlVfeH1touXd/DGWmFCd
    hPvECSYVYA0lnCjEcXmbWw9CPT/7kudSUvQkleb6OsReiZChFs+/vHsUZ1+4514Z
    qISTzsMXTWvt+iCvN2j+kRskp99g55j/v7ixnRE6v+UAyDh2bvAtjJOn5nioa/1o
    A4L1vP9hq4lLWgHehAxBCOV1Axfn/QTG37RYelucHbFtrB2GT/xy//ujZc4J/6vV
    mvMtIyXV5uDW0CNW9r0zDJxvHd77htv0R8OF7G64hKGH4wfRaZjbqXKkAuDjL20C
    InuarzbZLFkraj3Fywtsjg6oqPzG6FWz1Xf7RO5quufW5E3PhVf9hv0=
    -----END CERTIFICATE-----
  tls.key: |
    -----BEGIN RSA PRIVATE KEY-----
    MIIG5QIBAAKCAYEA27ihsFHHCCfWXkmtV4Waj1RaW97jZT5zsfMVeHHCGHHnCvM4
    ynaGyuyvU8JkOk6nZv61xfyuyZni2KdRMphZiYfM5+i5LnkI0k2T+rsfceHpqYwf
    Awts9bXJ3sllfPj5NWTXMrMEBnqZ5VAtuGoKWf4GvNePSXOftnGHlbrHzIlhOqx4
    Tn5xIhWo6AX+yRT2z6MGbl4OecpPTFVFnWDx/QgTcCKKVWWtLrJrHJiW4A0l911N
    cc5kOzqxvHzv9E5PKZUB9SQ2CAHp1aY1ydFlKeZkV+h5BHTgoe1Ci8qFb9LPHbYL
    OZbyUbZDNMxgCgFiG5VorO1PGKggUjb22dWm5h+35Akzv5T4thpnxa7n930VwTwZ
    b9FV5dTp/tNBcfxA8xyuwjQyRGoqW3Lyb0JEtjZRcc5Fh7QhcUDDVBa4xW7sWelU
    fGY5XmHD90XYtc6OeOxQ000vlJoZ0+XBtmRT42JhpCUmFcR37fa/SIIqPFX3lAyN
    jKD6XTswDxXJmYGHAgMBAAECggGBAKjC4iXMWgQQnR1kl6hurO1Dy/dedegQlMps
    O+R786nU6rHFaKxRZ2y7aFr8JwGF4hxArRs53oJoGQ1xTfN/gt4YmTDS1lE0k6r7
    /RoK2bcd3tvkDPnIr9L14uykYbggf0EciBGf4Aqd5lB0SfmoMPU4ILKxGpQ/I7/8
    6Tf+83FNX4myaOFZSsn0OvyjhjOqT3vh6pGg2pt+4XNu135utM81gcCSNxAqfV8t
    mQmoxdGnJ68cUdyEuwWnKlbs210ZO1XszRbr7w6sZhzrUeuqUmZcRHpzmzlY/quV
    Kx5u+Az/k1rAGmdS+t7pA+MM+HRyxFcMrVTffEguUXuA1OrPR8WNULGMUBzNf2w1
    0hmNjDUA/KViyZjPhwkiStWcExzs9OOWkh3M1//RasX6eZJ8Cp54gsVxmNlkMweq
    289y02pIxpBsUNoCoUl9GFvdTIKNTtxcNkazxeyMoOSO1jbEk1ZuwXXF3cJTK2Fd
    sAAx4KcS/Ua81foOSpLLOhvuEoLEIQKBwQDzwB71GpmYiU2nhvA3Gum89kSlMe3G
    wNekr0x6Hua2hcQqIbcQJbDxStgIohJGGGoyBYwKBCrrTQzXd3/LFj00jptouF2l
    fRHucGjaQGBzJnWT8bbsmU4i5kdLhI3RYBvtSD0nvISDoVt9S8mMIn8jjJPyRtdv
    OVuqGTQ1CrIEkjK24Ku7qbwSIxpx2IbWU2jeMZ2zfNW1SOJaGRJ5m6GqzeVcMEh2
    0TPsvZtlXY9x3+WsHETBNfarxBJGS9CoqDcCgcEA5sNfFT/+KNqC5b1tqfaolVH/
    1mThCEWEZslu/ohJe3H5N0Xr4IGQdc4+1GwIvqutJei3uK20JT7+k/ybyymcJmFe
    zig1TlnkhfsPhH5SXkvTTUHYkcnwwq0ce86yCRnQUofHKzUVC7m51MtCBrDGfaXv
    VAtSWmKc/brf79pzkm8FlLfXMF7azaYm/xBhpQGfGAVRu65LO+ZndBrburZtf2NX
    ujC6HyBGmdHoiEwfGewffxc+EHSROnsS0uSzY6kxAoHBANhRKugYmDEPwROopCwz
    PTYOU/NK8RrO71FepP9HxzY6VlGRpDW3TWWGJ1zaAF+msS/9Tj9hXXl+4qOhkI76
    CI1I9dCkta705OH3boYqVa47dmM6Qz2L/BTqymDRnU4v/fjBgExweCWdIGV8ybwM
    rUouKun7RpuViqzVO0jLWhrGaC12C9I6mwZ5krFwGJHCajGuVKcCZWJB8WdGEuhL
    XtkHasI6s0SG+o7h4jO+KVxE+D2axMW3D1d2ZUVvaRkUVwKBwQCgLOho5ZxTWykU
    sqHWIeHuk5ZTiH4ysZ4vgo5Kmur2hqwH077gfM57FwfBhqOjRaLP93Le+6NZXxpy
    Ohshr+Y1Nc0KqBooInlfDl89BjnCPjuTGqtqtpMpbeOhhF1Lt+FEB/8VXKkZFHeK
    3vMblcSRHoa6/YjSODTkYbxizmz+LZXgHqN9bbnOmQ/kZ8h/Mlrt33NWJKsQDuOs
    UaBHP61NiPUxxfTK+ipHRs5zHPNRmPZbzxRDc8YCo77zJ8/k02ECgcA2n8zrVtQ8
    kbdxEhRmFd6zc05QwtWhI8yDle/x8g+eiDlF0Q+UJ7J8DwOSnzL09bmqKNgs057e
    pulZk4VEjlmZibIcU2NZa3+vFz3JMTwVzALLjQLKFjv9Y0xZ7EUWVuZA8g4jegDV
    We6yLvBT5pf2ZmUDBR0W9ThGrT03MZpoCXhoCAqyPDqZZHWtHRKCwZr6GddcoBlO
    ohK7Now6fQqrbZJJBorTm1tH8+Pu735CSV3T5deI9Saw1q3xpEv8spQ=
    -----END RSA PRIVATE KEY-----
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-ingressgateway: upsert before upserting istio.io/ingressgateway
    kapp.k14s.io/versioned: ""
  name: cf-workloads-cert
  namespace: istio-system
stringData:
  tls.crt: |
    -----BEGIN CERTIFICATE-----
    MIIEjzCCAvegAwIBAgIRAIlcHEf7ulpwG22pUrGe0KkwDQYJKoZIhvcNAQELBQAw
    MzEMMAoGA1UEBhMDVVNBMRYwFAYDVQQKEw1DbG91ZCBGb3VuZHJ5MQswCQYDVQQD
    EwJjYTAeFw0yMDEyMTQxNzEwMzJaFw0yMTEyMTQxNzEwMzJaMD8xDDAKBgNVBAYT
    A1VTQTEWMBQGA1UEChMNQ2xvdWQgRm91bmRyeTEXMBUGA1UEAwwOKi5hcHBzLnZj
    YXAubWUwggGiMA0GCSqGSIb3DQEBAQUAA4IBjwAwggGKAoIBgQCw/V+aLtwEK8Xc
    tVWxCd8Q+GPiotIElFje97jExMD77udMQGjoi7NPsDA1ciEnRUPE+11lfJXctG+s
    c5RkHD1Ci48RfyVihPkgGt9nPXQe00f0cmmJ1UwWiy2D90Q67eB38UqDSUuvSxlL
    v05UIB9ntTCUglmrA5z3wzNi/Dod+O+eGAV7vePDkThfRV4rJNOB3WsjS12nkUqr
    kCuaAsMlv8jodQ2jF6lxDgsvKvPXBhkVqwUlmdb3tKo9SS8bWNChB7BE9WfhVhNd
    recQHY2puPQvjmIsAkO4r1+/2BRZc9DLRpNWQ4rlyxhdmUMy//1zM7M6DUYhSyYX
    MoDBfzU87eyQU2FQiPPH8tGvanUH7XKGpellpUshpaz6im5TCPjKIg2InMLQo5K4
    4dbYruVyvUdUo5ROdaEJWCLnWd/bduaK1AYNu3GP2DTjgeP1aMQqvD79Ln0ZyPYj
    2XPYKg3EJhGaF3vswGvoHcru85jrJzZJEkh1VN4zZEr8FbnRQGECAwEAAaOBkTCB
    jjAOBgNVHQ8BAf8EBAMCBaAwEwYDVR0lBAwwCgYIKwYBBQUHAwEwDAYDVR0TAQH/
    BAIwADAdBgNVHQ4EFgQUeZkb/53wbrADIKffrQyRnUJz1XMwHwYDVR0jBBgwFoAU
    vDVsa946lM4LsuGKVOiPU64WTdgwGQYDVR0RBBIwEIIOKi5hcHBzLnZjYXAubWUw
    DQYJKoZIhvcNAQELBQADggGBAIGaf+LJM2xtjSOUdMNdKypUH5aqt2v3xMlbepfN
    BeopRMj4BQHzYo0OTapGdi/4QRxC1ga9BS1FZMIHD057h3z/tttEZINo1qWDGadi
    uKTh47t4s8gzgM4KNKyx/cuxJ0JSh4lhSWply7ntJJ8Ct3Pt1Q8pEiLoriSUBVMh
    LQfKZioo07TOQqGcSKGo0LB0ZV3NDY0eq4T19pf2nucKQ6yempnAHrFgw4z7Ar07
    RfDzPgECSl7Tn7K/RsZulsFBmgF4dvZfQ6rAbZXncn7TzDwqxYHMJYV4/pB0ZPm/
    AE60a/sxIEbcqcwJELCmjdGwb2z4uhhn2Okyc89Cg8H3E5osB9A2cHsiYS/4Y0pv
    F2ivMVr/IRKlEX0w3X2tSd1bM6ljASyYdiLwUfNwK0bHpTcgoEufFl0X+4dV9evD
    k2Lgc3Xp4lhNxVe6ULzaqaq4B++yxAJgmLOBN7tiERU/uNUKdKHHGspXSKr+eBIR
    2BC+0UrZlrW9aP0xmFcXMxOszw==
    -----END CERTIFICATE-----
  tls.key: |
    -----BEGIN RSA PRIVATE KEY-----
    MIIG5QIBAAKCAYEAsP1fmi7cBCvF3LVVsQnfEPhj4qLSBJRY3ve4xMTA++7nTEBo
    6IuzT7AwNXIhJ0VDxPtdZXyV3LRvrHOUZBw9QouPEX8lYoT5IBrfZz10HtNH9HJp
    idVMFostg/dEOu3gd/FKg0lLr0sZS79OVCAfZ7UwlIJZqwOc98MzYvw6HfjvnhgF
    e73jw5E4X0VeKyTTgd1rI0tdp5FKq5ArmgLDJb/I6HUNoxepcQ4LLyrz1wYZFasF
    JZnW97SqPUkvG1jQoQewRPVn4VYTXa3nEB2Nqbj0L45iLAJDuK9fv9gUWXPQy0aT
    VkOK5csYXZlDMv/9czOzOg1GIUsmFzKAwX81PO3skFNhUIjzx/LRr2p1B+1yhqXp
    ZaVLIaWs+opuUwj4yiINiJzC0KOSuOHW2K7lcr1HVKOUTnWhCVgi51nf23bmitQG
    Dbtxj9g044Hj9WjEKrw+/S59Gcj2I9lz2CoNxCYRmhd77MBr6B3K7vOY6yc2SRJI
    dVTeM2RK/BW50UBhAgMBAAECggGBAKun8jMNw6Hf+nUHAmdEVa6V2fqTQ/HhFxiZ
    VgCxeyJdIMOZrKXt6CkfjoIngPQff4zq5jhpzsdR0QWGy6MUqG2EAWxMzqtwoFZ8
    +bOdrKPA8waoeKeP0c4Dik91YB1vXMe3pDcUvWzz/0Kx9nws84iX+NfwXJs6U+EQ
    1yPn0U4EhBHm5lqPXvnsPKpaEuzxOJm5cBG5JMpCZhNjLoaeqzpPecHK1UEaz+Gw
    ZzSGChy/81BKoCFJxW5VMM9jzWZOidy7/SxuiZZZS4Rz96NqanE3ZqAMI9DGmhPo
    590SznHZntTcUHSsgXH97ll0tI7jameebdG6NLaZiRoTXlXv4oNRMSG69tVqjNcC
    8P7AeIedJrooLBzLm6kBpzdao0ombHPik+3xICiIYJtq23wiErNGcskczFUet79Z
    QAJI0j2pnLrB4ulX+K7lx+ropEdb1xeDGQPgFfFjDPSnfoVAEPM7C1uc79zYXlsf
    NjSnQUoYqZi/wEcvCJ8ZXhSdk+4N4QKBwQDaXvnZ3SFBga4xrDjz/aF/mBg6/cTd
    l2ERZFqPQ9LmZZsvmXwei5NcwPOMwElKp92uo7I6eizs1+c0LF2RpPJAHVRDpRmH
    LauTmkA6IlHPnAJDIf/iE6UBk+Ek249+lwM2s920zNmwc1NRscI/z/fQJ6eIlBNt
    yJUDITgN3dLPBG24wfeQwX9QVVf4FMCYzQDbFSKlY3L06iA4vlkU1EPcER1XioEA
    1eIe5dssVgaCbL/nEEzFhTw9VS9iTNpFtl0CgcEAz3zw/lf96kmne5PCbWilED1k
    HxW3y8L9KS2SVv/XhZkgGVbtgRSyc9leX0Yp1EVd1iKshgnq+SfHQv2pa5zY+iyG
    ukMpO18PEju/NmXGeREHQodoMWpzam/tc+cJRvdPOmzXpVRu5gtd4F8N6EvQael6
    U5DKW1nwUHqRIieTId/Xx+9IsIieW8ZWZW9hd3742y7UVZDC8matCCBuq5gjUkGq
    cKxVNExxhqklYjzzbXsojnuUR4IL5MPDcgrDEEnVAoHBANfDE/eRqDRDX8wwsK1T
    o2ig7QAMkaGo2v4GO/xmNVH0ftsPOjYsDtSMyZf+vewH5N+TWpyw7watZQKF+4XW
    ho2W7RVRYeHQ3EChHmjSVCdfrFSMmXnVkyn15XU3g5a+uywnmB32cfkIWgDUNGw8
    nkyLgdtPA8trbuCCyBHbZVmqtIbjECt1JMhJKvwx9QKFPB07ytnDY2helKu8V+Re
    vxYHywgeD8y1iBCjaGVsMk5YCVzTHCflt1mae5ETAm/y+QKBwQChG0towlwHOg+Q
    tceG+nUIahK+zDc9QPcfrSHu6ZKoSqCQ7F1YGAEEUSik468BAqd86Ml6/mJz+f4P
    tzSAuXYEsuQd5p4yWnoyVy/+hgIY6S7w6oDttdFOOQBwOVmLv+XF4NOErU260+Kd
    oFEFKTD3u/Fex5NIYUpmwvTER2RILi23McYIRNxpOFTHSDeu+Gk0j2UR12h3nWAH
    al9kX6o1aYV1HWq/RAf2XooHgHonbTSthak56PFhPNwaRd72W80CgcBxGRDxTg1e
    iPwM1saFd/bvvNHVXbJ4S5AI1W3WlW7XIaL3OD0j6Yc1wLEfYJrdEWj78uaVMps9
    gDp+PTJLUUD+t6DN4XIwfeq+chiCZU1TnTaHPBFMnxoJANJFVGGUXn3R5U9pmCqZ
    BR4DahGljbo0eJheLsWgbIkuGKwR5pM28Hjgj0v0h5OiDfSjXVqtAA7rjOiCwCME
    XAGg/vSpknY0HCbvTSd0hBiwpv+L67SQbQLXDGe+G7gVGzwErtc23f0=
    -----END RSA PRIVATE KEY-----
---
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: istio-ingressgateway
  namespace: cf-system
spec:
  selector:
    istio: ingressgateway
  servers:
  - hosts:
    - '*'
    port:
      name: http
      number: 80
      protocol: HTTP
    tls:
      httpsRedirect: true
  - hosts:
    - '*/*.vcap.me'
    port:
      name: https-system
      number: 443
      protocol: HTTPS
    tls:
      credentialName: cf-system-cert
      mode: SIMPLE
  - hosts:
    - cf-workloads/*.apps.vcap.me
    port:
      name: https-workloads
      number: 443
      protocol: HTTPS
    tls:
      credentialName: cf-workloads-cert
      mode: SIMPLE
---
apiVersion: v1
data:
  fluent-bit.conf: |-
    [SERVICE]
        Flush          1
        Daemon         Off
        Log_Level      info
        Parsers_File   parsers.conf
    [INPUT]
        Name    tail
        Tag     istio-ingressgateway
        Path    /var/log/containers/istio-ingressgateway*istio-proxy*.log
        Parser  json
        Refresh_Interval 1
    [FILTER]
        Name parser
        Match istio-ingressgateway
        Parser json
        Key_Name log
    [FILTER]
        Name lua
        Match istio-ingressgateway
        script transform_record.lua
        call transform_record
    [OUTPUT]
        Name forward
        Match istio-ingressgateway
        Host fluentd-forwarder-ingress.cf-system
        Port 24224
  parsers.conf: |-
    [PARSER]
        Name   json
        Format json
        Time_Key time
  transform_record.lua: |-
    function transform_record(tag, timestamp, record)
      new_record = {}
      new_record["app_id"] = record["app_id"]
      new_record["instance_id"] = "0"
      new_record["log"] = record
      new_record["source_type"] = "RTR"
      return 1, timestamp, new_record
    end
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: ingressgateway-fluent-bit-forwarder-config
  namespace: istio-system
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    istio: mixer-adapter
    package: adapter
    release: istio
  name: adapters.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: adapter
    plural: adapters
    singular: adapter
  scope: Namespaced
  versions:
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            type: object
            x-kubernetes-preserve-unknown-fields: true
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    istio: core
    package: istio.io.mixer
    release: istio
  name: attributemanifests.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: attributemanifest
    listKind: attributemanifestList
    plural: attributemanifests
    singular: attributemanifest
  scope: Namespaced
  versions:
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Describes the rules used to configure Mixer''s policy and
              telemetry features. See more details at: https://istio.io/docs/reference/config/policy-and-telemetry/istio.policy.v1beta1.html'
            properties:
              attributes:
                additionalProperties:
                  properties:
                    description:
                      description: A human-readable description of the attribute's
                        purpose.
                      format: string
                      type: string
                    valueType:
                      description: The type of data carried by this attribute.
                      enum:
                      - VALUE_TYPE_UNSPECIFIED
                      - STRING
                      - INT64
                      - DOUBLE
                      - BOOL
                      - TIMESTAMP
                      - IP_ADDRESS
                      - EMAIL_ADDRESS
                      - URI
                      - DNS_NAME
                      - DURATION
                      - STRING_MAP
                      type: string
                  type: object
                description: The set of attributes this Istio component will be responsible
                  for producing at runtime.
                type: object
              name:
                description: Name of the component producing these attributes.
                format: string
                type: string
              revision:
                description: The revision of this document.
                format: string
                type: string
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    istio: security
    release: istio
  name: authorizationpolicies.security.istio.io
spec:
  group: security.istio.io
  names:
    categories:
    - istio-io
    - security-istio-io
    kind: AuthorizationPolicy
    listKind: AuthorizationPolicyList
    plural: authorizationpolicies
    singular: authorizationpolicy
  scope: Namespaced
  versions:
  - name: v1beta1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration for access control on workloads. See more
              details at: https://istio.io/docs/reference/config/security/authorization-policy.html'
            properties:
              action:
                description: Optional.
                enum:
                - ALLOW
                - DENY
                - AUDIT
                type: string
              rules:
                description: Optional.
                items:
                  properties:
                    from:
                      description: Optional.
                      items:
                        properties:
                          source:
                            description: Source specifies the source of a request.
                            properties:
                              ipBlocks:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              namespaces:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              notIpBlocks:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              notNamespaces:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              notPrincipals:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              notRequestPrincipals:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              principals:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              requestPrincipals:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                            type: object
                        type: object
                      type: array
                    to:
                      description: Optional.
                      items:
                        properties:
                          operation:
                            description: Operation specifies the operation of a request.
                            properties:
                              hosts:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              methods:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              notHosts:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              notMethods:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              notPaths:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              notPorts:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              paths:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                              ports:
                                description: Optional.
                                items:
                                  format: string
                                  type: string
                                type: array
                            type: object
                        type: object
                      type: array
                    when:
                      description: Optional.
                      items:
                        properties:
                          key:
                            description: The name of an Istio attribute.
                            format: string
                            type: string
                          notValues:
                            description: Optional.
                            items:
                              format: string
                              type: string
                            type: array
                          values:
                            description: Optional.
                            items:
                              format: string
                              type: string
                            type: array
                        type: object
                      type: array
                  type: object
                type: array
              selector:
                description: Optional.
                properties:
                  matchLabels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                type: object
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    release: istio
  name: destinationrules.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: DestinationRule
    listKind: DestinationRuleList
    plural: destinationrules
    shortNames:
    - dr
    singular: destinationrule
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The name of a service from the service registry
      jsonPath: .spec.host
      name: Host
      type: string
    - description: 'CreationTimestamp is a timestamp representing the server time
        when this object was created. It is not guaranteed to be set in happens-before
        order across separate operations. Clients may not set this value. It is represented
        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha3
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting load balancing, outlier detection,
              etc. See more details at: https://istio.io/docs/reference/config/networking/destination-rule.html'
            properties:
              exportTo:
                description: A list of namespaces to which this destination rule is
                  exported.
                items:
                  format: string
                  type: string
                type: array
              host:
                description: The name of a service from the service registry.
                format: string
                type: string
              subsets:
                items:
                  properties:
                    labels:
                      additionalProperties:
                        format: string
                        type: string
                      type: object
                    name:
                      description: Name of the subset.
                      format: string
                      type: string
                    trafficPolicy:
                      description: Traffic policies that apply to this subset.
                      properties:
                        connectionPool:
                          properties:
                            http:
                              description: HTTP connection pool settings.
                              properties:
                                h2UpgradePolicy:
                                  description: Specify if http1.1 connection should
                                    be upgraded to http2 for the associated destination.
                                  enum:
                                  - DEFAULT
                                  - DO_NOT_UPGRADE
                                  - UPGRADE
                                  type: string
                                http1MaxPendingRequests:
                                  description: Maximum number of pending HTTP requests
                                    to a destination.
                                  format: int32
                                  type: integer
                                http2MaxRequests:
                                  description: Maximum number of requests to a backend.
                                  format: int32
                                  type: integer
                                idleTimeout:
                                  description: The idle timeout for upstream connection
                                    pool connections.
                                  type: string
                                maxRequestsPerConnection:
                                  description: Maximum number of requests per connection
                                    to a backend.
                                  format: int32
                                  type: integer
                                maxRetries:
                                  format: int32
                                  type: integer
                              type: object
                            tcp:
                              description: Settings common to both HTTP and TCP upstream
                                connections.
                              properties:
                                connectTimeout:
                                  description: TCP connection timeout.
                                  type: string
                                maxConnections:
                                  description: Maximum number of HTTP1 /TCP connections
                                    to a destination host.
                                  format: int32
                                  type: integer
                                tcpKeepalive:
                                  description: If set then set SO_KEEPALIVE on the
                                    socket to enable TCP Keepalives.
                                  properties:
                                    interval:
                                      description: The time duration between keep-alive
                                        probes.
                                      type: string
                                    probes:
                                      type: integer
                                    time:
                                      type: string
                                  type: object
                              type: object
                          type: object
                        loadBalancer:
                          description: Settings controlling the load balancer algorithms.
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - simple
                              - properties:
                                  consistentHash:
                                    oneOf:
                                    - not:
                                        anyOf:
                                        - required:
                                          - httpHeaderName
                                        - required:
                                          - httpCookie
                                        - required:
                                          - useSourceIp
                                        - required:
                                          - httpQueryParameterName
                                    - required:
                                      - httpHeaderName
                                    - required:
                                      - httpCookie
                                    - required:
                                      - useSourceIp
                                    - required:
                                      - httpQueryParameterName
                                required:
                                - consistentHash
                          - required:
                            - simple
                          - properties:
                              consistentHash:
                                oneOf:
                                - not:
                                    anyOf:
                                    - required:
                                      - httpHeaderName
                                    - required:
                                      - httpCookie
                                    - required:
                                      - useSourceIp
                                    - required:
                                      - httpQueryParameterName
                                - required:
                                  - httpHeaderName
                                - required:
                                  - httpCookie
                                - required:
                                  - useSourceIp
                                - required:
                                  - httpQueryParameterName
                            required:
                            - consistentHash
                          properties:
                            consistentHash:
                              properties:
                                httpCookie:
                                  description: Hash based on HTTP cookie.
                                  properties:
                                    name:
                                      description: Name of the cookie.
                                      format: string
                                      type: string
                                    path:
                                      description: Path to set for the cookie.
                                      format: string
                                      type: string
                                    ttl:
                                      description: Lifetime of the cookie.
                                      type: string
                                  type: object
                                httpHeaderName:
                                  description: Hash based on a specific HTTP header.
                                  format: string
                                  type: string
                                httpQueryParameterName:
                                  description: Hash based on a specific HTTP query
                                    parameter.
                                  format: string
                                  type: string
                                minimumRingSize:
                                  type: integer
                                useSourceIp:
                                  description: Hash based on the source IP address.
                                  type: boolean
                              type: object
                            localityLbSetting:
                              properties:
                                distribute:
                                  description: 'Optional: only one of distribute or
                                    failover can be set.'
                                  items:
                                    properties:
                                      from:
                                        description: Originating locality, '/' separated,
                                          e.g.
                                        format: string
                                        type: string
                                      to:
                                        additionalProperties:
                                          type: integer
                                        description: Map of upstream localities to
                                          traffic distribution weights.
                                        type: object
                                    type: object
                                  type: array
                                enabled:
                                  description: enable locality load balancing, this
                                    is DestinationRule-level and will override mesh
                                    wide settings in entirety.
                                  nullable: true
                                  type: boolean
                                failover:
                                  description: 'Optional: only failover or distribute
                                    can be set.'
                                  items:
                                    properties:
                                      from:
                                        description: Originating region.
                                        format: string
                                        type: string
                                      to:
                                        format: string
                                        type: string
                                    type: object
                                  type: array
                              type: object
                            simple:
                              enum:
                              - ROUND_ROBIN
                              - LEAST_CONN
                              - RANDOM
                              - PASSTHROUGH
                              type: string
                          type: object
                        outlierDetection:
                          properties:
                            baseEjectionTime:
                              description: Minimum ejection duration.
                              type: string
                            consecutive5xxErrors:
                              description: Number of 5xx errors before a host is ejected
                                from the connection pool.
                              nullable: true
                              type: integer
                            consecutiveErrors:
                              format: int32
                              type: integer
                            consecutiveGatewayErrors:
                              description: Number of gateway errors before a host
                                is ejected from the connection pool.
                              nullable: true
                              type: integer
                            interval:
                              description: Time interval between ejection sweep analysis.
                              type: string
                            maxEjectionPercent:
                              format: int32
                              type: integer
                            minHealthPercent:
                              format: int32
                              type: integer
                          type: object
                        portLevelSettings:
                          description: Traffic policies specific to individual ports.
                          items:
                            properties:
                              connectionPool:
                                properties:
                                  http:
                                    description: HTTP connection pool settings.
                                    properties:
                                      h2UpgradePolicy:
                                        description: Specify if http1.1 connection
                                          should be upgraded to http2 for the associated
                                          destination.
                                        enum:
                                        - DEFAULT
                                        - DO_NOT_UPGRADE
                                        - UPGRADE
                                        type: string
                                      http1MaxPendingRequests:
                                        description: Maximum number of pending HTTP
                                          requests to a destination.
                                        format: int32
                                        type: integer
                                      http2MaxRequests:
                                        description: Maximum number of requests to
                                          a backend.
                                        format: int32
                                        type: integer
                                      idleTimeout:
                                        description: The idle timeout for upstream
                                          connection pool connections.
                                        type: string
                                      maxRequestsPerConnection:
                                        description: Maximum number of requests per
                                          connection to a backend.
                                        format: int32
                                        type: integer
                                      maxRetries:
                                        format: int32
                                        type: integer
                                    type: object
                                  tcp:
                                    description: Settings common to both HTTP and
                                      TCP upstream connections.
                                    properties:
                                      connectTimeout:
                                        description: TCP connection timeout.
                                        type: string
                                      maxConnections:
                                        description: Maximum number of HTTP1 /TCP
                                          connections to a destination host.
                                        format: int32
                                        type: integer
                                      tcpKeepalive:
                                        description: If set then set SO_KEEPALIVE
                                          on the socket to enable TCP Keepalives.
                                        properties:
                                          interval:
                                            description: The time duration between
                                              keep-alive probes.
                                            type: string
                                          probes:
                                            type: integer
                                          time:
                                            type: string
                                        type: object
                                    type: object
                                type: object
                              loadBalancer:
                                description: Settings controlling the load balancer
                                  algorithms.
                                oneOf:
                                - not:
                                    anyOf:
                                    - required:
                                      - simple
                                    - properties:
                                        consistentHash:
                                          oneOf:
                                          - not:
                                              anyOf:
                                              - required:
                                                - httpHeaderName
                                              - required:
                                                - httpCookie
                                              - required:
                                                - useSourceIp
                                              - required:
                                                - httpQueryParameterName
                                          - required:
                                            - httpHeaderName
                                          - required:
                                            - httpCookie
                                          - required:
                                            - useSourceIp
                                          - required:
                                            - httpQueryParameterName
                                      required:
                                      - consistentHash
                                - required:
                                  - simple
                                - properties:
                                    consistentHash:
                                      oneOf:
                                      - not:
                                          anyOf:
                                          - required:
                                            - httpHeaderName
                                          - required:
                                            - httpCookie
                                          - required:
                                            - useSourceIp
                                          - required:
                                            - httpQueryParameterName
                                      - required:
                                        - httpHeaderName
                                      - required:
                                        - httpCookie
                                      - required:
                                        - useSourceIp
                                      - required:
                                        - httpQueryParameterName
                                  required:
                                  - consistentHash
                                properties:
                                  consistentHash:
                                    properties:
                                      httpCookie:
                                        description: Hash based on HTTP cookie.
                                        properties:
                                          name:
                                            description: Name of the cookie.
                                            format: string
                                            type: string
                                          path:
                                            description: Path to set for the cookie.
                                            format: string
                                            type: string
                                          ttl:
                                            description: Lifetime of the cookie.
                                            type: string
                                        type: object
                                      httpHeaderName:
                                        description: Hash based on a specific HTTP
                                          header.
                                        format: string
                                        type: string
                                      httpQueryParameterName:
                                        description: Hash based on a specific HTTP
                                          query parameter.
                                        format: string
                                        type: string
                                      minimumRingSize:
                                        type: integer
                                      useSourceIp:
                                        description: Hash based on the source IP address.
                                        type: boolean
                                    type: object
                                  localityLbSetting:
                                    properties:
                                      distribute:
                                        description: 'Optional: only one of distribute
                                          or failover can be set.'
                                        items:
                                          properties:
                                            from:
                                              description: Originating locality, '/'
                                                separated, e.g.
                                              format: string
                                              type: string
                                            to:
                                              additionalProperties:
                                                type: integer
                                              description: Map of upstream localities
                                                to traffic distribution weights.
                                              type: object
                                          type: object
                                        type: array
                                      enabled:
                                        description: enable locality load balancing,
                                          this is DestinationRule-level and will override
                                          mesh wide settings in entirety.
                                        nullable: true
                                        type: boolean
                                      failover:
                                        description: 'Optional: only failover or distribute
                                          can be set.'
                                        items:
                                          properties:
                                            from:
                                              description: Originating region.
                                              format: string
                                              type: string
                                            to:
                                              format: string
                                              type: string
                                          type: object
                                        type: array
                                    type: object
                                  simple:
                                    enum:
                                    - ROUND_ROBIN
                                    - LEAST_CONN
                                    - RANDOM
                                    - PASSTHROUGH
                                    type: string
                                type: object
                              outlierDetection:
                                properties:
                                  baseEjectionTime:
                                    description: Minimum ejection duration.
                                    type: string
                                  consecutive5xxErrors:
                                    description: Number of 5xx errors before a host
                                      is ejected from the connection pool.
                                    nullable: true
                                    type: integer
                                  consecutiveErrors:
                                    format: int32
                                    type: integer
                                  consecutiveGatewayErrors:
                                    description: Number of gateway errors before a
                                      host is ejected from the connection pool.
                                    nullable: true
                                    type: integer
                                  interval:
                                    description: Time interval between ejection sweep
                                      analysis.
                                    type: string
                                  maxEjectionPercent:
                                    format: int32
                                    type: integer
                                  minHealthPercent:
                                    format: int32
                                    type: integer
                                type: object
                              port:
                                properties:
                                  number:
                                    type: integer
                                type: object
                              tls:
                                description: TLS related settings for connections
                                  to the upstream service.
                                properties:
                                  caCertificates:
                                    format: string
                                    type: string
                                  clientCertificate:
                                    description: REQUIRED if mode is `MUTUAL`.
                                    format: string
                                    type: string
                                  credentialName:
                                    format: string
                                    type: string
                                  mode:
                                    enum:
                                    - DISABLE
                                    - SIMPLE
                                    - MUTUAL
                                    - ISTIO_MUTUAL
                                    type: string
                                  privateKey:
                                    description: REQUIRED if mode is `MUTUAL`.
                                    format: string
                                    type: string
                                  sni:
                                    description: SNI string to present to the server
                                      during TLS handshake.
                                    format: string
                                    type: string
                                  subjectAltNames:
                                    items:
                                      format: string
                                      type: string
                                    type: array
                                type: object
                            type: object
                          type: array
                        tls:
                          description: TLS related settings for connections to the
                            upstream service.
                          properties:
                            caCertificates:
                              format: string
                              type: string
                            clientCertificate:
                              description: REQUIRED if mode is `MUTUAL`.
                              format: string
                              type: string
                            credentialName:
                              format: string
                              type: string
                            mode:
                              enum:
                              - DISABLE
                              - SIMPLE
                              - MUTUAL
                              - ISTIO_MUTUAL
                              type: string
                            privateKey:
                              description: REQUIRED if mode is `MUTUAL`.
                              format: string
                              type: string
                            sni:
                              description: SNI string to present to the server during
                                TLS handshake.
                              format: string
                              type: string
                            subjectAltNames:
                              items:
                                format: string
                                type: string
                              type: array
                          type: object
                      type: object
                  type: object
                type: array
              trafficPolicy:
                properties:
                  connectionPool:
                    properties:
                      http:
                        description: HTTP connection pool settings.
                        properties:
                          h2UpgradePolicy:
                            description: Specify if http1.1 connection should be upgraded
                              to http2 for the associated destination.
                            enum:
                            - DEFAULT
                            - DO_NOT_UPGRADE
                            - UPGRADE
                            type: string
                          http1MaxPendingRequests:
                            description: Maximum number of pending HTTP requests to
                              a destination.
                            format: int32
                            type: integer
                          http2MaxRequests:
                            description: Maximum number of requests to a backend.
                            format: int32
                            type: integer
                          idleTimeout:
                            description: The idle timeout for upstream connection
                              pool connections.
                            type: string
                          maxRequestsPerConnection:
                            description: Maximum number of requests per connection
                              to a backend.
                            format: int32
                            type: integer
                          maxRetries:
                            format: int32
                            type: integer
                        type: object
                      tcp:
                        description: Settings common to both HTTP and TCP upstream
                          connections.
                        properties:
                          connectTimeout:
                            description: TCP connection timeout.
                            type: string
                          maxConnections:
                            description: Maximum number of HTTP1 /TCP connections
                              to a destination host.
                            format: int32
                            type: integer
                          tcpKeepalive:
                            description: If set then set SO_KEEPALIVE on the socket
                              to enable TCP Keepalives.
                            properties:
                              interval:
                                description: The time duration between keep-alive
                                  probes.
                                type: string
                              probes:
                                type: integer
                              time:
                                type: string
                            type: object
                        type: object
                    type: object
                  loadBalancer:
                    description: Settings controlling the load balancer algorithms.
                    oneOf:
                    - not:
                        anyOf:
                        - required:
                          - simple
                        - properties:
                            consistentHash:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - httpHeaderName
                                  - required:
                                    - httpCookie
                                  - required:
                                    - useSourceIp
                                  - required:
                                    - httpQueryParameterName
                              - required:
                                - httpHeaderName
                              - required:
                                - httpCookie
                              - required:
                                - useSourceIp
                              - required:
                                - httpQueryParameterName
                          required:
                          - consistentHash
                    - required:
                      - simple
                    - properties:
                        consistentHash:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - httpHeaderName
                              - required:
                                - httpCookie
                              - required:
                                - useSourceIp
                              - required:
                                - httpQueryParameterName
                          - required:
                            - httpHeaderName
                          - required:
                            - httpCookie
                          - required:
                            - useSourceIp
                          - required:
                            - httpQueryParameterName
                      required:
                      - consistentHash
                    properties:
                      consistentHash:
                        properties:
                          httpCookie:
                            description: Hash based on HTTP cookie.
                            properties:
                              name:
                                description: Name of the cookie.
                                format: string
                                type: string
                              path:
                                description: Path to set for the cookie.
                                format: string
                                type: string
                              ttl:
                                description: Lifetime of the cookie.
                                type: string
                            type: object
                          httpHeaderName:
                            description: Hash based on a specific HTTP header.
                            format: string
                            type: string
                          httpQueryParameterName:
                            description: Hash based on a specific HTTP query parameter.
                            format: string
                            type: string
                          minimumRingSize:
                            type: integer
                          useSourceIp:
                            description: Hash based on the source IP address.
                            type: boolean
                        type: object
                      localityLbSetting:
                        properties:
                          distribute:
                            description: 'Optional: only one of distribute or failover
                              can be set.'
                            items:
                              properties:
                                from:
                                  description: Originating locality, '/' separated,
                                    e.g.
                                  format: string
                                  type: string
                                to:
                                  additionalProperties:
                                    type: integer
                                  description: Map of upstream localities to traffic
                                    distribution weights.
                                  type: object
                              type: object
                            type: array
                          enabled:
                            description: enable locality load balancing, this is DestinationRule-level
                              and will override mesh wide settings in entirety.
                            nullable: true
                            type: boolean
                          failover:
                            description: 'Optional: only failover or distribute can
                              be set.'
                            items:
                              properties:
                                from:
                                  description: Originating region.
                                  format: string
                                  type: string
                                to:
                                  format: string
                                  type: string
                              type: object
                            type: array
                        type: object
                      simple:
                        enum:
                        - ROUND_ROBIN
                        - LEAST_CONN
                        - RANDOM
                        - PASSTHROUGH
                        type: string
                    type: object
                  outlierDetection:
                    properties:
                      baseEjectionTime:
                        description: Minimum ejection duration.
                        type: string
                      consecutive5xxErrors:
                        description: Number of 5xx errors before a host is ejected
                          from the connection pool.
                        nullable: true
                        type: integer
                      consecutiveErrors:
                        format: int32
                        type: integer
                      consecutiveGatewayErrors:
                        description: Number of gateway errors before a host is ejected
                          from the connection pool.
                        nullable: true
                        type: integer
                      interval:
                        description: Time interval between ejection sweep analysis.
                        type: string
                      maxEjectionPercent:
                        format: int32
                        type: integer
                      minHealthPercent:
                        format: int32
                        type: integer
                    type: object
                  portLevelSettings:
                    description: Traffic policies specific to individual ports.
                    items:
                      properties:
                        connectionPool:
                          properties:
                            http:
                              description: HTTP connection pool settings.
                              properties:
                                h2UpgradePolicy:
                                  description: Specify if http1.1 connection should
                                    be upgraded to http2 for the associated destination.
                                  enum:
                                  - DEFAULT
                                  - DO_NOT_UPGRADE
                                  - UPGRADE
                                  type: string
                                http1MaxPendingRequests:
                                  description: Maximum number of pending HTTP requests
                                    to a destination.
                                  format: int32
                                  type: integer
                                http2MaxRequests:
                                  description: Maximum number of requests to a backend.
                                  format: int32
                                  type: integer
                                idleTimeout:
                                  description: The idle timeout for upstream connection
                                    pool connections.
                                  type: string
                                maxRequestsPerConnection:
                                  description: Maximum number of requests per connection
                                    to a backend.
                                  format: int32
                                  type: integer
                                maxRetries:
                                  format: int32
                                  type: integer
                              type: object
                            tcp:
                              description: Settings common to both HTTP and TCP upstream
                                connections.
                              properties:
                                connectTimeout:
                                  description: TCP connection timeout.
                                  type: string
                                maxConnections:
                                  description: Maximum number of HTTP1 /TCP connections
                                    to a destination host.
                                  format: int32
                                  type: integer
                                tcpKeepalive:
                                  description: If set then set SO_KEEPALIVE on the
                                    socket to enable TCP Keepalives.
                                  properties:
                                    interval:
                                      description: The time duration between keep-alive
                                        probes.
                                      type: string
                                    probes:
                                      type: integer
                                    time:
                                      type: string
                                  type: object
                              type: object
                          type: object
                        loadBalancer:
                          description: Settings controlling the load balancer algorithms.
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - simple
                              - properties:
                                  consistentHash:
                                    oneOf:
                                    - not:
                                        anyOf:
                                        - required:
                                          - httpHeaderName
                                        - required:
                                          - httpCookie
                                        - required:
                                          - useSourceIp
                                        - required:
                                          - httpQueryParameterName
                                    - required:
                                      - httpHeaderName
                                    - required:
                                      - httpCookie
                                    - required:
                                      - useSourceIp
                                    - required:
                                      - httpQueryParameterName
                                required:
                                - consistentHash
                          - required:
                            - simple
                          - properties:
                              consistentHash:
                                oneOf:
                                - not:
                                    anyOf:
                                    - required:
                                      - httpHeaderName
                                    - required:
                                      - httpCookie
                                    - required:
                                      - useSourceIp
                                    - required:
                                      - httpQueryParameterName
                                - required:
                                  - httpHeaderName
                                - required:
                                  - httpCookie
                                - required:
                                  - useSourceIp
                                - required:
                                  - httpQueryParameterName
                            required:
                            - consistentHash
                          properties:
                            consistentHash:
                              properties:
                                httpCookie:
                                  description: Hash based on HTTP cookie.
                                  properties:
                                    name:
                                      description: Name of the cookie.
                                      format: string
                                      type: string
                                    path:
                                      description: Path to set for the cookie.
                                      format: string
                                      type: string
                                    ttl:
                                      description: Lifetime of the cookie.
                                      type: string
                                  type: object
                                httpHeaderName:
                                  description: Hash based on a specific HTTP header.
                                  format: string
                                  type: string
                                httpQueryParameterName:
                                  description: Hash based on a specific HTTP query
                                    parameter.
                                  format: string
                                  type: string
                                minimumRingSize:
                                  type: integer
                                useSourceIp:
                                  description: Hash based on the source IP address.
                                  type: boolean
                              type: object
                            localityLbSetting:
                              properties:
                                distribute:
                                  description: 'Optional: only one of distribute or
                                    failover can be set.'
                                  items:
                                    properties:
                                      from:
                                        description: Originating locality, '/' separated,
                                          e.g.
                                        format: string
                                        type: string
                                      to:
                                        additionalProperties:
                                          type: integer
                                        description: Map of upstream localities to
                                          traffic distribution weights.
                                        type: object
                                    type: object
                                  type: array
                                enabled:
                                  description: enable locality load balancing, this
                                    is DestinationRule-level and will override mesh
                                    wide settings in entirety.
                                  nullable: true
                                  type: boolean
                                failover:
                                  description: 'Optional: only failover or distribute
                                    can be set.'
                                  items:
                                    properties:
                                      from:
                                        description: Originating region.
                                        format: string
                                        type: string
                                      to:
                                        format: string
                                        type: string
                                    type: object
                                  type: array
                              type: object
                            simple:
                              enum:
                              - ROUND_ROBIN
                              - LEAST_CONN
                              - RANDOM
                              - PASSTHROUGH
                              type: string
                          type: object
                        outlierDetection:
                          properties:
                            baseEjectionTime:
                              description: Minimum ejection duration.
                              type: string
                            consecutive5xxErrors:
                              description: Number of 5xx errors before a host is ejected
                                from the connection pool.
                              nullable: true
                              type: integer
                            consecutiveErrors:
                              format: int32
                              type: integer
                            consecutiveGatewayErrors:
                              description: Number of gateway errors before a host
                                is ejected from the connection pool.
                              nullable: true
                              type: integer
                            interval:
                              description: Time interval between ejection sweep analysis.
                              type: string
                            maxEjectionPercent:
                              format: int32
                              type: integer
                            minHealthPercent:
                              format: int32
                              type: integer
                          type: object
                        port:
                          properties:
                            number:
                              type: integer
                          type: object
                        tls:
                          description: TLS related settings for connections to the
                            upstream service.
                          properties:
                            caCertificates:
                              format: string
                              type: string
                            clientCertificate:
                              description: REQUIRED if mode is `MUTUAL`.
                              format: string
                              type: string
                            credentialName:
                              format: string
                              type: string
                            mode:
                              enum:
                              - DISABLE
                              - SIMPLE
                              - MUTUAL
                              - ISTIO_MUTUAL
                              type: string
                            privateKey:
                              description: REQUIRED if mode is `MUTUAL`.
                              format: string
                              type: string
                            sni:
                              description: SNI string to present to the server during
                                TLS handshake.
                              format: string
                              type: string
                            subjectAltNames:
                              items:
                                format: string
                                type: string
                              type: array
                          type: object
                      type: object
                    type: array
                  tls:
                    description: TLS related settings for connections to the upstream
                      service.
                    properties:
                      caCertificates:
                        format: string
                        type: string
                      clientCertificate:
                        description: REQUIRED if mode is `MUTUAL`.
                        format: string
                        type: string
                      credentialName:
                        format: string
                        type: string
                      mode:
                        enum:
                        - DISABLE
                        - SIMPLE
                        - MUTUAL
                        - ISTIO_MUTUAL
                        type: string
                      privateKey:
                        description: REQUIRED if mode is `MUTUAL`.
                        format: string
                        type: string
                      sni:
                        description: SNI string to present to the server during TLS
                          handshake.
                        format: string
                        type: string
                      subjectAltNames:
                        items:
                          format: string
                          type: string
                        type: array
                    type: object
                type: object
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
  - additionalPrinterColumns:
    - description: The name of a service from the service registry
      jsonPath: .spec.host
      name: Host
      type: string
    - description: 'CreationTimestamp is a timestamp representing the server time
        when this object was created. It is not guaranteed to be set in happens-before
        order across separate operations. Clients may not set this value. It is represented
        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1beta1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting load balancing, outlier detection,
              etc. See more details at: https://istio.io/docs/reference/config/networking/destination-rule.html'
            properties:
              exportTo:
                description: A list of namespaces to which this destination rule is
                  exported.
                items:
                  format: string
                  type: string
                type: array
              host:
                description: The name of a service from the service registry.
                format: string
                type: string
              subsets:
                items:
                  properties:
                    labels:
                      additionalProperties:
                        format: string
                        type: string
                      type: object
                    name:
                      description: Name of the subset.
                      format: string
                      type: string
                    trafficPolicy:
                      description: Traffic policies that apply to this subset.
                      properties:
                        connectionPool:
                          properties:
                            http:
                              description: HTTP connection pool settings.
                              properties:
                                h2UpgradePolicy:
                                  description: Specify if http1.1 connection should
                                    be upgraded to http2 for the associated destination.
                                  enum:
                                  - DEFAULT
                                  - DO_NOT_UPGRADE
                                  - UPGRADE
                                  type: string
                                http1MaxPendingRequests:
                                  description: Maximum number of pending HTTP requests
                                    to a destination.
                                  format: int32
                                  type: integer
                                http2MaxRequests:
                                  description: Maximum number of requests to a backend.
                                  format: int32
                                  type: integer
                                idleTimeout:
                                  description: The idle timeout for upstream connection
                                    pool connections.
                                  type: string
                                maxRequestsPerConnection:
                                  description: Maximum number of requests per connection
                                    to a backend.
                                  format: int32
                                  type: integer
                                maxRetries:
                                  format: int32
                                  type: integer
                              type: object
                            tcp:
                              description: Settings common to both HTTP and TCP upstream
                                connections.
                              properties:
                                connectTimeout:
                                  description: TCP connection timeout.
                                  type: string
                                maxConnections:
                                  description: Maximum number of HTTP1 /TCP connections
                                    to a destination host.
                                  format: int32
                                  type: integer
                                tcpKeepalive:
                                  description: If set then set SO_KEEPALIVE on the
                                    socket to enable TCP Keepalives.
                                  properties:
                                    interval:
                                      description: The time duration between keep-alive
                                        probes.
                                      type: string
                                    probes:
                                      type: integer
                                    time:
                                      type: string
                                  type: object
                              type: object
                          type: object
                        loadBalancer:
                          description: Settings controlling the load balancer algorithms.
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - simple
                              - properties:
                                  consistentHash:
                                    oneOf:
                                    - not:
                                        anyOf:
                                        - required:
                                          - httpHeaderName
                                        - required:
                                          - httpCookie
                                        - required:
                                          - useSourceIp
                                        - required:
                                          - httpQueryParameterName
                                    - required:
                                      - httpHeaderName
                                    - required:
                                      - httpCookie
                                    - required:
                                      - useSourceIp
                                    - required:
                                      - httpQueryParameterName
                                required:
                                - consistentHash
                          - required:
                            - simple
                          - properties:
                              consistentHash:
                                oneOf:
                                - not:
                                    anyOf:
                                    - required:
                                      - httpHeaderName
                                    - required:
                                      - httpCookie
                                    - required:
                                      - useSourceIp
                                    - required:
                                      - httpQueryParameterName
                                - required:
                                  - httpHeaderName
                                - required:
                                  - httpCookie
                                - required:
                                  - useSourceIp
                                - required:
                                  - httpQueryParameterName
                            required:
                            - consistentHash
                          properties:
                            consistentHash:
                              properties:
                                httpCookie:
                                  description: Hash based on HTTP cookie.
                                  properties:
                                    name:
                                      description: Name of the cookie.
                                      format: string
                                      type: string
                                    path:
                                      description: Path to set for the cookie.
                                      format: string
                                      type: string
                                    ttl:
                                      description: Lifetime of the cookie.
                                      type: string
                                  type: object
                                httpHeaderName:
                                  description: Hash based on a specific HTTP header.
                                  format: string
                                  type: string
                                httpQueryParameterName:
                                  description: Hash based on a specific HTTP query
                                    parameter.
                                  format: string
                                  type: string
                                minimumRingSize:
                                  type: integer
                                useSourceIp:
                                  description: Hash based on the source IP address.
                                  type: boolean
                              type: object
                            localityLbSetting:
                              properties:
                                distribute:
                                  description: 'Optional: only one of distribute or
                                    failover can be set.'
                                  items:
                                    properties:
                                      from:
                                        description: Originating locality, '/' separated,
                                          e.g.
                                        format: string
                                        type: string
                                      to:
                                        additionalProperties:
                                          type: integer
                                        description: Map of upstream localities to
                                          traffic distribution weights.
                                        type: object
                                    type: object
                                  type: array
                                enabled:
                                  description: enable locality load balancing, this
                                    is DestinationRule-level and will override mesh
                                    wide settings in entirety.
                                  nullable: true
                                  type: boolean
                                failover:
                                  description: 'Optional: only failover or distribute
                                    can be set.'
                                  items:
                                    properties:
                                      from:
                                        description: Originating region.
                                        format: string
                                        type: string
                                      to:
                                        format: string
                                        type: string
                                    type: object
                                  type: array
                              type: object
                            simple:
                              enum:
                              - ROUND_ROBIN
                              - LEAST_CONN
                              - RANDOM
                              - PASSTHROUGH
                              type: string
                          type: object
                        outlierDetection:
                          properties:
                            baseEjectionTime:
                              description: Minimum ejection duration.
                              type: string
                            consecutive5xxErrors:
                              description: Number of 5xx errors before a host is ejected
                                from the connection pool.
                              nullable: true
                              type: integer
                            consecutiveErrors:
                              format: int32
                              type: integer
                            consecutiveGatewayErrors:
                              description: Number of gateway errors before a host
                                is ejected from the connection pool.
                              nullable: true
                              type: integer
                            interval:
                              description: Time interval between ejection sweep analysis.
                              type: string
                            maxEjectionPercent:
                              format: int32
                              type: integer
                            minHealthPercent:
                              format: int32
                              type: integer
                          type: object
                        portLevelSettings:
                          description: Traffic policies specific to individual ports.
                          items:
                            properties:
                              connectionPool:
                                properties:
                                  http:
                                    description: HTTP connection pool settings.
                                    properties:
                                      h2UpgradePolicy:
                                        description: Specify if http1.1 connection
                                          should be upgraded to http2 for the associated
                                          destination.
                                        enum:
                                        - DEFAULT
                                        - DO_NOT_UPGRADE
                                        - UPGRADE
                                        type: string
                                      http1MaxPendingRequests:
                                        description: Maximum number of pending HTTP
                                          requests to a destination.
                                        format: int32
                                        type: integer
                                      http2MaxRequests:
                                        description: Maximum number of requests to
                                          a backend.
                                        format: int32
                                        type: integer
                                      idleTimeout:
                                        description: The idle timeout for upstream
                                          connection pool connections.
                                        type: string
                                      maxRequestsPerConnection:
                                        description: Maximum number of requests per
                                          connection to a backend.
                                        format: int32
                                        type: integer
                                      maxRetries:
                                        format: int32
                                        type: integer
                                    type: object
                                  tcp:
                                    description: Settings common to both HTTP and
                                      TCP upstream connections.
                                    properties:
                                      connectTimeout:
                                        description: TCP connection timeout.
                                        type: string
                                      maxConnections:
                                        description: Maximum number of HTTP1 /TCP
                                          connections to a destination host.
                                        format: int32
                                        type: integer
                                      tcpKeepalive:
                                        description: If set then set SO_KEEPALIVE
                                          on the socket to enable TCP Keepalives.
                                        properties:
                                          interval:
                                            description: The time duration between
                                              keep-alive probes.
                                            type: string
                                          probes:
                                            type: integer
                                          time:
                                            type: string
                                        type: object
                                    type: object
                                type: object
                              loadBalancer:
                                description: Settings controlling the load balancer
                                  algorithms.
                                oneOf:
                                - not:
                                    anyOf:
                                    - required:
                                      - simple
                                    - properties:
                                        consistentHash:
                                          oneOf:
                                          - not:
                                              anyOf:
                                              - required:
                                                - httpHeaderName
                                              - required:
                                                - httpCookie
                                              - required:
                                                - useSourceIp
                                              - required:
                                                - httpQueryParameterName
                                          - required:
                                            - httpHeaderName
                                          - required:
                                            - httpCookie
                                          - required:
                                            - useSourceIp
                                          - required:
                                            - httpQueryParameterName
                                      required:
                                      - consistentHash
                                - required:
                                  - simple
                                - properties:
                                    consistentHash:
                                      oneOf:
                                      - not:
                                          anyOf:
                                          - required:
                                            - httpHeaderName
                                          - required:
                                            - httpCookie
                                          - required:
                                            - useSourceIp
                                          - required:
                                            - httpQueryParameterName
                                      - required:
                                        - httpHeaderName
                                      - required:
                                        - httpCookie
                                      - required:
                                        - useSourceIp
                                      - required:
                                        - httpQueryParameterName
                                  required:
                                  - consistentHash
                                properties:
                                  consistentHash:
                                    properties:
                                      httpCookie:
                                        description: Hash based on HTTP cookie.
                                        properties:
                                          name:
                                            description: Name of the cookie.
                                            format: string
                                            type: string
                                          path:
                                            description: Path to set for the cookie.
                                            format: string
                                            type: string
                                          ttl:
                                            description: Lifetime of the cookie.
                                            type: string
                                        type: object
                                      httpHeaderName:
                                        description: Hash based on a specific HTTP
                                          header.
                                        format: string
                                        type: string
                                      httpQueryParameterName:
                                        description: Hash based on a specific HTTP
                                          query parameter.
                                        format: string
                                        type: string
                                      minimumRingSize:
                                        type: integer
                                      useSourceIp:
                                        description: Hash based on the source IP address.
                                        type: boolean
                                    type: object
                                  localityLbSetting:
                                    properties:
                                      distribute:
                                        description: 'Optional: only one of distribute
                                          or failover can be set.'
                                        items:
                                          properties:
                                            from:
                                              description: Originating locality, '/'
                                                separated, e.g.
                                              format: string
                                              type: string
                                            to:
                                              additionalProperties:
                                                type: integer
                                              description: Map of upstream localities
                                                to traffic distribution weights.
                                              type: object
                                          type: object
                                        type: array
                                      enabled:
                                        description: enable locality load balancing,
                                          this is DestinationRule-level and will override
                                          mesh wide settings in entirety.
                                        nullable: true
                                        type: boolean
                                      failover:
                                        description: 'Optional: only failover or distribute
                                          can be set.'
                                        items:
                                          properties:
                                            from:
                                              description: Originating region.
                                              format: string
                                              type: string
                                            to:
                                              format: string
                                              type: string
                                          type: object
                                        type: array
                                    type: object
                                  simple:
                                    enum:
                                    - ROUND_ROBIN
                                    - LEAST_CONN
                                    - RANDOM
                                    - PASSTHROUGH
                                    type: string
                                type: object
                              outlierDetection:
                                properties:
                                  baseEjectionTime:
                                    description: Minimum ejection duration.
                                    type: string
                                  consecutive5xxErrors:
                                    description: Number of 5xx errors before a host
                                      is ejected from the connection pool.
                                    nullable: true
                                    type: integer
                                  consecutiveErrors:
                                    format: int32
                                    type: integer
                                  consecutiveGatewayErrors:
                                    description: Number of gateway errors before a
                                      host is ejected from the connection pool.
                                    nullable: true
                                    type: integer
                                  interval:
                                    description: Time interval between ejection sweep
                                      analysis.
                                    type: string
                                  maxEjectionPercent:
                                    format: int32
                                    type: integer
                                  minHealthPercent:
                                    format: int32
                                    type: integer
                                type: object
                              port:
                                properties:
                                  number:
                                    type: integer
                                type: object
                              tls:
                                description: TLS related settings for connections
                                  to the upstream service.
                                properties:
                                  caCertificates:
                                    format: string
                                    type: string
                                  clientCertificate:
                                    description: REQUIRED if mode is `MUTUAL`.
                                    format: string
                                    type: string
                                  credentialName:
                                    format: string
                                    type: string
                                  mode:
                                    enum:
                                    - DISABLE
                                    - SIMPLE
                                    - MUTUAL
                                    - ISTIO_MUTUAL
                                    type: string
                                  privateKey:
                                    description: REQUIRED if mode is `MUTUAL`.
                                    format: string
                                    type: string
                                  sni:
                                    description: SNI string to present to the server
                                      during TLS handshake.
                                    format: string
                                    type: string
                                  subjectAltNames:
                                    items:
                                      format: string
                                      type: string
                                    type: array
                                type: object
                            type: object
                          type: array
                        tls:
                          description: TLS related settings for connections to the
                            upstream service.
                          properties:
                            caCertificates:
                              format: string
                              type: string
                            clientCertificate:
                              description: REQUIRED if mode is `MUTUAL`.
                              format: string
                              type: string
                            credentialName:
                              format: string
                              type: string
                            mode:
                              enum:
                              - DISABLE
                              - SIMPLE
                              - MUTUAL
                              - ISTIO_MUTUAL
                              type: string
                            privateKey:
                              description: REQUIRED if mode is `MUTUAL`.
                              format: string
                              type: string
                            sni:
                              description: SNI string to present to the server during
                                TLS handshake.
                              format: string
                              type: string
                            subjectAltNames:
                              items:
                                format: string
                                type: string
                              type: array
                          type: object
                      type: object
                  type: object
                type: array
              trafficPolicy:
                properties:
                  connectionPool:
                    properties:
                      http:
                        description: HTTP connection pool settings.
                        properties:
                          h2UpgradePolicy:
                            description: Specify if http1.1 connection should be upgraded
                              to http2 for the associated destination.
                            enum:
                            - DEFAULT
                            - DO_NOT_UPGRADE
                            - UPGRADE
                            type: string
                          http1MaxPendingRequests:
                            description: Maximum number of pending HTTP requests to
                              a destination.
                            format: int32
                            type: integer
                          http2MaxRequests:
                            description: Maximum number of requests to a backend.
                            format: int32
                            type: integer
                          idleTimeout:
                            description: The idle timeout for upstream connection
                              pool connections.
                            type: string
                          maxRequestsPerConnection:
                            description: Maximum number of requests per connection
                              to a backend.
                            format: int32
                            type: integer
                          maxRetries:
                            format: int32
                            type: integer
                        type: object
                      tcp:
                        description: Settings common to both HTTP and TCP upstream
                          connections.
                        properties:
                          connectTimeout:
                            description: TCP connection timeout.
                            type: string
                          maxConnections:
                            description: Maximum number of HTTP1 /TCP connections
                              to a destination host.
                            format: int32
                            type: integer
                          tcpKeepalive:
                            description: If set then set SO_KEEPALIVE on the socket
                              to enable TCP Keepalives.
                            properties:
                              interval:
                                description: The time duration between keep-alive
                                  probes.
                                type: string
                              probes:
                                type: integer
                              time:
                                type: string
                            type: object
                        type: object
                    type: object
                  loadBalancer:
                    description: Settings controlling the load balancer algorithms.
                    oneOf:
                    - not:
                        anyOf:
                        - required:
                          - simple
                        - properties:
                            consistentHash:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - httpHeaderName
                                  - required:
                                    - httpCookie
                                  - required:
                                    - useSourceIp
                                  - required:
                                    - httpQueryParameterName
                              - required:
                                - httpHeaderName
                              - required:
                                - httpCookie
                              - required:
                                - useSourceIp
                              - required:
                                - httpQueryParameterName
                          required:
                          - consistentHash
                    - required:
                      - simple
                    - properties:
                        consistentHash:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - httpHeaderName
                              - required:
                                - httpCookie
                              - required:
                                - useSourceIp
                              - required:
                                - httpQueryParameterName
                          - required:
                            - httpHeaderName
                          - required:
                            - httpCookie
                          - required:
                            - useSourceIp
                          - required:
                            - httpQueryParameterName
                      required:
                      - consistentHash
                    properties:
                      consistentHash:
                        properties:
                          httpCookie:
                            description: Hash based on HTTP cookie.
                            properties:
                              name:
                                description: Name of the cookie.
                                format: string
                                type: string
                              path:
                                description: Path to set for the cookie.
                                format: string
                                type: string
                              ttl:
                                description: Lifetime of the cookie.
                                type: string
                            type: object
                          httpHeaderName:
                            description: Hash based on a specific HTTP header.
                            format: string
                            type: string
                          httpQueryParameterName:
                            description: Hash based on a specific HTTP query parameter.
                            format: string
                            type: string
                          minimumRingSize:
                            type: integer
                          useSourceIp:
                            description: Hash based on the source IP address.
                            type: boolean
                        type: object
                      localityLbSetting:
                        properties:
                          distribute:
                            description: 'Optional: only one of distribute or failover
                              can be set.'
                            items:
                              properties:
                                from:
                                  description: Originating locality, '/' separated,
                                    e.g.
                                  format: string
                                  type: string
                                to:
                                  additionalProperties:
                                    type: integer
                                  description: Map of upstream localities to traffic
                                    distribution weights.
                                  type: object
                              type: object
                            type: array
                          enabled:
                            description: enable locality load balancing, this is DestinationRule-level
                              and will override mesh wide settings in entirety.
                            nullable: true
                            type: boolean
                          failover:
                            description: 'Optional: only failover or distribute can
                              be set.'
                            items:
                              properties:
                                from:
                                  description: Originating region.
                                  format: string
                                  type: string
                                to:
                                  format: string
                                  type: string
                              type: object
                            type: array
                        type: object
                      simple:
                        enum:
                        - ROUND_ROBIN
                        - LEAST_CONN
                        - RANDOM
                        - PASSTHROUGH
                        type: string
                    type: object
                  outlierDetection:
                    properties:
                      baseEjectionTime:
                        description: Minimum ejection duration.
                        type: string
                      consecutive5xxErrors:
                        description: Number of 5xx errors before a host is ejected
                          from the connection pool.
                        nullable: true
                        type: integer
                      consecutiveErrors:
                        format: int32
                        type: integer
                      consecutiveGatewayErrors:
                        description: Number of gateway errors before a host is ejected
                          from the connection pool.
                        nullable: true
                        type: integer
                      interval:
                        description: Time interval between ejection sweep analysis.
                        type: string
                      maxEjectionPercent:
                        format: int32
                        type: integer
                      minHealthPercent:
                        format: int32
                        type: integer
                    type: object
                  portLevelSettings:
                    description: Traffic policies specific to individual ports.
                    items:
                      properties:
                        connectionPool:
                          properties:
                            http:
                              description: HTTP connection pool settings.
                              properties:
                                h2UpgradePolicy:
                                  description: Specify if http1.1 connection should
                                    be upgraded to http2 for the associated destination.
                                  enum:
                                  - DEFAULT
                                  - DO_NOT_UPGRADE
                                  - UPGRADE
                                  type: string
                                http1MaxPendingRequests:
                                  description: Maximum number of pending HTTP requests
                                    to a destination.
                                  format: int32
                                  type: integer
                                http2MaxRequests:
                                  description: Maximum number of requests to a backend.
                                  format: int32
                                  type: integer
                                idleTimeout:
                                  description: The idle timeout for upstream connection
                                    pool connections.
                                  type: string
                                maxRequestsPerConnection:
                                  description: Maximum number of requests per connection
                                    to a backend.
                                  format: int32
                                  type: integer
                                maxRetries:
                                  format: int32
                                  type: integer
                              type: object
                            tcp:
                              description: Settings common to both HTTP and TCP upstream
                                connections.
                              properties:
                                connectTimeout:
                                  description: TCP connection timeout.
                                  type: string
                                maxConnections:
                                  description: Maximum number of HTTP1 /TCP connections
                                    to a destination host.
                                  format: int32
                                  type: integer
                                tcpKeepalive:
                                  description: If set then set SO_KEEPALIVE on the
                                    socket to enable TCP Keepalives.
                                  properties:
                                    interval:
                                      description: The time duration between keep-alive
                                        probes.
                                      type: string
                                    probes:
                                      type: integer
                                    time:
                                      type: string
                                  type: object
                              type: object
                          type: object
                        loadBalancer:
                          description: Settings controlling the load balancer algorithms.
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - simple
                              - properties:
                                  consistentHash:
                                    oneOf:
                                    - not:
                                        anyOf:
                                        - required:
                                          - httpHeaderName
                                        - required:
                                          - httpCookie
                                        - required:
                                          - useSourceIp
                                        - required:
                                          - httpQueryParameterName
                                    - required:
                                      - httpHeaderName
                                    - required:
                                      - httpCookie
                                    - required:
                                      - useSourceIp
                                    - required:
                                      - httpQueryParameterName
                                required:
                                - consistentHash
                          - required:
                            - simple
                          - properties:
                              consistentHash:
                                oneOf:
                                - not:
                                    anyOf:
                                    - required:
                                      - httpHeaderName
                                    - required:
                                      - httpCookie
                                    - required:
                                      - useSourceIp
                                    - required:
                                      - httpQueryParameterName
                                - required:
                                  - httpHeaderName
                                - required:
                                  - httpCookie
                                - required:
                                  - useSourceIp
                                - required:
                                  - httpQueryParameterName
                            required:
                            - consistentHash
                          properties:
                            consistentHash:
                              properties:
                                httpCookie:
                                  description: Hash based on HTTP cookie.
                                  properties:
                                    name:
                                      description: Name of the cookie.
                                      format: string
                                      type: string
                                    path:
                                      description: Path to set for the cookie.
                                      format: string
                                      type: string
                                    ttl:
                                      description: Lifetime of the cookie.
                                      type: string
                                  type: object
                                httpHeaderName:
                                  description: Hash based on a specific HTTP header.
                                  format: string
                                  type: string
                                httpQueryParameterName:
                                  description: Hash based on a specific HTTP query
                                    parameter.
                                  format: string
                                  type: string
                                minimumRingSize:
                                  type: integer
                                useSourceIp:
                                  description: Hash based on the source IP address.
                                  type: boolean
                              type: object
                            localityLbSetting:
                              properties:
                                distribute:
                                  description: 'Optional: only one of distribute or
                                    failover can be set.'
                                  items:
                                    properties:
                                      from:
                                        description: Originating locality, '/' separated,
                                          e.g.
                                        format: string
                                        type: string
                                      to:
                                        additionalProperties:
                                          type: integer
                                        description: Map of upstream localities to
                                          traffic distribution weights.
                                        type: object
                                    type: object
                                  type: array
                                enabled:
                                  description: enable locality load balancing, this
                                    is DestinationRule-level and will override mesh
                                    wide settings in entirety.
                                  nullable: true
                                  type: boolean
                                failover:
                                  description: 'Optional: only failover or distribute
                                    can be set.'
                                  items:
                                    properties:
                                      from:
                                        description: Originating region.
                                        format: string
                                        type: string
                                      to:
                                        format: string
                                        type: string
                                    type: object
                                  type: array
                              type: object
                            simple:
                              enum:
                              - ROUND_ROBIN
                              - LEAST_CONN
                              - RANDOM
                              - PASSTHROUGH
                              type: string
                          type: object
                        outlierDetection:
                          properties:
                            baseEjectionTime:
                              description: Minimum ejection duration.
                              type: string
                            consecutive5xxErrors:
                              description: Number of 5xx errors before a host is ejected
                                from the connection pool.
                              nullable: true
                              type: integer
                            consecutiveErrors:
                              format: int32
                              type: integer
                            consecutiveGatewayErrors:
                              description: Number of gateway errors before a host
                                is ejected from the connection pool.
                              nullable: true
                              type: integer
                            interval:
                              description: Time interval between ejection sweep analysis.
                              type: string
                            maxEjectionPercent:
                              format: int32
                              type: integer
                            minHealthPercent:
                              format: int32
                              type: integer
                          type: object
                        port:
                          properties:
                            number:
                              type: integer
                          type: object
                        tls:
                          description: TLS related settings for connections to the
                            upstream service.
                          properties:
                            caCertificates:
                              format: string
                              type: string
                            clientCertificate:
                              description: REQUIRED if mode is `MUTUAL`.
                              format: string
                              type: string
                            credentialName:
                              format: string
                              type: string
                            mode:
                              enum:
                              - DISABLE
                              - SIMPLE
                              - MUTUAL
                              - ISTIO_MUTUAL
                              type: string
                            privateKey:
                              description: REQUIRED if mode is `MUTUAL`.
                              format: string
                              type: string
                            sni:
                              description: SNI string to present to the server during
                                TLS handshake.
                              format: string
                              type: string
                            subjectAltNames:
                              items:
                                format: string
                                type: string
                              type: array
                          type: object
                      type: object
                    type: array
                  tls:
                    description: TLS related settings for connections to the upstream
                      service.
                    properties:
                      caCertificates:
                        format: string
                        type: string
                      clientCertificate:
                        description: REQUIRED if mode is `MUTUAL`.
                        format: string
                        type: string
                      credentialName:
                        format: string
                        type: string
                      mode:
                        enum:
                        - DISABLE
                        - SIMPLE
                        - MUTUAL
                        - ISTIO_MUTUAL
                        type: string
                      privateKey:
                        description: REQUIRED if mode is `MUTUAL`.
                        format: string
                        type: string
                      sni:
                        description: SNI string to present to the server during TLS
                          handshake.
                        format: string
                        type: string
                      subjectAltNames:
                        items:
                          format: string
                          type: string
                        type: array
                    type: object
                type: object
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: false
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    release: istio
  name: envoyfilters.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: EnvoyFilter
    listKind: EnvoyFilterList
    plural: envoyfilters
    singular: envoyfilter
  scope: Namespaced
  versions:
  - name: v1alpha3
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Customizing Envoy configuration generated by Istio. See
              more details at: https://istio.io/docs/reference/config/networking/envoy-filter.html'
            properties:
              configPatches:
                description: One or more patches with match conditions.
                items:
                  properties:
                    applyTo:
                      enum:
                      - INVALID
                      - LISTENER
                      - FILTER_CHAIN
                      - NETWORK_FILTER
                      - HTTP_FILTER
                      - ROUTE_CONFIGURATION
                      - VIRTUAL_HOST
                      - HTTP_ROUTE
                      - CLUSTER
                      type: string
                    match:
                      description: Match on listener/route configuration/cluster.
                      oneOf:
                      - not:
                          anyOf:
                          - required:
                            - listener
                          - required:
                            - routeConfiguration
                          - required:
                            - cluster
                      - required:
                        - listener
                      - required:
                        - routeConfiguration
                      - required:
                        - cluster
                      properties:
                        cluster:
                          description: Match on envoy cluster attributes.
                          properties:
                            name:
                              description: The exact name of the cluster to match.
                              format: string
                              type: string
                            portNumber:
                              description: The service port for which this cluster
                                was generated.
                              type: integer
                            service:
                              description: The fully qualified service name for this
                                cluster.
                              format: string
                              type: string
                            subset:
                              description: The subset associated with the service.
                              format: string
                              type: string
                          type: object
                        context:
                          description: The specific config generation context to match
                            on.
                          enum:
                          - ANY
                          - SIDECAR_INBOUND
                          - SIDECAR_OUTBOUND
                          - GATEWAY
                          type: string
                        listener:
                          description: Match on envoy listener attributes.
                          properties:
                            filterChain:
                              description: Match a specific filter chain in a listener.
                              properties:
                                applicationProtocols:
                                  description: Applies only to sidecars.
                                  format: string
                                  type: string
                                filter:
                                  description: The name of a specific filter to apply
                                    the patch to.
                                  properties:
                                    name:
                                      description: The filter name to match on.
                                      format: string
                                      type: string
                                    subFilter:
                                      properties:
                                        name:
                                          description: The filter name to match on.
                                          format: string
                                          type: string
                                      type: object
                                  type: object
                                name:
                                  description: The name assigned to the filter chain.
                                  format: string
                                  type: string
                                sni:
                                  description: The SNI value used by a filter chain's
                                    match condition.
                                  format: string
                                  type: string
                                transportProtocol:
                                  description: Applies only to SIDECAR_INBOUND context.
                                  format: string
                                  type: string
                              type: object
                            name:
                              description: Match a specific listener by its name.
                              format: string
                              type: string
                            portName:
                              format: string
                              type: string
                            portNumber:
                              type: integer
                          type: object
                        proxy:
                          description: Match on properties associated with a proxy.
                          properties:
                            metadata:
                              additionalProperties:
                                format: string
                                type: string
                              type: object
                            proxyVersion:
                              format: string
                              type: string
                          type: object
                        routeConfiguration:
                          description: Match on envoy HTTP route configuration attributes.
                          properties:
                            gateway:
                              format: string
                              type: string
                            name:
                              description: Route configuration name to match on.
                              format: string
                              type: string
                            portName:
                              description: Applicable only for GATEWAY context.
                              format: string
                              type: string
                            portNumber:
                              type: integer
                            vhost:
                              properties:
                                name:
                                  format: string
                                  type: string
                                route:
                                  description: Match a specific route within the virtual
                                    host.
                                  properties:
                                    action:
                                      description: Match a route with specific action
                                        type.
                                      enum:
                                      - ANY
                                      - ROUTE
                                      - REDIRECT
                                      - DIRECT_RESPONSE
                                      type: string
                                    name:
                                      format: string
                                      type: string
                                  type: object
                              type: object
                          type: object
                      type: object
                    patch:
                      description: The patch to apply along with the operation.
                      properties:
                        operation:
                          description: Determines how the patch should be applied.
                          enum:
                          - INVALID
                          - MERGE
                          - ADD
                          - REMOVE
                          - INSERT_BEFORE
                          - INSERT_AFTER
                          - INSERT_FIRST
                          type: string
                        value:
                          description: The JSON config of the object being patched.
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                      type: object
                  type: object
                type: array
              workloadSelector:
                properties:
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                type: object
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    release: istio
  name: gateways.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: Gateway
    listKind: GatewayList
    plural: gateways
    shortNames:
    - gw
    singular: gateway
  scope: Namespaced
  versions:
  - name: v1alpha3
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting edge load balancer. See more details
              at: https://istio.io/docs/reference/config/networking/gateway.html'
            properties:
              selector:
                additionalProperties:
                  format: string
                  type: string
                type: object
              servers:
                description: A list of server specifications.
                items:
                  properties:
                    bind:
                      format: string
                      type: string
                    defaultEndpoint:
                      format: string
                      type: string
                    hosts:
                      description: One or more hosts exposed by this gateway.
                      items:
                        format: string
                        type: string
                      type: array
                    name:
                      description: An optional name of the server, when set must be
                        unique across all servers.
                      format: string
                      type: string
                    port:
                      properties:
                        name:
                          description: Label assigned to the port.
                          format: string
                          type: string
                        number:
                          description: A valid non-negative integer port number.
                          type: integer
                        protocol:
                          description: The protocol exposed on the port.
                          format: string
                          type: string
                        targetPort:
                          type: integer
                      type: object
                    tls:
                      description: Set of TLS related options that govern the server's
                        behavior.
                      properties:
                        caCertificates:
                          description: REQUIRED if mode is `MUTUAL`.
                          format: string
                          type: string
                        cipherSuites:
                          description: 'Optional: If specified, only support the specified
                            cipher list.'
                          items:
                            format: string
                            type: string
                          type: array
                        credentialName:
                          format: string
                          type: string
                        httpsRedirect:
                          type: boolean
                        maxProtocolVersion:
                          description: 'Optional: Maximum TLS protocol version.'
                          enum:
                          - TLS_AUTO
                          - TLSV1_0
                          - TLSV1_1
                          - TLSV1_2
                          - TLSV1_3
                          type: string
                        minProtocolVersion:
                          description: 'Optional: Minimum TLS protocol version.'
                          enum:
                          - TLS_AUTO
                          - TLSV1_0
                          - TLSV1_1
                          - TLSV1_2
                          - TLSV1_3
                          type: string
                        mode:
                          enum:
                          - PASSTHROUGH
                          - SIMPLE
                          - MUTUAL
                          - AUTO_PASSTHROUGH
                          - ISTIO_MUTUAL
                          type: string
                        privateKey:
                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                          format: string
                          type: string
                        serverCertificate:
                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                          format: string
                          type: string
                        subjectAltNames:
                          items:
                            format: string
                            type: string
                          type: array
                        verifyCertificateHash:
                          items:
                            format: string
                            type: string
                          type: array
                        verifyCertificateSpki:
                          items:
                            format: string
                            type: string
                          type: array
                      type: object
                  type: object
                type: array
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
  - name: v1beta1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting edge load balancer. See more details
              at: https://istio.io/docs/reference/config/networking/gateway.html'
            properties:
              selector:
                additionalProperties:
                  format: string
                  type: string
                type: object
              servers:
                description: A list of server specifications.
                items:
                  properties:
                    bind:
                      format: string
                      type: string
                    defaultEndpoint:
                      format: string
                      type: string
                    hosts:
                      description: One or more hosts exposed by this gateway.
                      items:
                        format: string
                        type: string
                      type: array
                    name:
                      description: An optional name of the server, when set must be
                        unique across all servers.
                      format: string
                      type: string
                    port:
                      properties:
                        name:
                          description: Label assigned to the port.
                          format: string
                          type: string
                        number:
                          description: A valid non-negative integer port number.
                          type: integer
                        protocol:
                          description: The protocol exposed on the port.
                          format: string
                          type: string
                        targetPort:
                          type: integer
                      type: object
                    tls:
                      description: Set of TLS related options that govern the server's
                        behavior.
                      properties:
                        caCertificates:
                          description: REQUIRED if mode is `MUTUAL`.
                          format: string
                          type: string
                        cipherSuites:
                          description: 'Optional: If specified, only support the specified
                            cipher list.'
                          items:
                            format: string
                            type: string
                          type: array
                        credentialName:
                          format: string
                          type: string
                        httpsRedirect:
                          type: boolean
                        maxProtocolVersion:
                          description: 'Optional: Maximum TLS protocol version.'
                          enum:
                          - TLS_AUTO
                          - TLSV1_0
                          - TLSV1_1
                          - TLSV1_2
                          - TLSV1_3
                          type: string
                        minProtocolVersion:
                          description: 'Optional: Minimum TLS protocol version.'
                          enum:
                          - TLS_AUTO
                          - TLSV1_0
                          - TLSV1_1
                          - TLSV1_2
                          - TLSV1_3
                          type: string
                        mode:
                          enum:
                          - PASSTHROUGH
                          - SIMPLE
                          - MUTUAL
                          - AUTO_PASSTHROUGH
                          - ISTIO_MUTUAL
                          type: string
                        privateKey:
                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                          format: string
                          type: string
                        serverCertificate:
                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                          format: string
                          type: string
                        subjectAltNames:
                          items:
                            format: string
                            type: string
                          type: array
                        verifyCertificateHash:
                          items:
                            format: string
                            type: string
                          type: array
                        verifyCertificateSpki:
                          items:
                            format: string
                            type: string
                          type: array
                      type: object
                  type: object
                type: array
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: false
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    istio: mixer-handler
    package: handler
    release: istio
  name: handlers.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: handler
    listKind: handlerList
    plural: handlers
    singular: handler
  scope: Namespaced
  versions:
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: Handler allows the operator to configure a specific adapter
              implementation.
            properties:
              adapter:
                description: The name of a specific adapter implementation.
                format: string
                type: string
              compiledAdapter:
                description: The name of the compiled in adapter this handler instantiates.
                format: string
                type: string
              connection:
                description: Information on how to connect to the out-of-process adapter.
                properties:
                  address:
                    description: The address of the backend.
                    format: string
                    type: string
                  authentication:
                    description: Auth config for the connection to the backend.
                    oneOf:
                    - not:
                        anyOf:
                        - properties:
                            tls:
                              allOf:
                              - oneOf:
                                - not:
                                    anyOf:
                                    - required:
                                      - tokenPath
                                    - required:
                                      - oauth
                                - required:
                                  - tokenPath
                                - required:
                                  - oauth
                              - oneOf:
                                - not:
                                    anyOf:
                                    - required:
                                      - authHeader
                                    - required:
                                      - customHeader
                                - required:
                                  - authHeader
                                - required:
                                  - customHeader
                          required:
                          - tls
                        - required:
                          - mutual
                    - properties:
                        tls:
                          allOf:
                          - oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - tokenPath
                                - required:
                                  - oauth
                            - required:
                              - tokenPath
                            - required:
                              - oauth
                          - oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - authHeader
                                - required:
                                  - customHeader
                            - required:
                              - authHeader
                            - required:
                              - customHeader
                      required:
                      - tls
                    - required:
                      - mutual
                    properties:
                      mutual:
                        properties:
                          caCertificates:
                            format: string
                            type: string
                          clientCertificate:
                            description: The path to the file holding client certificate
                              for mutual TLS.
                            format: string
                            type: string
                          privateKey:
                            description: The path to the file holding the private
                              key for mutual TLS.
                            format: string
                            type: string
                          serverName:
                            description: Used to configure mixer mutual TLS client
                              to supply server name for SNI.
                            format: string
                            type: string
                        type: object
                      tls:
                        properties:
                          authHeader:
                            description: Access token is passed as authorization header.
                            enum:
                            - PLAIN
                            - BEARER
                            type: string
                          caCertificates:
                            format: string
                            type: string
                          customHeader:
                            description: Customized header key to hold access token,
                              e.g.
                            format: string
                            type: string
                          oauth:
                            description: Oauth config to fetch access token from auth
                              provider.
                            properties:
                              clientId:
                                description: OAuth client id for mixer.
                                format: string
                                type: string
                              clientSecret:
                                description: The path to the file holding the client
                                  secret for oauth.
                                format: string
                                type: string
                              endpointParams:
                                additionalProperties:
                                  format: string
                                  type: string
                                description: Additional parameters for requests to
                                  the token endpoint.
                                type: object
                              scopes:
                                description: List of requested permissions.
                                items:
                                  format: string
                                  type: string
                                type: array
                              tokenUrl:
                                description: The Resource server's token endpoint
                                  URL.
                                format: string
                                type: string
                            type: object
                          serverName:
                            format: string
                            type: string
                          tokenPath:
                            format: string
                            type: string
                        type: object
                    type: object
                  timeout:
                    description: Timeout for remote calls to the backend.
                    type: string
                type: object
              name:
                description: Must be unique in the entire Mixer configuration.
                format: string
                type: string
              params:
                description: Depends on adapter implementation.
                type: object
                x-kubernetes-preserve-unknown-fields: true
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-mixer
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    release: istio
  name: httpapispecbindings.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: HTTPAPISpecBinding
    listKind: HTTPAPISpecBindingList
    plural: httpapispecbindings
    singular: httpapispecbinding
  scope: Namespaced
  versions:
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            properties:
              api_specs:
                items:
                  properties:
                    name:
                      description: The short name of the HTTPAPISpec.
                      format: string
                      type: string
                    namespace:
                      description: Optional namespace of the HTTPAPISpec.
                      format: string
                      type: string
                  type: object
                type: array
              apiSpecs:
                items:
                  properties:
                    name:
                      description: The short name of the HTTPAPISpec.
                      format: string
                      type: string
                    namespace:
                      description: Optional namespace of the HTTPAPISpec.
                      format: string
                      type: string
                  type: object
                type: array
              services:
                description: One or more services to map the listed HTTPAPISpec onto.
                items:
                  properties:
                    domain:
                      description: Domain suffix used to construct the service FQDN
                        in implementations that support such specification.
                      format: string
                      type: string
                    labels:
                      additionalProperties:
                        format: string
                        type: string
                      description: Optional one or more labels that uniquely identify
                        the service version.
                      type: object
                    name:
                      description: The short name of the service such as "foo".
                      format: string
                      type: string
                    namespace:
                      description: Optional namespace of the service.
                      format: string
                      type: string
                    service:
                      description: The service FQDN.
                      format: string
                      type: string
                  type: object
                type: array
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-mixer
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    release: istio
  name: httpapispecs.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: HTTPAPISpec
    listKind: HTTPAPISpecList
    plural: httpapispecs
    singular: httpapispec
  scope: Namespaced
  versions:
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            properties:
              api_keys:
                items:
                  oneOf:
                  - not:
                      anyOf:
                      - required:
                        - query
                      - required:
                        - header
                      - required:
                        - cookie
                  - required:
                    - query
                  - required:
                    - header
                  - required:
                    - cookie
                  properties:
                    cookie:
                      format: string
                      type: string
                    header:
                      description: API key is sent in a request header.
                      format: string
                      type: string
                    query:
                      description: API Key is sent as a query parameter.
                      format: string
                      type: string
                  type: object
                type: array
              apiKeys:
                items:
                  oneOf:
                  - not:
                      anyOf:
                      - required:
                        - query
                      - required:
                        - header
                      - required:
                        - cookie
                  - required:
                    - query
                  - required:
                    - header
                  - required:
                    - cookie
                  properties:
                    cookie:
                      format: string
                      type: string
                    header:
                      description: API key is sent in a request header.
                      format: string
                      type: string
                    query:
                      description: API Key is sent as a query parameter.
                      format: string
                      type: string
                  type: object
                type: array
              attributes:
                properties:
                  attributes:
                    additionalProperties:
                      oneOf:
                      - not:
                          anyOf:
                          - required:
                            - stringValue
                          - required:
                            - int64Value
                          - required:
                            - doubleValue
                          - required:
                            - boolValue
                          - required:
                            - bytesValue
                          - required:
                            - timestampValue
                          - required:
                            - durationValue
                          - required:
                            - stringMapValue
                      - required:
                        - stringValue
                      - required:
                        - int64Value
                      - required:
                        - doubleValue
                      - required:
                        - boolValue
                      - required:
                        - bytesValue
                      - required:
                        - timestampValue
                      - required:
                        - durationValue
                      - required:
                        - stringMapValue
                      properties:
                        boolValue:
                          type: boolean
                        bytesValue:
                          format: binary
                          type: string
                        doubleValue:
                          format: double
                          type: number
                        durationValue:
                          type: string
                        int64Value:
                          format: int64
                          type: integer
                        stringMapValue:
                          properties:
                            entries:
                              additionalProperties:
                                format: string
                                type: string
                              description: Holds a set of name/value pairs.
                              type: object
                          type: object
                        stringValue:
                          format: string
                          type: string
                        timestampValue:
                          format: dateTime
                          type: string
                      type: object
                    description: A map of attribute name to its value.
                    type: object
                type: object
              patterns:
                description: List of HTTP patterns to match.
                items:
                  oneOf:
                  - not:
                      anyOf:
                      - required:
                        - uriTemplate
                      - required:
                        - regex
                  - required:
                    - uriTemplate
                  - required:
                    - regex
                  properties:
                    attributes:
                      properties:
                        attributes:
                          additionalProperties:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - stringValue
                                - required:
                                  - int64Value
                                - required:
                                  - doubleValue
                                - required:
                                  - boolValue
                                - required:
                                  - bytesValue
                                - required:
                                  - timestampValue
                                - required:
                                  - durationValue
                                - required:
                                  - stringMapValue
                            - required:
                              - stringValue
                            - required:
                              - int64Value
                            - required:
                              - doubleValue
                            - required:
                              - boolValue
                            - required:
                              - bytesValue
                            - required:
                              - timestampValue
                            - required:
                              - durationValue
                            - required:
                              - stringMapValue
                            properties:
                              boolValue:
                                type: boolean
                              bytesValue:
                                format: binary
                                type: string
                              doubleValue:
                                format: double
                                type: number
                              durationValue:
                                type: string
                              int64Value:
                                format: int64
                                type: integer
                              stringMapValue:
                                properties:
                                  entries:
                                    additionalProperties:
                                      format: string
                                      type: string
                                    description: Holds a set of name/value pairs.
                                    type: object
                                type: object
                              stringValue:
                                format: string
                                type: string
                              timestampValue:
                                format: dateTime
                                type: string
                            type: object
                          description: A map of attribute name to its value.
                          type: object
                      type: object
                    httpMethod:
                      format: string
                      type: string
                    regex:
                      format: string
                      type: string
                    uriTemplate:
                      format: string
                      type: string
                  type: object
                type: array
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    istio: mixer-instance
    package: instance
    release: istio
  name: instances.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: instance
    listKind: instanceList
    plural: instances
    singular: instance
  scope: Namespaced
  versions:
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: An Instance tells Mixer how to create instances for particular
              template.
            properties:
              attributeBindings:
                additionalProperties:
                  format: string
                  type: string
                type: object
              compiledTemplate:
                description: The name of the compiled in template this instance creates
                  instances for.
                format: string
                type: string
              name:
                format: string
                type: string
              params:
                description: Depends on referenced template.
                type: object
                x-kubernetes-preserve-unknown-fields: true
              template:
                description: The name of the template this instance creates instances
                  for.
                format: string
                type: string
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    release: istio
  name: istiooperators.install.istio.io
spec:
  group: install.istio.io
  names:
    kind: IstioOperator
    plural: istiooperators
    shortNames:
    - iop
    singular: istiooperator
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Istio control plane revision
      jsonPath: .spec.revision
      name: Revision
      type: string
    - description: IOP current state
      jsonPath: .status.status
      name: Status
      type: string
    - description: 'CreationTimestamp is a timestamp representing the server time
        when this object was created. It is not guaranteed to be set in happens-before
        order across separate operations. Clients may not set this value. It is represented
        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          spec:
            description: 'Specification of the desired state of the istio control
              plane resource. More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status'
            type: object
            x-kubernetes-preserve-unknown-fields: true
          status:
            description: 'Status describes each of istio control plane component status
              at the current time. 0 means NONE, 1 means UPDATING, 2 means HEALTHY,
              3 means ERROR, 4 means RECONCILING. More info: https://github.com/istio/api/blob/master/operator/v1alpha1/istio.operator.v1alpha1.pb.html
              & https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status'
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    istio: security
    release: istio
  name: peerauthentications.security.istio.io
spec:
  group: security.istio.io
  names:
    categories:
    - istio-io
    - security-istio-io
    kind: PeerAuthentication
    listKind: PeerAuthenticationList
    plural: peerauthentications
    shortNames:
    - pa
    singular: peerauthentication
  scope: Namespaced
  versions:
  - name: v1beta1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: PeerAuthentication defines how traffic will be tunneled (or
              not) to the sidecar.
            properties:
              mtls:
                description: Mutual TLS settings for workload.
                properties:
                  mode:
                    description: Defines the mTLS mode used for peer authentication.
                    enum:
                    - UNSET
                    - DISABLE
                    - PERMISSIVE
                    - STRICT
                    type: string
                type: object
              portLevelMtls:
                additionalProperties:
                  properties:
                    mode:
                      description: Defines the mTLS mode used for peer authentication.
                      enum:
                      - UNSET
                      - DISABLE
                      - PERMISSIVE
                      - STRICT
                      type: string
                  type: object
                description: Port specific mutual TLS settings.
                type: object
              selector:
                description: The selector determines the workloads to apply the ChannelAuthentication
                  on.
                properties:
                  matchLabels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                type: object
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-mixer
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    release: istio
  name: quotaspecbindings.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: QuotaSpecBinding
    listKind: QuotaSpecBindingList
    plural: quotaspecbindings
    singular: quotaspecbinding
  scope: Namespaced
  versions:
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            properties:
              quotaSpecs:
                items:
                  properties:
                    name:
                      description: The short name of the QuotaSpec.
                      format: string
                      type: string
                    namespace:
                      description: Optional namespace of the QuotaSpec.
                      format: string
                      type: string
                  type: object
                type: array
              services:
                description: One or more services to map the listed QuotaSpec onto.
                items:
                  properties:
                    domain:
                      description: Domain suffix used to construct the service FQDN
                        in implementations that support such specification.
                      format: string
                      type: string
                    labels:
                      additionalProperties:
                        format: string
                        type: string
                      description: Optional one or more labels that uniquely identify
                        the service version.
                      type: object
                    name:
                      description: The short name of the service such as "foo".
                      format: string
                      type: string
                    namespace:
                      description: Optional namespace of the service.
                      format: string
                      type: string
                    service:
                      description: The service FQDN.
                      format: string
                      type: string
                  type: object
                type: array
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-mixer
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    release: istio
  name: quotaspecs.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: QuotaSpec
    listKind: QuotaSpecList
    plural: quotaspecs
    singular: quotaspec
  scope: Namespaced
  versions:
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: Determines the quotas used for individual requests.
            properties:
              rules:
                description: A list of Quota rules.
                items:
                  properties:
                    match:
                      description: If empty, match all request.
                      items:
                        properties:
                          clause:
                            additionalProperties:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - exact
                                  - required:
                                    - prefix
                                  - required:
                                    - regex
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                              properties:
                                exact:
                                  format: string
                                  type: string
                                prefix:
                                  format: string
                                  type: string
                                regex:
                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                  format: string
                                  type: string
                              type: object
                            description: Map of attribute names to StringMatch type.
                            type: object
                        type: object
                      type: array
                    quotas:
                      description: The list of quotas to charge.
                      items:
                        properties:
                          charge:
                            format: int32
                            type: integer
                          quota:
                            format: string
                            type: string
                        type: object
                      type: array
                  type: object
                type: array
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    istio: security
    release: istio
  name: requestauthentications.security.istio.io
spec:
  group: security.istio.io
  names:
    categories:
    - istio-io
    - security-istio-io
    kind: RequestAuthentication
    listKind: RequestAuthenticationList
    plural: requestauthentications
    shortNames:
    - ra
    singular: requestauthentication
  scope: Namespaced
  versions:
  - name: v1beta1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: RequestAuthentication defines what request authentication
              methods are supported by a workload.
            properties:
              jwtRules:
                description: Define the list of JWTs that can be validated at the
                  selected workloads' proxy.
                items:
                  properties:
                    audiences:
                      items:
                        format: string
                        type: string
                      type: array
                    forwardOriginalToken:
                      description: If set to true, the orginal token will be kept
                        for the ustream request.
                      type: boolean
                    fromHeaders:
                      description: List of header locations from which JWT is expected.
                      items:
                        properties:
                          name:
                            description: The HTTP header name.
                            format: string
                            type: string
                          prefix:
                            description: The prefix that should be stripped before
                              decoding the token.
                            format: string
                            type: string
                        type: object
                      type: array
                    fromParams:
                      description: List of query parameters from which JWT is expected.
                      items:
                        format: string
                        type: string
                      type: array
                    issuer:
                      description: Identifies the issuer that issued the JWT.
                      format: string
                      type: string
                    jwks:
                      description: JSON Web Key Set of public keys to validate signature
                        of the JWT.
                      format: string
                      type: string
                    jwks_uri:
                      format: string
                      type: string
                    jwksUri:
                      format: string
                      type: string
                    outputPayloadToHeader:
                      format: string
                      type: string
                  type: object
                type: array
              selector:
                description: The selector determines the workloads to apply the RequestAuthentication
                  on.
                properties:
                  matchLabels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                type: object
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    istio: core
    package: istio.io.mixer
    release: istio
  name: rules.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: rule
    listKind: ruleList
    plural: rules
    singular: rule
  scope: Namespaced
  versions:
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Describes the rules used to configure Mixer''s policy and
              telemetry features. See more details at: https://istio.io/docs/reference/config/policy-and-telemetry/istio.policy.v1beta1.html'
            properties:
              actions:
                description: The actions that will be executed when match evaluates
                  to `true`.
                items:
                  properties:
                    handler:
                      description: Fully qualified name of the handler to invoke.
                      format: string
                      type: string
                    instances:
                      items:
                        format: string
                        type: string
                      type: array
                    name:
                      description: A handle to refer to the results of the action.
                      format: string
                      type: string
                  type: object
                type: array
              match:
                description: Match is an attribute based predicate.
                format: string
                type: string
              requestHeaderOperations:
                items:
                  properties:
                    name:
                      description: Header name literal value.
                      format: string
                      type: string
                    operation:
                      description: Header operation type.
                      enum:
                      - REPLACE
                      - REMOVE
                      - APPEND
                      type: string
                    values:
                      description: Header value expressions.
                      items:
                        format: string
                        type: string
                      type: array
                  type: object
                type: array
              responseHeaderOperations:
                items:
                  properties:
                    name:
                      description: Header name literal value.
                      format: string
                      type: string
                    operation:
                      description: Header operation type.
                      enum:
                      - REPLACE
                      - REMOVE
                      - APPEND
                      type: string
                    values:
                      description: Header value expressions.
                      items:
                        format: string
                        type: string
                      type: array
                  type: object
                type: array
              sampling:
                properties:
                  random:
                    description: Provides filtering of actions based on random selection
                      per request.
                    properties:
                      attributeExpression:
                        description: Specifies an attribute expression to use to override
                          the numerator in the `percent_sampled` field.
                        format: string
                        type: string
                      percentSampled:
                        description: The default sampling rate, expressed as a percentage.
                        properties:
                          denominator:
                            description: Specifies the denominator.
                            enum:
                            - HUNDRED
                            - TEN_THOUSAND
                            type: string
                          numerator:
                            description: Specifies the numerator.
                            type: integer
                        type: object
                      useIndependentRandomness:
                        description: By default sampling will be based on the value
                          of the request header `x-request-id`.
                        type: boolean
                    type: object
                  rateLimit:
                    properties:
                      maxUnsampledEntries:
                        description: Number of entries to allow during the `sampling_duration`
                          before sampling is enforced.
                        format: int64
                        type: integer
                      samplingDuration:
                        description: Window in which to enforce the sampling rate.
                        type: string
                      samplingRate:
                        description: The rate at which to sample entries once the
                          unsampled limit has been reached.
                        format: int64
                        type: integer
                    type: object
                type: object
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    release: istio
  name: serviceentries.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: ServiceEntry
    listKind: ServiceEntryList
    plural: serviceentries
    shortNames:
    - se
    singular: serviceentry
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The hosts associated with the ServiceEntry
      jsonPath: .spec.hosts
      name: Hosts
      type: string
    - description: Whether the service is external to the mesh or part of the mesh
        (MESH_EXTERNAL or MESH_INTERNAL)
      jsonPath: .spec.location
      name: Location
      type: string
    - description: Service discovery mode for the hosts (NONE, STATIC, or DNS)
      jsonPath: .spec.resolution
      name: Resolution
      type: string
    - description: 'CreationTimestamp is a timestamp representing the server time
        when this object was created. It is not guaranteed to be set in happens-before
        order across separate operations. Clients may not set this value. It is represented
        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha3
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting service registry. See more details
              at: https://istio.io/docs/reference/config/networking/service-entry.html'
            properties:
              addresses:
                description: The virtual IP addresses associated with the service.
                items:
                  format: string
                  type: string
                type: array
              endpoints:
                description: One or more endpoints associated with the service.
                items:
                  properties:
                    address:
                      format: string
                      type: string
                    labels:
                      additionalProperties:
                        format: string
                        type: string
                      description: One or more labels associated with the endpoint.
                      type: object
                    locality:
                      description: The locality associated with the endpoint.
                      format: string
                      type: string
                    network:
                      format: string
                      type: string
                    ports:
                      additionalProperties:
                        type: integer
                      description: Set of ports associated with the endpoint.
                      type: object
                    serviceAccount:
                      format: string
                      type: string
                    weight:
                      description: The load balancing weight associated with the endpoint.
                      type: integer
                  type: object
                type: array
              exportTo:
                description: A list of namespaces to which this service is exported.
                items:
                  format: string
                  type: string
                type: array
              hosts:
                description: The hosts associated with the ServiceEntry.
                items:
                  format: string
                  type: string
                type: array
              location:
                enum:
                - MESH_EXTERNAL
                - MESH_INTERNAL
                type: string
              ports:
                description: The ports associated with the external service.
                items:
                  properties:
                    name:
                      description: Label assigned to the port.
                      format: string
                      type: string
                    number:
                      description: A valid non-negative integer port number.
                      type: integer
                    protocol:
                      description: The protocol exposed on the port.
                      format: string
                      type: string
                    targetPort:
                      type: integer
                  type: object
                type: array
              resolution:
                description: Service discovery mode for the hosts.
                enum:
                - NONE
                - STATIC
                - DNS
                type: string
              subjectAltNames:
                items:
                  format: string
                  type: string
                type: array
              workloadSelector:
                description: Applicable only for MESH_INTERNAL services.
                properties:
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                type: object
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
  - additionalPrinterColumns:
    - description: The hosts associated with the ServiceEntry
      jsonPath: .spec.hosts
      name: Hosts
      type: string
    - description: Whether the service is external to the mesh or part of the mesh
        (MESH_EXTERNAL or MESH_INTERNAL)
      jsonPath: .spec.location
      name: Location
      type: string
    - description: Service discovery mode for the hosts (NONE, STATIC, or DNS)
      jsonPath: .spec.resolution
      name: Resolution
      type: string
    - description: 'CreationTimestamp is a timestamp representing the server time
        when this object was created. It is not guaranteed to be set in happens-before
        order across separate operations. Clients may not set this value. It is represented
        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1beta1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting service registry. See more details
              at: https://istio.io/docs/reference/config/networking/service-entry.html'
            properties:
              addresses:
                description: The virtual IP addresses associated with the service.
                items:
                  format: string
                  type: string
                type: array
              endpoints:
                description: One or more endpoints associated with the service.
                items:
                  properties:
                    address:
                      format: string
                      type: string
                    labels:
                      additionalProperties:
                        format: string
                        type: string
                      description: One or more labels associated with the endpoint.
                      type: object
                    locality:
                      description: The locality associated with the endpoint.
                      format: string
                      type: string
                    network:
                      format: string
                      type: string
                    ports:
                      additionalProperties:
                        type: integer
                      description: Set of ports associated with the endpoint.
                      type: object
                    serviceAccount:
                      format: string
                      type: string
                    weight:
                      description: The load balancing weight associated with the endpoint.
                      type: integer
                  type: object
                type: array
              exportTo:
                description: A list of namespaces to which this service is exported.
                items:
                  format: string
                  type: string
                type: array
              hosts:
                description: The hosts associated with the ServiceEntry.
                items:
                  format: string
                  type: string
                type: array
              location:
                enum:
                - MESH_EXTERNAL
                - MESH_INTERNAL
                type: string
              ports:
                description: The ports associated with the external service.
                items:
                  properties:
                    name:
                      description: Label assigned to the port.
                      format: string
                      type: string
                    number:
                      description: A valid non-negative integer port number.
                      type: integer
                    protocol:
                      description: The protocol exposed on the port.
                      format: string
                      type: string
                    targetPort:
                      type: integer
                  type: object
                type: array
              resolution:
                description: Service discovery mode for the hosts.
                enum:
                - NONE
                - STATIC
                - DNS
                type: string
              subjectAltNames:
                items:
                  format: string
                  type: string
                type: array
              workloadSelector:
                description: Applicable only for MESH_INTERNAL services.
                properties:
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                type: object
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: false
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    release: istio
  name: sidecars.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: Sidecar
    listKind: SidecarList
    plural: sidecars
    singular: sidecar
  scope: Namespaced
  versions:
  - name: v1alpha3
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting network reachability of a sidecar.
              See more details at: https://istio.io/docs/reference/config/networking/sidecar.html'
            properties:
              egress:
                items:
                  properties:
                    bind:
                      format: string
                      type: string
                    captureMode:
                      enum:
                      - DEFAULT
                      - IPTABLES
                      - NONE
                      type: string
                    hosts:
                      items:
                        format: string
                        type: string
                      type: array
                    port:
                      description: The port associated with the listener.
                      properties:
                        name:
                          description: Label assigned to the port.
                          format: string
                          type: string
                        number:
                          description: A valid non-negative integer port number.
                          type: integer
                        protocol:
                          description: The protocol exposed on the port.
                          format: string
                          type: string
                        targetPort:
                          type: integer
                      type: object
                  type: object
                type: array
              ingress:
                items:
                  properties:
                    bind:
                      description: The IP to which the listener should be bound.
                      format: string
                      type: string
                    captureMode:
                      enum:
                      - DEFAULT
                      - IPTABLES
                      - NONE
                      type: string
                    defaultEndpoint:
                      format: string
                      type: string
                    port:
                      description: The port associated with the listener.
                      properties:
                        name:
                          description: Label assigned to the port.
                          format: string
                          type: string
                        number:
                          description: A valid non-negative integer port number.
                          type: integer
                        protocol:
                          description: The protocol exposed on the port.
                          format: string
                          type: string
                        targetPort:
                          type: integer
                      type: object
                  type: object
                type: array
              outboundTrafficPolicy:
                description: Configuration for the outbound traffic policy.
                properties:
                  egressProxy:
                    properties:
                      host:
                        description: The name of a service from the service registry.
                        format: string
                        type: string
                      port:
                        description: Specifies the port on the host that is being
                          addressed.
                        properties:
                          number:
                            type: integer
                        type: object
                      subset:
                        description: The name of a subset within the service.
                        format: string
                        type: string
                    type: object
                  mode:
                    enum:
                    - REGISTRY_ONLY
                    - ALLOW_ANY
                    type: string
                type: object
              workloadSelector:
                properties:
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                type: object
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
  - name: v1beta1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting network reachability of a sidecar.
              See more details at: https://istio.io/docs/reference/config/networking/sidecar.html'
            properties:
              egress:
                items:
                  properties:
                    bind:
                      format: string
                      type: string
                    captureMode:
                      enum:
                      - DEFAULT
                      - IPTABLES
                      - NONE
                      type: string
                    hosts:
                      items:
                        format: string
                        type: string
                      type: array
                    port:
                      description: The port associated with the listener.
                      properties:
                        name:
                          description: Label assigned to the port.
                          format: string
                          type: string
                        number:
                          description: A valid non-negative integer port number.
                          type: integer
                        protocol:
                          description: The protocol exposed on the port.
                          format: string
                          type: string
                        targetPort:
                          type: integer
                      type: object
                  type: object
                type: array
              ingress:
                items:
                  properties:
                    bind:
                      description: The IP to which the listener should be bound.
                      format: string
                      type: string
                    captureMode:
                      enum:
                      - DEFAULT
                      - IPTABLES
                      - NONE
                      type: string
                    defaultEndpoint:
                      format: string
                      type: string
                    port:
                      description: The port associated with the listener.
                      properties:
                        name:
                          description: Label assigned to the port.
                          format: string
                          type: string
                        number:
                          description: A valid non-negative integer port number.
                          type: integer
                        protocol:
                          description: The protocol exposed on the port.
                          format: string
                          type: string
                        targetPort:
                          type: integer
                      type: object
                  type: object
                type: array
              outboundTrafficPolicy:
                description: Configuration for the outbound traffic policy.
                properties:
                  egressProxy:
                    properties:
                      host:
                        description: The name of a service from the service registry.
                        format: string
                        type: string
                      port:
                        description: Specifies the port on the host that is being
                          addressed.
                        properties:
                          number:
                            type: integer
                        type: object
                      subset:
                        description: The name of a subset within the service.
                        format: string
                        type: string
                    type: object
                  mode:
                    enum:
                    - REGISTRY_ONLY
                    - ALLOW_ANY
                    type: string
                type: object
              workloadSelector:
                properties:
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                type: object
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: false
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: mixer
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    istio: mixer-template
    package: template
    release: istio
  name: templates.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: template
    plural: templates
    singular: template
  scope: Namespaced
  versions:
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            type: object
            x-kubernetes-preserve-unknown-fields: true
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    release: istio
  name: virtualservices.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: VirtualService
    listKind: VirtualServiceList
    plural: virtualservices
    shortNames:
    - vs
    singular: virtualservice
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The names of gateways and sidecars that should apply these routes
      jsonPath: .spec.gateways
      name: Gateways
      type: string
    - description: The destination hosts to which traffic is being sent
      jsonPath: .spec.hosts
      name: Hosts
      type: string
    - description: 'CreationTimestamp is a timestamp representing the server time
        when this object was created. It is not guaranteed to be set in happens-before
        order across separate operations. Clients may not set this value. It is represented
        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha3
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting label/content routing, sni routing,
              etc. See more details at: https://istio.io/docs/reference/config/networking/virtual-service.html'
            properties:
              exportTo:
                description: A list of namespaces to which this virtual service is
                  exported.
                items:
                  format: string
                  type: string
                type: array
              gateways:
                description: The names of gateways and sidecars that should apply
                  these routes.
                items:
                  format: string
                  type: string
                type: array
              hosts:
                description: The destination hosts to which traffic is being sent.
                items:
                  format: string
                  type: string
                type: array
              http:
                description: An ordered list of route rules for HTTP traffic.
                items:
                  properties:
                    corsPolicy:
                      description: Cross-Origin Resource Sharing policy (CORS).
                      properties:
                        allowCredentials:
                          nullable: true
                          type: boolean
                        allowHeaders:
                          items:
                            format: string
                            type: string
                          type: array
                        allowMethods:
                          description: List of HTTP methods allowed to access the
                            resource.
                          items:
                            format: string
                            type: string
                          type: array
                        allowOrigin:
                          description: The list of origins that are allowed to perform
                            CORS requests.
                          items:
                            format: string
                            type: string
                          type: array
                        allowOrigins:
                          description: String patterns that match allowed origins.
                          items:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          type: array
                        exposeHeaders:
                          items:
                            format: string
                            type: string
                          type: array
                        maxAge:
                          type: string
                      type: object
                    delegate:
                      properties:
                        name:
                          description: Name specifies the name of the delegate VirtualService.
                          format: string
                          type: string
                        namespace:
                          description: Namespace specifies the namespace where the
                            delegate VirtualService resides.
                          format: string
                          type: string
                      type: object
                    fault:
                      description: Fault injection policy to apply on HTTP traffic
                        at the client side.
                      properties:
                        abort:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - httpStatus
                              - required:
                                - grpcStatus
                              - required:
                                - http2Error
                          - required:
                            - httpStatus
                          - required:
                            - grpcStatus
                          - required:
                            - http2Error
                          properties:
                            grpcStatus:
                              format: string
                              type: string
                            http2Error:
                              format: string
                              type: string
                            httpStatus:
                              description: HTTP status code to use to abort the Http
                                request.
                              format: int32
                              type: integer
                            percentage:
                              description: Percentage of requests to be aborted with
                                the error code provided.
                              properties:
                                value:
                                  format: double
                                  type: number
                              type: object
                          type: object
                        delay:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - fixedDelay
                              - required:
                                - exponentialDelay
                          - required:
                            - fixedDelay
                          - required:
                            - exponentialDelay
                          properties:
                            exponentialDelay:
                              type: string
                            fixedDelay:
                              description: Add a fixed delay before forwarding the
                                request.
                              type: string
                            percent:
                              description: Percentage of requests on which the delay
                                will be injected (0-100).
                              format: int32
                              type: integer
                            percentage:
                              description: Percentage of requests on which the delay
                                will be injected.
                              properties:
                                value:
                                  format: double
                                  type: number
                              type: object
                          type: object
                      type: object
                    headers:
                      properties:
                        request:
                          properties:
                            add:
                              additionalProperties:
                                format: string
                                type: string
                              type: object
                            remove:
                              items:
                                format: string
                                type: string
                              type: array
                            set:
                              additionalProperties:
                                format: string
                                type: string
                              type: object
                          type: object
                        response:
                          properties:
                            add:
                              additionalProperties:
                                format: string
                                type: string
                              type: object
                            remove:
                              items:
                                format: string
                                type: string
                              type: array
                            set:
                              additionalProperties:
                                format: string
                                type: string
                              type: object
                          type: object
                      type: object
                    match:
                      items:
                        properties:
                          authority:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          gateways:
                            description: Names of gateways where the rule should be
                              applied.
                            items:
                              format: string
                              type: string
                            type: array
                          headers:
                            additionalProperties:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - exact
                                  - required:
                                    - prefix
                                  - required:
                                    - regex
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                              properties:
                                exact:
                                  format: string
                                  type: string
                                prefix:
                                  format: string
                                  type: string
                                regex:
                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                  format: string
                                  type: string
                              type: object
                            type: object
                          ignoreUriCase:
                            description: Flag to specify whether the URI matching
                              should be case-insensitive.
                            type: boolean
                          method:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          name:
                            description: The name assigned to a match.
                            format: string
                            type: string
                          port:
                            description: Specifies the ports on the host that is being
                              addressed.
                            type: integer
                          queryParams:
                            additionalProperties:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - exact
                                  - required:
                                    - prefix
                                  - required:
                                    - regex
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                              properties:
                                exact:
                                  format: string
                                  type: string
                                prefix:
                                  format: string
                                  type: string
                                regex:
                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                  format: string
                                  type: string
                              type: object
                            description: Query parameters for matching.
                            type: object
                          scheme:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          sourceLabels:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          sourceNamespace:
                            description: Source namespace constraining the applicability
                              of a rule to workloads in that namespace.
                            format: string
                            type: string
                          uri:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          withoutHeaders:
                            additionalProperties:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - exact
                                  - required:
                                    - prefix
                                  - required:
                                    - regex
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                              properties:
                                exact:
                                  format: string
                                  type: string
                                prefix:
                                  format: string
                                  type: string
                                regex:
                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                  format: string
                                  type: string
                              type: object
                            description: withoutHeader has the same syntax with the
                              header, but has opposite meaning.
                            type: object
                        type: object
                      type: array
                    mirror:
                      properties:
                        host:
                          description: The name of a service from the service registry.
                          format: string
                          type: string
                        port:
                          description: Specifies the port on the host that is being
                            addressed.
                          properties:
                            number:
                              type: integer
                          type: object
                        subset:
                          description: The name of a subset within the service.
                          format: string
                          type: string
                      type: object
                    mirror_percent:
                      description: Percentage of the traffic to be mirrored by the
                        `mirror` field.
                      nullable: true
                      type: integer
                    mirrorPercent:
                      description: Percentage of the traffic to be mirrored by the
                        `mirror` field.
                      nullable: true
                      type: integer
                    mirrorPercentage:
                      description: Percentage of the traffic to be mirrored by the
                        `mirror` field.
                      properties:
                        value:
                          format: double
                          type: number
                      type: object
                    name:
                      description: The name assigned to the route for debugging purposes.
                      format: string
                      type: string
                    redirect:
                      description: A HTTP rule can either redirect or forward (default)
                        traffic.
                      properties:
                        authority:
                          format: string
                          type: string
                        redirectCode:
                          type: integer
                        uri:
                          format: string
                          type: string
                      type: object
                    retries:
                      description: Retry policy for HTTP requests.
                      properties:
                        attempts:
                          description: Number of retries for a given request.
                          format: int32
                          type: integer
                        perTryTimeout:
                          description: Timeout per retry attempt for a given request.
                          type: string
                        retryOn:
                          description: Specifies the conditions under which retry
                            takes place.
                          format: string
                          type: string
                        retryRemoteLocalities:
                          description: Flag to specify whether the retries should
                            retry to other localities.
                          nullable: true
                          type: boolean
                      type: object
                    rewrite:
                      description: Rewrite HTTP URIs and Authority headers.
                      properties:
                        authority:
                          description: rewrite the Authority/Host header with this
                            value.
                          format: string
                          type: string
                        uri:
                          format: string
                          type: string
                      type: object
                    route:
                      description: A HTTP rule can either redirect or forward (default)
                        traffic.
                      items:
                        properties:
                          destination:
                            properties:
                              host:
                                description: The name of a service from the service
                                  registry.
                                format: string
                                type: string
                              port:
                                description: Specifies the port on the host that is
                                  being addressed.
                                properties:
                                  number:
                                    type: integer
                                type: object
                              subset:
                                description: The name of a subset within the service.
                                format: string
                                type: string
                            type: object
                          headers:
                            properties:
                              request:
                                properties:
                                  add:
                                    additionalProperties:
                                      format: string
                                      type: string
                                    type: object
                                  remove:
                                    items:
                                      format: string
                                      type: string
                                    type: array
                                  set:
                                    additionalProperties:
                                      format: string
                                      type: string
                                    type: object
                                type: object
                              response:
                                properties:
                                  add:
                                    additionalProperties:
                                      format: string
                                      type: string
                                    type: object
                                  remove:
                                    items:
                                      format: string
                                      type: string
                                    type: array
                                  set:
                                    additionalProperties:
                                      format: string
                                      type: string
                                    type: object
                                type: object
                            type: object
                          weight:
                            format: int32
                            type: integer
                        type: object
                      type: array
                    timeout:
                      description: Timeout for HTTP requests, default is disabled.
                      type: string
                  type: object
                type: array
              tcp:
                description: An ordered list of route rules for opaque TCP traffic.
                items:
                  properties:
                    match:
                      items:
                        properties:
                          destinationSubnets:
                            description: IPv4 or IPv6 ip addresses of destination
                              with optional subnet.
                            items:
                              format: string
                              type: string
                            type: array
                          gateways:
                            description: Names of gateways where the rule should be
                              applied.
                            items:
                              format: string
                              type: string
                            type: array
                          port:
                            description: Specifies the port on the host that is being
                              addressed.
                            type: integer
                          sourceLabels:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          sourceNamespace:
                            description: Source namespace constraining the applicability
                              of a rule to workloads in that namespace.
                            format: string
                            type: string
                          sourceSubnet:
                            description: IPv4 or IPv6 ip address of source with optional
                              subnet.
                            format: string
                            type: string
                        type: object
                      type: array
                    route:
                      description: The destination to which the connection should
                        be forwarded to.
                      items:
                        properties:
                          destination:
                            properties:
                              host:
                                description: The name of a service from the service
                                  registry.
                                format: string
                                type: string
                              port:
                                description: Specifies the port on the host that is
                                  being addressed.
                                properties:
                                  number:
                                    type: integer
                                type: object
                              subset:
                                description: The name of a subset within the service.
                                format: string
                                type: string
                            type: object
                          weight:
                            format: int32
                            type: integer
                        type: object
                      type: array
                  type: object
                type: array
              tls:
                items:
                  properties:
                    match:
                      items:
                        properties:
                          destinationSubnets:
                            description: IPv4 or IPv6 ip addresses of destination
                              with optional subnet.
                            items:
                              format: string
                              type: string
                            type: array
                          gateways:
                            description: Names of gateways where the rule should be
                              applied.
                            items:
                              format: string
                              type: string
                            type: array
                          port:
                            description: Specifies the port on the host that is being
                              addressed.
                            type: integer
                          sniHosts:
                            description: SNI (server name indicator) to match on.
                            items:
                              format: string
                              type: string
                            type: array
                          sourceLabels:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          sourceNamespace:
                            description: Source namespace constraining the applicability
                              of a rule to workloads in that namespace.
                            format: string
                            type: string
                        type: object
                      type: array
                    route:
                      description: The destination to which the connection should
                        be forwarded to.
                      items:
                        properties:
                          destination:
                            properties:
                              host:
                                description: The name of a service from the service
                                  registry.
                                format: string
                                type: string
                              port:
                                description: Specifies the port on the host that is
                                  being addressed.
                                properties:
                                  number:
                                    type: integer
                                type: object
                              subset:
                                description: The name of a subset within the service.
                                format: string
                                type: string
                            type: object
                          weight:
                            format: int32
                            type: integer
                        type: object
                      type: array
                  type: object
                type: array
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
  - additionalPrinterColumns:
    - description: The names of gateways and sidecars that should apply these routes
      jsonPath: .spec.gateways
      name: Gateways
      type: string
    - description: The destination hosts to which traffic is being sent
      jsonPath: .spec.hosts
      name: Hosts
      type: string
    - description: 'CreationTimestamp is a timestamp representing the server time
        when this object was created. It is not guaranteed to be set in happens-before
        order across separate operations. Clients may not set this value. It is represented
        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1beta1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting label/content routing, sni routing,
              etc. See more details at: https://istio.io/docs/reference/config/networking/virtual-service.html'
            properties:
              exportTo:
                description: A list of namespaces to which this virtual service is
                  exported.
                items:
                  format: string
                  type: string
                type: array
              gateways:
                description: The names of gateways and sidecars that should apply
                  these routes.
                items:
                  format: string
                  type: string
                type: array
              hosts:
                description: The destination hosts to which traffic is being sent.
                items:
                  format: string
                  type: string
                type: array
              http:
                description: An ordered list of route rules for HTTP traffic.
                items:
                  properties:
                    corsPolicy:
                      description: Cross-Origin Resource Sharing policy (CORS).
                      properties:
                        allowCredentials:
                          nullable: true
                          type: boolean
                        allowHeaders:
                          items:
                            format: string
                            type: string
                          type: array
                        allowMethods:
                          description: List of HTTP methods allowed to access the
                            resource.
                          items:
                            format: string
                            type: string
                          type: array
                        allowOrigin:
                          description: The list of origins that are allowed to perform
                            CORS requests.
                          items:
                            format: string
                            type: string
                          type: array
                        allowOrigins:
                          description: String patterns that match allowed origins.
                          items:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          type: array
                        exposeHeaders:
                          items:
                            format: string
                            type: string
                          type: array
                        maxAge:
                          type: string
                      type: object
                    delegate:
                      properties:
                        name:
                          description: Name specifies the name of the delegate VirtualService.
                          format: string
                          type: string
                        namespace:
                          description: Namespace specifies the namespace where the
                            delegate VirtualService resides.
                          format: string
                          type: string
                      type: object
                    fault:
                      description: Fault injection policy to apply on HTTP traffic
                        at the client side.
                      properties:
                        abort:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - httpStatus
                              - required:
                                - grpcStatus
                              - required:
                                - http2Error
                          - required:
                            - httpStatus
                          - required:
                            - grpcStatus
                          - required:
                            - http2Error
                          properties:
                            grpcStatus:
                              format: string
                              type: string
                            http2Error:
                              format: string
                              type: string
                            httpStatus:
                              description: HTTP status code to use to abort the Http
                                request.
                              format: int32
                              type: integer
                            percentage:
                              description: Percentage of requests to be aborted with
                                the error code provided.
                              properties:
                                value:
                                  format: double
                                  type: number
                              type: object
                          type: object
                        delay:
                          oneOf:
                          - not:
                              anyOf:
                              - required:
                                - fixedDelay
                              - required:
                                - exponentialDelay
                          - required:
                            - fixedDelay
                          - required:
                            - exponentialDelay
                          properties:
                            exponentialDelay:
                              type: string
                            fixedDelay:
                              description: Add a fixed delay before forwarding the
                                request.
                              type: string
                            percent:
                              description: Percentage of requests on which the delay
                                will be injected (0-100).
                              format: int32
                              type: integer
                            percentage:
                              description: Percentage of requests on which the delay
                                will be injected.
                              properties:
                                value:
                                  format: double
                                  type: number
                              type: object
                          type: object
                      type: object
                    headers:
                      properties:
                        request:
                          properties:
                            add:
                              additionalProperties:
                                format: string
                                type: string
                              type: object
                            remove:
                              items:
                                format: string
                                type: string
                              type: array
                            set:
                              additionalProperties:
                                format: string
                                type: string
                              type: object
                          type: object
                        response:
                          properties:
                            add:
                              additionalProperties:
                                format: string
                                type: string
                              type: object
                            remove:
                              items:
                                format: string
                                type: string
                              type: array
                            set:
                              additionalProperties:
                                format: string
                                type: string
                              type: object
                          type: object
                      type: object
                    match:
                      items:
                        properties:
                          authority:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          gateways:
                            description: Names of gateways where the rule should be
                              applied.
                            items:
                              format: string
                              type: string
                            type: array
                          headers:
                            additionalProperties:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - exact
                                  - required:
                                    - prefix
                                  - required:
                                    - regex
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                              properties:
                                exact:
                                  format: string
                                  type: string
                                prefix:
                                  format: string
                                  type: string
                                regex:
                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                  format: string
                                  type: string
                              type: object
                            type: object
                          ignoreUriCase:
                            description: Flag to specify whether the URI matching
                              should be case-insensitive.
                            type: boolean
                          method:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          name:
                            description: The name assigned to a match.
                            format: string
                            type: string
                          port:
                            description: Specifies the ports on the host that is being
                              addressed.
                            type: integer
                          queryParams:
                            additionalProperties:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - exact
                                  - required:
                                    - prefix
                                  - required:
                                    - regex
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                              properties:
                                exact:
                                  format: string
                                  type: string
                                prefix:
                                  format: string
                                  type: string
                                regex:
                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                  format: string
                                  type: string
                              type: object
                            description: Query parameters for matching.
                            type: object
                          scheme:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          sourceLabels:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          sourceNamespace:
                            description: Source namespace constraining the applicability
                              of a rule to workloads in that namespace.
                            format: string
                            type: string
                          uri:
                            oneOf:
                            - not:
                                anyOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - regex
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                format: string
                                type: string
                            type: object
                          withoutHeaders:
                            additionalProperties:
                              oneOf:
                              - not:
                                  anyOf:
                                  - required:
                                    - exact
                                  - required:
                                    - prefix
                                  - required:
                                    - regex
                              - required:
                                - exact
                              - required:
                                - prefix
                              - required:
                                - regex
                              properties:
                                exact:
                                  format: string
                                  type: string
                                prefix:
                                  format: string
                                  type: string
                                regex:
                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
                                  format: string
                                  type: string
                              type: object
                            description: withoutHeader has the same syntax with the
                              header, but has opposite meaning.
                            type: object
                        type: object
                      type: array
                    mirror:
                      properties:
                        host:
                          description: The name of a service from the service registry.
                          format: string
                          type: string
                        port:
                          description: Specifies the port on the host that is being
                            addressed.
                          properties:
                            number:
                              type: integer
                          type: object
                        subset:
                          description: The name of a subset within the service.
                          format: string
                          type: string
                      type: object
                    mirror_percent:
                      description: Percentage of the traffic to be mirrored by the
                        `mirror` field.
                      nullable: true
                      type: integer
                    mirrorPercent:
                      description: Percentage of the traffic to be mirrored by the
                        `mirror` field.
                      nullable: true
                      type: integer
                    mirrorPercentage:
                      description: Percentage of the traffic to be mirrored by the
                        `mirror` field.
                      properties:
                        value:
                          format: double
                          type: number
                      type: object
                    name:
                      description: The name assigned to the route for debugging purposes.
                      format: string
                      type: string
                    redirect:
                      description: A HTTP rule can either redirect or forward (default)
                        traffic.
                      properties:
                        authority:
                          format: string
                          type: string
                        redirectCode:
                          type: integer
                        uri:
                          format: string
                          type: string
                      type: object
                    retries:
                      description: Retry policy for HTTP requests.
                      properties:
                        attempts:
                          description: Number of retries for a given request.
                          format: int32
                          type: integer
                        perTryTimeout:
                          description: Timeout per retry attempt for a given request.
                          type: string
                        retryOn:
                          description: Specifies the conditions under which retry
                            takes place.
                          format: string
                          type: string
                        retryRemoteLocalities:
                          description: Flag to specify whether the retries should
                            retry to other localities.
                          nullable: true
                          type: boolean
                      type: object
                    rewrite:
                      description: Rewrite HTTP URIs and Authority headers.
                      properties:
                        authority:
                          description: rewrite the Authority/Host header with this
                            value.
                          format: string
                          type: string
                        uri:
                          format: string
                          type: string
                      type: object
                    route:
                      description: A HTTP rule can either redirect or forward (default)
                        traffic.
                      items:
                        properties:
                          destination:
                            properties:
                              host:
                                description: The name of a service from the service
                                  registry.
                                format: string
                                type: string
                              port:
                                description: Specifies the port on the host that is
                                  being addressed.
                                properties:
                                  number:
                                    type: integer
                                type: object
                              subset:
                                description: The name of a subset within the service.
                                format: string
                                type: string
                            type: object
                          headers:
                            properties:
                              request:
                                properties:
                                  add:
                                    additionalProperties:
                                      format: string
                                      type: string
                                    type: object
                                  remove:
                                    items:
                                      format: string
                                      type: string
                                    type: array
                                  set:
                                    additionalProperties:
                                      format: string
                                      type: string
                                    type: object
                                type: object
                              response:
                                properties:
                                  add:
                                    additionalProperties:
                                      format: string
                                      type: string
                                    type: object
                                  remove:
                                    items:
                                      format: string
                                      type: string
                                    type: array
                                  set:
                                    additionalProperties:
                                      format: string
                                      type: string
                                    type: object
                                type: object
                            type: object
                          weight:
                            format: int32
                            type: integer
                        type: object
                      type: array
                    timeout:
                      description: Timeout for HTTP requests, default is disabled.
                      type: string
                  type: object
                type: array
              tcp:
                description: An ordered list of route rules for opaque TCP traffic.
                items:
                  properties:
                    match:
                      items:
                        properties:
                          destinationSubnets:
                            description: IPv4 or IPv6 ip addresses of destination
                              with optional subnet.
                            items:
                              format: string
                              type: string
                            type: array
                          gateways:
                            description: Names of gateways where the rule should be
                              applied.
                            items:
                              format: string
                              type: string
                            type: array
                          port:
                            description: Specifies the port on the host that is being
                              addressed.
                            type: integer
                          sourceLabels:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          sourceNamespace:
                            description: Source namespace constraining the applicability
                              of a rule to workloads in that namespace.
                            format: string
                            type: string
                          sourceSubnet:
                            description: IPv4 or IPv6 ip address of source with optional
                              subnet.
                            format: string
                            type: string
                        type: object
                      type: array
                    route:
                      description: The destination to which the connection should
                        be forwarded to.
                      items:
                        properties:
                          destination:
                            properties:
                              host:
                                description: The name of a service from the service
                                  registry.
                                format: string
                                type: string
                              port:
                                description: Specifies the port on the host that is
                                  being addressed.
                                properties:
                                  number:
                                    type: integer
                                type: object
                              subset:
                                description: The name of a subset within the service.
                                format: string
                                type: string
                            type: object
                          weight:
                            format: int32
                            type: integer
                        type: object
                      type: array
                  type: object
                type: array
              tls:
                items:
                  properties:
                    match:
                      items:
                        properties:
                          destinationSubnets:
                            description: IPv4 or IPv6 ip addresses of destination
                              with optional subnet.
                            items:
                              format: string
                              type: string
                            type: array
                          gateways:
                            description: Names of gateways where the rule should be
                              applied.
                            items:
                              format: string
                              type: string
                            type: array
                          port:
                            description: Specifies the port on the host that is being
                              addressed.
                            type: integer
                          sniHosts:
                            description: SNI (server name indicator) to match on.
                            items:
                              format: string
                              type: string
                            type: array
                          sourceLabels:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          sourceNamespace:
                            description: Source namespace constraining the applicability
                              of a rule to workloads in that namespace.
                            format: string
                            type: string
                        type: object
                      type: array
                    route:
                      description: The destination to which the connection should
                        be forwarded to.
                      items:
                        properties:
                          destination:
                            properties:
                              host:
                                description: The name of a service from the service
                                  registry.
                                format: string
                                type: string
                              port:
                                description: Specifies the port on the host that is
                                  being addressed.
                                properties:
                                  number:
                                    type: integer
                                type: object
                              subset:
                                description: The name of a subset within the service.
                                format: string
                                type: string
                            type: object
                          weight:
                            format: int32
                            type: integer
                        type: object
                      type: array
                  type: object
                type: array
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: false
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    helm.sh/resource-policy: keep
  labels:
    app: istio-pilot
    chart: istio
    cloudfoundry.org/istio_version: 1.7.3
    heritage: Tiller
    release: istio
  name: workloadentries.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: WorkloadEntry
    listKind: WorkloadEntryList
    plural: workloadentries
    shortNames:
    - we
    singular: workloadentry
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: 'CreationTimestamp is a timestamp representing the server time
        when this object was created. It is not guaranteed to be set in happens-before
        order across separate operations. Clients may not set this value. It is represented
        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - description: Address associated with the network endpoint.
      jsonPath: .spec.address
      name: Address
      type: string
    name: v1alpha3
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting VMs onboarded into the mesh. See
              more details at: https://istio.io/docs/reference/config/networking/workload-entry.html'
            properties:
              address:
                format: string
                type: string
              labels:
                additionalProperties:
                  format: string
                  type: string
                description: One or more labels associated with the endpoint.
                type: object
              locality:
                description: The locality associated with the endpoint.
                format: string
                type: string
              network:
                format: string
                type: string
              ports:
                additionalProperties:
                  type: integer
                description: Set of ports associated with the endpoint.
                type: object
              serviceAccount:
                format: string
                type: string
              weight:
                description: The load balancing weight associated with the endpoint.
                type: integer
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: true
    subresources:
      status: {}
  - additionalPrinterColumns:
    - description: 'CreationTimestamp is a timestamp representing the server time
        when this object was created. It is not guaranteed to be set in happens-before
        order across separate operations. Clients may not set this value. It is represented
        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - description: Address associated with the network endpoint.
      jsonPath: .spec.address
      name: Address
      type: string
    name: v1beta1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: 'Configuration affecting VMs onboarded into the mesh. See
              more details at: https://istio.io/docs/reference/config/networking/workload-entry.html'
            properties:
              address:
                format: string
                type: string
              labels:
                additionalProperties:
                  format: string
                  type: string
                description: One or more labels associated with the endpoint.
                type: object
              locality:
                description: The locality associated with the endpoint.
                format: string
                type: string
              network:
                format: string
                type: string
              ports:
                additionalProperties:
                  type: integer
                description: Set of ports associated with the endpoint.
                type: object
              serviceAccount:
                format: string
                type: string
              weight:
                description: The load balancing weight associated with the endpoint.
                type: integer
            type: object
          status:
            type: object
            x-kubernetes-preserve-unknown-fields: true
        type: object
    served: true
    storage: false
    subresources:
      status: {}
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: istio-ingressgateway
    cloudfoundry.org/istio_version: 1.7.3
    istio: ingressgateway
    release: istio
  name: istio-ingressgateway-service-account
  namespace: istio-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: istio-reader
    cloudfoundry.org/istio_version: 1.7.3
    release: istio
  name: istio-reader-service-account
  namespace: istio-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: istiod
    cloudfoundry.org/istio_version: 1.7.3
    release: istio
  name: istiod-service-account
  namespace: istio-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: istio-reader
    cloudfoundry.org/istio_version: 1.7.3
    release: istio
  name: istio-reader-istio-system
rules:
- apiGroups:
  - config.istio.io
  - security.istio.io
  - networking.istio.io
  - authentication.istio.io
  resources:
  - '*'
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - endpoints
  - pods
  - services
  - nodes
  - replicationcontrollers
  - namespaces
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - replicasets
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: istiod
    cloudfoundry.org/istio_version: 1.7.3
    release: istio
  name: istiod-istio-system
rules:
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
  - patch
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - validatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
  - update
- apiGroups:
  - config.istio.io
  - security.istio.io
  - networking.istio.io
  - authentication.istio.io
  resources:
  - '*'
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - pods
  - nodes
  - services
  - namespaces
  - endpoints
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - discovery.k8s.io
  resources:
  - endpointslices
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses
  - ingressclasses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses/status
  verbs:
  - '*'
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - create
  - get
  - list
  - watch
  - update
- apiGroups:
  - certificates.k8s.io
  resources:
  - certificatesigningrequests
  - certificatesigningrequests/approval
  - certificatesigningrequests/status
  verbs:
  - update
  - create
  - get
  - delete
  - watch
- apiGroups:
  - certificates.k8s.io
  resourceNames:
  - kubernetes.io/legacy-unknown
  resources:
  - signers
  verbs:
  - approve
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- apiGroups:
  - networking.x-k8s.io
  resources:
  - '*'
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app: istio-reader
    cloudfoundry.org/istio_version: 1.7.3
    release: istio
  name: istio-reader-istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istio-reader-istio-system
subjects:
- kind: ServiceAccount
  name: istio-reader-service-account
  namespace: istio-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app: pilot
    cloudfoundry.org/istio_version: 1.7.3
    release: istio
  name: istiod-pilot-istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istiod-istio-system
subjects:
- kind: ServiceAccount
  name: istiod-service-account
  namespace: istio-system
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  labels:
    app: istiod
    cloudfoundry.org/istio_version: 1.7.3
    istio: istiod
    release: istio
  name: istiod-istio-system
webhooks:
- admissionReviewVersions:
  - v1beta1
  - v1
  clientConfig:
    caBundle: ""
    service:
      name: istiod
      namespace: istio-system
      path: /validate
  failurePolicy: Ignore
  name: validation.istio.io
  rules:
  - apiGroups:
    - config.istio.io
    - security.istio.io
    - authentication.istio.io
    - networking.istio.io
    apiVersions:
    - '*'
    operations:
    - CREATE
    - UPDATE
    resources:
    - '*'
  sideEffects: None
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    istio.io/rev: default
  name: metadata-exchange-1.6
  namespace: istio-system
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: ANY
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.metadata_exchange
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {}
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.metadata_exchange
                runtime: envoy.wasm.runtime.null
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    istio.io/rev: default
  name: metadata-exchange-1.7
  namespace: istio-system
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_INBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.metadata_exchange
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration:
                '@type': type.googleapis.com/google.protobuf.StringValue
                value: |
                  {}
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.metadata_exchange
                runtime: envoy.wasm.runtime.null
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_OUTBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.metadata_exchange
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration:
                '@type': type.googleapis.com/google.protobuf.StringValue
                value: |
                  {}
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.metadata_exchange
                runtime: envoy.wasm.runtime.null
  - applyTo: HTTP_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.metadata_exchange
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration:
                '@type': type.googleapis.com/google.protobuf.StringValue
                value: |
                  {}
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.metadata_exchange
                runtime: envoy.wasm.runtime.null
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    istio.io/rev: default
  name: stats-filter-1.6
  namespace: istio-system
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_OUTBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio"
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_outbound
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_INBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio"
                }
              root_id: stats_inbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_inbound
  - applyTo: HTTP_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio",
                  "disable_host_header_fallback": true
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_outbound
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    istio.io/rev: default
  name: stats-filter-1.7
  namespace: istio-system
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_OUTBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration:
                '@type': type.googleapis.com/google.protobuf.StringValue
                value: |
                  {
                    "debug": "false",
                    "stat_prefix": "istio"
                  }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_outbound
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_INBOUND
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration:
                '@type': type.googleapis.com/google.protobuf.StringValue
                value: |
                  {
                    "debug": "false",
                    "stat_prefix": "istio"
                  }
              root_id: stats_inbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_inbound
  - applyTo: HTTP_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: envoy.http_connection_manager
            subFilter:
              name: envoy.router
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
          value:
            config:
              configuration:
                '@type': type.googleapis.com/google.protobuf.StringValue
                value: |
                  {
                    "debug": "false",
                    "stat_prefix": "istio",
                    "disable_host_header_fallback": true
                  }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: stats_outbound
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    istio.io/rev: default
  name: tcp-metadata-exchange-1.6
  namespace: istio-system
spec:
  configPatches:
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_INBOUND
      listener: {}
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.metadata_exchange
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
          value:
            protocol: istio-peer-exchange
  - applyTo: CLUSTER
    match:
      cluster: {}
      context: SIDECAR_OUTBOUND
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: MERGE
      value:
        filters:
        - name: istio.metadata_exchange
          typed_config:
            '@type': type.googleapis.com/udpa.type.v1.TypedStruct
            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
            value:
              protocol: istio-peer-exchange
  - applyTo: CLUSTER
    match:
      cluster: {}
      context: GATEWAY
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: MERGE
      value:
        filters:
        - name: istio.metadata_exchange
          typed_config:
            '@type': type.googleapis.com/udpa.type.v1.TypedStruct
            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
            value:
              protocol: istio-peer-exchange
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    istio.io/rev: default
  name: tcp-metadata-exchange-1.7
  namespace: istio-system
spec:
  configPatches:
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_INBOUND
      listener: {}
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.metadata_exchange
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
          value:
            protocol: istio-peer-exchange
  - applyTo: CLUSTER
    match:
      cluster: {}
      context: SIDECAR_OUTBOUND
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: MERGE
      value:
        filters:
        - name: istio.metadata_exchange
          typed_config:
            '@type': type.googleapis.com/udpa.type.v1.TypedStruct
            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
            value:
              protocol: istio-peer-exchange
  - applyTo: CLUSTER
    match:
      cluster: {}
      context: GATEWAY
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: MERGE
      value:
        filters:
        - name: istio.metadata_exchange
          typed_config:
            '@type': type.googleapis.com/udpa.type.v1.TypedStruct
            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
            value:
              protocol: istio-peer-exchange
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    istio.io/rev: default
  name: tcp-stats-filter-1.6
  namespace: istio-system
spec:
  configPatches:
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_INBOUND
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio"
                }
              root_id: stats_inbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_inbound
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_OUTBOUND
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio"
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_outbound
  - applyTo: NETWORK_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.6.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
          value:
            config:
              configuration: |
                {
                  "debug": "false",
                  "stat_prefix": "istio"
                }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_outbound
---
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    istio.io/rev: default
  name: tcp-stats-filter-1.7
  namespace: istio-system
spec:
  configPatches:
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_INBOUND
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
          value:
            config:
              configuration:
                '@type': type.googleapis.com/google.protobuf.StringValue
                value: |
                  {
                    "debug": "false",
                    "stat_prefix": "istio"
                  }
              root_id: stats_inbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_inbound
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_OUTBOUND
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
          value:
            config:
              configuration:
                '@type': type.googleapis.com/google.protobuf.StringValue
                value: |
                  {
                    "debug": "false",
                    "stat_prefix": "istio"
                  }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_outbound
  - applyTo: NETWORK_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: envoy.tcp_proxy
      proxy:
        proxyVersion: ^1\.7.*
    patch:
      operation: INSERT_BEFORE
      value:
        name: istio.stats
        typed_config:
          '@type': type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
          value:
            config:
              configuration:
                '@type': type.googleapis.com/google.protobuf.StringValue
                value: |
                  {
                    "debug": "false",
                    "stat_prefix": "istio"
                  }
              root_id: stats_outbound
              vm_config:
                code:
                  local:
                    inline_string: envoy.wasm.stats
                runtime: envoy.wasm.runtime.null
                vm_id: tcp_stats_outbound
---
apiVersion: v1
data:
  mesh: |-
    accessLogEncoding: JSON
    accessLogFile: /dev/stdout
    accessLogFormat: |-
      {
        "app_id": "%REQ(CF-APP-ID)%",
        "authority": "%REQ(:AUTHORITY)%",
        "bytes_received": "%BYTES_RECEIVED%",
        "bytes_sent": "%BYTES_SENT%",
        "downstream_local_address": "%DOWNSTREAM_LOCAL_ADDRESS%",
        "downstream_remote_address": "%DOWNSTREAM_REMOTE_ADDRESS%",
        "duration": "%DURATION%",
        "method": "%REQ(:METHOD)%",
        "organization_id": "%REQ(CF-ORGANIZATION-ID)%",
        "path": "%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%",
        "process_type": "%REQ(APP-PROCESS-TYPE)%",
        "protocol": "%PROTOCOL%",
        "referer": "%REQ(REFERER)%",
        "request_id": "%REQ(X-REQUEST-ID)%",
        "requested_server_name": "%REQUESTED_SERVER_NAME%",
        "response_code": "%RESPONSE_CODE%",
        "response_duration": "%RESPONSE_DURATION%",
        "response_flags": "%RESPONSE_FLAGS%",
        "response_tx_duration": "%RESPONSE_TX_DURATION%",
        "space_id": "%REQ(CF-SPACE-ID)%",
        "start_time": "%START_TIME%",
        "upstream_cluster": "%UPSTREAM_CLUSTER%",
        "upstream_host": "%UPSTREAM_HOST%",
        "upstream_local_address": "%UPSTREAM_LOCAL_ADDRESS%",
        "upstream_service_time": "%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%",
        "upstream_transport_failure_reason": "%UPSTREAM_TRANSPORT_FAILURE_REASON%",
        "user_agent": "%REQ(USER-AGENT)%",
        "x_b3_parentspanid": "%REQ(X-B3-PARENTSPANID)%",
        "x_b3_spanid": "%REQ(X-B3-SPANID)%",
        "x_b3_traceid": "%REQ(X-B3-TRACEID)%",
        "x_forwarded_for": "%REQ(X-FORWARDED-FOR)%",
        "x_forwarded_proto": "%REQ(X-FORWARDED-PROTO)%"
      }
    defaultConfig:
      discoveryAddress: istiod.istio-system.svc:15012
      proxyMetadata:
        DNS_AGENT: ""
      tracing:
        zipkin:
          address: zipkin.istio-system:9411
    disableMixerHttpReports: true
    enableAutoMtls: true
    enablePrometheusMerge: true
    rootNamespace: istio-system
    trustDomain: cluster.local
  meshNetworks: 'networks: {}'
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    istio.io/rev: default
    release: istio
  name: istio
  namespace: istio-system
---
apiVersion: v1
data:
  config: |-
    policy: enabled
    alwaysInjectSelector:
      []
    neverInjectSelector:
      []
    injectedAnnotations:

    template: |
      rewriteAppHTTPProbe: {{ valueOrDefault .Values.sidecarInjectorWebhook.rewriteAppHTTPProbe false }}
      initContainers:
      {{ if ne (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `NONE` }}
      {{ if .Values.istio_cni.enabled -}}
      - name: istio-validation
      {{ else -}}
      - name: istio-init
      {{ end -}}
      {{- if contains "/" .Values.global.proxy_init.image }}
        image: "{{ .Values.global.proxy_init.image }}"
      {{- else }}
        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy_init.image }}:{{ .Values.global.tag }}"
      {{- end }}
        args:
        - istio-iptables
        - "-p"
        - 15001
        - "-z"
        - "15006"
        - "-u"
        - 1337
        - "-m"
        - "{{ annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode }}"
        - "-i"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundIPRanges` .Values.global.proxy.includeIPRanges }}"
        - "-x"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundIPRanges` .Values.global.proxy.excludeIPRanges }}"
        - "-b"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` `*` }}"
        - "-d"
      {{- if excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}
        - "15090,15021,{{ excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}"
      {{- else }}
        - "15090,15021"
      {{- end }}
        {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/includeOutboundPorts`) (ne (valueOrDefault .Values.global.proxy.includeOutboundPorts "") "") -}}
        - "-q"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundPorts` .Values.global.proxy.includeOutboundPorts }}"
        {{ end -}}
        {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/excludeOutboundPorts`) (ne (valueOrDefault .Values.global.proxy.excludeOutboundPorts "") "") -}}
        - "-o"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundPorts` .Values.global.proxy.excludeOutboundPorts }}"
        {{ end -}}
        {{ if (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces`) -}}
        - "-k"
        - "{{ index .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces` }}"
        {{ end -}}
        {{ if .Values.istio_cni.enabled -}}
        - "--run-validation"
        - "--skip-rule-apply"
        {{ end -}}
        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
      {{- if .ProxyConfig.ProxyMetadata }}
        env:
        {{- range $key, $value := .ProxyConfig.ProxyMetadata }}
        - name: {{ $key }}
          value: "{{ $value }}"
        {{- end }}
      {{- end }}
      {{- if .Values.global.proxy_init.resources }}
        resources:
          {{ toYaml .Values.global.proxy_init.resources | indent 4 }}
      {{- else }}
        resources: {}
      {{- end }}
        securityContext:
          allowPrivilegeEscalation: {{ .Values.global.proxy.privileged }}
          privileged: {{ .Values.global.proxy.privileged }}
          capabilities:
        {{- if not .Values.istio_cni.enabled }}
            add:
            - NET_ADMIN
            - NET_RAW
        {{- end }}
            drop:
            - ALL
        {{- if not .Values.istio_cni.enabled }}
          readOnlyRootFilesystem: false
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
        {{- else }}
          readOnlyRootFilesystem: true
          runAsGroup: 1337
          runAsUser: 1337
          runAsNonRoot: true
        {{- end }}
        restartPolicy: Always
      {{ end -}}
      {{- if eq .Values.global.proxy.enableCoreDump true }}
      - name: enable-core-dump
        args:
        - -c
        - sysctl -w kernel.core_pattern=/var/lib/istio/data/core.proxy && ulimit -c unlimited
        command:
          - /bin/sh
      {{- if contains "/" .Values.global.proxy_init.image }}
        image: "{{ .Values.global.proxy_init.image }}"
      {{- else }}
        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy_init.image }}:{{ .Values.global.tag }}"
      {{- end }}
        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
        resources: {}
        securityContext:
          allowPrivilegeEscalation: true
          capabilities:
            add:
            - SYS_ADMIN
            drop:
            - ALL
          privileged: true
          readOnlyRootFilesystem: false
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
      {{ end }}
      containers:
      - name: istio-proxy
      {{- if contains "/" (annotation .ObjectMeta `sidecar.istio.io/proxyImage` .Values.global.proxy.image) }}
        image: "{{ annotation .ObjectMeta `sidecar.istio.io/proxyImage` .Values.global.proxy.image }}"
      {{- else }}
        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy.image }}:{{ .Values.global.tag }}"
      {{- end }}
        ports:
        - containerPort: 15090
          protocol: TCP
          name: http-envoy-prom
        args:
        - proxy
        - sidecar
        - --domain
        - $(POD_NAMESPACE).svc.{{ .Values.global.proxy.clusterDomain }}
        - --serviceCluster
        {{ if ne "" (index .ObjectMeta.Labels "app") -}}
        - "{{ index .ObjectMeta.Labels `app` }}.$(POD_NAMESPACE)"
        {{ else -}}
        - "{{ valueOrDefault .DeploymentMeta.Name `istio-proxy` }}.{{ valueOrDefault .DeploymentMeta.Namespace `default` }}"
        {{ end -}}
        - --proxyLogLevel={{ annotation .ObjectMeta `sidecar.istio.io/logLevel` .Values.global.proxy.logLevel}}
        - --proxyComponentLogLevel={{ annotation .ObjectMeta `sidecar.istio.io/componentLogLevel` .Values.global.proxy.componentLogLevel}}
      {{- if .Values.global.sts.servicePort }}
        - --stsPort={{ .Values.global.sts.servicePort }}
      {{- end }}
      {{- if .Values.global.trustDomain }}
        - --trust-domain={{ .Values.global.trustDomain }}
      {{- end }}
      {{- if .Values.global.logAsJson }}
        - --log_as_json
      {{- end }}
      {{- if gt .ProxyConfig.Concurrency.GetValue 0 }}
        - --concurrency
        - "{{ .ProxyConfig.Concurrency.GetValue }}"
      {{- end -}}
      {{- if .Values.global.proxy.lifecycle }}
        lifecycle:
          {{ toYaml .Values.global.proxy.lifecycle | indent 4 }}
      {{- else if .Values.global.proxy.holdApplicationUntilProxyStarts}}
        lifecycle:
          postStart:
            exec:
              command:
              - pilot-agent
              - wait
      {{- end }}
        env:
        - name: JWT_POLICY
          value: {{ .Values.global.jwtPolicy }}
        - name: PILOT_CERT_PROVIDER
          value: {{ .Values.global.pilotCertProvider }}
        - name: CA_ADDR
        {{- if .Values.global.caAddress }}
          value: {{ .Values.global.caAddress }}
        {{- else }}
          value: istiod{{- if not (eq .Values.revision "") }}-{{ .Values.revision }}{{- end }}.{{ .Values.global.istioNamespace }}.svc:15012
        {{- end }}
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: INSTANCE_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: SERVICE_ACCOUNT
          valueFrom:
            fieldRef:
              fieldPath: spec.serviceAccountName
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: CANONICAL_SERVICE
          valueFrom:
            fieldRef:
              fieldPath: metadata.labels['service.istio.io/canonical-name']
        - name: CANONICAL_REVISION
          valueFrom:
            fieldRef:
              fieldPath: metadata.labels['service.istio.io/canonical-revision']
        - name: PROXY_CONFIG
          value: |
                 {{ protoToJSON .ProxyConfig }}
        - name: ISTIO_META_POD_PORTS
          value: |-
            [
            {{- $first := true }}
            {{- range $index1, $c := .Spec.Containers }}
              {{- range $index2, $p := $c.Ports }}
                {{- if (structToJSON $p) }}
                {{if not $first}},{{end}}{{ structToJSON $p }}
                {{- $first = false }}
                {{- end }}
              {{- end}}
            {{- end}}
            ]
        - name: ISTIO_META_APP_CONTAINERS
          value: "{{- range $index, $container := .Spec.Containers }}{{- if ne $index 0}},{{- end}}{{ $container.Name }}{{- end}}"
        - name: ISTIO_META_CLUSTER_ID
          value: "{{ valueOrDefault .Values.global.multiCluster.clusterName `Kubernetes` }}"
        - name: ISTIO_META_INTERCEPTION_MODE
          value: "{{ or (index .ObjectMeta.Annotations `sidecar.istio.io/interceptionMode`) .ProxyConfig.InterceptionMode.String }}"
        {{- if .Values.global.network }}
        - name: ISTIO_META_NETWORK
          value: "{{ .Values.global.network }}"
        {{- end }}
        {{ if .ObjectMeta.Annotations }}
        - name: ISTIO_METAJSON_ANNOTATIONS
          value: |
                 {{ toJSON .ObjectMeta.Annotations }}
        {{ end }}
        {{- if .DeploymentMeta.Name }}
        - name: ISTIO_META_WORKLOAD_NAME
          value: {{ .DeploymentMeta.Name }}
        {{ end }}
        {{- if and .TypeMeta.APIVersion .DeploymentMeta.Name }}
        - name: ISTIO_META_OWNER
          value: kubernetes://apis/{{ .TypeMeta.APIVersion }}/namespaces/{{ valueOrDefault .DeploymentMeta.Namespace `default` }}/{{ toLower .TypeMeta.Kind}}s/{{ .DeploymentMeta.Name }}
        {{- end}}
        {{- if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
        - name: ISTIO_BOOTSTRAP_OVERRIDE
          value: "/etc/istio/custom-bootstrap/custom_bootstrap.json"
        {{- end }}
        {{- if .Values.global.meshID }}
        - name: ISTIO_META_MESH_ID
          value: "{{ .Values.global.meshID }}"
        {{- else if .Values.global.trustDomain }}
        - name: ISTIO_META_MESH_ID
          value: "{{ .Values.global.trustDomain }}"
        {{- end }}
        {{- if and (eq .Values.global.proxy.tracer "datadog") (isset .ObjectMeta.Annotations `apm.datadoghq.com/env`) }}
        {{- range $key, $value := fromJSON (index .ObjectMeta.Annotations `apm.datadoghq.com/env`) }}
        - name: {{ $key }}
          value: "{{ $value }}"
        {{- end }}
        {{- end }}
        {{- range $key, $value := .ProxyConfig.ProxyMetadata }}
        - name: {{ $key }}
          value: "{{ $value }}"
        {{- end }}
        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
        {{ if ne (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) `0` }}
        readinessProbe:
          httpGet:
            path: /healthz/ready
            port: 15021
          initialDelaySeconds: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/initialDelaySeconds` .Values.global.proxy.readinessInitialDelaySeconds }}
          periodSeconds: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/periodSeconds` .Values.global.proxy.readinessPeriodSeconds }}
          failureThreshold: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/failureThreshold` .Values.global.proxy.readinessFailureThreshold }}
        {{ end -}}
        securityContext:
          allowPrivilegeEscalation: {{ .Values.global.proxy.privileged }}
          capabilities:
            {{ if or (eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY`) (eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true`) -}}
            add:
            {{ if eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY` -}}
            - NET_ADMIN
            {{- end }}
            {{ if eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true` -}}
            - NET_BIND_SERVICE
            {{- end }}
            {{- end }}
            drop:
            - ALL
          privileged: {{ .Values.global.proxy.privileged }}
          readOnlyRootFilesystem: {{ not .Values.global.proxy.enableCoreDump }}
          runAsGroup: 1337
          fsGroup: 1337
          {{ if or (eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY`) (eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true`) -}}
          runAsNonRoot: false
          runAsUser: 0
          {{- else -}}
          runAsNonRoot: true
          runAsUser: 1337
          {{- end }}
        resources:
      {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) }}
        {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) }}
          requests:
            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) -}}
            cpu: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU` }}"
            {{ end }}
            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) -}}
            memory: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory` }}"
            {{ end }}
        {{- end }}
        {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) }}
          limits:
            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) -}}
            cpu: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit` }}"
            {{ end }}
            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) -}}
            memory: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit` }}"
            {{ end }}
        {{- end }}
      {{- else }}
        {{- if .Values.global.proxy.resources }}
          {{ toYaml .Values.global.proxy.resources | indent 4 }}
        {{- end }}
      {{- end }}
        volumeMounts:
        {{- if eq .Values.global.pilotCertProvider "istiod" }}
        - mountPath: /var/run/secrets/istio
          name: istiod-ca-cert
        {{- end }}
        - mountPath: /var/lib/istio/data
          name: istio-data
        {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
        - mountPath: /etc/istio/custom-bootstrap
          name: custom-bootstrap-volume
        {{- end }}
        # SDS channel between istioagent and Envoy
        - mountPath: /etc/istio/proxy
          name: istio-envoy
        {{- if eq .Values.global.jwtPolicy "third-party-jwt" }}
        - mountPath: /var/run/secrets/tokens
          name: istio-token
        {{- end }}
        {{- if .Values.global.mountMtlsCerts }}
        # Use the key and cert mounted to /etc/certs/ for the in-cluster mTLS communications.
        - mountPath: /etc/certs/
          name: istio-certs
          readOnly: true
        {{- end }}
        - name: istio-podinfo
          mountPath: /etc/istio/pod
         {{- if and (eq .Values.global.proxy.tracer "lightstep") .ProxyConfig.GetTracing.GetTlsSettings }}
        - mountPath: {{ directory .ProxyConfig.GetTracing.GetTlsSettings.GetCaCertificates }}
          name: lightstep-certs
          readOnly: true
        {{- end }}
          {{- if isset .ObjectMeta.Annotations `sidecar.istio.io/userVolumeMount` }}
          {{ range $index, $value := fromJSON (index .ObjectMeta.Annotations `sidecar.istio.io/userVolumeMount`) }}
        - name: "{{  $index }}"
          {{ toYaml $value | indent 4 }}
          {{ end }}
          {{- end }}
      {{- if .ProxyConfig.ProxyMetadata.ISTIO_META_DNS_CAPTURE }}
      dnsConfig:
        options:
        - name: "ndots"
          value: "4"
      {{- end }}
      volumes:
      {{- if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
      - name: custom-bootstrap-volume
        configMap:
          name: {{ annotation .ObjectMeta `sidecar.istio.io/bootstrapOverride` "" }}
      {{- end }}
      # SDS channel between istioagent and Envoy
      - emptyDir:
          medium: Memory
        name: istio-envoy
      - name: istio-data
        emptyDir: {}
      - name: istio-podinfo
        downwardAPI:
          items:
            - path: "labels"
              fieldRef:
                fieldPath: metadata.labels
            - path: "annotations"
              fieldRef:
                fieldPath: metadata.annotations
      {{- if eq .Values.global.jwtPolicy "third-party-jwt" }}
      - name: istio-token
        projected:
          sources:
          - serviceAccountToken:
              path: istio-token
              expirationSeconds: 43200
              audience: {{ .Values.global.sds.token.aud }}
      {{- end }}
      {{- if eq .Values.global.pilotCertProvider "istiod" }}
      - name: istiod-ca-cert
        configMap:
          name: istio-ca-root-cert
      {{- end }}
      {{- if .Values.global.mountMtlsCerts }}
      # Use the key and cert mounted to /etc/certs/ for the in-cluster mTLS communications.
      - name: istio-certs
        secret:
          optional: true
          {{ if eq .Spec.ServiceAccountName "" }}
          secretName: istio.default
          {{ else -}}
          secretName: {{  printf "istio.%s" .Spec.ServiceAccountName }}
          {{  end -}}
      {{- end }}
        {{- if isset .ObjectMeta.Annotations `sidecar.istio.io/userVolume` }}
        {{range $index, $value := fromJSON (index .ObjectMeta.Annotations `sidecar.istio.io/userVolume`) }}
      - name: "{{ $index }}"
        {{ toYaml $value | indent 2 }}
        {{ end }}
        {{ end }}
      {{- if and (eq .Values.global.proxy.tracer "lightstep") .ProxyConfig.GetTracing.GetTlsSettings }}
      - name: lightstep-certs
        secret:
          optional: true
          secretName: lightstep.cacert
      {{- end }}
      {{- if .Values.global.podDNSSearchNamespaces }}
      dnsConfig:
        searches:
          {{- range .Values.global.podDNSSearchNamespaces }}
          - {{ render . }}
          {{- end }}
      {{- end }}
      podRedirectAnnot:
      {{- if and (.Values.istio_cni.enabled) (not .Values.istio_cni.chained) }}
      {{ if isset .ObjectMeta.Annotations `k8s.v1.cni.cncf.io/networks` }}
        k8s.v1.cni.cncf.io/networks: "{{ index .ObjectMeta.Annotations `k8s.v1.cni.cncf.io/networks`}}, istio-cni"
      {{- else }}
        k8s.v1.cni.cncf.io/networks: "istio-cni"
      {{- end }}
      {{- end }}
        sidecar.istio.io/interceptionMode: "{{ annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode }}"
        traffic.sidecar.istio.io/includeOutboundIPRanges: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundIPRanges` .Values.global.proxy.includeIPRanges }}"
        traffic.sidecar.istio.io/excludeOutboundIPRanges: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundIPRanges` .Values.global.proxy.excludeIPRanges }}"
        traffic.sidecar.istio.io/includeInboundPorts: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` (includeInboundPorts .Spec.Containers) }}"
        traffic.sidecar.istio.io/excludeInboundPorts: "{{ excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}"
      {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/includeOutboundPorts`) (ne (valueOrDefault .Values.global.proxy.includeOutboundPorts "") "") }}
        traffic.sidecar.istio.io/includeOutboundPorts: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundPorts` .Values.global.proxy.includeOutboundPorts }}"
      {{- end }}
      {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/excludeOutboundPorts`) (ne .Values.global.proxy.excludeOutboundPorts "") }}
        traffic.sidecar.istio.io/excludeOutboundPorts: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundPorts` .Values.global.proxy.excludeOutboundPorts }}"
      {{- end }}
        traffic.sidecar.istio.io/kubevirtInterfaces: "{{ index .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces` }}"
      {{- if .Values.global.imagePullSecrets }}
      imagePullSecrets:
        {{- range .Values.global.imagePullSecrets }}
        - name: {{ . }}
        {{- end }}
      {{- end }}
  values: '{"global":{"arch":{"amd64":2,"ppc64le":2,"s390x":2},"caAddress":"","centralIstiod":false,"configValidation":true,"controlPlaneSecurityEnabled":true,"createRemoteSvcEndpoints":false,"defaultNodeSelector":{},"defaultPodDisruptionBudget":{"enabled":true},"defaultResources":{"requests":{"cpu":"10m"}},"enableHelmTest":false,"enabled":true,"hub":"gcr.io/cf-routing","imagePullPolicy":"","imagePullSecrets":[],"istioNamespace":"istio-system","istiod":{"enableAnalysis":false},"jwtPolicy":"first-party-jwt","logAsJson":false,"logging":{"level":"default:info"},"meshExpansion":{"enabled":false,"useILB":false},"meshID":"","meshNetworks":{},"mountMtlsCerts":false,"multiCluster":{"clusterName":"","enabled":false},"namespace":"istio-system","network":"","omitSidecarInjectorConfigMap":false,"oneNamespace":false,"operatorManageWebhooks":false,"pilotCertProvider":"istiod","policyNamespace":"istio-system","priorityClassName":"","proxy":{"autoInject":"enabled","clusterDomain":"cluster.local","componentLogLevel":"misc:error","enableCoreDump":false,"excludeIPRanges":"","excludeInboundPorts":"","excludeOutboundPorts":"","holdApplicationUntilProxyStarts":true,"image":"gcr.io/cf-routing/proxyv2@sha256:1cb3ad5eb354c0a3f0547cc8f5bbc18329ffcbc055a620244214244a55690f6e","includeIPRanges":"*","logLevel":"warning","privileged":false,"readinessFailureThreshold":30,"readinessInitialDelaySeconds":1,"readinessPeriodSeconds":2,"resources":{"limits":{"cpu":"2000m","memory":"1024Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"statusPort":15020,"tracer":"zipkin"},"proxy_init":{"image":"gcr.io/cf-routing/proxyv2@sha256:1cb3ad5eb354c0a3f0547cc8f5bbc18329ffcbc055a620244214244a55690f6e"},"remotePilotAddress":"","remotePolicyAddress":"","remoteTelemetryAddress":"","sds":{"token":{"aud":"istio-ca"}},"sts":{"servicePort":0},"tag":"1.7.3","telemetryNamespace":"istio-system","tracer":{"datadog":{"address":"$(HOST_IP):8126"},"lightstep":{"accessToken":"","address":""},"stackdriver":{"debug":false,"maxNumberOfAnnotations":200,"maxNumberOfAttributes":200,"maxNumberOfMessageEvents":200},"zipkin":{"address":""}},"trustDomain":"cluster.local","useMCP":false},"istio_cni":{"enabled":false},"revision":"","sidecarInjectorWebhook":{"alwaysInjectSelector":[],"enableNamespacesByDefault":false,"injectLabel":"istio-injection","injectedAnnotations":{},"neverInjectSelector":[],"objectSelector":{"autoInject":true,"enabled":false},"rewriteAppHTTPProbe":true}}'
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
    kbld.k14s.io/images: |
      - Metas:
        - Type: preresolved
          URL: gcr.io/cf-routing/proxyv2@sha256:1cb3ad5eb354c0a3f0547cc8f5bbc18329ffcbc055a620244214244a55690f6e
        URL: gcr.io/cf-routing/proxyv2@sha256:1cb3ad5eb354c0a3f0547cc8f5bbc18329ffcbc055a620244214244a55690f6e
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    istio.io/rev: default
    release: istio
  name: istio-sidecar-injector
  namespace: istio-system
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  annotations:
    kapp.k14s.io/change-group: cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
  labels:
    app: sidecar-injector
    cloudfoundry.org/istio_version: 1.7.3
    istio.io/rev: default
    release: istio
  name: istio-sidecar-injector
webhooks:
- admissionReviewVersions:
  - v1beta1
  - v1
  clientConfig:
    service:
      name: istiod
      namespace: istio-system
      path: /inject
  failurePolicy: Fail
  name: sidecar-injector.istio.io
  namespaceSelector:
    matchLabels:
      istio-injection: enabled
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - pods
  sideEffects: None
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  annotations:
    kapp.k14s.io/change-group: istio.io/ingressgateway
    kbld.k14s.io/images: |
      null
  labels:
    app: istio-ingressgateway
    cloudfoundry.org/istio_version: 1.7.3
    istio: ingressgateway
    release: istio
  name: istio-ingressgateway
  namespace: istio-system
spec:
  selector:
    matchLabels:
      app: istio-ingressgateway
      istio: ingressgateway
  template:
    metadata:
      annotations:
        prometheus.io/path: /stats/prometheus
        prometheus.io/port: "15090"
        prometheus.io/scrape: "true"
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: istio-ingressgateway
        chart: gateways
        cloudfoundry.org/istio_version: 1.7.3
        heritage: Tiller
        istio: ingressgateway
        release: istio
        service.istio.io/canonical-name: istio-ingressgateway
        service.istio.io/canonical-revision: latest
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: kubernetes.io/arch
                operator: In
                values:
                - amd64
            weight: 2
          - preference:
              matchExpressions:
              - key: kubernetes.io/arch
                operator: In
                values:
                - ppc64le
            weight: 2
          - preference:
              matchExpressions:
              - key: kubernetes.io/arch
                operator: In
                values:
                - s390x
            weight: 2
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.io/arch
                operator: In
                values:
                - amd64
                - ppc64le
                - s390x
      containers:
      - args:
        - proxy
        - router
        - --domain
        - $(POD_NAMESPACE).svc.cluster.local
        - --proxyLogLevel=warning
        - --proxyComponentLogLevel=misc:error
        - --log_output_level=default:info
        - --serviceCluster
        - istio-ingressgateway
        - --trust-domain=cluster.local
        env:
        - name: JWT_POLICY
          value: first-party-jwt
        - name: PILOT_CERT_PROVIDER
          value: istiod
        - name: CA_ADDR
          value: istiod.istio-system.svc:15012
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.nodeName
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: INSTANCE_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: SERVICE_ACCOUNT
          valueFrom:
            fieldRef:
              fieldPath: spec.serviceAccountName
        - name: CANONICAL_SERVICE
          valueFrom:
            fieldRef:
              fieldPath: metadata.labels['service.istio.io/canonical-name']
        - name: CANONICAL_REVISION
          valueFrom:
            fieldRef:
              fieldPath: metadata.labels['service.istio.io/canonical-revision']
        - name: ISTIO_META_WORKLOAD_NAME
          value: istio-ingressgateway
        - name: ISTIO_META_OWNER
          value: kubernetes://apis/apps/v1/namespaces/istio-system/deployments/istio-ingressgateway
        - name: ISTIO_META_MESH_ID
          value: cluster.local
        - name: ISTIO_META_ROUTER_MODE
          value: sni-dnat
        - name: ISTIO_META_CLUSTER_ID
          value: Kubernetes
        - name: TERMINATION_DRAIN_DURATION_SECONDS
          value: "60"
        image: gcr.io/cf-routing/proxyv2@sha256:1cb3ad5eb354c0a3f0547cc8f5bbc18329ffcbc055a620244214244a55690f6e
        lifecycle:
          preStop:
            exec:
              command:
              - /bin/bash
              - -c
              - sleep 20
        name: istio-proxy
        ports:
        - containerPort: 15021
        - containerPort: 8080
          hostPort: 80
        - containerPort: 8443
          hostPort: 443
        - containerPort: 15443
        - containerPort: 15090
          name: http-envoy-prom
          protocol: TCP
        readinessProbe:
          failureThreshold: 30
          httpGet:
            path: /healthz/ready
            port: 15021
            scheme: HTTP
          initialDelaySeconds: 1
          periodSeconds: 2
          successThreshold: 1
          timeoutSeconds: 1
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
        volumeMounts:
        - mountPath: /etc/istio/proxy
          name: istio-envoy
        - mountPath: /etc/istio/config
          name: config-volume
        - mountPath: /var/run/secrets/istio
          name: istiod-ca-cert
        - mountPath: /var/run/ingress_gateway
          name: gatewaysdsudspath
        - mountPath: /etc/istio/pod
          name: podinfo
        - mountPath: /etc/istio/ingressgateway-certs
          name: ingressgateway-certs
          readOnly: true
        - mountPath: /etc/istio/ingressgateway-ca-certs
          name: ingressgateway-ca-certs
          readOnly: true
      - image: gcr.io/cf-networking-images/cf-k8s-networking/fluentbit@sha256:636813e4dfa80d615ecba1667d2e0f94c28096010bc190e177134b46e1e03eea
        name: fluent-bit
        volumeMounts:
        - mountPath: /fluent-bit/etc
          name: fluent-bit-config
        - mountPath: /var/log
          name: varlog
        - mountPath: /var/lib/docker/containers
          name: dockercontainers
          readOnly: true
      priorityClassName: slightly-above-normal
      securityContext:
        runAsNonRoot: false
      serviceAccountName: istio-ingressgateway-service-account
      terminationGracePeriodSeconds: 80
      volumes:
      - configMap:
          name: istio-ca-root-cert
        name: istiod-ca-cert
      - downwardAPI:
          items:
          - fieldRef:
              fieldPath: metadata.labels
            path: labels
          - fieldRef:
              fieldPath: metadata.annotations
            path: annotations
        name: podinfo
      - emptyDir: {}
        name: istio-envoy
      - emptyDir: {}
        name: gatewaysdsudspath
      - configMap:
          name: istio
          optional: true
        name: config-volume
      - name: ingressgateway-certs
        secret:
          optional: true
          secretName: istio-ingressgateway-certs
      - name: ingressgateway-ca-certs
        secret:
          optional: true
          secretName: istio-ingressgateway-ca-certs
      - configMap:
          name: ingressgateway-fluent-bit-forwarder-config
        name: fluent-bit-config
      - hostPath:
          path: /var/log
        name: varlog
      - hostPath:
          path: /var/lib/docker/containers
        name: dockercontainers
  updateStrategy:
    rollingUpdate:
      maxUnavailable: 1
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      null
  labels:
    app: istiod
    cloudfoundry.org/istio_version: 1.7.3
    istio: pilot
    istio.io/rev: default
    release: istio
  name: istiod
  namespace: istio-system
spec:
  replicas: 1
  selector:
    matchLabels:
      istio: pilot
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 25%
  template:
    metadata:
      annotations:
        prometheus.io/port: "15014"
        prometheus.io/scrape: "true"
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: istiod
        cloudfoundry.org/istio_version: 1.7.3
        istio: pilot
        istio.io/rev: default
    spec:
      containers:
      - args:
        - discovery
        - --monitoringAddr=:15014
        - --log_output_level=default:info
        - --domain
        - cluster.local
        - --trust-domain=cluster.local
        - --keepaliveMaxServerConnectionAge
        - 30m
        env:
        - name: REVISION
          value: default
        - name: JWT_POLICY
          value: first-party-jwt
        - name: PILOT_CERT_PROVIDER
          value: istiod
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: SERVICE_ACCOUNT
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.serviceAccountName
        - name: KUBECONFIG
          value: /var/run/secrets/remote/config
        - name: PILOT_TRACE_SAMPLING
          value: "1"
        - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_OUTBOUND
          value: "true"
        - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_INBOUND
          value: "true"
        - name: INJECTION_WEBHOOK_CONFIG_NAME
          value: istio-sidecar-injector
        - name: ISTIOD_ADDR
          value: istiod.istio-system.svc:15012
        - name: PILOT_ENABLE_ANALYSIS
          value: "false"
        - name: CLUSTER_ID
          value: Kubernetes
        - name: CENTRAL_ISTIOD
          value: "false"
        image: gcr.io/cf-routing/pilot@sha256:dc3ae4f4a5b30828d4d92e879c698fd56d898e5755fad07fcbc1e25227062eba
        name: discovery
        ports:
        - containerPort: 8080
        - containerPort: 15010
        - containerPort: 15017
        - containerPort: 15053
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 1
          periodSeconds: 3
          timeoutSeconds: 5
        securityContext:
          capabilities:
            drop:
            - ALL
          runAsGroup: 1337
          runAsNonRoot: true
          runAsUser: 1337
        volumeMounts:
        - mountPath: /etc/istio/config
          name: config-volume
        - mountPath: /var/run/secrets/istio-dns
          name: local-certs
        - mountPath: /etc/cacerts
          name: cacerts
          readOnly: true
        - mountPath: /var/run/secrets/remote
          name: istio-kubeconfig
          readOnly: true
        - mountPath: /var/lib/istio/inject
          name: inject
          readOnly: true
      securityContext:
        fsGroup: 1337
      serviceAccountName: istiod-service-account
      volumes:
      - emptyDir:
          medium: Memory
        name: local-certs
      - name: cacerts
        secret:
          optional: true
          secretName: cacerts
      - name: istio-kubeconfig
        secret:
          optional: true
          secretName: istio-kubeconfig
      - configMap:
          name: istio-sidecar-injector
        name: inject
      - configMap:
          name: istio
        name: config-volume
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
  labels:
    app: istio-ingressgateway
    cloudfoundry.org/istio_version: 1.7.3
    istio: ingressgateway
    release: istio
  name: istio-ingressgateway
  namespace: istio-system
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: istio-ingressgateway
      istio: ingressgateway
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
  labels:
    app: istiod
    cloudfoundry.org/istio_version: 1.7.3
    istio: pilot
    istio.io/rev: default
    release: istio
  name: istiod
  namespace: istio-system
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: istiod
      istio: pilot
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    release: istio
  name: istio-ingressgateway-sds
  namespace: istio-system
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app: istiod
    cloudfoundry.org/istio_version: 1.7.3
    release: istio
  name: istiod-istio-system
  namespace: istio-system
rules:
- apiGroups:
  - networking.istio.io
  resources:
  - gateways
  verbs:
  - create
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - get
  - watch
  - list
  - update
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
    release: istio
  name: istio-ingressgateway-sds
  namespace: istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: istio-ingressgateway-sds
subjects:
- kind: ServiceAccount
  name: istio-ingressgateway-service-account
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app: pilot
    cloudfoundry.org/istio_version: 1.7.3
    release: istio
  name: istiod-istio-system
  namespace: istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: istiod-istio-system
subjects:
- kind: ServiceAccount
  name: istiod-service-account
  namespace: istio-system
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: istio-ingressgateway
    cloudfoundry.org/istio_version: 1.7.3
    istio: ingressgateway
    release: istio
  name: istio-ingressgateway
  namespace: istio-system
spec:
  externalTrafficPolicy: Local
  ports:
  - name: status-port
    port: 15021
    targetPort: 15021
  - name: http2
    port: 80
    targetPort: 8080
  - name: https
    port: 443
    targetPort: 8443
  - name: tls
    port: 15443
    targetPort: 15443
  selector:
    app: istio-ingressgateway
    istio: ingressgateway
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: istiod
    cloudfoundry.org/istio_version: 1.7.3
    istio: pilot
    istio.io/rev: default
    release: istio
  name: istiod
  namespace: istio-system
spec:
  ports:
  - name: grpc-xds
    port: 15010
  - name: https-dns
    port: 15012
  - name: https-webhook
    port: 443
    targetPort: 15017
  - name: http-monitoring
    port: 15014
  - name: dns-tls
    port: 853
    protocol: TCP
    targetPort: 15053
  selector:
    app: istiod
    istio: pilot
---
apiVersion: v1
kind: Namespace
metadata:
  labels:
    cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
    cloudfoundry.org/istio_version: 1.7.3
  name: istio-system
---
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  labels:
    cloudfoundry.org/istio_version: 1.7.3
  name: default
  namespace: istio-system
spec:
  mtls:
    mode: STRICT
---
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: fluentd-allow-plaintext
  namespace: cf-system
spec:
  mtls:
    mode: PERMISSIVE
  selector:
    matchLabels:
      app: fluentd
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: restart-workloads
  namespace: cf-workloads
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: restart-workloads
  namespace: cf-workloads
rules:
- apiGroups:
  - apps
  - extensions
  resources:
  - statefulsets
  verbs:
  - get
  - patch
  - list
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - delete
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: restart-workloads
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: restart-workloads
subjects:
- kind: ServiceAccount
  name: restart-workloads
  namespace: cf-workloads
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: restart-workloads
  namespace: istio-system
rules:
- apiGroups:
  - apps
  - extensions
  - ""
  resources:
  - daemonsets
  - pods
  - deployments
  - configmaps
  verbs:
  - get
  - patch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: restart-workloads
  namespace: istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: restart-workloads
subjects:
- kind: ServiceAccount
  name: restart-workloads
  namespace: cf-workloads
---
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  labels:
    cloudfoundry.org/istio_version: 1.7.3
  name: restart-workloads-for-istio1-7-3
  namespace: cf-workloads
spec:
  backoffLimit: 2
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - env:
        - name: ISTIO_VERSION
          value: 1.7.3
        image: gcr.io/cf-networking-images/cf-k8s-networking/upgrade-sidecars@sha256:8cef1082ec0eb1d2e2f78c9b668065ce106de775cec929c745ca0e7f20a4c8fd
        name: roll
      restartPolicy: Never
      serviceAccountName: restart-workloads
---
apiVersion: kapp.k14s.io/v1alpha1
kind: Config
metadata:
  name: kapp-config
rebaseRules:
- paths:
  - - metadata
    - annotations
  - - webhooks
    - allIndexes: true
    - rules
  - - webhooks
    - allIndexes: true
    - namespaceSelector
  - - webhooks
    - allIndexes: true
    - clientConfig
    - service
    - path
  - - webhooks
    - allIndexes: true
    - sideEffects
  - - webhooks
    - allIndexes: true
    - timeoutSeconds
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
  sources:
  - new
  - existing
  type: copy
---
apiVersion: kpack.io/v1alpha1
kind: ClusterStore
metadata:
  annotations:
    kapp.k14s.io/change-group.kpack-resources: cf-for-k8s.cloudfoundry.org/kpack-resources
    kbld.k14s.io/images: |
      null
  name: cf-buildpack-store
spec:
  sources:
  - image: gcr.io/paketo-buildpacks/ruby@sha256:aa5e88c30bfedf9e28145d1c32ae2397bf9aad8c204b4c2a98e6811a59003c7d
  - image: gcr.io/paketo-community/python@sha256:e6546f3072c49336ce99a2d8297716b748a69da9128c5afb1606c2b73a18a317
  - image: gcr.io/paketo-buildpacks/java@sha256:5e8e6a02a827a189effdc1e52772d72faacaf6ab9d71af0431a472a929704458
  - image: gcr.io/paketo-buildpacks/nodejs@sha256:5b1ce5f3093eaf9a1a210c9080f7a7539d3bdd5c98e80dba3fd77a52faf5f1e6
  - image: gcr.io/paketo-buildpacks/go@sha256:913f17254fea069c8ff8b1e47e6367dec689a7ecc497be1a30fd8f042a1daf26
  - image: gcr.io/paketo-buildpacks/dotnet-core@sha256:766c3a800cc69b80e079960dc52af3b22c71fe07dd43ba728a9b9e72fd5873d5
  - image: gcr.io/paketo-buildpacks/php@sha256:9e3d9c0c192773d559fbf232667fb2c82425240d9f36c7fbd1354a6c991b433f
  - image: gcr.io/paketo-buildpacks/procfile@sha256:bf6a4265db23ae25b34d402cd24e04c36dccdf24d6a6b9297f1d154a9d0b8062
---
apiVersion: kpack.io/v1alpha1
kind: ClusterStack
metadata:
  annotations:
    kapp.k14s.io/change-group.kpack-resources: cf-for-k8s.cloudfoundry.org/kpack-resources
    kbld.k14s.io/images: |
      null
  name: bionic-stack
spec:
  buildImage:
    image: index.docker.io/paketobuildpacks/build@sha256:ce6d02881c1adef461dd00eda7c96f401a49e781879be2cd19d2d74c0901bc95
  id: io.buildpacks.stacks.bionic
  runImage:
    image: index.docker.io/paketobuildpacks/run@sha256:6a56ff2918331ed0f3c53acd3bfa75d870ede36dfdf84a45300ebdb697d9bc84
---
apiVersion: kpack.io/v1alpha1
kind: Builder
metadata:
  annotations:
    kapp.k14s.io/change-rule.kpack-resources: upsert after upserting cf-for-k8s.cloudfoundry.org/kpack-resources
  name: cf-default-builder
  namespace: cf-workloads-staging
spec:
  order:
  - group:
    - id: paketo-buildpacks/ruby
  - group:
    - id: paketo-buildpacks/dotnet-core
    - id: paketo-buildpacks/procfile
      optional: true
  - group:
    - id: paketo-buildpacks/nodejs
    - id: paketo-buildpacks/procfile
      optional: true
  - group:
    - id: paketo-buildpacks/go
    - id: paketo-buildpacks/procfile
      optional: true
  - group:
    - id: paketo-community/python
    - id: paketo-buildpacks/procfile
      optional: true
  - group:
    - id: paketo-buildpacks/php
    - id: paketo-buildpacks/procfile
      optional: true
  - group:
    - id: paketo-buildpacks/nginx
    - id: paketo-buildpacks/procfile
      optional: true
  - group:
    - id: paketo-buildpacks/httpd
    - id: paketo-buildpacks/procfile
      optional: true
  - group:
    - id: paketo-buildpacks/java
  - group:
    - id: paketo-buildpacks/procfile
  serviceAccount: cc-kpack-registry-service-account
  stack:
    kind: ClusterStack
    name: bionic-stack
  store:
    kind: ClusterStore
    name: cf-buildpack-store
  tag: harbor.harbor.svc.cluster.local:80/library/cf-default-builder
---
apiVersion: kapp.k14s.io/v1alpha1
kind: Config
metadata:
  name: kapp-wait-rule-config
waitRules:
- conditionMatchers:
  - status: "True"
    success: true
    type: Ready
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: kpack.io/v1alpha1
      kind: ClusterStack
  - apiVersionKindMatcher:
      apiVersion: kpack.io/v1alpha1
      kind: ClusterStore
  supportsObservedGeneration: true
- conditionMatchers:
  - status: "True"
    success: true
    type: Ready
  - failure: true
    status: "False"
    type: Ready
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: kpack.io/v1alpha1
      kind: Builder
  supportsObservedGeneration: true
---
apiVersion: v1
kind: Namespace
metadata:
  labels:
    cf-for-k8s.cloudfoundry.org/kpack-ns: ""
    istio-injection: enabled
  name: kpack
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: builds.kpack.io
spec:
  additionalPrinterColumns:
  - JSONPath: .status.latestImage
    name: Image
    type: string
  - JSONPath: .status.conditions[?(@.type=="Succeeded")].status
    name: Succeeded
    type: string
  group: kpack.io
  names:
    categories:
    - kpack
    kind: Build
    plural: builds
    shortNames:
    - cnbbuild
    - cnbbuilds
    - bld
    - blds
    singular: build
  scope: Namespaced
  subresources:
    status: {}
  version: v1alpha1
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: builders.kpack.io
spec:
  additionalPrinterColumns:
  - JSONPath: .status.latestImage
    name: LatestImage
    type: string
  - JSONPath: .status.conditions[?(@.type=="Ready")].status
    name: Ready
    type: string
  group: kpack.io
  names:
    categories:
    - kpack
    kind: Builder
    plural: builders
    shortNames:
    - bldr
    - bldrs
    singular: builder
  scope: Namespaced
  subresources:
    status: {}
  version: v1alpha1
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: clusterbuilders.kpack.io
spec:
  additionalPrinterColumns:
  - JSONPath: .status.latestImage
    name: LatestImage
    type: string
  - JSONPath: .status.conditions[?(@.type=="Ready")].status
    name: Ready
    type: string
  group: kpack.io
  names:
    categories:
    - kpack
    kind: ClusterBuilder
    plural: clusterbuilders
    shortNames:
    - clstbldr
    - clstbldrs
    singular: clusterbuilder
  scope: Cluster
  subresources:
    status: {}
  version: v1alpha1
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: clusterstores.kpack.io
spec:
  additionalPrinterColumns:
  - JSONPath: .status.conditions[?(@.type=="Ready")].status
    name: Ready
    type: string
  group: kpack.io
  names:
    categories:
    - kpack
    kind: ClusterStore
    plural: clusterstores
    singular: clusterstore
  scope: Cluster
  subresources:
    status: {}
  version: v1alpha1
---
apiVersion: v1
data:
  image: gcr.io/cf-build-service-public/kpack/build-init@sha256:175c3a032bb2c50b135559e2d59e3ab7da99e36e935650e7f9a5094c1b1ba87d
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
    kbld.k14s.io/images: |
      null
  name: build-init-image
  namespace: kpack
---
apiVersion: v1
data:
  image: gcr.io/cf-build-service-public/kpack/rebase@sha256:ae21beaf8bd66062422140102c02b48ed892174d41732761e8a5ae0e828ddd2f
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
    kbld.k14s.io/images: |
      null
  name: rebase-image
  namespace: kpack
---
apiVersion: v1
data:
  image: gcr.io/cf-build-service-public/kpack/lifecycle@sha256:fee4a9b88aaec8b762ac1dceda8e745e86bce61445387538f0074017d9f1be4f
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
    kbld.k14s.io/images: |
      null
  name: lifecycle-image
  namespace: kpack
---
apiVersion: v1
data:
  image: gcr.io/cf-build-service-public/kpack/completion@sha256:bd3d01fe9bd0d466003602907a029ee6dd9a98bac85993af65f4d22368d99a0d
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
    kbld.k14s.io/images: |
      null
  name: completion-image
  namespace: kpack
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  name: kpack-controller
  namespace: kpack
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kpack-controller
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: kpack-controller
        version: 0.1.4-rc.7
    spec:
      containers:
      - env:
        - name: CONFIG_LOGGING_NAME
          value: config-logging
        - name: CONFIG_OBSERVABILITY_NAME
          value: config-observability
        - name: METRICS_DOMAIN
          value: kpack.io
        - name: SYSTEM_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: BUILD_INIT_IMAGE
          valueFrom:
            configMapKeyRef:
              key: image
              name: build-init-image
        - name: REBASE_IMAGE
          valueFrom:
            configMapKeyRef:
              key: image
              name: rebase-image
        - name: COMPLETION_IMAGE
          valueFrom:
            configMapKeyRef:
              key: image
              name: completion-image
        - name: LIFECYCLE_IMAGE
          valueFrom:
            configMapKeyRef:
              key: image
              name: lifecycle-image
        image: gcr.io/cf-build-service-public/kpack/controller@sha256:5d09cf3894be54d00ebb7233811dffd3e02a720d9f4543b861576355742f14c0
        name: controller
      nodeSelector:
        kubernetes.io/os: linux
      serviceAccountName: controller
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: controller
  namespace: kpack
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kpack-controller-admin
rules:
- apiGroups:
  - kpack.io
  resources:
  - builds
  - builds/status
  - builds/finalizers
  - images
  - images/status
  - images/finalizers
  - builders
  - builders/status
  - clusterbuilders
  - clusterbuilders/status
  - clusterstores
  - clusterstores/status
  - clusterstacks
  - clusterstacks/status
  - sourceresolvers
  - sourceresolvers/status
  verbs:
  - get
  - list
  - create
  - update
  - delete
  - patch
  - watch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  verbs:
  - get
  - list
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  - pods
  verbs:
  - get
  - list
  - create
  - update
  - delete
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kpack-controller-admin-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kpack-controller-admin
subjects:
- kind: ServiceAccount
  name: controller
  namespace: kpack
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kpack-controller-local-config
  namespace: kpack
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kpack-controller-local-config-binding
  namespace: kpack
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: kpack-controller-local-config
subjects:
- kind: ServiceAccount
  name: controller
  namespace: kpack
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: images.kpack.io
spec:
  additionalPrinterColumns:
  - JSONPath: .status.latestImage
    name: LatestImage
    type: string
  - JSONPath: .status.conditions[?(@.type=="Ready")].status
    name: Ready
    type: string
  group: kpack.io
  names:
    categories:
    - kpack
    kind: Image
    plural: images
    shortNames:
    - cnbimage
    - cnbimages
    - img
    - imgs
    singular: image
  scope: Namespaced
  subresources:
    status: {}
  version: v1alpha1
---
apiVersion: v1
kind: Service
metadata:
  name: kpack-webhook
  namespace: kpack
spec:
  ports:
  - port: 443
    targetPort: 8443
  selector:
    role: webhook
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: sourceresolvers.kpack.io
spec:
  additionalPrinterColumns:
  - JSONPath: .status.conditions[?(@.type=="Ready")].status
    name: Ready
    type: string
  group: kpack.io
  names:
    categories:
    - kpack
    kind: SourceResolver
    plural: sourceresolvers
    singular: sourceresolver
  scope: Namespaced
  subresources:
    status: {}
  version: v1alpha1
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: clusterstacks.kpack.io
spec:
  additionalPrinterColumns:
  - JSONPath: .status.conditions[?(@.type=="Ready")].status
    name: Ready
    type: string
  group: kpack.io
  names:
    categories:
    - kpack
    kind: ClusterStack
    plural: clusterstacks
    singular: clusterstack
  scope: Cluster
  subresources:
    status: {}
  version: v1alpha1
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  name: defaults.webhook.kpack.io
webhooks:
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    service:
      name: kpack-webhook
      namespace: kpack
  failurePolicy: Fail
  name: defaults.webhook.kpack.io
  sideEffects: None
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  name: validation.webhook.kpack.io
webhooks:
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    service:
      name: kpack-webhook
      namespace: kpack
  failurePolicy: Fail
  name: validation.webhook.kpack.io
  sideEffects: None
---
apiVersion: v1
kind: Secret
metadata:
  name: webhook-certs
  namespace: kpack
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  name: kpack-webhook
  namespace: kpack
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kpack-webhook
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: kpack-webhook
        role: webhook
        version: 0.1.4-rc.7
    spec:
      containers:
      - env:
        - name: CONFIG_LOGGING_NAME
          value: config-logging
        - name: CONFIG_OBSERVABILITY_NAME
          value: config-observability
        - name: METRICS_DOMAIN
          value: kpack.io
        - name: SYSTEM_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        image: gcr.io/cf-build-service-public/kpack/webhook@sha256:045d8931f374c4b17b3260b82d83a35952f5dbb29c27ef5145abcbbf4a899704
        name: webhook
        ports:
        - containerPort: 8443
          name: https-webhook
      nodeSelector:
        kubernetes.io/os: linux
      serviceAccountName: webhook
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: webhook
  namespace: kpack
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kpack-webhook-certs-admin
  namespace: kpack
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resourceNames:
  - webhook-certs
  resources:
  - secrets
  verbs:
  - update
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kpack-webhook-certs-admin-binding
  namespace: kpack
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: kpack-webhook-certs-admin
subjects:
- kind: ServiceAccount
  name: webhook
  namespace: kpack
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kpack-webhook-mutatingwebhookconfiguration-admin
rules:
- apiGroups:
  - admissionregistration.k8s.io
  resourceNames:
  - defaults.webhook.kpack.io
  resources:
  - mutatingwebhookconfigurations
  verbs:
  - update
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - admissionregistration.k8s.io
  resourceNames:
  - validation.webhook.kpack.io
  resources:
  - validatingwebhookconfigurations
  verbs:
  - update
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - validatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - storage.k8s.io
  resources:
  - storageclasses
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kpack-webhook-certs-mutatingwebhookconfiguration-admin-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kpack-webhook-mutatingwebhookconfiguration-admin
subjects:
- kind: ServiceAccount
  name: webhook
  namespace: kpack
---
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: cf-blobstore-allow-plaintext
  namespace: cf-blobstore
spec:
  mtls:
    mode: PERMISSIVE
  selector:
    matchLabels:
      app: minio
---
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: kpack-webhook-allow-plaintext
  namespace: kpack
spec:
  mtls:
    mode: PERMISSIVE
  selector:
    matchLabels:
      app: kpack-webhook
---
apiVersion: v1
kind: Service
metadata:
  name: fluentd-forwarder-ingress
  namespace: cf-system
spec:
  ports:
  - port: 24224
    protocol: TCP
  selector:
    app: fluentd
---
apiVersion: v1
data:
  aggregate_drains.conf: ""
  fluentd.conf: |
    # Inputs
    <source>
      @type forward
      tag forwarded.test
      port 24224
    </source>

    <source>
      @type tail
      @id in_tail_container_logs
      path /var/log/containers/*_cf-workloads_*.log,/var/log/containers/*_cf-workloads-staging_*.log
      exclude_path /var/log/containers/*istio*.log,/var/log/containers/*fluentd*.log
      pos_file /var/log/fluentd-containers.log.pos
      tag kubernetes.*
      refresh_interval 1
      read_from_head true
      <parse>
        @type multi_format
        <pattern>
          format json
          time_key time
          time_format %Y-%m-%dT%H:%M:%S.%NZ
        </pattern>
        <pattern>
          format /^(?<time>.+) (?<stream>stdout|stderr) [^ ]* (?<log>.*)$/
          time_format %Y-%m-%dT%H:%M:%S.%N%:z
        </pattern>
      </parse>
    </source>

    # expose metrics in prometheus format
    <source>
      @type prometheus
      bind 0.0.0.0
      port 24231
      metrics_path /metrics
    </source>

    <source>
      @type prometheus_output_monitor
      interval 10
      <labels>
        hostname ${hostname}
      </labels>
    </source>

    <filter kubernetes.**>
      @type kubernetes_metadata
      skip_container_metadata true
      skip_master_url true
      skip_namespace_metadata true
      watch false
    </filter>

    <filter kubernetes.**>
      @type record_transformer
      enable_ruby
      <record>
        app_id ${record.dig("kubernetes", "labels", "cloudfoundry_org/app_guid")}
        instance_id ${record.dig("kubernetes","pod_id")}
        structured_data \[tags@47450 source_type="${record.dig("kubernetes", "labels", "cloudfoundry_org/source_type") == "APP" ? record.dig("kubernetes", "labels", "cloudfoundry_org/source_type") + "/PROC/" + record.dig("kubernetes", "labels", "cloudfoundry_org/process_type")&.upcase : record.dig("kubernetes", "labels", "cloudfoundry_org/source_type")}"\]
      </record>
    </filter>

    <filter forwarded.**>
      @type record_transformer
      enable_ruby
      <record>
        structured_data \[tags@47450 source_type="${record.dig("source_type")}"\]
      </record>
    </filter>

    <filter **>
      @type grep
      <regexp>
        key $.app_id
        pattern /.+/
      </regexp>
    </filter>

    <match **>
      @type copy
      <store ignore_error>
        @type syslog_rfc5424
        host log-cache-syslog
        port 8082
        transport tcp
        <format>
          @type syslog_rfc5424
          proc_id_field instance_id
          app_name_field app_id
          structured_data_field structured_data
        </format>

        <buffer>
          @type memory
          flush_mode immediate
          flush_thread_count 8
        </buffer>
      </store>
      @include /fluentd/etc/aggregate_drains.conf
    </match>
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: fluentd-config
  namespace: cf-system
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  labels:
    app: fluentd
  name: fluentd
  namespace: cf-system
spec:
  selector:
    matchLabels:
      app: fluentd
  template:
    metadata:
      annotations:
        prometheus.io/path: /metrics
        prometheus.io/port: "24231"
        prometheus.io/scrape: "true"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: fluentd
    spec:
      containers:
      - env: []
        image: index.docker.io/cloudfoundry/cf-k8s-logging@sha256:c1c8fd251fd9ffbda26da394fc43e4859361e8d9810269093559749345c51bdc
        name: fluentd
        ports:
        - containerPort: 24224
        volumeMounts:
        - mountPath: /fluentd/etc
          name: fluentd-config
        - mountPath: /var/log
          name: varlog
        - mountPath: /var/vcap/store
          name: varvcapstore
        - mountPath: /var/lib/docker/containers
          name: dockercontainers
      priorityClassName: slightly-above-normal
      serviceAccountName: fluentd-service-account
      terminationGracePeriodSeconds: 30
      tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/master
      volumes:
      - configMap:
          name: fluentd-config
        name: fluentd-config
      - hostPath:
          path: /var/log
        name: varlog
      - hostPath:
          path: /var/vcap/store
        name: varvcapstore
      - hostPath:
          path: /var/lib/docker/containers
        name: dockercontainers
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  labels:
    app: log-cache-api
  name: log-cache-frontend
  namespace: cf-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app: log-cache-api
  template:
    metadata:
      annotations:
        prometheus.io/path: /metrics
        prometheus.io/port: "6065"
        prometheus.io/scrape: "true"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: log-cache-api
    spec:
      containers:
      - env:
        - name: LOG_CACHE_GATEWAY_ADDR
          value: http://localhost:8081
        - name: CAPI_ADDR
          value: http://capi.cf-system.svc.cluster.local:80
        - name: UAA_ADDR
          value: http://uaa.cf-system.svc.cluster.local:8080
        - name: PROMQL_UNIMPLEMENTED
          value: "true"
        image: index.docker.io/cloudfoundry/log-cache-cf-auth-proxy@sha256:c4cd637f31ef97958f0d521597c670ef476675af7f469e73b071a419ce79c2ac
        name: cf-auth-proxy
        ports:
        - containerPort: 8083
        readinessProbe:
          failureThreshold: 1
          httpGet:
            path: /api/v1/info
            port: 8083
          periodSeconds: 10
      - env:
        - name: LOG_CACHE_ADDR
          value: log-cache:8080
        image: index.docker.io/cloudfoundry/log-cache-gateway@sha256:de52fdff79318a3dd1cbf5f564ad9321c150042c8075a9a8da483df86ca5f92a
        name: gateway
        ports:
        - containerPort: 8081
---
apiVersion: v1
kind: Service
metadata:
  name: log-cache-api
  namespace: cf-system
spec:
  ports:
  - name: http
    port: 8083
    protocol: TCP
  selector:
    app: log-cache-api
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  labels:
    app: log-cache
  name: log-cache-backend
  namespace: cf-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app: log-cache
  template:
    metadata:
      annotations:
        prometheus.io/path: /metrics
        prometheus.io/port: "6060"
        prometheus.io/scrape: "true"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: log-cache
    spec:
      containers:
      - env:
        - name: LOG_CACHE_ADDR
          value: localhost:8080
        image: index.docker.io/cloudfoundry/syslog-server@sha256:bb1aa0d603eff716245f25c832ad9b9bca569059f48bd2b5a9a792486f453427
        name: syslog-server
        ports:
        - containerPort: 8082
      - env:
        - name: MEMORY_LIMIT_BYTES
          valueFrom:
            resourceFieldRef:
              containerName: log-cache
              resource: limits.memory
        - name: MEMORY_LIMIT_PERCENT
          value: "85"
        - name: MAX_PER_SOURCE
          value: "1000"
        image: index.docker.io/cloudfoundry/log-cache@sha256:b247b0658053bd416d18ab7e87d5b3df8d5637ad397ea71b613ab23c48b76130
        name: log-cache
---
apiVersion: v1
kind: Service
metadata:
  name: log-cache
  namespace: cf-system
spec:
  ports:
  - port: 8080
    protocol: TCP
  selector:
    app: log-cache
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: log-cache-external-virtual-service
  namespace: cf-system
spec:
  gateways:
  - cf-system/istio-ingressgateway
  hosts:
  - log-cache.vcap.me
  http:
  - route:
    - destination:
        host: log-cache-api.cf-system.svc.cluster.local
        port:
          number: 8083
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: fluentd-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: pod-namespace-read
  namespace: cf-system
rules:
- apiGroups:
  - '*'
  resources:
  - pods
  - namespaces
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: fluentd-service-account-pod-namespace-read
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: pod-namespace-read
subjects:
- kind: ServiceAccount
  name: fluentd-service-account
  namespace: cf-system
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: uaa-log-cache
  namespace: cf-system
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app: log-cache-api
  podSelector:
    matchLabels:
      app.kubernetes.io/name: uaa
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: cf-api-server-log-cache
  namespace: cf-system
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app: log-cache-api
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      app.kubernetes.io/name: cf-api-server
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: log-cache-network-policy
  namespace: cf-system
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app: log-cache-api
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app: fluentd
  podSelector:
    matchLabels:
      app: log-cache
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: log-cache-api-network-policy
  namespace: cf-system
spec:
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: uaa
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app: log-cache
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-server
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
      podSelector:
        matchLabels:
          istio: ingressgateway
  podSelector:
    matchLabels:
      app: log-cache-api
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: fluentd-network-policy
  namespace: cf-system
spec:
  egress:
  - {}
  podSelector:
    matchLabels:
      app: fluentd
  policyTypes:
  - Egress
---
apiVersion: v1
kind: Service
metadata:
  name: log-cache-syslog
  namespace: cf-system
spec:
  ports:
  - port: 8082
    protocol: TCP
  selector:
    app: log-cache
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    rbac.authorization.k8s.io/aggregate-to-admin: "true"
    rbac.authorization.k8s.io/aggregate-to-edit: "true"
    rbac.authorization.k8s.io/aggregate-to-view: "true"
  name: system:aggregated-metrics-reader
rules:
- apiGroups:
  - metrics.k8s.io
  resources:
  - pods
  - nodes
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: metrics-server:system:auth-delegator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:auth-delegator
subjects:
- kind: ServiceAccount
  name: metrics-server
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: metrics-server-auth-reader
  namespace: kube-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: extension-apiserver-authentication-reader
subjects:
- kind: ServiceAccount
  name: metrics-server
  namespace: kube-system
---
apiVersion: apiregistration.k8s.io/v1beta1
kind: APIService
metadata:
  name: v1beta1.metrics.k8s.io
spec:
  group: metrics.k8s.io
  groupPriorityMinimum: 100
  insecureSkipTLSVerify: true
  service:
    name: metrics-server
    namespace: kube-system
  version: v1beta1
  versionPriority: 100
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: metrics-server
  namespace: kube-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  labels:
    k8s-app: metrics-server
  name: metrics-server
  namespace: kube-system
spec:
  selector:
    matchLabels:
      k8s-app: metrics-server
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        k8s-app: metrics-server
      name: metrics-server
    spec:
      containers:
      - args:
        - --cert-dir=/tmp
        - --secure-port=4443
        - --kubelet-insecure-tls
        - --kubelet-preferred-address-types=InternalIP
        image: index.docker.io/oratos/metrics-server@sha256:a37da13de7b74c373e8698dee7836ce5fdbd102c3c1c8b9953a95e7f20138ab6
        imagePullPolicy: IfNotPresent
        name: metrics-server
        ports:
        - containerPort: 4443
          name: main-port
          protocol: TCP
        securityContext:
          readOnlyRootFilesystem: true
          runAsNonRoot: true
          runAsUser: 1000
        volumeMounts:
        - mountPath: /tmp
          name: tmp-dir
      nodeSelector:
        kubernetes.io/arch: amd64
        kubernetes.io/os: linux
      serviceAccountName: metrics-server
      volumes:
      - emptyDir: {}
        name: tmp-dir
---
apiVersion: v1
kind: Service
metadata:
  labels:
    kubernetes.io/cluster-service: "true"
    kubernetes.io/name: Metrics-server
  name: metrics-server
  namespace: kube-system
spec:
  ports:
  - port: 443
    protocol: TCP
    targetPort: main-port
  selector:
    k8s-app: metrics-server
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: system:metrics-server
rules:
- apiGroups:
  - ""
  resources:
  - pods
  - nodes
  - nodes/stats
  - namespaces
  - configmaps
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: system:metrics-server
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:metrics-server
subjects:
- kind: ServiceAccount
  name: metrics-server
  namespace: kube-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: metric-proxy
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: metric-proxy
  namespace: cf-system
rules:
- apiGroups:
  - '*'
  resources:
  - pods
  - namespaces
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: metric-proxy
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: metric-proxy
subjects:
- kind: ServiceAccount
  name: metric-proxy
  namespace: cf-system
---
apiVersion: v1
kind: Service
metadata:
  name: metric-proxy
  namespace: cf-system
spec:
  ports:
  - name: https
    port: 8080
    protocol: TCP
  selector:
    app: metric-proxy
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  labels:
    app: metric-proxy
  name: metric-proxy
  namespace: cf-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app: metric-proxy
  template:
    metadata:
      annotations:
        prometheus.io/path: /metrics
        prometheus.io/port: "9090"
        prometheus.io/scrape: "true"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: metric-proxy
    spec:
      containers:
      - env:
        - name: ADDR
          value: :8080
        - name: APP_SELECTOR
          value: cloudfoundry.org/guid
        - name: NAMESPACE
          value: cf-workloads
        - name: QUERY_TIMEOUT
          value: "5"
        image: index.docker.io/oratos/metric-proxy@sha256:aa06c55a4d4af904e6faa44cf776000534d9dc738554a1eff4a85279a504100e
        imagePullPolicy: Always
        name: metric-proxy
        ports:
        - containerPort: 8080
        - containerPort: 9090
      serviceAccountName: metric-proxy
---
apiVersion: v1
kind: Namespace
metadata:
  labels:
    cf-for-k8s.cloudfoundry.org/cf-blobstore-ns: ""
    istio-injection: enabled
  name: cf-blobstore
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: minio-update-prometheus-secret
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-blobstore-minio
  namespace: cf-blobstore
---
apiVersion: v1
kind: Secret
metadata:
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
stringData:
  accesskey: admin
  secretkey: 3kh9ynzp79gcfm8jvfdh
type: Opaque
---
apiVersion: v1
data:
  initialize: |-
    #!/bin/sh
    set -e ; # Have script exit in the event of a failed command.
    MC_CONFIG_DIR="/etc/minio/mc/"
    MC="/usr/bin/mc --config-dir ${MC_CONFIG_DIR}"

    # connectToMinio
    # Use a check-sleep-check loop to wait for Minio service to be available
    connectToMinio() {
      SCHEME=$1
      ATTEMPTS=0 ; LIMIT=29 ; # Allow 30 attempts
      set -e ; # fail if we can't read the keys.
      ACCESS=$(cat /config/accesskey) ; SECRET=$(cat /config/secretkey) ;
      set +e ; # The connections to minio are allowed to fail.
      echo "Connecting to Minio server: $SCHEME://$MINIO_ENDPOINT:$MINIO_PORT" ;
      MC_COMMAND="${MC} config host add myminio $SCHEME://$MINIO_ENDPOINT:$MINIO_PORT $ACCESS $SECRET" ;
      $MC_COMMAND ;
      STATUS=$? ;
      until [ $STATUS = 0 ]
      do
        ATTEMPTS=`expr $ATTEMPTS + 1` ;
        echo \"Failed attempts: $ATTEMPTS\" ;
        if [ $ATTEMPTS -gt $LIMIT ]; then
          exit 1 ;
        fi ;
        sleep 2 ; # 1 second intervals between attempts
        $MC_COMMAND ;
        STATUS=$? ;
      done ;
      set -e ; # reset `e` as active
      return 0
    }

    # checkBucketExists ($bucket)
    # Check if the bucket exists, by using the exit code of `mc ls`
    checkBucketExists() {
      BUCKET=$1
      CMD=$(${MC} ls myminio/$BUCKET > /dev/null 2>&1)
      return $?
    }

    # createBucket ($bucket, $policy, $purge)
    # Ensure bucket exists, purging if asked to
    createBucket() {
      BUCKET=$1
      POLICY=$2
      PURGE=$3

      # Purge the bucket, if set & exists
      # Since PURGE is user input, check explicitly for `true`
      if [ $PURGE = true ]; then
        if checkBucketExists $BUCKET ; then
          echo "Purging bucket '$BUCKET'."
          set +e ; # don't exit if this fails
          ${MC} rm -r --force myminio/$BUCKET
          set -e ; # reset `e` as active
        else
          echo "Bucket '$BUCKET' does not exist, skipping purge."
        fi
      fi

      # Create the bucket if it does not exist
      if ! checkBucketExists $BUCKET ; then
        echo "Creating bucket '$BUCKET'"
        ${MC} mb myminio/$BUCKET
      else
        echo "Bucket '$BUCKET' already exists."
      fi

      # At this point, the bucket should exist, skip checking for existence
      # Set policy on the bucket
      echo "Setting policy of bucket '$BUCKET' to '$POLICY'."
      ${MC} policy set $POLICY myminio/$BUCKET
    }

    # Try connecting to Minio instance
    scheme=http
    connectToMinio $scheme
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app: minio-update-prometheus-secret
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
rules:
- apiGroups:
  - ""
  resourceNames:
  - cf-blobstore-minio-prometheus
  resources:
  - secrets
  verbs:
  - get
  - create
  - update
  - patch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
- apiGroups:
  - monitoring.coreos.com
  resourceNames:
  - cf-blobstore-minio
  resources:
  - servicemonitors
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app: minio-update-prometheus-secret
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: cf-blobstore-minio-update-prometheus-secret
subjects:
- kind: ServiceAccount
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
spec:
  ports:
  - name: http
    port: 9000
    protocol: TCP
    targetPort: 9000
  selector:
    app: minio
    release: cf-blobstore
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
spec:
  selector:
    matchLabels:
      app: minio
      release: cf-blobstore
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 1
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/config: 6f2dbe8a0c3f59cb8d9e7051cd9370791c2df5ec3cbe0bad179295559a282d2f
        checksum/secrets: debfe7f1d286d311ff318bdae05da710f2c6b260e296564745e6e261a630dccb
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: minio
        release: cf-blobstore
      name: cf-blobstore-minio
    spec:
      containers:
      - command:
        - /bin/sh
        - -ce
        - /usr/bin/docker-entrypoint.sh minio -S /etc/minio/certs/ server /export
        env:
        - name: MINIO_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              key: accesskey
              name: cf-blobstore-minio
        - name: MINIO_SECRET_KEY
          valueFrom:
            secretKeyRef:
              key: secretkey
              name: cf-blobstore-minio
        - name: MINIO_API_READY_DEADLINE
          value: 5s
        image: index.docker.io/minio/minio@sha256:35d654988af3b5761162d5ce06243c1517ec34beeae271c8b5983b5082968858
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 1
          httpGet:
            path: /minio/health/live
            port: http
            scheme: HTTP
          initialDelaySeconds: 5
          periodSeconds: 5
          successThreshold: 1
          timeoutSeconds: 1
        name: minio
        ports:
        - containerPort: 9000
          name: http
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /minio/health/ready
            port: http
          initialDelaySeconds: 30
          periodSeconds: 5
          successThreshold: 1
          timeoutSeconds: 6
        volumeMounts:
        - mountPath: /export
          name: export
      securityContext:
        fsGroup: 1000
        runAsGroup: 1000
        runAsUser: 1000
      serviceAccountName: cf-blobstore-minio
      volumes:
      - name: export
        persistentVolumeClaim:
          claimName: cf-blobstore-minio
      - name: minio-user
        secret:
          secretName: cf-blobstore-minio
---
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: default-allow-all
  namespace: cf-system
spec:
  rules:
  - {}
---
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: cf-api-server
  namespace: cf-system
spec:
  action: DENY
  rules:
  - from:
    - source:
        notPrincipals:
        - cluster.local/ns/cf-system/sa/opi
        - cluster.local/ns/cf-system/sa/eirini-events
        - cluster.local/ns/cf-system/sa/eirini-task-reporter
    to:
    - operation:
        paths:
        - /internal*
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-server
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-ingress
  namespace: cf-system
spec:
  podSelector: {}
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-ingress
  namespace: cf-db
spec:
  podSelector: {}
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-ingress
  namespace: cf-blobstore
spec:
  podSelector: {}
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: only-allow-istio-control-plane
  namespace: cf-system
spec:
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: only-allow-istio-control-plane
  namespace: cf-db
spec:
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: only-allow-istio-control-plane
  namespace: cf-blobstore
spec:
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns-egress
  namespace: cf-system
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
    to:
    - namespaceSelector: {}
  podSelector: {}
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns-egress
  namespace: cf-db
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
    to:
    - namespaceSelector: {}
  podSelector: {}
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns-egress
  namespace: cf-blobstore
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
    to:
    - namespaceSelector: {}
  podSelector: {}
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: cf-db
  namespace: cf-db
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          job-name: ccdb-migrate
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-worker
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-clock
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-server
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-deployment-updater
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: uaa
  podSelector:
    matchLabels:
      release: cf-db
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: uaa
  namespace: cf-system
spec:
  egress:
  - {}
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
      podSelector:
        matchLabels:
          istio: ingressgateway
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-server
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-controllers
  podSelector:
    matchLabels:
      app.kubernetes.io/name: uaa
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: cf-api-server
  namespace: cf-system
spec:
  egress:
  - {}
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
      podSelector:
        matchLabels:
          istio: ingressgateway
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-controllers
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          name: eirini
    ports:
    - port: 80
      protocol: TCP
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          name: eirini
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          name: eirini-task-reporter
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          name: eirini-events
    ports:
    - port: 9023
      protocol: TCP
  podSelector:
    matchLabels:
      app.kubernetes.io/name: cf-api-server
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: cf-api-deployment-updater-eirini
  namespace: cf-system
spec:
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          name: eirini
  podSelector:
    matchLabels:
      app.kubernetes.io/name: cf-api-deployment-updater
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: cf-api-deployment-updater
  namespace: cf-system
spec:
  egress:
  - ports:
    - port: 5432
      protocol: TCP
    - port: 5432
      protocol: TCP
    to:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-db-ns: ""
      podSelector:
        matchLabels:
          release: cf-db
  podSelector:
    matchLabels:
      app.kubernetes.io/name: cf-api-deployment-updater
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: cf-api-clock-eirini
  namespace: cf-system
spec:
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          name: eirini
  podSelector:
    matchLabels:
      app.kubernetes.io/name: cf-api-clock
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: cf-api-clock
  namespace: cf-system
spec:
  egress:
  - ports:
    - port: 5432
      protocol: TCP
    - port: 5432
      protocol: TCP
    to:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-db-ns: ""
      podSelector:
        matchLabels:
          release: cf-db
  podSelector:
    matchLabels:
      app.kubernetes.io/name: cf-api-clock
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: cf-api-worker
  namespace: cf-system
spec:
  egress:
  - {}
  podSelector:
    matchLabels:
      app.kubernetes.io/name: cf-api-worker
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: ccdb-migrate
  namespace: cf-system
spec:
  egress:
  - ports:
    - port: 5432
      protocol: TCP
    - port: 5432
      protocol: TCP
    to:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-db-ns: ""
      podSelector:
        matchLabels:
          release: cf-db
  podSelector:
    matchLabels:
      job-name: ccdb-migrate
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: cf-blobstore-minio
  namespace: cf-blobstore
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
      podSelector:
        matchLabels:
          istio: ingressgateway
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-workloads-staging-ns: ""
      podSelector:
        matchLabels:
          cloudfoundry.org/source_type: STG
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-server
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-worker
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-deployment-updater
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-clock
  podSelector:
    matchLabels:
      release: cf-blobstore
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: eirini
  namespace: cf-system
spec:
  egress:
  - {}
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-deployment-updater
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-clock
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-worker
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-server
  podSelector:
    matchLabels:
      name: eirini
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: eirini-events
  namespace: cf-system
spec:
  egress:
  - {}
  podSelector:
    matchLabels:
      name: eirini-events
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: eirini-task-reporter
  namespace: cf-system
spec:
  egress:
  - {}
  podSelector:
    matchLabels:
      name: eirini-task-reporter
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: eirini-controller
  namespace: cf-system
spec:
  egress:
  - {}
  podSelector:
    matchLabels:
      name: eirini-controller
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: eirini-instance-index-env-injector
  namespace: cf-system
spec:
  egress:
  - {}
  ingress:
  - {}
  podSelector:
    matchLabels:
      name: instance-index-env-injector
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: cf-api-controllers
  namespace: cf-system
spec:
  egress:
  - {}
  podSelector:
    matchLabels:
      app.kubernetes.io/name: cf-api-controllers
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: routecontroller
  namespace: cf-system
spec:
  egress:
  - {}
  podSelector:
    matchLabels:
      app: routecontroller
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: metric-proxy
  namespace: cf-system
spec:
  egress:
  - {}
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-server
  podSelector:
    matchLabels:
      app: metric-proxy
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: fluentd
  namespace: cf-system
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-server
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-worker
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-clock
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
      podSelector:
        matchLabels:
          app.kubernetes.io/name: cf-api-deployment-updater
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
      podSelector:
        matchLabels:
          istio: ingressgateway
  podSelector:
    matchLabels:
      app: fluentd
  policyTypes:
  - Ingress
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.2.4
  creationTimestamp: null
  name: routes.networking.cloudfoundry.org
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.url
    name: URL
    type: string
  - JSONPath: .metadata.creationTimestamp
    name: Age
    type: date
  group: networking.cloudfoundry.org
  names:
    kind: Route
    listKind: RouteList
    plural: routes
    singular: route
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      description: Route is the Schema for the routes API
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation
            of an object. Servers should convert recognized schemas to the latest
            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this
            object represents. Servers may infer this from the endpoint the client
            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: RouteSpec defines the desired state of Route
          properties:
            destinations:
              items:
                properties:
                  app:
                    properties:
                      guid:
                        type: string
                      process:
                        properties:
                          type:
                            type: string
                        required:
                        - type
                        type: object
                    required:
                    - guid
                    - process
                    type: object
                  guid:
                    type: string
                  port:
                    type: integer
                  selector:
                    properties:
                      matchLabels:
                        additionalProperties:
                          type: string
                        type: object
                    required:
                    - matchLabels
                    type: object
                  weight:
                    type: integer
                required:
                - app
                - guid
                - port
                - selector
                type: object
              type: array
            domain:
              properties:
                internal:
                  type: boolean
                name:
                  type: string
              required:
              - internal
              - name
              type: object
            host:
              type: string
            path:
              type: string
            url:
              type: string
          required:
          - destinations
          - domain
          - host
          - url
          type: object
        status:
          description: RouteStatus defines the observed state of Route
          properties:
            conditions:
              items:
                properties:
                  status:
                    type: boolean
                  type:
                    type: string
                required:
                - status
                - type
                type: object
              type: array
          required:
          - conditions
          type: object
      type: object
  version: v1alpha1
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations:
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
  labels:
    app.kubernetes.io/component: cf-networking
    app.kubernetes.io/name: routecontroller
    app.kubernetes.io/part-of: cloudfoundry
  name: routecontroller
  namespace: cf-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: routecontroller
subjects:
- kind: ServiceAccount
  name: routecontroller
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
  labels:
    app.kubernetes.io/component: cf-networking
    app.kubernetes.io/name: routecontroller
    app.kubernetes.io/part-of: cloudfoundry
  name: routecontroller
  namespace: cf-system
rules:
- apiGroups:
  - networking.cloudfoundry.org
  resources:
  - routes
  - routes/status
  verbs:
  - create
  - delete
  - get
  - update
  - list
  - watch
- apiGroups:
  - networking.istio.io
  resources:
  - virtualservices
  verbs:
  - create
  - delete
  - get
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - create
  - delete
  - get
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - create
  - delete
  - get
  - update
---
apiVersion: v1
data:
  ISTIO_GATEWAY_NAME: cf-system/istio-ingressgateway
  RESYNC_INTERVAL: "900"
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
    kapp.k14s.io/num-versions: "2"
    kapp.k14s.io/versioned: ""
  labels:
    app.kubernetes.io/component: cf-networking
    app.kubernetes.io/name: routecontroller-config
    app.kubernetes.io/part-of: cloudfoundry
  name: routecontroller-config
  namespace: cf-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  labels:
    app: routecontroller
    app.kubernetes.io/component: cf-networking
    app.kubernetes.io/name: routecontroller
    app.kubernetes.io/part-of: cloudfoundry
  name: routecontroller
  namespace: cf-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app: routecontroller
  template:
    metadata:
      annotations:
        prometheus.io/path: /metrics
        prometheus.io/port: "8080"
        prometheus.io/scrape: "true"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: routecontroller
        app.kubernetes.io/component: cf-networking
        app.kubernetes.io/name: routecontroller
        app.kubernetes.io/part-of: cloudfoundry
      namespace: cf-system
    spec:
      containers:
      - args:
        - --enable-leader-election=true
        envFrom:
        - configMapRef:
            name: routecontroller-config
        image: gcr.io/cf-networking-images/cf-k8s-networking/routecontroller@sha256:4b65f377a956f2f427809295aac6b5a6ec03db4c5977570e70173c8064d8deb8
        name: routecontroller
      serviceAccountName: routecontroller
      terminationGracePeriodSeconds: 10
---
apiVersion: v1
kind: ServiceAccount
metadata:
  annotations:
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
  labels:
    app.kubernetes.io/component: cf-networking
    app.kubernetes.io/name: routecontroller
    app.kubernetes.io/part-of: cloudfoundry
  name: routecontroller
  namespace: cf-system
---
apiVersion: v1
kind: Namespace
metadata:
  labels:
    cf-for-k8s.cloudfoundry.org/cf-db-ns: ""
    istio-injection: enabled
  name: cf-db
---
apiVersion: v1
kind: Secret
metadata:
  name: cf-db-admin-secret
  namespace: cf-db
stringData:
  postgresql-password: nvuurf4z1drv9ftcf77x
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: cf-db-credentials
  namespace: cf-db
stringData:
  ccdb-password: g7vfkc8qani1aq8b4hqv
  ccdb-username: cloud_controller
  uaadb-password: hrhr7uxbx4uv3w8cjd9q
  uaadb-username: uaa
---
apiVersion: v1
data:
  init.sh: |
    #!/bin/bash
    CCDB_USERNAME=$(cat /docker-entrypoint-initdb.d/secret/ccdb-username)
    CCDB_PASSWORD=$(cat /docker-entrypoint-initdb.d/secret/ccdb-password)
    UAADB_USERNAME=$(cat /docker-entrypoint-initdb.d/secret/uaadb-username)
    UAADB_PASSWORD=$(cat /docker-entrypoint-initdb.d/secret/uaadb-password)
    cat > /tmp/setup_db.sql <<EOT
    CREATE DATABASE cloud_controller;
    CREATE ROLE ${CCDB_USERNAME} LOGIN PASSWORD '${CCDB_PASSWORD}';
    CREATE DATABASE uaa;
    CREATE ROLE ${UAADB_USERNAME} LOGIN PASSWORD '${UAADB_PASSWORD}';
    EOT
    psql -U postgres -f /tmp/setup_db.sql
    psql -U postgres -d cloud_controller -c "CREATE EXTENSION citext"
    psql -U postgres -d uaa -c "CREATE EXTENSION citext"
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql-init-scripts
  namespace: cf-db
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql-headless
  namespace: cf-db
spec:
  clusterIP: None
  ports:
  - name: tcp-postgresql
    port: 5432
    targetPort: tcp-postgresql
  selector:
    app: postgresql
    release: cf-db
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql
  namespace: cf-db
spec:
  ports:
  - name: tcp-postgresql
    port: 5432
    targetPort: tcp-postgresql
  selector:
    app: postgresql
    release: cf-db
    role: master
  type: ClusterIP
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  annotations:
    kapp.k14s.io/change-group.cf-db-postgresql: cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql
  namespace: cf-db
spec:
  replicas: 1
  selector:
    matchLabels:
      app: postgresql
      release: cf-db
      role: master
  serviceName: cf-db-postgresql-headless
  template:
    metadata:
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: postgresql
        chart: postgresql-8.10.6
        heritage: Helm
        release: cf-db
        role: master
      name: cf-db-postgresql
    spec:
      containers:
      - env:
        - name: BITNAMI_DEBUG
          value: "false"
        - name: POSTGRESQL_PORT_NUMBER
          value: "5432"
        - name: POSTGRESQL_VOLUME_DIR
          value: /bitnami/postgresql
        - name: PGDATA
          value: /bitnami/postgresql/data
        - name: POSTGRES_USER
          value: postgres
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              key: postgresql-password
              name: cf-db-admin-secret
        - name: POSTGRESQL_ENABLE_LDAP
          value: "no"
        image: index.docker.io/bitnami/postgresql@sha256:0f76a419cfd9996036e3a53672f50cf69ed7699f1241cbf8e20af17bbbdf0683
        imagePullPolicy: IfNotPresent
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - exec pg_isready -U "postgres" -h 127.0.0.1 -p 5432
          failureThreshold: 6
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        name: cf-db-postgresql
        ports:
        - containerPort: 5432
          name: tcp-postgresql
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - -e
            - |
              exec pg_isready -U "postgres" -h 127.0.0.1 -p 5432
              [ -f /opt/bitnami/postgresql/tmp/.initialized ] || [ -f /bitnami/postgresql/.initialized ]
          failureThreshold: 6
          initialDelaySeconds: 5
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        securityContext:
          runAsUser: 1001
        volumeMounts:
        - mountPath: /docker-entrypoint-initdb.d/
          name: custom-init-scripts
        - mountPath: /docker-entrypoint-initdb.d/secret
          name: custom-init-scripts-secret
        - mountPath: /dev/shm
          name: dshm
        - mountPath: /bitnami/postgresql
          name: data
          subPath: null
      securityContext:
        fsGroup: 1001
      volumes:
      - configMap:
          name: cf-db-postgresql-init-scripts
        name: custom-init-scripts
      - name: custom-init-scripts-secret
        secret:
          secretName: cf-db-credentials
      - emptyDir:
          medium: Memory
          sizeLimit: 1Gi
        name: dshm
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 8Gi
---
apiVersion: scheduling.k8s.io/v1
description: Useful for DaemonSets which don't really have higher priority but should
  move other pods to other nodes
kind: PriorityClass
metadata:
  name: slightly-above-normal
value: 1
---
apiVersion: v1
kind: Namespace
metadata:
  labels:
    cf-for-k8s.cloudfoundry.org/cf-system-ns: ""
    istio-injection: enabled
  name: cf-system
---
apiVersion: v1
data:
  log4j2.properties: |-
    status = error
    dest = err
    name = UaaLog

    property.log_pattern=[%d{yyyy-MM-dd HH:mm:ss.SSS}] uaa%X{context} - %pid [%t] .... %5p --- %c{1}: %replace{%m}{(?<=password=|client_secret=)([^&]*)}{<redacted>}%n

    appender.uaaDefaultAppender.type = Console
    appender.uaaDefaultAppender.name = UaaDefaultAppender
    appender.uaaDefaultAppender.layout.type = PatternLayout
    appender.uaaDefaultAppender.layout.pattern = [UAA] ${log_pattern}

    appender.uaaAuditAppender.type = Console
    appender.uaaAuditAppender.name = UaaAuditAppender
    appender.uaaAuditAppender.layout.type = PatternLayout
    appender.uaaAuditAppender.layout.pattern = [UAA_AUDIT] ${log_pattern}

    rootLogger.level = info
    rootLogger.appenderRef.uaaDefaultAppender.ref = UaaDefaultAppender

    logger.UAAAudit.name = UAA.Audit
    logger.UAAAudit.level = info
    logger.UAAAudit.additivity = true
    logger.UAAAudit.appenderRef.auditEventLog.ref = UaaAuditAppender

    logger.cfIdentity.name = org.cloudfoundry.identity
    logger.cfIdentity.level = info
    logger.cfIdentity.additivity = false
    logger.cfIdentity.appenderRef.uaaDefaultAppender.ref = UaaDefaultAppender
  uaa.yml: |
    issuer:
      uri: https://uaa.vcap.me
    database:
      maxactive: 100
      maxidle: 10
      minidle: 0
      removeabandoned: false
      logabandoned: true
      abandonedtimeout: 300
      url: jdbc:postgresql://cf-db-postgresql.cf-db.svc.cluster.local:5432/uaa?sslmode=disable
    smtp:
      host: null
      port: 25
      starttls: null
      from_address: null
    oauth:
      client:
        override: true
      clients:
        admin:
          authorized-grant-types: client_credentials
          authorities: clients.read,clients.write,clients.secret,uaa.admin,scim.read,scim.write,password.write,openid
          autoapprove:
          - openid
          id: admin
        cf:
          id: cf
          override: true
          authorized-grant-types: password,refresh_token
          scope: cloud_controller.read,cloud_controller.write,openid,password.write,cloud_controller.admin,scim.read,scim.write,doppler.firehose,uaa.user,routing.router_groups.read,routing.router_groups.write
          authorities: uaa.none
          access-token-validity: 600
          refresh-token-validity: 2592000
          secret: ""
        cloud_controller_username_lookup:
          authorities: scim.userids
          authorized-grant-types: client_credentials
        cf_api_controllers:
          authorities: cloud_controller.write,cloud_controller.read,cloud_controller.update_build_state,cloud_controller.admin_read_only
          authorized-grant-types: client_credentials
        cf_api_backup_metadata_generator:
          authorities: cloud_controller.read,cloud_controller.admin_read_only
          authorized-grant-types: client_credentials
      user:
        authorities:
        - openid
        - scim.me
        - scim.userids
        - cloud_controller.read
        - cloud_controller.write
        - cloud_controller_service_permissions.read
        - password.write
        - uaa.user
        - approvals.me
        - oauth.approvals
        - profile
        - roles
        - user_attributes
        - uaa.offline_token
    scim:
      userids_enabled: true
      user:
        override: true
      groups:
        zones.read: Read identity zones
        zones.write: Create and update identity zones
        idps.read: Retrieve identity providers
        idps.write: Create and update identity providers
        clients.admin: Create, modify and delete OAuth clients
        clients.write: Create and modify OAuth clients
        clients.read: Read information about OAuth clients
        clients.secret: Change the password of an OAuth client
        scim.write: Create, modify and delete SCIM entities, i.e. users and groups
        scim.read: Read all SCIM entities, i.e. users and groups
        scim.create: Create users
        scim.userids: Read user IDs and retrieve users by ID
        scim.zones: Control a user's ability to manage a zone
        scim.invite: Send invitations to users
        password.write: Change your password
        oauth.approval: Manage approved scopes
        oauth.login: Authenticate users outside of the UAA
        openid: Access profile information, i.e. email, first and last name, and phone number
        groups.update: Update group information and memberships
        uaa.user: Act as a user in the UAA
        uaa.resource: Serve resources protected by the UAA
        uaa.admin: Act as an administrator throughout the UAA
        uaa.none: Forbid acting as a user
        uaa.offline_token: Allow offline access
    zones:
      internal:
        hostnames:
        - uaa.cf-system.svc.cluster.local
    login:
      url: https://login.vcap.me
      entityBaseURL: https://uaa.vcap.me
      entityID: cloudfoundry-saml-login
    uaa:
      url: https://uaa.vcap.me
      token:
        url: https://uaa.vcap.me/oauth/token
      approvals:
        url: https://uaa.vcap.me/approvals
      login:
        url: https://uaa.vcap.me/authenticate
      limitedFunctionality:
        enabled: false
        whitelist:
          endpoints:
          - /oauth/authorize/**
          - /oauth/token/**
          - /check_token/**
          - /login/**
          - /login.do
          - /logout/**
          - /logout.do
          - /saml/**
          - /autologin/**
          - /authenticate/**
          - /idp_discovery/**
          methods:
          - GET
          - HEAD
          - OPTIONS
kind: ConfigMap
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  labels:
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: uaa
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/version: 74.12.0
  name: uaa-config
  namespace: cf-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kbld.k14s.io/images: |
      null
  labels:
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: uaa
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/version: 74.12.0
  name: uaa
  namespace: cf-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app: uaa-deployment
  template:
    metadata:
      annotations:
        prometheus.io/path: /metrics
        prometheus.io/port: "9102"
        prometheus.io/scrape: "true"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: uaa-deployment
        app.kubernetes.io/component: authorization_server
        app.kubernetes.io/instance: uaa-standalone
        app.kubernetes.io/managed-by: kubectl
        app.kubernetes.io/name: uaa
        app.kubernetes.io/part-of: uaa
        app.kubernetes.io/version: 74.12.0
      namespace: cf-system
    spec:
      containers:
      - env:
        - name: BPL_TOMCAT_ACCESS_LOGGING
          value: "y"
        - name: JAVA_OPTS
          value: -Dspring_profiles=postgresql -Djava.security.egd=file:/dev/./urandom
            -Dlogging.config=/etc/config/log4j2.properties -Dlog4j.configurationFile=/etc/config/log4j2.properties
            -DCLOUDFOUNDRY_CONFIG_PATH=/etc/config -DSECRETS_DIR=/etc/secrets -Djavax.net.ssl.trustStore=/etc/truststore/uaa.pkcs12.truststore
            -Djavax.net.ssl.trustStoreType=PKCS12 -Djavax.net.ssl.trustStorePassword=changeit
            -Dstatsd.enabled=true -Dservlet.session-store=database
        image: index.docker.io/cfidentity/uaa@sha256:a721dc416a900745099469920573b076728856f83acad9bee6f2c47d0625be70
        name: uaa
        ports:
        - containerPort: 8080
          name: http-uaa
          protocol: TCP
        volumeMounts:
        - mountPath: /etc/config
          name: uaa-config
        - mountPath: /etc/secrets/smtp_credentials.yml
          name: smtp-credentials-file
          readOnly: true
          subPath: smtp_credentials.yml
        - mountPath: /etc/secrets/database_credentials.yml
          name: database-credentials-file
          readOnly: true
          subPath: database_credentials.yml
        - mountPath: /etc/secrets/admin_client_credentials.yml
          name: admin-client-credentials-file
          readOnly: true
          subPath: admin_client_credentials.yml
        - mountPath: /etc/secrets/jwt_policy_signing_keys.yml
          name: jwt-policy-signing-keys-file
          readOnly: true
          subPath: jwt_policy_signing_keys.yml
        - mountPath: /etc/truststore
          name: truststore-file
          readOnly: true
        - mountPath: /etc/secrets/saml_keys.yml
          name: saml-keys-file
          readOnly: true
          subPath: saml_keys.yml
        - mountPath: /etc/secrets/encryption_keys.yml
          name: encryption-keys-file
          readOnly: true
          subPath: encryption_keys.yml
        - mountPath: /etc/secrets/cf_admin_user_credentials.yml
          name: cf-admin-user-credentials-file
          readOnly: true
          subPath: cf_admin_user_credentials.yml
        - mountPath: /etc/secrets/cf_client_credentials.yml
          name: cc-admin-client-credentials-file
          readOnly: true
          subPath: client_credentials.yml
        - mountPath: /etc/secrets/cloud_controller_username_lookup_client_credentials.yml
          name: cloud-controller-username-lookup-client-credentials-file
          readOnly: true
          subPath: client_credentials.yml
        - mountPath: /etc/secrets/cf_api_controllers_client_credentials.yml
          name: cf-api-controllers-client-credentials-file
          readOnly: true
          subPath: client_credentials.yml
        - mountPath: /etc/secrets/cf_api_backup_metadata_generator_client_credentials.yml
          name: cf-api-backup-metadata-generator-client-credentials-file
          readOnly: true
          subPath: client_credentials.yml
      - args:
        - --statsd.listen-udp=:8125
        image: index.docker.io/cloudfoundry/statsd_exporter@sha256:10a64dc4ad0a3e3fe88372f0481dea5c02595c38d168617836a99a649d3ac407
        imagePullPolicy: Always
        name: statsd-exporter
        ports:
        - containerPort: 9102
          name: metrics-uaa
          protocol: TCP
      initContainers:
      - command:
        - sh
        - -c
        - |
          find_keytool_or_fail_fast() {
            local has_keytool
            ls "${JAVA_HOME}"/bin/keytool
            has_keytool=$?

            if [ ${has_keytool} -ne 0 ]; then
              exit ${has_keytool}
            fi
          }

          import_cert() {
            local pemfile="${1}"
            local alias="${2}"

            echo "Adding ${pemfile} to truststore"

            # Have to use cat instead of -file
            # because keytool won't understand all of the filenames!
            cat "${pemfile}" | "${JAVA_HOME}"/bin/keytool \
              -noprompt \
              -import \
              -trustcacerts \
              -alias "${alias}" \
              -keystore "${TRUSTSTORE_FILE}" \
              -storepass "${TRUSTSTORE_PASSWORD}"
          }

          get_alias() {
            local pemfile="${1}"
            basename "${pemfile}" .pem
          }

          add_ca_certs() {
            local has_ca_certs
            ls ${SECRETS_DIR}/ca_certs/*.pem
            has_ca_certs=$?

            if [ ${has_ca_certs} -eq 0 ]; then
              for cert in ${SECRETS_DIR}/ca_certs/*.pem; do
                import_cert "${cert}" "$(get_alias $cert)"
              done
            fi
          }

          add_system_certs() {
            for cert in $OS_CERTS_DIR/*.pem; do
              import_cert "${cert}" "$(get_alias $cert)"
            done
          }

          main() {
            find_keytool_or_fail_fast
            add_ca_certs
            add_system_certs
          }

          main
        env:
        - name: SECRETS_DIR
          value: /etc/secrets
        - name: TRUSTSTORE_FILE
          value: /etc/truststore/uaa.pkcs12.truststore
        - name: TRUSTSTORE_PASSWORD
          value: changeit
        - name: JAVA_HOME
          value: /layers/paketo-buildpacks_bellsoft-liberica/jre
        - name: OS_CERTS_DIR
          value: /etc/ssl/certs
        image: index.docker.io/cfidentity/uaa@sha256:a721dc416a900745099469920573b076728856f83acad9bee6f2c47d0625be70
        name: build-uaa-truststore
        volumeMounts:
        - mountPath: /etc/secrets/ca_certs
          name: ca-certs-files
          readOnly: true
        - mountPath: /etc/truststore
          name: truststore-file
      serviceAccountName: uaa
      volumes:
      - configMap:
          name: uaa-config
        name: uaa-config
      - name: smtp-credentials-file
        secret:
          optional: true
          secretName: uaa-smtp-credentials
      - name: database-credentials-file
        secret:
          optional: true
          secretName: uaa-database-credentials
      - name: admin-client-credentials-file
        secret:
          secretName: uaa-admin-client-credentials
      - name: jwt-policy-signing-keys-file
        secret:
          secretName: uaa-jwt-policy-signing-keys
      - name: ca-certs-files
        secret:
          optional: true
          secretName: uaa-ca-certs
      - emptyDir: {}
        name: truststore-file
      - name: saml-keys-file
        secret:
          optional: false
          secretName: uaa-saml-keys
      - name: encryption-keys-file
        secret:
          optional: false
          secretName: encryption-keys
      - name: cf-admin-user-credentials-file
        secret:
          secretName: uaa-cf-admin-user-credentials
      - name: cc-admin-client-credentials-file
        secret:
          secretName: uaa-cf-client-secret
      - name: cloud-controller-username-lookup-client-credentials-file
        secret:
          secretName: uaa-cloud-controller-username-lookup-client-secret
      - name: cf-api-controllers-client-credentials-file
        secret:
          secretName: uaa-cf-api-controllers-client-secret
      - name: cf-api-backup-metadata-generator-client-credentials-file
        secret:
          secretName: uaa-cf-api-backup-metadata-generator-client-secret
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  labels:
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: uaa
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/version: 74.12.0
  name: uaa-admin-client-credentials
  namespace: cf-system
stringData:
  admin_client_credentials.yml: |
    oauth:
      clients:
        admin:
          secret: r53csu7cd1tb0zq7oimj
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  labels:
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: uaa
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/version: 74.12.0
  name: uaa-database-credentials
  namespace: cf-system
stringData:
  database_credentials.yml: |
    database:
      username: uaa
      password: hrhr7uxbx4uv3w8cjd9q
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  labels:
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: uaa
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/version: 74.12.0
  name: encryption-keys
  namespace: cf-system
stringData:
  encryption_keys.yml: |
    encryption:
      active_key_label: default_encryption_key
      encryption_keys:
      - label: default_encryption_key
        passphrase: d1phxa2io2t1r032jkgl
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  labels:
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: uaa
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/version: 74.12.0
  name: uaa-jwt-policy-signing-keys
  namespace: cf-system
stringData:
  jwt_policy_signing_keys.yml: |
    jwt:
      token:
        policy:
          activeKeyId: default_jwt_policy_key
          keys:
            default_jwt_policy_key:
              signingKey: |
                -----BEGIN RSA PRIVATE KEY-----
                MIIG5QIBAAKCAYEAqFMuULl1ZHyCHiB5g9Pylym+aYyR4n+5oBzSWY8plR2nm8LH
                y13i4DjY2z/PYMvQIKlAvlKHg9vszAqge7HSFGgkyB2NKW7h62RQcy0HseyZwAED
                UAgic5sgSFsl18YFnuXP9lPSM18ksGlumprb9XU9H+tbed+ZdtWD341x92+fHNrM
                n8kwsOP87UwFDqCG9GQhfbzPXwMj8yxQpSwcoOTpflz+KQ3N4XO0nx4N3rkN7jAY
                YFekqHkzeZb+1u6O3jwDykuILCsk1JNaVrxwXbp7rS7C+FNCVyD/3XXagVZR8MKZ
                dPRLOnwJDCZ7u3nUX6nf23ALDV9rjp9rekH9PLoZecSjyz6koGtSopo+0reusTcU
                lhpQGYEveAv4eE8OQ40X2zB7wp7pvl8M4xVp2A1voGBiRyOD6ypXopA1UWvc9xDp
                mMY3nWQNnz8+Fwrf74UMHC/9sNEOcZRGUZ3i96FfpQkCzvxjEcP9klpQfi6EJht6
                GyYbEeEPL268tuEZAgMBAAECggGBAITYWUZWiELNTTgPszeKr/wDcwcEbSKQYWTv
                Okh6h3vrUpvIxzxGlccWtnebTcT8Nf+A9NsAcXlsud9zR6M3/TAj3VuejwkzPNQ1
                cJTl5hvTOqjhY8bnFKGevYS9gwlffJIil9W148Cth1w/aY5VR+HaLGqjqqduBEVY
                T+LAVEDPdIkmWbaF54rD9JsnkxovMTNyT0hYGmXHKblCsUcaoGGPKISVSfYGsgUL
                93JZGuM7s7XXeXWX1hksxqZguDHTReAZ7y1x76JbnaPORCCeos2COsSzhYytiOvn
                l28TWdZNWtt4cNDE2RvHboUA0bOzaL5oCtKsiFNzHhys44FJs7i8bBU+oPU6L80j
                J7Yd89YJNAbxGwU6RkVCHBuxdQ2wB5PKSkFH+653KWBtaydKhMms0c8IMnYOVgT+
                UrVaBIh4uQ5zV4PDlQEs0GzwPfJXBnBWDCNJCLpzrtReV9+cJ4/pftQBiFksulNT
                wgWBcacUhUIWMsK9EtCVcnaNR6JjTQKBwQDa2q0chKC/I+Vc0wfpzOUb9mp9IwVA
                p3kSX5UOuklzuHNh9r8k+td6uTJoAjRshsqTztl5UdGGOylj/jFgskU0aA12T48l
                TowV/6U9zaj2lFV/icHlvcR+Tm3GhyBU+9+k7Lm1DcLt1ss6rlST/65rxjan9Ym6
                D2RdmxBAUujakI/yqpV2fkCKhQB0QGHdOZRRAZOTuN27Zn0nRhv1ZNnXc2i2kF9D
                WLT2EtCDkIa6RUFy34pkfNbbqeSbAiJ4IFMCgcEAxOT7g16dKbrBGfrGdLPbR10R
                YEgc9qrIkEbLCUfb5n7OTgBt5hZ03A3rhU4VP0YgluM/8RX9JRD1MuKtb5Jgbh6y
                hjfUjv8aOM856DVhUlcoq0Ouqu41vFkGHZFA+K4cqLRDqWOCqEWsJ5ZP0puon7/Z
                E187aPVlkO76UAloyFaKEpkC1//ZE4uZ0opvYn4B3F6JJtJnAqx+IrqOm0I9ok4X
                up/B6qxZW81DKmYcTLFvIhq04n/NX1bQFY0vC/tjAoHADHPe372IK/gN5+82Bw6a
                hrHJs18XwGsHD42SvKjK3yPCpPNWQvNm6Vu6S4K8muQ8iJZ/d1C5fErHeyIOizL5
                jxbQlUfHnFbQz7uhGlgmYglkqAIdn0Xh9VHfGym7JDrEqeyyUGP9EG1lWOxscZNd
                yFIZ8AqfkI+ppU3aad6N00ngdu1P3dMnNvqEYRj8uIq7LrTJQeGF9FDLlD1//8GC
                R6kQbzrdwMY+XbYKWUIS+GxSYgfoJvmXfB45nLxNW8pzAoHBAJGwUX7CSo5vFqVP
                jvsZfl6OueXBVlUax68iAuhKGKe0GplS7f67jRqq3iPURBp+nGypmE2elKKRqq1N
                V0HgUKQK6NQxiYGJt3BjvZhZrzqLLZeUTDFEc9R7FvBX43he9OvL/ujerfYvH5Rn
                P4c6EIqsHUadR8uBEPcuLV99pt/eUOoz+Au1z30L5fUI5CQ/0sap2Ng2BWzQD8FI
                w26UlCB9okdAIO+xOamY92LvDW+eNvpIQqH6KQ+rn+riffZiuwKBwQCCCCJTMmpQ
                EOTWAe0gUTwyBdKWk+Yx68BL5Rq7Qgmw1xL5fXbyHOSFp9cdYxiO2N6o8cmn2XSf
                qwDK0iQCPQjQfMnIiC8E+zl+sH13pIZ5L3h/uDssVIfJJuu7q9/fepJoGiMjPM+o
                h+10FAnvuC1m2fxgoZ95c4fcNIXlKO9c0a1thO39nbeoul0wOfO9dWTet4mMZX9M
                LhEzSQqW7Wia1X5v7jpBeijrhfF8duT5L7JDUzoJ76IBVqst8lu93Wo=
                -----END RSA PRIVATE KEY-----
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  labels:
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: uaa
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/version: 74.12.0
  name: uaa-saml-keys
  namespace: cf-system
stringData:
  saml_keys.yml: |
    login:
      saml:
        activeKeyId: default_saml_key
        keys:
          default_saml_key:
            key: |
              -----BEGIN RSA PRIVATE KEY-----
              MIIG4wIBAAKCAYEAwCsrqdi4kvt8mUN7I5ccfkvNfp12ip5va7xBAhM0NRiv/dvU
              4YP+ODazihXFmMrYnOueP7yIJu9bxr0z1agKkbp2dAZQU+qMUfAZ4Hd8VtvA/CPR
              NiFGAT4YovhDEq8DeWfZwurZXoEHwgQSRsenNYgS8xThGzttO2x7ielD/tt5/eQ9
              4M4GXYHes+r38hPJriQvpnsw6XdVPq2DfZbByW41uYXtygJ+nhj1I7/OsGFk/smQ
              XmMF/l6ToAH1SxRssABh9pj3t3sL38jjMbjXoTMhr4SPU8L38xGCZGW/To7/G+N6
              GhZjSvrpnz6CfR54f1J+s+9llWYXCcdoS0zr7bQcE4telkT+0Zz47cCKchSmF4GW
              boyRugkeoCwRzJkOdX9JSgqVPOsabhOX6WkFk/OLXMxWmRnx4ErSaRkLKTz18NMj
              Qm2IEJlFnqjuKfmpFOnIBpM43dWZs8ng797UpyYkKa5TwURjCux1ZwAP1BOrOWKF
              /MXxJ/EErRMEVTOJAgMBAAECggGAEfQ2mSDJZdofMwaN+65DmD0mztyRVbQlvtAQ
              1svKhedvke02/3bgion5zj3ofzT8dfTBjTzlD5YvYesNa7nOev0L0h1A5gY04/bl
              xAYF1OulJSmHg2IqczVFAfzl71nwnigovUBJ3L17ZxIQTxKaObMj6hgaS/wKYZHq
              HOFxW99Pj3wCl/1HtPbMQs0CK1jT7/Qri4dY84cVrMxzS4mJQ3OLi3DK3aPMBqNY
              S+XAvtPqpq9YUKk5xyE486sbKs+WincUfYcMeogamtMZs4XpRivwPizVyaXTJzkA
              bMjXX4TkyIoGGlJhBFET5hsmxswC4H/xt/uNkkFPyeOE0AaN9g4ZaAJC0HGhZ73L
              f2qw+ceWVgt+pQepFuhHcd+EAoiWtJf4KLk5W+kJlMaZ3edcpMK/ndNuAjHDkesS
              om39zEu6TdhBZYdNWKYEUCBLfPL0L3nt3UYMJoAUIuwH0TMPcJvPTGm/tQ1MUYEQ
              vG+HANZ+fgXuyVDtR5cA9OURpl9dAoHBAM/6GZhPG0Akul8tX1VTGbNPj0R7EaWG
              oCyvOhAoZ0+ggi9I6RjKYVVz/XdBm2AQfwC/vcRSgA87F5Fn2i/0WA0L6Iv0HoxX
              wRDQ9Yb//zcvsyUSkAdQ0DjWr8uRrM74t+ELRc3fEpodiFXM4OQhWkC82Ny6uliL
              Dslrl2AcFXF9YDIfw+o6Ca5ePGFmzM/K7GofzT+cOBvejIp8ccAiWNdp1BjAMgmA
              vAjPeUpcSH84Pg7dyohfBfRq8M4WO9uLfwKBwQDsipyhiZ7bPNnDQ6a0PBD1qBn1
              wgo5ZOgOyqdpt/bw1KMUCct7cb9egcVZZ5sQZSlC6yFErxo2UQr1nzOmY6hhbZCi
              kmhbBMlMQ+nDZOw1ZMw/KUy0fBiHSSmhGGnWrTSfdnLrnkYsdyE3gBe0forVedPh
              0VBs4sRUrnUhIL1DSWfwg6haY0mJ2dSYVgGGZgugn9z1YI3s+j5/IWt0r3RB/Z+J
              bGQ+xGOz/zTTlmGX8NGyTFbPA+47VI1ft9D8ZPcCgcABdOP3AB7VvSwc/IldZJ6a
              deUv+piuCxpWFcgXUuEeWqZuxFj1ln1GBvDwg+Idsx/glncyx80jzislFpAdo912
              Ae5YBJauLvMoNf5yOprD/S6JBO9DTdqXe1Fx4IxQSsem6NhNT9GmiKxqxWuRzXX/
              XBM8wIYLlrW8zWcbAjdYOyOQVk6d9lgZA4nyuLCYh/hN6fkbB/IQp+deFO8LBHKQ
              16nnnnj7Pg6TFTjpP2o2keNFYWJIwDmfc5xKJTe4GusCgcEAxde94EK6Msc3oGGS
              KkffK4kZhXtxj8W9brnDwuHS0mYXrGfw4OQn2wURqpDEmrbyBv2hStBmTS4Fy6EH
              01ChgjPg+IkabZ6YO4jGGd7szk/roZyKgp8U6PqhrhM8Wwlt7T5mKnqsWP6fMsuZ
              iCcbOih2tvaanSgibG2qnDXE92WLYRjNlCRdWsZuUagGCIKLkSKE7lt++cnowe6S
              8Prbc2KNsKSPSAx9FA0OAzdRk4Mh8U52gRnZhZhX0sptKt3LAoHAL+3Gd3XrE7iY
              GI+SJ4GdKfFRSyAV0uGBps2lkFxEg9CfihQXeGdGAi/hyhDnD2FxuBJATWdn/QRD
              GF1JvjrdyidAkIBUOEz/2/iqTzDDexBFDRZVi5vQmq+ik7KDu3f6ZupOxQz2+hem
              sWGGH/nh9g9CAmMlolaqkN7phrplsD6eDDeRMkWRs5nkPl3/4qndcd8Uuz4MHFGn
              rR4WaQeq7xngGtqHo00KNEe4kkk8aEB/mAmT8fLp/wPFF3OlJRBR
              -----END RSA PRIVATE KEY-----
            passphrase: ""
            certificate: |
              -----BEGIN CERTIFICATE-----
              MIIEfTCCAuWgAwIBAgIQbSCpD9kVoS+7+kJ//3O6PjANBgkqhkiG9w0BAQsFADAz
              MQwwCgYDVQQGEwNVU0ExFjAUBgNVBAoTDUNsb3VkIEZvdW5kcnkxCzAJBgNVBAMT
              AmNhMB4XDTIwMTIxNDE3MTAzNFoXDTIxMTIxNDE3MTAzNFowSzEMMAoGA1UEBhMD
              VVNBMRYwFAYDVQQKEw1DbG91ZCBGb3VuZHJ5MSMwIQYDVQQDDBp1YWFfbG9naW5f
              c2VydmljZV9wcm92aWRlcjCCAaIwDQYJKoZIhvcNAQEBBQADggGPADCCAYoCggGB
              AMArK6nYuJL7fJlDeyOXHH5LzX6ddoqeb2u8QQITNDUYr/3b1OGD/jg2s4oVxZjK
              2Jzrnj+8iCbvW8a9M9WoCpG6dnQGUFPqjFHwGeB3fFbbwPwj0TYhRgE+GKL4QxKv
              A3ln2cLq2V6BB8IEEkbHpzWIEvMU4Rs7bTtse4npQ/7bef3kPeDOBl2B3rPq9/IT
              ya4kL6Z7MOl3VT6tg32WwcluNbmF7coCfp4Y9SO/zrBhZP7JkF5jBf5ek6AB9UsU
              bLAAYfaY97d7C9/I4zG416EzIa+Ej1PC9/MRgmRlv06O/xvjehoWY0r66Z8+gn0e
              eH9SfrPvZZVmFwnHaEtM6+20HBOLXpZE/tGc+O3AinIUpheBlm6MkboJHqAsEcyZ
              DnV/SUoKlTzrGm4Tl+lpBZPzi1zMVpkZ8eBK0mkZCyk89fDTI0JtiBCZRZ6o7in5
              qRTpyAaTON3VmbPJ4O/e1KcmJCmuU8FEYwrsdWcAD9QTqzlihfzF8SfxBK0TBFUz
              iQIDAQABo3UwczAOBgNVHQ8BAf8EBAMCBaAwEwYDVR0lBAwwCgYIKwYBBQUHAwEw
              DAYDVR0TAQH/BAIwADAdBgNVHQ4EFgQUZQSdLhMVSA6Xwv77G6v6BK2zGYAwHwYD
              VR0jBBgwFoAUvDVsa946lM4LsuGKVOiPU64WTdgwDQYJKoZIhvcNAQELBQADggGB
              AFnfhbRg9VArMe0Suoj50B1a7VboSpv5mdmJYya7dWWZZ/Eizim56E0LSsfRF8Jo
              IbALAi7KmI5UZkcMqWa4aCB+s9YRGDJin28IGAciCUogxxWl4POZvMbYtPF1M1Sp
              mmgUbXCDN2yGMNi/NjJyDT4tpvo2tRkDiUPUdbfBSOJ3T6L85VDttYELB18Ga4U4
              Mv4wkkdDebLE6WPRx/DLb2W6leXvAZjaZMZmdeamo6qyke52oAqV39kF9vVLQA7P
              zvHFmo/TvlWWEZ+shraR0EN5vTZhkp0rY4GBO8SEEvkVHC8YfzHulLqQO2oN8UPr
              enyQfwrRVOQ4TyZ36RTGaOFBgy14Q0/x69V1dQtyATuNk68eUiHMiQih47wTSn6G
              2H7k+f2Xr7i/FjjRKxCQnXHKa7FE6SCexc0h44xluN5rA9ntSWcjHTAephAH8d/v
              4OoDhXgf3qvLOTUiGkaS0g/2YgygdlhTOLvdM1mVkxSSoWgkKaSGRo46Ez+N9ZgT
              bA==
              -----END CERTIFICATE-----
type: Opaque
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: uaa-deployment
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: uaa
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/version: 74.12.0
  name: uaa
  namespace: cf-system
spec:
  ports:
  - name: http-uaa
    port: 8080
    protocol: TCP
    targetPort: 8080
  selector:
    app: uaa-deployment
  type: ClusterIP
---
apiVersion: v1
automountServiceAccountToken: true
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/managed-by: kubectl
    app.kubernetes.io/name: uaa
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/version: 74.12.0
  name: uaa
  namespace: cf-system
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: uaa-external-virtual-service
  namespace: cf-system
spec:
  gateways:
  - cf-system/istio-ingressgateway
  hosts:
  - uaa.vcap.me
  - '*.uaa.vcap.me'
  - login.vcap.me
  - '*.login.vcap.me'
  http:
  - route:
    - destination:
        host: uaa.cf-system.svc.cluster.local
        port:
          number: 8080
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: uaa-certs
  namespace: cf-system
stringData:
  uaa.crt: |
    -----BEGIN CERTIFICATE-----
    MIIEtzCCAx+gAwIBAgIRAI/lZbAdcy/8Kw+Boi4dvUwwDQYJKoZIhvcNAQELBQAw
    MzEMMAoGA1UEBhMDVVNBMRYwFAYDVQQKEw1DbG91ZCBGb3VuZHJ5MQswCQYDVQQD
    EwJjYTAeFw0yMDEyMTQxNzEwMzNaFw0yMTEyMTQxNzEwMzNaME4xDDAKBgNVBAYT
    A1VTQTEWMBQGA1UEChMNQ2xvdWQgRm91bmRyeTEmMCQGA1UEAwwdKi5jZi1zeXN0
    ZW0uc3ZjLmNsdXN0ZXIubG9jYWwwggGiMA0GCSqGSIb3DQEBAQUAA4IBjwAwggGK
    AoIBgQD19Ift7HeYQKWYxYBDSRKcv0OtS0+PyTidOyTYh1ISCXPB4aCUWZwUqyyX
    e5/RNCapNG6dnetWYviH2KQWVTh5CwiAzo5hy7L6BBmium/Tb/TeM4T4tt+kBdcP
    9AmAbr2suv7JQLYuYY+agx6dULiMVoug1AfN07VunEKzmlHTXkuB9dyY0LNVG/EZ
    qKUV691SC93Sv/h+Xj+J7y1cUeIzBA3KJ4thpz3+Bx0I6wHsi5IUJmeIGmx3BC31
    igkuF2P5pyUS/+nJcGBaamdZW5Z5Sk+rzSDKZiGd6OAkTTsMXD+KAV/oJKY8xwFc
    j1ZoL43Jh7aJBAd3aJa8IEiejMQuSEqWOtwUW//iVSr2FtEzM+s4vaLVF1kpB6DK
    KQUo+tK+FcVlgklRzXybw3LDrD71e7NJ0MxU6xNkF+qXqOib9kXYKpxOvicCiyJ4
    wkY2ywOFg+IfTo79HB/f6WEFbjPBYHB94IoAyUqxYlHOge438y35cv3Xuk1mzjfM
    Y6GSXHMCAwEAAaOBqjCBpzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYB
    BQUHAwIGCCsGAQUFBwMBMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFNTTvOy+1GX4
    nkWGJDzp50IHbURtMB8GA1UdIwQYMBaAFLw1bGveOpTOC7LhilToj1OuFk3YMCgG
    A1UdEQQhMB+CHSouY2Ytc3lzdGVtLnN2Yy5jbHVzdGVyLmxvY2FsMA0GCSqGSIb3
    DQEBCwUAA4IBgQDGmhQxV3eszsCp8Jd1hNApfZWigfer5P1gr24wTCoQdep1BAbQ
    ZTVZScq2jkB4Lc+FfonR4SAvum5nln4AxVpsePO7dDCSKsh7WKNHSv5w1qVlpaMK
    m4Rnb+rtVcJ4jg5Chv4uM5uV2raHQBPrtLkexblOaGLIxURY28dkWKTUABY7l3ZV
    17xVXpRQn/nf890N4f40+GydwXaFQHSj0DSBfqZXbZr83ljUuSbioHzuNp551zUM
    IoYzThu+LaXlf6F70lI3ajqeBtQk5c/Skmui4tI42W/szAcjZ+zeP996rX9jOJ1u
    EXX6eR731+XhY+w1xbNLqmOel2Sdz3Vgc5EN8VLneQy4sAjEcT7+CgI5bylJvlzZ
    OUKICJK6Qi+JGCZ0bWDL3vzFU7KHB6qC6+zJqSe02DeL6iK49svCvESi1FEAbvbR
    tdVnypolHpyU9yXL7F95+xu5XUv7t94Edefm11a7/t8+fi9U+L8uYCGTcdCUOBDZ
    2ou63fZQfXgKBOw=
    -----END CERTIFICATE-----
  uaa.key: |
    -----BEGIN RSA PRIVATE KEY-----
    MIIG5AIBAAKCAYEA9fSH7ex3mEClmMWAQ0kSnL9DrUtPj8k4nTsk2IdSEglzweGg
    lFmcFKssl3uf0TQmqTRunZ3rVmL4h9ikFlU4eQsIgM6OYcuy+gQZorpv02/03jOE
    +LbfpAXXD/QJgG69rLr+yUC2LmGPmoMenVC4jFaLoNQHzdO1bpxCs5pR015LgfXc
    mNCzVRvxGailFevdUgvd0r/4fl4/ie8tXFHiMwQNyieLYac9/gcdCOsB7IuSFCZn
    iBpsdwQt9YoJLhdj+aclEv/pyXBgWmpnWVuWeUpPq80gymYhnejgJE07DFw/igFf
    6CSmPMcBXI9WaC+NyYe2iQQHd2iWvCBInozELkhKljrcFFv/4lUq9hbRMzPrOL2i
    1RdZKQegyikFKPrSvhXFZYJJUc18m8Nyw6w+9XuzSdDMVOsTZBfql6jom/ZF2Cqc
    Tr4nAosieMJGNssDhYPiH06O/Rwf3+lhBW4zwWBwfeCKAMlKsWJRzoHuN/Mt+XL9
    17pNZs43zGOhklxzAgMBAAECggGAMU1YJhA9lO54g1wrrtEqAvOwDD/Jbggm6hWd
    +C1//Q+Z/aZNuw8PY3FAmgj060mp6kcRWVT7hLCIIysBEVz52gGlLbS6A86CTO2f
    eegnXFnX2ua24+g8gjONfawsb2tDaCl/wzXOjxONZqqb62rv42nByXZXLiIe/1Ih
    aMEpX9ZKCn4PPy6ulAPq23rbxL4n+jdYutMya5pW4D5qeFQNpK5OWVR98xBEM/SX
    FF+PXixIFvPv0u+BCIZ09AA8gNm9EwRfLgECzfOqjD3ClC9GhV6e20guNCCSDWJS
    KmiyxSU3iOEE41Uymja36O0SWwugEo1vR94ywXrAo/9WCCj1azDNpTMAg3YizddV
    v/muKan4sCFUR0IMo9VDhhzcuzm1l1cXFgpGDHaLXVdx5R+/leAVeQmD2CXXZCzd
    3BQL0a2UGBRb0IhR9F3rPT8xkSj8dQYXJXze5hgEDN+Qqd5TR18CR1RTIbaW2jFB
    NfPYo4rfiZLtHeGHqtkQu4asU0CJAoHBAPbYOk+Tbvuo70f3g/gsJ2r+ihmt6fiB
    jY6PNRWDLr2v3BPDGaRjoS0aXe4Ty104c2xJZlslaKaBmlH78aanaIcUuC5x0ANa
    Fg07NzwHNiGeJmvbIZ7FblxiTNV8GxnrdfEM7ijhDo3+wVG2ASpKV7wT+RJBChUO
    fCnkzFY50OGF4xYp9kWB/8HLIyMmyhSBwugX3XU4sWLHXdirQQ1Scl0IAU3nTr/I
    7h7cHb2ntHDDA5CnjmYt6PgI/KHerzgg3QKBwQD/E9unVt9Wc4poKnVvc9uz1bcn
    AGBXMCAxBDUM0t9Gqh1ijPegw3T3fB0OeIRlP6aMwx63JVOLUvD7DB3rnoz4v/9+
    R7fGv+LvOwyCFgijF2iWDFXSo0vxsT872o5GCygqbBRYaULlZDgk8/07RHbPtuVl
    0uTEdPzU+r3ky3t3xDQc3ICakOR/K0zZqXXuINgMO8ji/KlW7Wp0xE0wnutQdpFm
    Xo35qkbZQn9077BUPoGpxkv7JxGqDg/fwm5PdY8CgcBE7E0jyPvVIu9k/dSIZ/O9
    qULwNqI8tBfNdWkSD6XuavsdPX2cbAEl8dXGUxqWddusobYFvyVAULHBMILh0J6c
    EQn4VekJ9o5vtVgP18eijWEW/oGdrmzJON1RQqziiN9Ophidq3F/7mEWKqaao1Vp
    +32xPh3NkVTT8cGoVc5gGh01JBRShiDegJTYDM2h+jVszrUUNPc6qIYoqHCqgpnS
    JhkPIoXXgQgT78wSF5CHZ7xIGLDnEOyazQ+VNvNfzbUCgcEA0P20Oqcy1eJUxIQF
    NAv5Np8kMRBd3xHPTlnkHV2pEnzPFq/pNA7xBtTp+bFEyLAeBbbYs7YhfUW3q/mB
    ikudtTGaZBzetjkB9oCq/uqOqRHE3yu8JZkl4CEZbjDj4P/DKP7krIuSA+DZH23J
    TYYK0qVHzuW8CjrP7LCEZbFSuA5JpFwGAp40mP0hOjVeKn0+hsd1EIVzOYXMc19i
    3zNWGdcLypQuPyEEa33QcD7yehO8qR2Po3efQXXEC9GCEBiBAoHBAKRHabAdZnNQ
    EUSBV4E8jJHSzjxE2RZ6DWtUu15CAEGK7lLE/8kLHxlqNKkpZ9gcyEsLQXZl8FcZ
    RT+e9qRJACOzKvtcyHruVqbOnIP30KK5Vv4407NsMH/kc3dVLJRLZ1ADs6a4rhWN
    VrK9YM36KtjAWLWZ/uc7EakrIqzBeAuJcwH705C/1xzWhBCDDTUB6IqwoxrYTKAH
    kkIJqkRZ+ABZn7C/nT7U1gjgThgi3NYNkDcnrXBXLXsCTljZY3g+UA==
    -----END RSA PRIVATE KEY-----
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: uaa-cf-api-controllers-client-secret
  namespace: cf-system
stringData:
  client_credentials.yml: |
    oauth:
      clients:
        cf_api_controllers:
          secret: f4c343xwhmsbc1lvqdnx
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: uaa-cf-api-backup-metadata-generator-client-secret
  namespace: cf-system
stringData:
  client_credentials.yml: |
    oauth:
      clients:
        cf_api_backup_metadata_generator:
          secret: knxl0ak3r1x3puynlg19
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: uaa-cloud-controller-username-lookup-client-secret
  namespace: cf-system
stringData:
  client_credentials.yml: |
    oauth:
      clients:
        cloud_controller_username_lookup:
          secret: 5f810ouud86w3lpgtct0
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: uaa-cf-admin-user-credentials
  namespace: cf-system
stringData:
  cf_admin_user_credentials.yml: |
    scim:
      users:
      - admin|ret31ua56xnthcgp40sb|admin@admin.tld|first|last|clients.read,cloud_controller.admin,doppler.firehose,network.admin,openid,routing.router_groups.read,routing.router_groups.write,scim.read,scim.write|uaa
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    kapp.k14s.io/versioned: ""
  name: uaa-cf-client-secret
  namespace: cf-system
stringData:
  client_credentials.yml: |
    oauth:
      clients:
        cf:
          secret: ""
type: Opaque
---
apiVersion: v1
kind: Namespace
metadata:
  annotations:
    kapp.k14s.io/change-rule.cf-workloads-namespace: delete before deleting cf-k8s-networking/routecontroller
  labels:
    cf-for-k8s.cloudfoundry.org/cf-workloads-ns: ""
    istio-injection: enabled
  name: cf-workloads

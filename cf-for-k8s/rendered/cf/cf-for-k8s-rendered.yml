apiVersion: kapp.k14s.io/v1alpha1
kind: Config
metadata:
  name: kapp-version
minimumRequiredVersion: 0.29.0
---
apiVersion: kapp.k14s.io/v1alpha1
kind: Config
metadata:
  name: kapp-istio-gateway-rules
templateRules:
- resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: Secret
  affectedResources:
    objectReferences:
    - path:
      - spec
      - servers
      - allIndexes: true
      - tls
      resourceMatchers:
      - apiVersionKindMatcher:
          apiVersion: networking.istio.io/v1alpha3
          kind: Gateway
      nameKey: credentialName
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cf-api-server
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 2
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-server
  template:
    metadata:
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9102"
        prometheus.io/path: metrics
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app.kubernetes.io/name: cf-api-server
    spec:
      containers:
      - name: cf-api-server
        image: cloudfoundry/cloud-controller-ng@sha256:eee7019f38a84297b45ab69b25ea7bf67c4373c2da508fefe20f87e19b765a2a
        imagePullPolicy: Always
        volumeMounts:
        - name: server-sock
          mountPath: /data/cloud_controller_ng
        - name: cloud-controller-ng-yaml
          mountPath: /config/
        - name: uaa-certs
          mountPath: /config/uaa/certs
        - name: eirini-certs
          mountPath: /config/eirini/certs
        - name: metric-proxy-certs
          mountPath: /config/metric_proxy/certs
        - name: metric-proxy-ca
          mountPath: /config/metric_proxy/ca
      - name: cf-api-local-worker
        image: cloudfoundry/cloud-controller-ng@sha256:eee7019f38a84297b45ab69b25ea7bf67c4373c2da508fefe20f87e19b765a2a
        imagePullPolicy: Always
        command:
        - /usr/local/bin/bundle
        args:
        - exec
        - rake
        - jobs:local
        volumeMounts:
        - name: cloud-controller-ng-yaml
          mountPath: /config/
        - name: nginx-uploads
          mountPath: /tmp/uploads
      - name: nginx
        image: cloudfoundry/capi-nginx@sha256:abfa8900163892fae1ebdaffbe3619ef821b769646d51279278bff4334b3d8bc
        imagePullPolicy: Always
        ports:
        - containerPort: 80
        readinessProbe:
          httpGet:
            port: 80
            path: /healthz
        volumeMounts:
        - name: nginx
          mountPath: /etc/nginx
          readOnly: true
        - name: server-sock
          mountPath: /data/cloud_controller_ng
        - name: nginx-logs
          mountPath: /cloud_controller_ng
        - name: nginx-uploads
          mountPath: /tmp/uploads
      - name: statsd-exporter
        image: oratos/statsd_exporter:v0.15.0@sha256:10a64dc4ad0a3e3fe88372f0481dea5c02595c38d168617836a99a649d3ac407
        imagePullPolicy: Always
      serviceAccountName: cf-api-server-service-account
      volumes:
      - name: server-sock
        emptyDir: {}
      - name: cloud-controller-ng-yaml
        configMap:
          name: cloud-controller-ng-yaml
      - name: nginx
        configMap:
          name: nginx
      - name: nginx-logs
        emptyDir: {}
      - name: uaa-certs
        secret:
          secretName: uaa-certs
      - name: eirini-certs
        secret:
          secretName: eirini-internal-tls-certs
      - name: metric-proxy-certs
        secret:
          secretName: metric-proxy-cert
      - name: metric-proxy-ca
        secret:
          secretName: metric-proxy-ca
      - name: nginx-uploads
        emptyDir: {}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cf-api-kpack-watcher
  namespace: cf-system
  labels:
    app.kubernetes.io/name: cf-api-kpack-watcher
    app.kubernetes.io/instance: cf-api-kpack-watcher-0
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-kpack-watcher
  template:
    metadata:
      labels:
        app.kubernetes.io/name: cf-api-kpack-watcher
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      serviceAccountName: cf-api-kpack-watcher-service-account
      containers:
      - name: cf-api-kpack-watcher
        image: cloudfoundry/capi-kpack-watcher@sha256:1d1ab7acf9b2829f42613ecea4ab6714090e3b41360d2ad9a0a8c88d00c3392a
        env:
        - name: UAA_CLIENT_SECRET
          value: whqizmu0vdn00bbnf8gk
        - name: UAA_ENDPOINT
          value: http://uaa.cf-system.svc.cluster.local:8080
        - name: UAA_CLIENT_NAME
          value: capi_kpack_watcher
        - name: CAPI_HOST
          value: http://capi.cf-system.svc.cluster.local
        - name: STAGING_NAMESPACE
          value: cf-workloads-staging
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kpack-watcher
rules:
- apiGroups:
  - build.pivotal.io
  resources:
  - images
  - builds
  - builds/status
  - images/status
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kpack-watcher-binding
subjects:
- kind: ServiceAccount
  namespace: cf-system
  name: default
roleRef:
  kind: ClusterRole
  name: kpack-watcher
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kpack-watcher-pod-logs-reader
  namespace: cf-workloads
rules:
- apiGroups:
  - ""
  resources:
  - pods
  - pods/log
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kpack-watcher-pod-logs-binding
  namespace: cf-workloads
subjects:
- kind: ServiceAccount
  namespace: cf-system
  name: default
roleRef:
  kind: Role
  name: kpack-watcher-pod-logs-reader
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: batch/v1
kind: Job
metadata:
  name: ccdb-migrate
  namespace: cf-system
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  backoffLimit: 6
  template:
    spec:
      containers:
      - name: run-migrations
        image: cloudfoundry/cloud-controller-ng@sha256:eee7019f38a84297b45ab69b25ea7bf67c4373c2da508fefe20f87e19b765a2a
        imagePullPolicy: Always
        command:
        - /bin/bash
        - -c
        args:
        - |
          bundle exec rake db:wait_for_istio && \
          bundle exec rake db:setup_database && \
          bundle exec rake db:terminate_istio
        volumeMounts:
        - name: cloud-controller-ng-yaml
          mountPath: /config
      restartPolicy: OnFailure
      volumes:
      - name: cloud-controller-ng-yaml
        configMap:
          name: cloud-controller-ng-yaml
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cloud-controller-ng-yaml
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  cloud_controller_ng.yml: |
    local_route: 0.0.0.0
    external_port: 9022
    tls_port: 9023
    readiness_port:
      cloud_controller_worker: 4444
      deployment_updater: 4445
      clock: 4446
    fluent:
      host: fluentd-forwarder-ingress
      port: 24224
    internal_service_hostname: capi.cf-system.svc.cluster.local
    pid_filename: /cloud_controller_ng/cloud_controller_ng.pid
    newrelic_enabled: false
    development_mode: false
    external_protocol: https
    external_domain: api.vcap.me
    temporary_disable_deployments: false
    temporary_use_logcache: true
    system_domain_organization: system
    system_domain: vcap.me
    app_domains:
    - apps.vcap.me
    reserved_private_domains: /dev/null
    disable_private_domain_cross_space_context_path_route_sharing: false
    jobs:
      global:
        timeout_in_seconds: 14400
    default_app_memory: 1024
    default_app_disk_in_mb: 1024
    maximum_app_disk_in_mb: 2048
    instance_file_descriptor_limit: 16384
    request_timeout_in_seconds: 900
    bulk_api:
      auth_user: TODO
      auth_password: TODO
    internal_api:
      auth_user: TODO
      auth_password: TODO
    nginx:
      use_nginx: true
      instance_socket: /data/cloud_controller_ng/cloud_controller.sock
    index: 0
    name: ""
    route_services_enabled: true
    volume_services_enabled: true
    info:
      name: ""
      build: ""
      version: 0
      support_address: ""
      description: ""
      app_ssh_endpoint: TODO.TODO
      app_ssh_host_key_fingerprint: placeholder
      app_ssh_oauth_client: placeholder
      min_cli_version: ""
      min_recommended_cli_version: ""
    directories:
      tmpdir: /tmp/
      diagnostics: /cloud_controller_ng/diagnostics/
    logging:
      file: /dev/stdout
      syslog: vcap.cloud_controller_ng
      level: info
      max_retries: 1
    logcache:
      host: metric-proxy
      port: 8080
      temporary_ignore_server_unavailable_errors: true
    logcache_tls:
      ca_file: /config/metric_proxy/ca/tls.crt
      cert_file: /config/metric_proxy/certs/tls.crt
      key_file: /config/metric_proxy/certs/tls.key
      subject_name: metric-proxy
    log_stream:
      url: https://log-stream.vcap.me
    doppler:
      url: wss://doppler.vcap.me:443
    db:
      database:
        adapter: postgres
        host: cf-db-postgresql.cf-db.svc.cluster.local
        port: 5432
        user: cloud_controller
        password: jbyk2klnemaa5uo2o02o
        database: cloud_controller
      max_connections: 25
      pool_timeout: 10
      log_level: debug2
      log_db_queries: false
      read_timeout: 3600
      connection_validation_timeout: 3600
      ssl_verify_hostname: false
    telemetry_log_path: /dev/null
    log_cache:
      url: https://log-cache.vcap.me
    threadpool_size: 20
    internal_route_vip_range: ""
    login:
      url: https://login.vcap.me
    uaa:
      url: https://uaa.vcap.me
      internal_url: http://uaa.cf-system.svc.cluster.local:8080
      resource_id: cloud_controller,cloud_controller_service_permissions
      client_timeout: 60
      ca_file: /config/uaa/certs/uaa.crt
    routing_api:
      url: https://api.vcap.me/routing
      routing_client_name: TODO
      routing_client_secret: TODO
    credential_references:
      interpolate_service_bindings: true
    staging:
      timeout_in_seconds: 900
      minimum_staging_memory_mb: 1024
      minimum_staging_disk_mb: 4096
      minimum_staging_file_descriptor_limit: 16384
      auth:
        user: TODO
        password: TODO
    default_health_check_timeout: 60
    maximum_health_check_timeout: 180
    runtimes_file: /dev/null
    stacks_file: /cloud_controller_ng/config/stacks.yml
    shared_isolation_segment_name: shared
    quota_definitions:
      default:
        memory_limit: 102400
        non_basic_services_allowed: true
        total_routes: 1000
        total_services: -1
        total_reserved_route_ports: 100
    default_quota_definition: default
    resource_pool:
      resource_directory_key: cc-resources
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_secret_access_key: g03yvbzco7wosjxlz9ro
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      minimum_size: 65536
      maximum_size: 536870912
      cdn:
        uri: null
        key_pair_id: null
        private_key: ""
      fog_aws_storage_options: {}
    packages:
      app_package_directory_key: cc-packages
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_secret_access_key: g03yvbzco7wosjxlz9ro
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      max_valid_packages_stored: 5
      max_package_size: 1073741824
      cdn:
        uri: null
        key_pair_id: null
        private_key: ""
      fog_aws_storage_options: {}
    droplets:
      droplet_directory_key: cc-droplets
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_secret_access_key: g03yvbzco7wosjxlz9ro
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      cdn:
        uri: null
        key_pair_id: null
        private_key: ""
      fog_aws_storage_options: {}
      max_staged_droplets_stored: 5
    buildpacks:
      buildpack_directory_key: cc-buildpacks
      blobstore_type: fog
      fog_connection:
        provider: AWS
        endpoint: http://cf-blobstore-minio.cf-blobstore.svc.cluster.local:9000
        aws_access_key_id: admin
        aws_secret_access_key: g03yvbzco7wosjxlz9ro
        aws_signature_version: "2"
        region: ''''''
        path_style: true
      cdn:
        uri: null
        key_pair_id: null
        private_key: ""
      fog_aws_storage_options: {}
    db_encryption_key: TODO
    database_encryption:
      keys:
        encryption_key_0: TODO
      current_key_label: encryption_key_0
      pbkdf2_hmac_iterations: 2048
    disable_custom_buildpacks: false
    broker_client_timeout_seconds: 60
    broker_client_default_async_poll_interval_seconds: 60
    broker_client_max_async_poll_duration_minutes: 10080
    renderer:
      max_results_per_page: 100
      default_results_per_page: 50
      max_inline_relations_depth: 2
    uaa_client_name: cc-service-dashboards
    uaa_client_secret: TODO
    uaa_client_scope: openid,cloud_controller_service_permissions.read
    cloud_controller_username_lookup_client_name: cloud_controller_username_lookup
    cloud_controller_username_lookup_client_secret: whqizmu0vdn00bbnf8gk
    cc_service_key_client_name: cc_service_key_client
    cc_service_key_client_secret: TODO
    allow_app_ssh_access: true
    default_app_ssh_access: true
    skip_cert_verify: true
    install_buildpacks: []
    app_bits_upload_grace_period_in_seconds: 1200
    security_group_definitions:
    - name: public_networks
      rules:
      - destination: 0.0.0.0-9.255.255.255
        protocol: all
      - destination: 11.0.0.0-169.253.255.255
        protocol: all
      - destination: 169.255.0.0-172.15.255.255
        protocol: all
      - destination: 172.32.0.0-192.167.255.255
        protocol: all
      - destination: 192.169.0.0-255.255.255.255
        protocol: all
    - name: dns
      rules:
      - destination: 0.0.0.0/0
        ports: "53"
        protocol: tcp
      - destination: 0.0.0.0/0
        ports: "53"
        protocol: udp
    default_running_security_groups:
    - public_networks
    - dns
    default_staging_security_groups:
    - public_networks
    - dns
    allowed_cors_domains: []
    statsd_host: 127.0.0.1
    statsd_port: 9125
    security_event_logging:
      enabled: false
      file: /dev/null
    system_hostnames:
    - api
    - uaa
    - login
    - doppler
    - loggregator
    - hm9000
    - credhub
    bits_service:
      enabled: false
      public_endpoint: https://bits.vcap.me
      private_endpoint: https://TODO.TODO
      username: TODO
      password: TODO
      ca_cert_path: /dev/null
    rate_limiter:
      enabled: false
      general_limit: 2000
      unauthenticated_limit: 100
      reset_interval_in_minutes: 60
    diego:
      bbs:
        url: https://TODO.TODO
        key_file: /dev/null
        cert_file: /dev/null
        ca_file: /dev/null
        connect_timeout: 10
        send_timeout: 10
        receive_timeout: 10
      cc_uploader_url: https://TODO.TODO
      docker_staging_stack: cflinuxfs3
      file_server_url: https://TODO.TODO
      insecure_docker_registry_list: []
      lifecycle_bundles:
        buildpack/cflinuxfs3: buildpack_app_lifecycle/buildpack_app_lifecycle.tgz
        buildpack/windows: buildpack_app_lifecycle/buildpack_app_lifecycle.tgz
        buildpack/windows2012R2: windows_app_lifecycle/windows_app_lifecycle.tgz
        buildpack/windows2016: buildpack_app_lifecycle/buildpack_app_lifecycle.tgz
        docker: docker_app_lifecycle/docker_app_lifecycle.tgz
      droplet_destinations:
        cflinuxfs3: /home/vcap
        windows: /Users/vcap
        windows2012R2: /
        windows2016: /Users/vcap
      pid_limit: 1024
      temporary_oci_buildpack_mode: null
      enable_declarative_asset_downloads: false
      use_privileged_containers_for_running: false
      use_privileged_containers_for_staging: false
    opi:
      url: https://eirini.cf-system.svc.cluster.local:8085
      opi_staging: true
      enabled: true
      cc_uploader_url: https://TODO.TODO
      ca_file: /config/eirini/certs/tls.ca
      client_cert_file: /config/eirini/certs/tls.crt
      client_key_file: /config/eirini/certs/tls.key
    perm:
      enabled: false
    max_labels_per_resource: 50
    max_annotations_per_resource: 200
    default_app_lifecycle: kpack
    kubernetes:
      host_url: https://kubernetes.default
      service_account:
        token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
      workloads_namespace: cf-workloads
      kpack:
        builder_namespace: cf-workloads-staging
        registry_service_account_name: cc-kpack-registry-service-account
        registry_tag_base: harbor.harbor.svc.cluster.local/library
    perform_blob_cleanup: true
    app_usage_events:
      cutoff_age_in_days: 31
    audit_events:
      cutoff_age_in_days: 31
    failed_jobs:
      cutoff_age_in_days: 31
    completed_tasks:
      cutoff_age_in_days: 31
    service_usage_events:
      cutoff_age_in_days: 31
    max_retained_deployments_per_app: 100
    max_retained_builds_per_app: 100
    max_retained_revisions_per_app: 100
    diego_sync:
      frequency_in_seconds: 15
    pending_builds:
      frequency_in_seconds: 300
      expiration_in_seconds: 42
    pending_droplets:
      frequency_in_seconds: 300
      expiration_in_seconds: 42
    deployment_updater:
      update_frequency_in_seconds: 1
---
apiVersion: v1
kind: Namespace
metadata:
  name: cf-workloads-staging
  labels:
    istio-injection: enabled
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cf-api-clock
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-clock
  template:
    metadata:
      labels:
        app.kubernetes.io/name: cf-api-clock
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - name: cf-api-clock
        workingDir: /cloud_controller_ng
        command:
        - /usr/local/bin/bundle
        args:
        - exec
        - rake
        - clock:start
        image: cloudfoundry/cloud-controller-ng@sha256:eee7019f38a84297b45ab69b25ea7bf67c4373c2da508fefe20f87e19b765a2a
        imagePullPolicy: Always
        readinessProbe:
          tcpSocket:
            port: 4446
          periodSeconds: 3
        volumeMounts:
        - name: cloud-controller-ng-yaml
          mountPath: /config
        - name: eirini-certs
          mountPath: /config/eirini/certs
      volumes:
      - name: cloud-controller-ng-yaml
        configMap:
          name: cloud-controller-ng-yaml
      - name: eirini-certs
        secret:
          secretName: eirini-internal-tls-certs
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cf-api-deployment-updater
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-deployment-updater
  template:
    metadata:
      labels:
        app.kubernetes.io/name: cf-api-deployment-updater
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - name: cf-api-deployment-updater
        workingDir: /cloud_controller_ng
        command:
        - /usr/local/bin/bundle
        args:
        - exec
        - rake
        - deployment_updater:start
        image: cloudfoundry/cloud-controller-ng@sha256:eee7019f38a84297b45ab69b25ea7bf67c4373c2da508fefe20f87e19b765a2a
        imagePullPolicy: Always
        readinessProbe:
          tcpSocket:
            port: 4445
          periodSeconds: 3
        volumeMounts:
        - name: cloud-controller-ng-yaml
          mountPath: /config
        - name: eirini-certs
          mountPath: /config/eirini/certs
      volumes:
      - name: cloud-controller-ng-yaml
        configMap:
          name: cloud-controller-ng-yaml
      - name: eirini-certs
        secret:
          secretName: eirini-internal-tls-certs
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  nginx.conf: |
    error_log stderr info;

    worker_processes auto;

    events {}

    http {
      server_tokens off;

      access_log  /cloud_controller_ng/nginx-access.log;

      tcp_nopush           on;
      tcp_nodelay          on;  #disable nagel's algorithm

      upstream cloud_controller {
        server unix:/data/cloud_controller_ng/cloud_controller.sock;
      }

      server {
          # TODO: get TLS working
          # include nginx_server_mtls.conf;

          listen 80;

          # TODO: move to a separate file and `include` like capi-release?
          # proxy and log all CC traffic
          location / {
            access_log  /cloud_controller_ng/nginx-access.log;
            proxy_buffering             off;
            proxy_set_header            Host $host;
            proxy_set_header            X-Real_IP $remote_addr;
            proxy_set_header            X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_redirect              off;
            proxy_connect_timeout       10;
            proxy_pass                  http://cloud_controller;
          }

          location @cc_uploads {
            proxy_pass http://cloud_controller;
          }

          location ~ /v3/packages/.*/upload {
            if ($arg_bits_path) { return 422; }

            include public_upload.conf;
            upload_pass_form_field "^resources$";
          }

          location ~ /v2/apps/[^/]+/bits {
            if ($arg_application_path) { return 422; }

            include public_upload.conf;

            upload_pass_args on;
            upload_pass_form_field "^resources$";
          }
      }
    }
  public_upload.conf: |
    # Pass altered request body to this location
    upload_pass   @cc_uploads;

    # Allow large uploads
    client_max_body_size 1536M;

    # Store files to this directory
    upload_store /tmp/uploads;

    # No limit for output body forwarded to CC
    upload_max_output_body_len 0;

    # Allow uploaded files to be read only by user
    upload_store_access user:r;

    # Set specified fields in request body
    upload_set_form_field "${upload_field_name}_name" $upload_file_name;
    upload_set_form_field "${upload_field_name}_path" $upload_tmp_path;

    #forward the following fields from existing body
    upload_pass_form_field "_method";

    #on any error, delete uploaded files.
    upload_cleanup 400-505;
---
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: opi-secrets
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  opi.ca: TFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVVlZla05EUVhKMVowRjNTVUpCWjBsUlptSlpTRmRuZDBGdFMxQmlXak5HY1djclIzZG1SRUZPUW1kcmNXaHJhVWM1ZHpCQ1FWRnpSa0ZFUVhvS1RWRjNkME5uV1VSV1VWRkhSWGRPVmxVd1JYaEdha0ZWUW1kT1ZrSkJiMVJFVlU1ellqTldhMGxGV25aa1Z6VnJZMjVyZUVONlFVcENaMDVXUWtGTlZBcEJiVTVvVFVJMFdFUlVTWGROUkZsNVQwUkZOVTFFVFhoT1ZtOVlSRlJKZUUxRVdYbFBSRVUxVFVSTmVFNVdiM2ROZWtWTlRVRnZSMEV4VlVWQ2FFMUVDbFpXVGtKTlVsbDNSa0ZaUkZaUlVVdEZkekZFWWtjNU1WcERRa2RpTTFaMVdraEtOVTFSYzNkRFVWbEVWbEZSUkVWM1NtcFpWRU5EUVdGSmQwUlJXVW9LUzI5YVNXaDJZMDVCVVVWQ1FsRkJSR2RuUjFCQlJFTkRRVmx2UTJkblIwSkJTbE12WVdKR05taDNVUzgyUmpoNWVWZE5PV2hxTkVJMFpFbzJkMWRIWlFwdFozcHdiM3AxZEN0UWFuRk5PVUZUVDNGc05Ya3dWVGhVVTJKUlNWbEJNRGxFVTJGd05sZEJRMnB1VEhCQ1VWZEtjVzl3TTJFdldYSnhPVFJ5WkhvNUNtSlpMekZyV1VKSmJFNTRkbE5aUlV3NFFqZ3dURFk0VUd0aVdYVlljMWRGVERCMVJGRmhjMkYzU2pkM1pHMUNiVVlyV1c5MFkxQlFUSGM1V1M5aE0xSUthRkYwYzBGaGFqSXJkSEZtWm5abVJVMDBkalpwV2tjdlFrTnhjbk5sVWs5aGR6UlZablZHYkU4NVR5dG5NRFpaYkN0MEszVlJSSFpZYWs1MGJuRkdVd3B0ZVVaUWFsSmxlWEZIWW01UFZWVktOV0ZDUWpac1RuZFRaakk0V1d0RE1UbHdiMWRSVFhaS0wyRkdOakpRZUdGcFFWRXhVMkpZYzNoRWVXOUNlbk5RQ2tSemMzQk5MMDR2UWpFeWMzRjViM0pxZG0xeFVYTlFTa05oVVdOMFdHVlpVMkpvWVhSNUwxVTVZbnByVG5sVmJYQklXbUZWT1U5MFprTjZTakExVW1nS05WQTRTalpRVEdRNGIydzNMMmswTDBKUlkwWnlSMFZWUkcxMlNtdzRjM1Y1ZDJjNVlrOXdTbEZHUzNwRk9FcGtNVEE1YVV4eFNucFJOM0V3Y0dsVkt3bzVZVk5LYm5SdVRpdFBZaXRhY21KelZtZFhPRTVGUkd4R1ltWkpSV1ZOVFZwRFJsVnFORzFIUVRkdmEzaDFNRE5OTWpsa2RHSjBWSGxHU2pOeE5DOTRDbHBUZFVJeE1FSlNTVE4zZWxWeGFtaDJlVTgyUkdGeU9XbHJWRlp1WVRrd2JIZEpSRUZSUVVKdk1rMTNXVlJCVDBKblRsWklVVGhDUVdZNFJVSkJUVU1LUVZGWmQwUjNXVVJXVWpCVVFWRklMMEpCVlhkQmQwVkNMM3BCWkVKblRsWklVVFJGUm1kUlZXSlRibkpEVnpVM1VuRjNjVmx4UXpaVFJ6UkVWSFpXYkFwalZtZDNTSGRaUkZaU01HcENRbWQzUm05QlZXSlRibkpEVnpVM1VuRjNjVmx4UXpaVFJ6UkVWSFpXYkdOV1ozZEVVVmxLUzI5YVNXaDJZMDVCVVVWTUNrSlJRVVJuWjBkQ1FVaHVkVWN3YUVvM2FUbFhSMGhLY1ZSUU5UbFZhbEZySzNwNFVuQktPVmMxYTJod01ERkxXamxKZGsxVWNIZElaV2c1UnpGRWNVd0tiMWRDS3k5MlVsbFpZa1l3WjBwUFVrTnRhMWQ0VG05dmFHVlpabTgxUXl0aVJ5dExVa1ZyVUdodWVXZHliak5pUlZkTWVHMHpkWFpSZGsxUFprNVZid3BhWVVRMVoyNXdiWFpCYUdOdmFUWmhNWFo2VURCNFVtWndNazAxVlcxVFltMVFha2gyVGtScU5WRnNZazB6TUV0TmJHcDVWRFpaTjBGcFJrUmxSRU5vQ2xodVlVRTFOMkk0Y1ZwT2JHRmFlazUyUjFsR01HcGhjVXRGUW1salZUZFhOblJUY25GTVFWSlFXV0p1TTFaeVdqVmtOMHBMVGtaUFJtaEtlVGxvY2xjS1owcEJUR1F3YTJ4SE1tTkhUR2hOUVdVcmVVNWxWVmw0WVUxcVlWRlBZVnB2VTFKR1VtWnJhbWN6TkZKd1dEVXJSQzltYkhjclNuVndOazFTZDBScWF3cFRjbGRRWkN0TmRqbHBSazVUYURSNU9EQm5TWFZrVEdwM1pVeDNSazVKWTJaQlVtdEtkRUZKYUZaRE5tNUNkbXB4WWtkVWJUQjFXa0paTkhaaWRuQnZDbWhQVUZkMmFHMVhRVUZxWW0xaVkzbGlUbEp2VDBacGQwNTBSVkpoTW1SRVdFaFFkMDlwUzAwelN6SnZNRWM0YkVSNmEySmhRM1Y1UjNGaGFsZG5RazhLZG0xdGVWWlJSbVYyVmtwT2REaE5VbVJ0Y1VKamVsRlNhMFV6WVVJNVVISnhhVGQ1WW5KcmVtazJWVmd3ZUhKUldGZHBhRmxEYldwelIxTXJhM1JVY2dwTEwzb3ZNSFphVkdsblBUMEtMUzB0TFMxRlRrUWdRMFZTVkVsR1NVTkJWRVV0TFMwdExRb0s=
  opi.crt: TFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVVnpla05EUVhoMVowRjNTVUpCWjBsUlRXOHdVREF5VmxSd2JqbGtRMGwyU25CWVVrUnJSRUZPUW1kcmNXaHJhVWM1ZHpCQ1FWRnpSa0ZFUVhvS1RWRjNkME5uV1VSV1VWRkhSWGRPVmxVd1JYaEdha0ZWUW1kT1ZrSkJiMVJFVlU1ellqTldhMGxGV25aa1Z6VnJZMjVyZUVONlFVcENaMDVXUWtGTlZBcEJiVTVvVFVJMFdFUlVTWGROUkZsNVQwUkZOVTFFVFhoUFJtOVlSRlJKZUUxRVdYbFBSRVUxVFVSTmVFOUdiM2RVYWtWTlRVRnZSMEV4VlVWQ2FFMUVDbFpXVGtKTlVsbDNSa0ZaUkZaUlVVdEZkekZFWWtjNU1WcERRa2RpTTFaMVdraEtOVTFUV1hkS1FWbEVWbEZSUkVSQ01IRk1iVTV0VEZoT05XTXpVbXdLWWxNMWVtUnRUWFZaTW5neFl6TlNiR05wTlhOaU1rNW9Za1JEUTBGaFNYZEVVVmxLUzI5YVNXaDJZMDVCVVVWQ1FsRkJSR2RuUjFCQlJFTkRRVmx2UXdwblowZENRVXhZWVhoVVRHbFJlWEJtVkZKM00xUXlUVXhLY1RseE5WTjVObFU1UzNaTFQwY3hhR00zUmpVd1VUWnBibWsyTDJsTU4wRnNkSFl6ZW1JckNsRjBRMWRpVmtWblFWSlljazR2SzFkVVIxYzNhV2hYTTI5emFrOVdOR3hxTmxkaE9FNVJhRkJIUzJkd1VUUXdlbkpUU1Vwek1YSjNNSG8zTjAxeE0wUUtXR1pLVW1aeVdHVnRiRkZGUVhOWFprWlJURmszWlRReGEyY3daMWxDUlhwTUwydFNVV295YlhCcFMxUnNNV1JzVEVoYVJqaHRRV1JpS3pBMlNVbEdhd28zVW1aMFVERlhSbUphZDJKelkxRklRMHRRVGxsaU1WUXliUzlLYkhkYVZsWlZOV2wyWVZsa1ZGaHFaRnBJV2twMFIyVjBWMkpLYjJSYVUzaEtaRzloQ2tOdk1UbDFNbTh2T0N0T09HRlhWbWxKWldvMk1IZHhWWGhVY1VGaE5WWTBWa2xPYWtScVptNVpZbUpDT0hkRlZHRjRaWEpYUm0xQ2FHeFhXUzlHTDFBS2FFSlVaSGRETkhaMk5sSkJUak5YVlZKU1pFUnhPV1k0TTJaU2RFcEtiQ3RxTW5WTlJURXdZbVpaWmpFeU1FbFpiV2RaUkVoYVIzbFhaekJvYjJzd1ZRcGlhVUpOVUhZemJGZzRUemRTY21WMVpHbEVLMGhZYWxjelVWRkhZM2hvZURjelVsRmpjWFpwUm5SRmRrMWxiRlE0U1U1U2RYUkZiblZCUlVGdlVWaHZDa1ZaUVcxRmRtMU1aVmt6Y1hveWRWVkdja2gwV1Rsd2RYRXpNVXBMWmsxMWVHMWhaa0ZyY3pKSU5VdExVRVpoZDBFdlFsQTBaSGR2V1cxUVEwcFVjWE1LVDBnNGFFMTNTVVJCVVVGQ2J6UkhiazFKUjJ0TlFUUkhRVEZWWkVSM1JVSXZkMUZGUVhkSlJtOUVRV1JDWjA1V1NGTlZSVVpxUVZWQ1oyZHlRbWRGUmdwQ1VXTkVRV2RaU1V0M1dVSkNVVlZJUVhkRmQwUkJXVVJXVWpCVVFWRklMMEpCU1hkQlJFRmtRbWRPVmtoUk5FVkdaMUZWYUVscU9EVm5TMjkyVm5kSkNqTlJRbk5PZWpKTFlWVkJjMHcxVVhkSWQxbEVWbEl3YWtKQ1ozZEdiMEZWWWxOdWNrTlhOVGRTY1hkeFdYRkRObE5ITkVSVWRsWnNZMVpuZDBwUldVUUtWbEl3VWtKQ05IZElTVWxoUzJrMWIxbFlTbWxpTTBsMVl6TmFha3h0VG5Oa1dFNHdXbGhKZFdKSE9XcFpWM2QzUkZGWlNrdHZXa2xvZG1OT1FWRkZUQXBDVVVGRVoyZEhRa0ZEZG5nMGEyNVdZMkl3U1VGNk9IWnBhV0l2YjNCR1MyaEZORVpqWVZGVVIybFZObmhYVmxoalVVRmtjMUUzWkdock1YSmlZV2xWQ21kQ2RqRlFNMUZqTlZOcVpHbERUalpvVTI1QmF6SnpZVXQ2YzA5RFVIZHJNVFpxSzFndmNGbGpPRk4xYzJSVFlWRnZUSGhKVUhoRVMxSlBWa1YyWVVZS1prNW5ZVTlqVHk4MWNYQnNZVGxRSzNSd01FVlZRa3hSTkVocmJsUjJTRVpOVFZsMllUYzRVRVJ5YVRKMVkwZGxVWFJDVkRkNVNsWlZSRTVGVDBaMGFncGlRMjVMZDFSUE1VVnhVMWxJWjBGblVqRTNkRTh6YXpOaWJVbHFRVzVCYjJFelMwWkhXVmRETTFad1RXczJabm93SzAxdGNEaFZlVkZHWVRFeE5IRjRDbXBvVWpSWFFXbHFSR2xZY0cxVmIzYzFhbUoxUjNWM1NETnRaa2xLYTI1VU5TdDFSMFJzWmtnMlptUkJlWHBPUzB3elZVSTNOblp6U1cxTFZ5OU1kbmtLT0dSRmJ6UkVUakJuVDNJclpHTkRObWhsVEc1alJXTjJNWGhzYW1aTlExUlBaRFpFZEVjME9HeDVlVVEyVmtKdFJUQXhhREJ5Unk5Q1ZXZzFWVGROS3dwWU9YVktWMDlMVUhjNVZWVnhZa0o1Vm5Ob1NqaE9Zamc1Y0ZoeldtODBXbVl3VURSUVNrUXZkM1pKTUc5SGVESkZiMXBNY0cwNFRUaHZWM3BMWVRSeUNraFpVbWxKYURob1pEZzFhVTFJUlZSaFVVSlVLM2t3UkZselJtSndZVEZIWTNOVlFWSnZjMUpHTWpGTlpscHFWSEJZZDB4WWVsTjJkekprVWxjNWNqSUtVMWhDVjBFdk5rNHZkejA5Q2kwdExTMHRSVTVFSUVORlVsUkpSa2xEUVZSRkxTMHRMUzBLQ2c9PQ==
  opi.key: TFMwdExTMUNSVWRKVGlCU1UwRWdVRkpKVmtGVVJTQkxSVmt0TFMwdExRcE5TVWxITlVGSlFrRkJTME5CV1VWQmRHUnlSazExU2tSTGJEbE9TRVJrVUZsM2MyMXlNbkpzVEV4d1ZEQnhPRzgwWWxkR2VuTllibEpFY1V0bFRISXJDa2wyYzBOWE1pOW1UblkxUXpCS1duUlZVMEZDUm1Wek15ODFXazFhWW5WTFJtSmxhWGxOTlZocFYxQndXbkozTVVORk9GbHhRMnhFYWxSUGRFbG5iWG9LVjNaRVZGQjJjM2x5WTA1a09HeEdLM1JrTm1GV1FWRkRlRm80VmtGMGFuUTNhbGRUUkZOQ1owVlVUWFlyVWtaRFVHRmhiVWx3VDFoV01sVnpaR3RZZVFwWlFqRjJOMVJ2WjJkWFZIUkdLekF2VmxsV2RHNUNkWGg0UVdOSmJ6Z3hhSFpXVUdGaU9HMVlRbXhXVmxSdFN6bHdhREZPWlU0eGEyUnJiVEJhTmpGYUNuTnRhREZzVEVWc01taHZTMnBZTWpkaGFpOTZORE40Y0ZwWFNXZzJVSEpVUTNCVVJrOXZRbkpzV0doVlp6Sk5UMDRyWkdoMGMwaDZRVkpPY2tZMmRGa0tWMWxIUjFaYWFqaFlPQ3RGUms0elFVeHBLeTl3UlVFelpGcFNSa1l3VDNJeEwzcGtPVWN3YTIxWU5sQmhOSGRVV0ZKME9XZ3ZXR0pSYUdsaFFtZE5aQXByWWtwaFJGTkhhVlJTVW5WSlJYY3JMMlZXWm5jM2RFZDBOalV5U1ZBMFpHVk9ZbVJDUVZwNlIwaElkbVJHUW5seEswbFhNRk00ZURaV1VIZG5NVWMyQ2pCVFpUUkJVVU5vUW1WblVtZERXVk1yV1hRMWFtVnlVR0UxVVZkelpURnFNbTAyY21aVmEzQTRlVGRIV25BNFExTjZXV1pyYjI4NFZuSkJSRGhGTDJnS00wTm9hVms0U1d4UGNYYzBabmxGZWtGblRVSkJRVVZEWjJkSFFrRktMMVJQT0dwNWNteEZTa2hRTkZaYWEwbEllRTlKWVhOdWRsTTNiVk5XTmxCdmJBcDZVVzVxVTA1UVowWXhOM2REVUdFMVdVZE1ORTlXWkdSek1UaGlUbU4zT0hOdVpWQkhUa2xoVWprMlNrdHNlbGd6WTNSYUwyWnJWSGhGWlRCV1Z5dFBDa0pJSzFka1NGbGxNbkZUTVc1a2JuQkhaQ3RoWVdadWNGbERTR1J0WkRGQ1dFdFdSMDlUUm5sS1RXTjRNMFJ4YXk5ck1XNUVUV1JTUlROS01IaHhSR3NLVnpsTE4yOURSVUpJUldnclVsQjRVVWwwVWpsYU5rRlNSVmxqWW5waVVHUTFiVEY1YzFwTk1VVXhWRk0xYm0wNGRuQm1UWFJzZVhOc2NVdHFhVlZZTndwTWRVWjNkMmxDY25Wdkx6Y3ZTRGhrTmpKcVdrbEJiRVpLWXpCbmJVTkNTRGRMTUUxSWEzVnFSRU5sVjBRME4ySldkV2xET1ROb1IweHpkM2RHVDFOaUNrcHJTVkIyWWtWNWFESkRWV1Y2YVVaRk1Vc3lZVFZ2WldkcFZsZGljbVkxTW5CVldUTlZVV2xpY2poeU5VdHJjMGxHWkROTk0xRlVOazlpUW05NU9FNEtXVFYzTDB0bGR6Qm9NakpJWWtjeVpEVlFZV0ZuUVhndk1FcENWRTlTVjNsS0syUjVNWFZqVmtWdllpOTFVa2xvT1dFcmF5dExPR2hhU0hFNVJWcFFOd3B4YVhoRmF6TjRTbGxNUTIxcVRrcFVWbW81T1dKNU1UbGFSSFJXS3pBeE9WWkJSVXQyYzJWTVl6TTVVV3BwYjNGUWVUWnFhVXRyYkVzeFJuWXJlbTlsQ2tWNlRFWm5OSGd5WVZGTWRtbExXREpaV1d4SFRtdGFZMFF3UkU4d1VVdENkMUZFUzFkT01qbFdlV051TUVoVlRIbERTMU01VmxOWFdubFhUVXhWYXk4S00yc3dVM2RhVEU4eVprRnJiek5xV1VzMGEzbHZaVmhHYkdrNVJ6SmhWazU1ZGtrclJEaEtUMVJZUjJoa1ltMUVhRVZoZDBaR2EwRXZaMDFUUjFrd2FncHBNbU51UlVsU2FWQjFkbFZwVGtoNk5sbDZaR1ZSTWxvdmVsTnhiSE5KVEROVVZXVkxZV2RpTlhONWVIZFBUbWR4TDAwNFNtcFZVMlJ2WTAxdVdra3hDbEJ1VGk5bWJVWkdkbFJ0TW1weFVVZHNjMHBVY1hGbk5rdzJTWFpCVkVWUGRVMVlVbGhqWnlzM1pIa3ZaV0ZZZGk5b1lVdFFka1ZyUjBGck1qbE1RV2tLVnpoMldqVjZSR2c1UjJwaEszQkNNM0YwU0dOUWEyeDBaSGMyUm1weE1FTlphVlZEWjJORlFUVm9UR3BaZVhGWFJpdHBVRW93Tlc4emNEUjVWV04wVVFwMloxWmtiblJ1YlU5QmJEZDNSRFJvWmxSVVUxZFZURU5WWmpWcmRHMWxVRVJ5Um1rdlRVdzJjazh6VWtKT1VESkZUbTlHS3pZcmNHVlVhMmM1VldvM0NuWkVaVTR5VUhWdk1Hb3pSbkJTYjNOaE1tbFJXVE5XTmpCSE1rWktTa013WVdwMFYwWmphM1JsZFVVM1UyVkNlVFY2ZGxZMFpGVkdlR3BQVFROdE5FTUtTVWRRVWpSWlZ6ZHJNRkk1Vm5FNE5UUklVSGQ0VEU1bVlrWmpkWEJUWlVoWlpEa3ZLemRDU0ZacU1WRk1URlV2YlRKUU9FeENNbmxqVlV4c1Z5OXlZd3A1U1VSMWFrRnNOM1I2WkZKSE0wdDRlalpJUkdsblpWWldUSE5KUkVOamNFZDNaRkZyVG5BelFXOUlRVkIzVkRoVmJYSm9Wa0ZKVmxsbmVqZDZOVGdyQ25JdlZVSXJZVEZzUVdSSkwxZE9ZMWN6VUhRNVZXcDJhbVZDWm1aREwycHRUV1Z3TjFsUGNVdEdSR1JtZVV4d2NIWnhPVm80TTNCU2R6aGpabkZPYXprS1pYaFRhR0ZxUzNoQ1ZpOHlVMWhHV1dWaGVURkZRMVp2YkdwdGJqSktXa3REVTNNeFowOWxhRWRqWWxWTk1HVjNRbkpwVlVOamVGVlNTbWh3UldSUGJ3cGtZelpoWTNaQ2ExSTVZbWxoT1U4eFoyUXpWVXR4YnpCS1lWVjNZM0JTVlM5dlNURldZMUpsVUdkTFNVRmFVR1YxVGt0dFJFeENZbGxQY0Zkd1RXNUVDbTF2VlhRMFdVeEdiRWd6V1dWRk5FeHhSMUJTWjBadVNGRnhNMlF6UjFVNWQzbDZkMUpsU2xGMVkzaE9RVzlJUWtGS2FUQk1TM2RxUm1RdmEyZFRPVXdLWjFwMFVWVkpSM1JsYm1aRmR5OURkRWN6Y0ZOQlVYTkdjMlZEVTJOS1RFTkdiM1Z3VmpGemFIWlFaVFZyVFZCSEwyVTFUa2xvUVdOU2VGQkZVVmhvWkFwcVVsSnBZMHBsWTNrd2FWQmlkSGd6YmtGT0t6aElSekoyTkdwRGNrTk1NMVpJTmtkVmJuRkZaVTV4VW1FeksyMVBWVTR6ZG05M05FcHpkVWhGVm5sRkNuTlJTblZOU3psd1VVbDNVemxNYWtWMFJYbzBhRzFDUldsU2RVdHRSMFpXTVVvemNEazFSM2xtVFRkbVRYVnFkMmhWYVdWQ1ZuSklTMlZMVUV0Rk5UTUtiak53UWs1ck5HOVpUMWhNWmxsclFYVnNXazl3YzNsaVFWb3lXRGxzY21zd1dqWmtWRXRuVlZSa2IyTnljMHRXTTFGTFFuZEZkVTlQYUM4eE9EQXllZ280Y0VSaVlqaGhWblo2UVZrd1EyOVhiMVZWWW5aS2RYaElXRGx2VVZOUmIzbHNNUzl2VUZCU1dWQmtkM1J1U1dORGRsVjNObVJaVjI5YWIwUktiR2RJQ2xwM2N5OVJZVzltTVhwMlpuTnBkemhZYTNGSFIxZDZRVEFyVjBsVmNXSlRSM0JvZGtGYWVYZGtVbkZPVDNORlQzSXhaR2tyZEZsUWMxQlRWME40WlNzS2MzSkxWV1JKVUZwaWFIUmtjR3hyTTFwSmQyd3daazlCZVV0dU9FcDZWRU5sWVROcVYwTnJRalZTUVVKSldIUXhUbFJ6V1ROaGRGaHdWREZwVUVOSE5BcFJSekpWV0ZOUVVWaDRPV05ZUVVkcVZtSnJlRFpSVHpSVlJUSXpURTQzVkhoMFZrUm1VRkp5WkdORFUzaFhNVVZhTWtNM1FVRTlQUW90TFMwdExVVk9SQ0JTVTBFZ1VGSkpWa0ZVUlNCTFJWa3RMUzB0TFFvSw==
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-api-server-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:routes-admin
rules:
- apiGroups:
  - networking.cloudfoundry.org
  resources:
  - routes
  verbs:
  - create
  - get
  - update
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:kpack-builds-admin
rules:
- apiGroups:
  - build.pivotal.io
  resources:
  - images
  verbs:
  - create
  - get
  - update
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-server-service-account-cf-routes-admin
  namespace: cf-workloads
subjects:
- kind: ServiceAccount
  name: cf-api-server-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:routes-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-server-service-account-kpack-builds-admin
  namespace: cf-workloads-staging
subjects:
- kind: ServiceAccount
  name: cf-api-server-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:kpack-builds-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-api-worker-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-worker-service-account-cf-routes-admin
  namespace: cf-workloads
subjects:
- kind: ServiceAccount
  name: cf-api-worker-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:routes-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-worker-service-account-kpack-builds-admin
  namespace: cf-workloads-staging
subjects:
- kind: ServiceAccount
  name: cf-api-worker-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:kpack-builds-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-api-kpack-watcher-service-account
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:kpack-builds-informer
rules:
- apiGroups:
  - build.pivotal.io
  resources:
  - builds
  verbs:
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cf:service-accounts-secrets-fetcher
rules:
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  - secrets
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-kpack-watcher-service-account-kpack-builds-reader
  namespace: cf-workloads-staging
subjects:
- kind: ServiceAccount
  name: cf-api-kpack-watcher-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:kpack-builds-informer
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-api-kpack-watcher-service-account-service-accounts-secrets-fetcher
  namespace: cf-workloads-staging
subjects:
- kind: ServiceAccount
  name: cf-api-kpack-watcher-service-account
  namespace: cf-system
roleRef:
  kind: ClusterRole
  name: cf:service-accounts-secrets-fetcher
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: Secret
metadata:
  name: cc-kpack-registry-auth-secret
  namespace: cf-workloads-staging
  annotations:
    kapp.k14s.io/versioned: ""
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL2hhcmJvci5oYXJib3Iuc3ZjLmNsdXN0ZXIubG9jYWwiOnsiYXV0aCI6IllXUnRhVzQ2WVdSdGFXND0iLCJwYXNzd29yZCI6ImFkbWluIiwidXNlcm5hbWUiOiJhZG1pbiJ9fX0=
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cc-kpack-registry-service-account
  namespace: cf-workloads-staging
secrets:
- name: cc-kpack-registry-auth-secret
imagePullSecrets:
- name: cc-kpack-registry-auth-secret
---
apiVersion: v1
kind: Service
metadata:
  name: capi
  namespace: cf-system
spec:
  type: ClusterIP
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
    name: http
  selector:
    app.kubernetes.io/name: cf-api-server
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cf-api-worker
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-rule.cf-db-postgresql: upsert after upserting cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: cf-api-worker
  template:
    metadata:
      labels:
        app.kubernetes.io/name: cf-api-worker
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - name: cf-api-worker
        workingDir: /cloud_controller_ng
        command:
        - /usr/local/bin/bundle
        args:
        - exec
        - rake
        - jobs:generic
        image: cloudfoundry/cloud-controller-ng@sha256:eee7019f38a84297b45ab69b25ea7bf67c4373c2da508fefe20f87e19b765a2a
        imagePullPolicy: Always
        readinessProbe:
          tcpSocket:
            port: 4444
          periodSeconds: 3
        volumeMounts:
        - name: cloud-controller-ng-yaml
          mountPath: /config
        - name: eirini-certs
          mountPath: /config/eirini/certs
      serviceAccountName: cf-api-worker-service-account
      volumes:
      - name: cloud-controller-ng-yaml
        configMap:
          name: cloud-controller-ng-yaml
      - name: eirini-certs
        secret:
          secretName: eirini-internal-tls-certs
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: cf-api-external-virtual-service
  namespace: cf-system
spec:
  hosts:
  - api.vcap.me
  gateways:
  - cf-system/istio-ingressgateway
  http:
  - route:
    - destination:
        host: capi.cf-system.svc.cluster.local
        port:
          number: 80
---
apiVersion: experimental.kpack.pivotal.io/v1alpha1
kind: Store
metadata:
  name: cf-buildpack-store
spec:
  sources:
  - image: gcr.io/paketo-community/ruby@sha256:5d95274fc0468f34d29ff2fd115634206fa6beaa3d8ecb2e0d8f06b42f37a777
  - image: gcr.io/paketo-community/python@sha256:c152763e3bc606f72cb7d8c513abe2fcf6ee2d8650b1e3a2884a0b7966404300
  - image: gcr.io/paketo-buildpacks/java@sha256:32ba0e8e7e8fee56adda85b2ff6a43bd6baa06088cf9c5b08d0a7fe5a342ae8b
  - image: gcr.io/paketo-buildpacks/nodejs@sha256:3234414b97541a9661ba89fe20a8fe6505f6e1ca64f27227342399e5ca86138e
  - image: gcr.io/paketo-buildpacks/go@sha256:bad4b5bae7818134cfef2609057e40b4d6bcc2406c5f7c4a85f77e9b31d1c96e
  - image: gcr.io/paketo-buildpacks/dotnet-core@sha256:52952dbaf7bd65ea10ac6491c5af8dda238bdda0c33a938806026d327c3a075f
  - image: gcr.io/paketo-buildpacks/php@sha256:43ba252c72d3ce60930ded5e30f87f1f8715fc8f5d964fcbce3a3548c2d2e03e
  - image: gcr.io/paketo-buildpacks/procfile@sha256:224f4f533d9bd44f675b704f51a21ec86dad8979aefa0d30cad2f0d72e7f2d9e
---
apiVersion: experimental.kpack.pivotal.io/v1alpha1
kind: Stack
metadata:
  name: cflinuxfs3-stack
spec:
  id: org.cloudfoundry.stacks.cflinuxfs3
  buildImage:
    image: gcr.io/paketo-buildpacks/build@sha256:84f7b60192e69036cb363b2fc7d9834cff69dcbcf7aaf8c058d986fdee6941c3
  runImage:
    image: gcr.io/paketo-buildpacks/run@sha256:84f7b60192e69036cb363b2fc7d9834cff69dcbcf7aaf8c058d986fdee6941c3
---
apiVersion: experimental.kpack.pivotal.io/v1alpha1
kind: CustomBuilder
metadata:
  name: cf-default-builder
  namespace: cf-workloads-staging
spec:
  tag: harbor.harbor.svc.cluster.local/library/cf-default-builder
  serviceAccount: cc-kpack-registry-service-account
  stack: cflinuxfs3-stack
  store: cf-buildpack-store
  order:
  - group:
    - id: paketo-community/ruby
  - group:
    - id: paketo-community/python
  - group:
    - id: paketo-buildpacks/java
  - group:
    - id: paketo-buildpacks/nodejs
  - group:
    - id: paketo-buildpacks/go
  - group:
    - id: paketo-buildpacks/dotnet-core
  - group:
    - id: paketo-buildpacks/php
  - group:
    - id: paketo-buildpacks/httpd
  - group:
    - id: paketo-buildpacks/nginx
  - group:
    - id: paketo-buildpacks/procfile
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-app-ingress
  namespace: cf-workloads
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: cf-system
      podSelector:
        matchLabels:
          app.kubernetes.io/component: router
    - namespaceSelector:
        matchLabels:
          name: cf-system
      podSelector:
        matchLabels:
          app.kubernetes.io/component: adapter
  podSelector: {}
  policyTypes:
  - Ingress
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default,runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: cf-workloads-app-psp
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: RunAsAny
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
  - emptyDir
  - projected
  - secret
  - downwardAPI
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: runtime/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: runtime/default
  name: eirini
spec:
  allowPrivilegeEscalation: false
  fsGroup:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  hostIPC: false
  hostNetwork: false
  hostPID: false
  privileged: false
  readOnlyRootFilesystem: false
  requiredDropCapabilities:
  - ALL
  runAsUser:
    rule: MustRunAsNonRoot
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    ranges:
    - max: 65535
      min: 1
    rule: MustRunAs
  volumes:
  - configMap
  - emptyDir
  - projected
  - secret
  - downwardAPI
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: eirini
  namespace: cf-workloads
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: opi
  namespace: cf-system
---
apiVersion: v1
data:
  events.yml: |
    app_namespace: cf-workloads
    cc_internal_api: "https://api.cf-system.svc.cluster.local:9023"
    cc_cert_path: "/etc/eirini/secrets/cc.crt"
    cc_key_path: "/etc/eirini/secrets/cc.key"
    cc_ca_path: "/etc/eirini/secrets/cc.ca"
  metrics.yml: |
    app_namespace: cf-workloads
    loggregator_address: "doppler-doppler.cf-system.svc.cluster.local:8082"
    loggergator_cert_path: "/etc/eirini/secrets/doppler.crt"
    loggregator_key_path: "/etc/eirini/secrets/doppler.key"
    loggregator_ca_path: "/etc/eirini/secrets/doppler.ca"
  opi.yml: |
    opi:
      app_namespace: cf-workloads
      registry_address: "registry.not-used:443"
      registry_secret_name: app-registry-credentials
      eirini_address: "https://eirini-opi.cf-system.svc.cluster.local:8085"
      downloader_image: eirini/recipe-downloader@sha256:394326cadab00cc31f73a6cccd679c9d0183e31f5123f1045ecf7ebb1dd60920
      executor_image: eirini/recipe-executor@sha256:11cc93ae21ac68512e1f7d0f8b59b012b68eb7b109ce057855dc2fdbf5c49ce5
      uploader_image: eirini/recipe-uploader@sha256:a73c13656f2a85ac3cb220b3d96e6ca5e2037a436a45980a4a9c7214a503fcae

      cc_uploader_secret_name: secrets-2.16.4-2
      cc_uploader_cert_path: cc-server-crt
      cc_uploader_key_path: cc-server-crt-key

      client_certs_secret_name: secrets-2.16.4-2
      client_cert_path: eirini-client-crt
      client_key_path: eirini-client-crt-key

      ca_cert_secret_name: secrets-2.16.4-2
      ca_cert_path: internal-ca-cert

      cc_cert_path: "/workspace/jobs/opi/secrets/cc.crt"
      cc_key_path: "/workspace/jobs/opi/secrets/cc.key"
      cc_ca_path: "/workspace/jobs/opi/secrets/cc.ca"
      rootfs_version: v75.0.0
      client_ca_path: "/workspace/jobs/opi/secrets/eirini.ca"
      server_cert_path: "/workspace/jobs/opi/secrets/eirini-server.crt"
      server_key_path: "/workspace/jobs/opi/secrets/eirini-server.key"
      tls_port: 8085
      disk_limit_mb: 2048
      application_service_account: eirini
      allow_run_image_as_root: false
  routing.yml: |
    app_namespace: cf-workloads
    nats_ip: "nats-nats.cf-system.svc.cluster.local"
    nats_port: 4222
  staging-reporter.yml: |
    app_namespace: cf-workloads
    eirini_cert_path: "/etc/eirini/secrets/eirini-client.crt"
    eirini_key_path: "/etc/eirini/secrets/eirini-client.key"
    ca_path: "/etc/eirini/secrets/eirini-client.ca"
kind: ConfigMap
metadata:
  name: eirini
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: cf-workloads-app-role
  namespace: cf-workloads
rules:
- apiGroups:
  - policy
  resourceNames:
  - cf-workloads-app-psp
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-role
  namespace: cf-workloads
rules:
- apiGroups:
  - batch
  resources:
  - jobs
  verbs:
  - create
  - delete
  - list
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - create
  - update
  - delete
  - list
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - list
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - list
  - delete
- apiGroups:
  - policy
  resources:
  - poddisruptionbudgets
  verbs:
  - create
  - delete
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: eirini-role
  namespace: cf-system
rules:
- apiGroups:
  - policy
  resourceNames:
  - eirini
  resources:
  - podsecuritypolicies
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cf-workloads-app-rolebinding
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: cf-workloads-app-role
subjects:
- kind: ServiceAccount
  name: eirini
  namespace: cf-workloads
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-rolebinding
  namespace: cf-workloads
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-role
subjects:
- kind: ServiceAccount
  name: opi
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: eirini-rolebinding
  namespace: cf-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: eirini-role
subjects:
- kind: ServiceAccount
  name: opi
  namespace: cf-system
- kind: ServiceAccount
  name: eirini-rootfs-patcher
  namespace: cf-system
- kind: ServiceAccount
  name: eirini-secret-smuggler
  namespace: cf-system
---
apiVersion: v1
kind: Service
metadata:
  name: eirini
  namespace: cf-system
spec:
  ports:
  - name: https
    port: 8085
    protocol: TCP
  selector:
    name: eirini
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas: null
        URL: index.docker.io/eirini/opi@sha256:c8bf721839e7828a4591fba8463f885912006007b58949eb9cd23acd775fe8e0
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
  name: eirini
  namespace: cf-system
spec:
  selector:
    matchLabels:
      name: eirini
  template:
    metadata:
      labels:
        eirinifs_version: v75.0.0
        name: eirini
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - image: index.docker.io/eirini/opi@sha256:c8bf721839e7828a4591fba8463f885912006007b58949eb9cd23acd775fe8e0
        imagePullPolicy: Always
        name: opi
        ports:
        - containerPort: 8085
          name: https
        resources: {}
        volumeMounts:
        - mountPath: /workspace/jobs/opi/config
          name: config-map-volume
        - mountPath: /workspace/jobs/opi/secrets
          name: cf-secrets
      dnsPolicy: ClusterFirst
      securityContext:
        runAsNonRoot: true
      serviceAccountName: opi
      volumes:
      - configMap:
          items:
          - key: opi.yml
            path: opi.yml
          name: eirini
        name: config-map-volume
      - name: cf-secrets
        projected:
          sources:
          - secret:
              items:
              - key: tls.crt
                path: cc.crt
              - key: tls.key
                path: cc.key
              name: eirini-internal-tls-certs
          - secret:
              items:
              - key: tls.ca
                path: cc.ca
              name: eirini-internal-tls-certs
          - secret:
              items:
              - key: tls.crt
                path: eirini-server.crt
              - key: tls.key
                path: eirini-server.key
              name: eirini-internal-tls-certs
          - secret:
              items:
              - key: tls.ca
                path: eirini.ca
              name: eirini-internal-tls-certs
---
apiVersion: v1
kind: Secret
metadata:
  name: eirini-internal-tls-certs
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVzekNDQXh1Z0F3SUJBZ0lRTW8wUDAyVlRwbjlkQ0l2SnBYUkRrREFOQmdrcWhraUc5dzBCQVFzRkFEQXoKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEN6QUpCZ05WQkFNVApBbU5oTUI0WERUSXdNRFl5T0RFNU1ETXhPRm9YRFRJeE1EWXlPREU1TURNeE9Gb3dUakVNTUFvR0ExVUVCaE1EClZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1TWXdKQVlEVlFRRERCMHFMbU5tTFhONWMzUmwKYlM1emRtTXVZMngxYzNSbGNpNXNiMk5oYkRDQ0FhSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnR1BBRENDQVlvQwpnZ0dCQUxYYXhUTGlReXBmVFJ3M1QyTUxKcTlxNVN5NlU5S3ZLT0cxaGM3RjUwUTZpbmk2L2lMN0FsdHYzemIrClF0Q1diVkVnQVJYck4vK1dUR1c3aWhXM29zak9WNGxqNldhOE5RaFBHS2dwUTQwenJTSUpzMXJ3MHo3N01xM0QKWGZKUmZyWGVtbFFFQXNXZkZRTFk3ZTQxa2cwZ1lCRXpML2tSUWoybXBpS1RsMWRsTEhaRjhtQWRiKzA2SUlGawo3UmZ0UDFXRmJad2JzY1FIQ0tQTlliMVQybS9KbHdaVlZVNWl2YVlkVFhqZFpIWkp0R2V0V2JKb2RaU3hKZG9hCkNvMTl1Mm8vOCtOOGFXVmlJZWo2MHdxVXhUcUFhNVY0VklOakRqZm5ZYmJCOHdFVGF4ZXJXRm1CaGxXWS9GL1AKaEJUZHdDNHZ2NlJBTjNXVVJSZERxOWY4M2ZSdEpKbCtqMnVNRTEwYmZZZjEyMElZbWdZREhaR3lXZzBob2swVQpiaUJNUHYzbFg4TzdScmV1ZGlEK0hYalczUVFHY3hoeDczUlFjcXZpRnRFdk1lbFQ4SU5SdXRFbnVBRUFvUVhvCkVZQW1Fdm1MZVkzcXoydVVGckh0WTlwdXEzMUpLZk11eG1hZkFrczJINUtLUEZhd0EvQlA0ZHdvWW1QQ0pUcXMKT0g4aE13SURBUUFCbzRHbk1JR2tNQTRHQTFVZER3RUIvd1FFQXdJRm9EQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRgpCUWNEQWdZSUt3WUJCUVVIQXdFd0RBWURWUjBUQVFIL0JBSXdBREFkQmdOVkhRNEVGZ1FVaElqODVnS292VndJCjNRQnNOejJLYVVBc0w1UXdId1lEVlIwakJCZ3dGb0FVYlNuckNXNTdScXdxWXFDNlNHNERUdlZsY1Znd0pRWUQKVlIwUkJCNHdISUlhS2k1b1lYSmliM0l1YzNaakxtTnNkWE4wWlhJdWJHOWpZV3d3RFFZSktvWklodmNOQVFFTApCUUFEZ2dHQkFDdng0a25WY2IwSUF6OHZpaWIvb3BGS2hFNEZjYVFUR2lVNnhXVlhjUUFkc1E3ZGhrMXJiYWlVCmdCdjFQM1FjNVNqZGlDTjZoU25BazJzYUt6c09DUHdrMTZqK1gvcFljOFN1c2RTYVFvTHhJUHhES1JPVkV2YUYKZk5nYU9jTy81cXBsYTlQK3RwMEVVQkxRNEhrblR2SEZNTVl2YTc4UERyaTJ1Y0dlUXRCVDd5SlZVRE5FT0Z0agpiQ25Ld1RPMUVxU1lIZ0FnUjE3dE8zazNibUlqQW5Bb2EzS0ZHWVdDM1ZwTWs2ZnowK01tcDhVeVFGYTExNHF4CmpoUjRXQWlqRGlYcG1Vb3c1amJ1R3V3SDNtZklKa25UNSt1R0RsZkg2ZmRBeXpOS0wzVUI3NnZzSW1LVy9MdnkKOGRFbzRETjBnT3IrZGNDNmhlTG5jRWN2MXhsamZNQ1RPZDZEdEc0OGx5eUQ2VkJtRTAxaDByRy9CVWg1VTdNKwpYOXVKV09LUHc5VVVxYkJ5VnNoSjhOYjg5cFhzWm80WmYwUDRQSkQvd3ZJMG9HeDJFb1pMcG04TThvV3pLYTRyCkhZUmlJaDhoZDg1aU1IRVRhUUJUK3kwRFlzRmJwYTFHY3NVQVJvc1JGMjFNZlpqVHBYd0xYelN2dzJkUlc5cjIKU1hCV0EvNk4vdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNUFJQkFBS0NBWUVBdGRyRk11SkRLbDlOSERkUFl3c21yMnJsTExwVDBxOG80YldGenNYblJEcUtlTHIrCkl2c0NXMi9mTnY1QzBKWnRVU0FCRmVzMy81Wk1aYnVLRmJlaXlNNVhpV1BwWnJ3MUNFOFlxQ2xEalRPdElnbXoKV3ZEVFB2c3lyY05kOGxGK3RkNmFWQVFDeFo4VkF0anQ3aldTRFNCZ0VUTXYrUkZDUGFhbUlwT1hWMlVzZGtYeQpZQjF2N1RvZ2dXVHRGKzAvVllWdG5CdXh4QWNJbzgxaHZWUGFiOG1YQmxWVlRtSzlwaDFOZU4xa2RrbTBaNjFaCnNtaDFsTEVsMmhvS2pYMjdhai96NDN4cFpXSWg2UHJUQ3BURk9vQnJsWGhVZzJNT04rZGh0c0h6QVJOckY2dFkKV1lHR1ZaajhYOCtFRk4zQUxpKy9wRUEzZFpSRkYwT3IxL3pkOUcwa21YNlBhNHdUWFJ0OWgvWGJRaGlhQmdNZAprYkphRFNHaVRSUnVJRXcrL2VWZnc3dEd0NjUySVA0ZGVOYmRCQVp6R0hIdmRGQnlxK0lXMFM4eDZWUHdnMUc2CjBTZTRBUUNoQmVnUmdDWVMrWXQ1amVyUGE1UVdzZTFqMm02cmZVa3A4eTdHWnA4Q1N6WWZrb284VnJBRDhFL2gKM0NoaVk4SWxPcXc0ZnlFekFnTUJBQUVDZ2dHQkFKL1RPOGp5cmxFSkhQNFZaa0lIeE9JYXNudlM3bVNWNlBvbAp6UW5qU05QZ0YxN3dDUGE1WUdMNE9WZGRzMThiTmN3OHNuZVBHTklhUjk2SktselgzY3RaL2ZrVHhFZTBWVytPCkJIK1dkSFllMnFTMW5kbnBHZCthYWZucFlDSGRtZDFCWEtWR09TRnlKTWN4M0Rxay9rMW5ETWRSRTNKMHhxRGsKVzlLN29DRUJIRWgrUlB4UUl0UjlaNkFSRVljYnpiUGQ1bTF5c1pNMUUxVFM1bm04dnBmTXRseXNscUtqaVVYNwpMdUZ3d2lCcnVvLzcvSDhkNjJqWklBbEZKYzBnbUNCSDdLME1Ia3VqRENlV0Q0N2JWdWlDOTNoR0xzd3dGT1NiCkprSVB2YkV5aDJDVWV6aUZFMUsyYTVvZWdpVldicmY1MnBVWTNVUWlicjhyNUtrc0lGZDNNM1FUNk9iQm95OE4KWTV3L0tldzBoMjJIYkcyZDVQYWFnQXgvMEpCVE9SV3lKK2R5MXVjVkVvYi91UkloOWEraytLOGhaSHE5RVpQNwpxaXhFazN4SllMQ21qTkpUVmo5OWJ5MTlaRHRWKzAxOVZBRUt2c2VMYzM5UWppb3FQeTZqaUtrbEsxRnYrem9lCkV6TEZnNHgyYVFMdmlLWDJZWWxHTmtaY0QwRE8wUUtCd1FES1dOMjlWeWNuMEhVTHlDS1M5VlNXWnlXTUxVay8KM2swU3daTE8yZkFrbzNqWUs0a3lvZVhGbGk5RzJhVk55dkkrRDhKT1RYR2hkYm1EaEVhd0ZGa0EvZ01TR1kwagppMmNuRUlSaVB1dlVpTkh6Nll6ZGVRMlovelNxbHNJTDNUVWVLYWdiNXN5eHdPTmdxL004SmpVU2RvY01uWkkxClBuTi9mbUZGdlRtMmpxUUdsc0pUcXFnNkw2SXZBVEVPdU1YUlhjZys3ZHkvZWFYdi9oYUtQdkVrR0FrMjlMQWkKVzh2WjV6RGg5R2phK3BCM3F0SGNQa2x0ZHc2RmpxMENZaVVDZ2NFQTVoTGpZeXFXRitpUEowNW8zcDR5VWN0UQp2Z1ZkbnRubU9BbDd3RDRoZlRUU1dVTENVZjVrdG1lUERyRmkvTUw2ck8zUkJOUDJFTm9GKzYrcGVUa2c5VWo3CnZEZU4yUHVvMGozRnBSb3NhMmlRWTNWNjBHMkZKSkMwYWp0V0Zja3RldUU3U2VCeTV6dlY0ZFVGeGpPTTNtNEMKSUdQUjRZVzdrMFI5VnE4NTRIUHd4TE5mYkZjdXBTZUhZZDkvKzdCSFZqMVFMTFUvbTJQOExCMnljVUxsVy9yYwp5SUR1akFsN3R6ZFJHM0t4ejZIRGlnZVZWTHNJRENjcEd3ZFFrTnAzQW9IQVB3VDhVbXJoVkFJVllnejd6NTgrCnIvVUIrYTFsQWRJL1dOY1czUHQ5VWp2amVCZmZDL2ptTWVwN1lPcUtGRGRmeUxwcHZxOVo4M3BSdzhjZnFOazkKZXhTaGFqS3hCVi8yU1hGWWVheTFFQ1ZvbGptbjJKWktDU3MxZ09laEdjYlVNMGV3QnJpVUNjeFVSSmhwRWRPbwpkYzZhY3ZCa1I5YmlhOU8xZ2QzVUtxbzBKYVV3Y3BSVS9vSTFWY1JlUGdLSUFaUGV1TkttRExCYllPcFdwTW5ECm1vVXQ0WUxGbEgzWWVFNExxR1BSZ0ZuSFFxM2QzR1U5d3l6d1JlSlF1Y3hOQW9IQkFKaTBMS3dqRmQva2dTOUwKZ1p0UVVJR3RlbmZFdy9DdEczcFNBUXNGc2VDU2NKTENGb3VwVjFzaHZQZTVrTVBHL2U1TkloQWNSeFBFUVhoZApqUlJpY0plY3kwaVBidHgzbkFOKzhIRzJ2NGpDckNMM1ZINkdVbnFFZU5xUmEzK21PVU4zdm93NEpzdUhFVnlFCnNRSnVNSzlwUUl3UzlMakV0RXo0aG1CRWlSdUttR0ZWMUozcDk1R3lmTTdmTXVqd2hVaWVCVnJIS2VLUEtFNTMKbjNwQk5rNG9ZT1hMZllrQXVsWk9wc3liQVoyWDlscmswWjZkVEtnVVRkb2Nyc0tWM1FLQndFdU9PaC8xODAyego4cERiYjhhVnZ6QVkwQ29Xb1VVYnZKdXhIWDlvUVNRb3lsMS9vUFBSWVBkd3RuSWNDdlV3NmRZV29ab0RKbGdIClp3cy9RYW9mMXp2ZnNpdzhYa3FHR1d6QTArV0lVcWJTR3BodkFaeXdkUnFOT3NFT3IxZGkrdFlQc1BTV0N4ZSsKc3JLVWRJUFpiaHRkcGxrM1pJd2wwZk9BeUtuOEp6VENlYTNqV0NrQjVSQUJJWHQxTlRzWTNhdFhwVDFpUENHNApRRzJVWFNQUVh4OWNYQUdqVmJreDZRTzRVRTIzTE43VHh0VkRmUFJyZGNDU3hXMUVaMkM3QUE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
  tls.ca: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVVekNDQXJ1Z0F3SUJBZ0lRZmJZSFdnd0FtS1BiWjNGcWcrR3dmREFOQmdrcWhraUc5dzBCQVFzRkFEQXoKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEN6QUpCZ05WQkFNVApBbU5oTUI0WERUSXdNRFl5T0RFNU1ETXhOVm9YRFRJeE1EWXlPREU1TURNeE5Wb3dNekVNTUFvR0ExVUVCaE1EClZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1Rc3dDUVlEVlFRREV3SmpZVENDQWFJd0RRWUoKS29aSWh2Y05BUUVCQlFBRGdnR1BBRENDQVlvQ2dnR0JBSlMvYWJGNmh3US82Rjh5eVdNOWhqNEI0ZEo2d1dHZQptZ3pwb3p1dCtQanFNOUFTT3FsNXkwVThUU2JRSVlBMDlEU2FwNldBQ2puTHBCUVdKcW9wM2EvWXJxOTRyZHo5CmJZLzFrWUJJbE54dlNZRUw4QjgwTDY4UGtiWXVYc1dFTDB1RFFhc2F3Sjd3ZG1CbUYrWW90Y1BQTHc5WS9hM1IKaFF0c0FhajIrdHFmZnZmRU00djZpWkcvQkNxcnNlUk9hdzRVZnVGbE85TytnMDZZbCt0K3VRRHZYak50bnFGUwpteUZQalJleXFHYm5PVVVKNWFCQjZsTndTZjI4WWtDMTlwb1dRTXZKL2FGNjJQeGFpQVExU2JYc3hEeW9CenNQCkRzc3BNL04vQjEyc3F5b3Jqdm1xUXNQSkNhUWN0WGVZU2JoYXR5L1U5YnprTnlVbXBIWmFVOU90ZkN6SjA1UmgKNVA4SjZQTGQ4b2w3L2k0L0JRY0ZyR0VVRG12Smw4c3V5d2c5Yk9wSlFGS3pFOEpkMTA5aUxxSnpRN3EwcGlVKwo5YVNKbnRuTitPYitacmJzVmdXOE5FRGxGYmZJRWVNTVpDRlVqNG1HQTdva3h1MDNNMjlkdGJ0VHlGSjNxNC94ClpTdUIxMEJSSTN3elVxamh2eU82RGFyOWlrVFZuYTkwbHdJREFRQUJvMk13WVRBT0JnTlZIUThCQWY4RUJBTUMKQVFZd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVWJTbnJDVzU3UnF3cVlxQzZTRzREVHZWbApjVmd3SHdZRFZSMGpCQmd3Rm9BVWJTbnJDVzU3UnF3cVlxQzZTRzREVHZWbGNWZ3dEUVlKS29aSWh2Y05BUUVMCkJRQURnZ0dCQUhudUcwaEo3aTlXR0hKcVRQNTlValFrK3p4UnBKOVc1a2hwMDFLWjlJdk1UcHdIZWg5RzFEcUwKb1dCKy92UllZYkYwZ0pPUkNta1d4Tm9vaGVZZm81QytiRytLUkVrUGhueWdybjNiRVdMeG0zdXZRdk1PZk5VbwpaYUQ1Z25wbXZBaGNvaTZhMXZ6UDB4UmZwMk01VW1TYm1Qakh2TkRqNVFsYk0zMEtNbGp5VDZZN0FpRkRlRENoClhuYUE1N2I4cVpObGFaek52R1lGMGphcUtFQmljVTdXNnRTcnFMQVJQWWJuM1ZyWjVkN0pLTkZPRmhKeTloclcKZ0pBTGQwa2xHMmNHTGhNQWUreU5lVVl4YU1qYVFPYVpvU1JGUmZramczNFJwWDUrRC9mbHcrSnVwNk1Sd0RqawpTcldQZCtNdjlpRk5TaDR5ODBnSXVkTGp3ZUx3Rk5JY2ZBUmtKdEFJaFZDNm5CdmpxYkdUbTB1WkJZNHZidnBvCmhPUFd2aG1XQUFqYm1iY3liTlJvT0Zpd050RVJhMmREWEhQd09pS00zSzJvMEc4bER6a2JhQ3V5R3FhaldnQk8Kdm1teVZRRmV2VkpOdDhNUmRtcUJjelFSa0UzYUI5UHJxaTd5YnJremk2VVgweHJRWFdpaFlDbWpzR1Mra3RUcgpLL3ovMHZaVGlnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-app-ingress-from-ingressgateway
  namespace: cf-workloads
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
      podSelector:
        matchLabels:
          istio: ingressgateway
---
apiVersion: v1
kind: Secret
metadata:
  name: app-registry-credentials
  namespace: cf-workloads
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL2hhcmJvci5oYXJib3Iuc3ZjLmNsdXN0ZXIubG9jYWwiOnsiYXV0aCI6IllXUnRhVzQ2WVdSdGFXND0iLCJwYXNzd29yZCI6ImFkbWluIiwidXNlcm5hbWUiOiJhZG1pbiJ9fX0=
---
apiVersion: v1
kind: Secret
metadata:
  name: cf-system-cert
  namespace: istio-system
  annotations:
    kapp.k14s.io/change-rule.istio-ingressgateway: upsert before upserting istio.io/ingressgateway
    kapp.k14s.io/versioned: ""
data:
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNUFJQkFBS0NBWUVBeHZkdmJ6a1dhVmxzT1AzeUQyMSt6NG9vdnZOMmFHdE40cTJCNHp4VjFxcmI4eUhiCm45ZWhxeldBUWNLUThHL1dqRVpraW8vTHpCa3pVek5XcFhlbk1EaWZOdmswV3ozajI5ZDM0bndzME5FMm9LVGsKUlJHUFdwVG1Od3lKa0lOS2VWM0hwSGhibCtYdEVUZEVUNUFOMUY5L0hpUWM5VzNkQW16bWNVZ1dFbWJia3RlMgpQZ0wvRGhjaHJnTzBiRldQS3hCd1JPRWdORXhOUEY3bTlkZndnczJ4T3pRL0p0UFNIbHlYbzdDVDBUbW1Pa04wCjZ5QWdmZHE3cmJhT3BhaG9ZaU5hRjViVUt6R1FMbE9OUDkrTVkxYVV4K20vZjFvd2hPOG84TkxyOHdHVHVUN1gKNGk1UmQ3d0NEZHpvSTFYOUU2RHRVWmUya1hrTnRsUnRBSDE1NEhpYTdPZHY1ZzdHM2NXNlJIendTcVNReHdqZgorMzVpWklKQjZCT3FOdzltUzhUV2pKTnFhT0Viem5DSG5odzJzdnNvNVlYWEM0UkN6L2ptT05IdTZGWXEzRjRECjgzT1RPcnUwcUlWMWNMQWszd2orWTdvclhRQUZVeTBVbTVzTTZ0bXpUQXZuelRwb1VPZ211K29FYTYxZldhdFQKV0Z5OXZ6L1VvalVGaE5yekFnTUJBQUVDZ2dHQU1VQ0kvakJVZ3VtVzU1aTlOZUoxOUt3UG9BMG1iM3k0Zi9kUgpZczNKdGVUL28zVHJKK3M1NHViUWcvYkU2Qy9YSFV4RGtTVTlYcDJTWGZNa2JMdHMwSHdEdFprRXc5MVRMVlZ1CklNdDZVSXFwaWlTbk9RMjZ2Y0tFSm5aZEN6L2t6SnhSVWo1VTlnbjlvRGhkR1pEZ1M0VUVNNUxlOUVZbzRuUFEKcTVRYm1weUptQlQ3ME9mdStTN3lzRi9NWnREYkt0N2IyOEVhdHJkNG13d25BZzVkUkJQazNuSDFmQWdOU0dURgpTTWpxSG0yMTMxQlpmZWFyQkZ5RC91RmsrRTd5YjU1ZmN2UEplQjJWb1IzdFBiVG9NY29JeEtsaFZQbWtJZXlYCm9NL1hMVWhjT0dsSkZqYUJESzdTVU96RGtHZjNUQStROWltTS9DYk5RM1YyS016Wi9nVTlXczJLckJ3ZE8waWMKcUdFc3VSNllCbXZMVk9Ua1pLN3dpbG55ck9Yb2ZpbTU5bmxjelJ2ZzJ1THFxbVAxUDJNTWsxT3UwbHFUd0xKRApuekRMb3gzNVVycjZTbThhR2lvVGh5Vko1LzU3K3BMWjJER2Rva2EwM0NHeGt2dWdvOUg3aU5WblNnSmVBbnFHCnc1ZVlNd0RqQVFMc2RDUGVadmwvcS8rcXhZMVpBb0hCQU11NldIT3A1SW1ZTHh5M0wwc2lRS2NDeEpnVnNUM0sKRDlybTMzdnY3eXI2TWFyVUVsbnYrOWl0VUhObVlwd3dwWDBMa0RicE1CenJ0L3lUSHZFNnVuQVJJQndaalUzQQp1WDlZYmFrQ2FrNW5sREdVTTFlNDlLY3BhS3VaK2FEL2JCcUdScUMwdTVUNTNzbUorZ2RzL1l6UjZqNlZvL1VnCk1tNk1oMXlHZlZ5bzdUNUp3NmJsQzJPQUw4NGR5U1ZQLy9nbnJKNTV1OW5LZEZ4Tlg4STFQT2VMelY2TzZjTmUKR1JiV0NJWS84clpQK2MvQmNoci83ZE9hZlFIblM4Z1diUUtCd1FENkJGZ2tPc0cyZWE1Wk5rT3NGZThjaU91Tgo1QmFkS3EwRTJkcHYvTW03SEwzR0RyZjRJVy9nVzNyRmlwSUIyK3dVQlhjRTlkVS85ZU1VVGpJRHFZYlNmVXd6ClhqL2NVZ0gwSG42WlJhU0w4VGxxYlNhMEZaSXl3dU1ZSEVGdkQ0ZUFjT29WNHhUS2hPblFoN2pTTm5yYUVLRGcKaUF4OUpQVXo5ZSttdHZ6R1JqU291ZFRBWEVkSHdlQVMvc1F1VllaTHA0S3NGMHk0SFV0Y2JQVmMvQWRvM3VsTwp1ZHFuTVhsa3cxOGtpWXk4ZHVteXlQeWlCTHd1bmpjY2hObFRXdDhDZ2NCL0RmQXI4a0I5TDFQeWJLd3FCMnFhCnZiY3R3aG1QbDN6YjREQndjdXFOdXd0T3BvUHJZeWVGc2xFQ0oxQklhRzVNMWZGU3pZc2Iva1g0VnlocytWdGMKbU5HVnRMblRTK1pqN1JvMjFUTEhRd0hCQ2RRYldWWDdDbkFrMVJwQnRnb05ZTUNiYVJ1emhVSFVIeUMza05sdwpBVm85UGNYTEVoRmhzSEthMmFWRkxIVUk2NmdCWmNiOGZ1MVJkbklEdXlpLzhyNU05MDZZUFJMa25ieWl1ZUVKCjVyNWx3bXMzVkhBQk5lcUxEMGFuUEtsblVCV0JrU3NaVkxleGdEWmF5dUVDZ2NFQWdoMWVyY1F5YWovYlg2eGcKL1o4UXFONE5FUFFpWExzSC9sMU9WRGZQMk9RMVUyejNpMWdEZkZTL2lTejduYUlSczczQVdrR0NNTjVMeHBhSAphdWFBTnUxa2lkdEVDdXBXLy9BYTNMT2sxZnU5Y01qTGVxODdQZFcxRUNnc1dadFFYcVRrL20wR3Rmc0VJRFZ5CkYxeXBCUEhnZDluMS9lOE0rWFRGdXhMQ2JJRy9DQXhtVDVIMnVyNklXZnBpcU9aemxNM2hzS1FUbGtJUXBWSkQKUTVnYVZ4YWpmd2cwWmd6V2EzMU45NXJxTm04QVlyNDgxQ2o0c3A0K2VrWWRRRWNyQW9IQkFLRzgyTFA3RmdqZQpxWmR5ck54cGdHcmlxZWQ2cEpYZjg5NkpoTC9kZFRDclpGbHFkWUlNc29rUURaWm5qZDNIcVNhYnNyQmM5eVg4CmdaMzZYYWJqakZKN1BpVlhtcTBYYkFaVmI3WTZsazNYUFoyUkdTeW1wVnFRQVQzNHNEOWlCbmFTZjYyZFJBVU4KY2xJbXZjYjR2RkNQem5USGtlTmRhUkxHQ0p4QlFJSDVXYSs0aGt2c3JyeUl1RTJzVndMWUphWHJCTzNlSGQzUgpCVHFDRStoWGNrcE0xOHlBUmZRTEtCVFE1ZDBmN0tVd3AxUHkrVkhTck1KcUlEclBxcWE3Z0E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVtVENDQXdHZ0F3SUJBZ0lRUWV3bDhtdzR2OC9jR0lRNFUvWlFXakFOQmdrcWhraUc5dzBCQVFzRkFEQXoKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEN6QUpCZ05WQkFNVApBbU5oTUI0WERUSXdNRFl5T0RFNU1ETXhOMW9YRFRJeE1EWXlPREU1TURNeE4xb3dPakVNTUFvR0ExVUVCaE1EClZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1SSXdFQVlEVlFRRERBa3FMblpqWVhBdWJXVXcKZ2dHaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQmp3QXdnZ0dLQW9JQmdRREc5Mjl2T1JacFdXdzQvZklQYlg3UAppaWkrODNab2EwM2lyWUhqUEZYV3F0dnpJZHVmMTZHck5ZQkJ3cER3YjlhTVJtU0tqOHZNR1ROVE0xYWxkNmN3Ck9KODIrVFJiUGVQYjEzZmlmQ3pRMFRhZ3BPUkZFWTlhbE9ZM0RJbVFnMHA1WGNla2VGdVg1ZTBSTjBSUGtBM1UKWDM4ZUpCejFiZDBDYk9aeFNCWVNadHVTMTdZK0F2OE9GeUd1QTdSc1ZZOHJFSEJFNFNBMFRFMDhYdWIxMS9DQwp6YkU3TkQ4bTA5SWVYSmVqc0pQUk9hWTZRM1RySUNCOTJydXR0bzZscUdoaUkxb1hsdFFyTVpBdVU0MC8zNHhqClZwVEg2YjkvV2pDRTd5ancwdXZ6QVpPNVB0ZmlMbEYzdkFJTjNPZ2pWZjBUb08xUmw3YVJlUTIyVkcwQWZYbmcKZUpyczUyL21Ec2JkeGJwRWZQQktwSkRIQ04vN2ZtSmtna0hvRTZvM0QyWkx4TmFNazJwbzRSdk9jSWVlSERheQoreWpsaGRjTGhFTFArT1k0MGU3b1ZpcmNYZ1B6YzVNNnU3U29oWFZ3c0NUZkNQNWp1aXRkQUFWVExSU2Jtd3pxCjJiTk1DK2ZOT21oUTZDYTc2Z1JyclY5WnExTllYTDIvUDlTaU5RV0Uydk1DQXdFQUFhT0JvVENCbmpBT0JnTlYKSFE4QkFmOEVCQU1DQmFBd0V3WURWUjBsQkF3d0NnWUlLd1lCQlFVSEF3RXdEQVlEVlIwVEFRSC9CQUl3QURBZApCZ05WSFE0RUZnUVU1STRBbnQwMHpKamJWVXA4ZW9NQ2F6bDNObUV3SHdZRFZSMGpCQmd3Rm9BVWJTbnJDVzU3ClJxd3FZcUM2U0c0RFR2VmxjVmd3S1FZRFZSMFJCQ0l3SUlJUEtpNXNiMmRwYmk1MlkyRndMbTFsZ2cwcUxuVmgKWVM1MlkyRndMbTFsTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCZ1FBQ21qNStTK0xGRmJpZEllQVpUdGpzWjBUUApDQTBjTHk5ZjR0dklDcHI0RkFRaVRuKzVqc2I3OHJJV0NpNlhQZ203ZVdCN0hRb1RkSmVCU0JKRUZYZnVadzU4ClNOZ2ZURklnUVd2TjE5NXBjWkFDenF6dTV6SmRHbWVTcCtCL21KUmphNGJxd3BUU0M2emFIYlJMbWVuTFZIMTQKaGw4aFpYc01kOUphMmZ6L3FEN0N5QmNlc1FmaHB2dnltL2RPUW5JWXVETHJhSEZIUTVuOVZPaUtxSUJ6dlJTSwpWMjhLcXRCWnFucmF2UitMOFp4TnlqcUNObU1XRGV4OVlMcHZxaGRUZXRIL3lVaU8rLzBLb2s1RVV0bVBlM3NQClNSMTh0SkMva2lWMVpTQ1IzTkZFNDhqaC9tWkhwV1B5eHhodEtLYnVCUHArVWpkWER3MWJLcUZvMzB5THluaWsKb0d5aWRzNDdZbWtEbW5kZlpmYzdHUm9TbExUNVhhcmFKM0NqUlFTY05ndWYvaUY2c3JXRE1tVkdvdEhyMzJWawpHaFQ0SmtCVmJQQkJzTFBncy9Vb1hhUlBOd1lVN0F6U0JOS3l4VXdYOUNZMmhNMVhmQkFBVXBUd3VkS0QrTTdhCm5WZjBlRndFdC8rS01kVERSQkNidWNRQUVsZXltOHZOZ1V3V1kvND0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
---
apiVersion: v1
kind: Secret
metadata:
  name: cf-workloads-cert
  namespace: istio-system
  annotations:
    kapp.k14s.io/change-rule.istio-ingressgateway: upsert before upserting istio.io/ingressgateway
    kapp.k14s.io/versioned: ""
data:
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNVFJQkFBS0NBWUVBd2ZjbDcxQjh6cDFrb2xZUVJpZEczYll2aXJQU2Y5eXBMY3doU3hJWm8rN3M0ZmZoCjAweHFiTUovTlNTSEV3Mmd4c29qVEp6eFluVW13RDcrY2dMQzJac3ZSbkhCbjNkcmxlRm8wQlBPRW9LNTZBYm0KMC9FTG45ekhxUW1IZkNVU2tWT0lieCttR1Y1dlNrSzJTeFVnNFBrNVByZ2lhWExDM3d5OXBOZkZVdmxiNHFYbgpjZG5sM1gxdzVwcmpKb3NFcDB1K1pOaXl1UVNZUkYyV0ErNmFpVVovM1hnR0tOeHhKa2QrUWt3MU4xdVpSQzl4ClFJN2hiWGEvUjN1dlR1eTN4WkZZTE5oVWg4eTdISUZmTVBBak9zZVVwM2hFRmZMZkpIUXpFMVNLOVZGbU5mNGMKV245dytzSkJLNGtCTmlBV2pkdHhUWS90Rm5zNy9xelAyM3pOT3g1R3dsVXlQMXZydDFydVVFbXZndWdXK2VINgpSQnh4anJ5RTA1VkNkRnN6clk2Z2YxcVhxVWhwWUR3Wko2YlZ5SCtIVkxYOFBnQS9GYllQM0ZUdjJJaFJrMkVGCkVSMXZBTENnVmRmUEJlbVVrT0pFQ3ArNkt0OUwyT0hDRWtEOEFGVngzb3JiTjlvL2VKVTFIOEJnYUx3M3NmbjAKYThlYS9uU0FDdTBBSGpQckFnTUJBQUVDZ2dHQkFJT1YweHBqRkFobkpsb3E0S2QzQmRCclJCMW9tS2s5WFZoQQpYMlc2UmNLODE5OEVkeU1OZURXSVRSd1VSNzVaUkhVWHRKTEk5Y2pCaVNScWw5dG9uQjliODlwcVdkeUErMitXCmw3QnhmeDkzcC84TWo1UEF0dzRnalNMVDRDSU1WR2hhcnZnVUZHNnBiZjZHKzN3OFBTM2laVDl6VTRVTjRiM0gKdXZBVm9Ud0ZCcHpmeC8rb3Z4UmZnVFF3WjJGQ2RrbTRUTlhGWEptLzBEeXc4SkNDVWp4R28zL3ZhTjVYamp0Vgp6UVhWQlZVa3d2bEs1aDNSMElTZVJtMk1Md1h2K0J0emdOaXNvOW9BZzEvdXVsUzZDanJ4elIwV2ZFWUJTbTMrClhjOFYyMWhqNFVOUDV6d1dpTC82bUFLWEpOdEh6UVVGYjZnTWh5L2pwM0FDd2hHUkNaWVE2UlRTdkxGaFRpaS8KUENRSmtXalkycXRVdExwTDVGdWhORmI2NVhjUGlOM1JZalZIRElndERGTjNlcW0rNFoxS0pCaGZ6Y0NFdW1UWgptcXBTRmxGWjg0MGRiRDlVRFJQV2tjYy81TEJQcWM0YXJmMTNpK2xNcGErVWJkTDVzVzR2QUYxanZ1UkdrMElBCkl6cXF4MmZWdjJQb09ZWkx5NGRHd05Lczc0VjFnUUtCd1FEN2hYazdWcTdxOXFuNmhMbjNkdnF0d2VoR2RqYjkKc2xERjJkZkM4Z0JnWWJBbVFLVS9NeUpaYjdqdTRVcmNySGNhVEZ6OUpOOXV1bFhFUi9scFYyU29EY2ZrZW9ydApqdisraEVoTlM3Q1BaN3pDN3RVNlpSN0UvK29ZSlhBQUhyUFF6TGFJWnhpM2VSOEJVVVR5YVpXMmFXMTloWnlXCjJjckhWM0Z5K1lHWjQxLzhlMGdLRHRYaUZDSjVxMmRya09WT25PVWwrOXhoUlhQSmYrOTM1Y2JxT0paUE1HNDEKczlpZVBEbE1RT1ZLNk5ib3JCc0JxUEgwaVZRVzJWSWRDVkVDZ2NFQXhXdFFRbTZlbUlFTVVRZHZNZGo2THBGbwpaU0lPeGZNMlhsNDRzRXEyV2tGbFhMcXA2a2FpNzRVRXEvTkloT2k5RU5SeW1Tek5hclBZRnFLOFRZSG8zaGFPCjBWbE1LSS9TR0doQVZISkF0MnZKcEdETXBhbHJleVNNT0pMZnh6ellhWS9SdmlXc0M2cGVEMk9lZzNKamZpZFMKSTZIdWtITVFsMzc3UVBSdG1tRUViMWlSV3N5bnhMNGh5bm10WFpBb0J6YmNLYm9oVzd4Q2NYeHFuZitEejJ6YgpIci9iV3JNSmwrR0NpLzdLSDhEMC9NSjVpb1NpbmtFVWkzU25rSnA3QW9IQkFPSDREVzNKT0FjeXFvMit0dERrCkhOMEVxK2k2Qmpldy95NXh3NDJLRzlwN2lXVWtpUkdab0ErWDl4N3VXM0tjbzdpRnlMbEphazh4cXlKWHczVG4KcGkveGlaZjBuR0pIS2U4QksyLytRMWJqVFV3WWhJc2RGQ0xMQkliREE3ZW4zY2NHVkN1QjdFdlJ6cEJCY2w4VAppd1RCL1ROYldjNlJSc1FIQkk3V0tLQ1lEY0ZwQk5TOGRWM1MxeEpXY3VqSjJhbmgvV0U5d01YSFB2cFdMVStiCnFUVCt0OVBYWC94eFluanZCRTlFc251MWFuYkpRTTRoK1piSDFqdGM3WS9Xc1FLQndRQzdpU1hFOWJCU3pzUVUKZFN0Ny90SXFTcGNRK3psdGNZekVPRjFCbXJkL0pZQlVoajNDL3pib3NVT3UxSHlmUlRmVk5QdG41dGQ3OVR2Zwp4Tlo4Q2x4Y0hMR3V6VlU3Y3VQeHE1YndvVmc0NVh1M1d2ME1vZFFvTnArOVhraVZ5NGNKUUVYT2k1clR1aE9BCkt2SDVqRUJYSnFNd2xqTTVwUlN0MVVKNGdibGNYYTBJMk9tN2g0NFhwMFlTUVdRZTdVSVpHRlFzajFRQkFPVmQKU1FNKzgrc1NzQ1czSUNvUUR1T2VFK3NmY2Zvd0QreXA3MVBsOGZsSXZDbjREK2pkeE9FQ2djQWtqcVdpeS8rTgpvNUtLYVVUY1NvWWtnSTIzVUpEdi9iUmxMd0NkQ0lyWkdkeUE3TDd5QlFVWW5GdEZhUGpRSUlIdEF6OFNna2ZZCjhneUg2MHYwRHRRTGNxcVZkUFZNQThCT3VCaHI5b203c25aQTVvU25DaWc1R29FZ0xXMlNwRHRSVjNUZ1c1QTMKcEhGQVlGR2o5ajRPbzh4WW1lY0NnZEtpWVhpbEdZVmQ3My9FUjhQU3AyYnNXS25MOGdQMVZublYrTFVHQnhIdAp3RVpiUlRIejdNc2Q0TUlSYWNQd2xWYkMrRHErdWpEZWIxOFh5OGV0enBJYmhxRW85YXJ3V200PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVjVENDQXRtZ0F3SUJBZ0lRR2VFVnVad21NL2pnb2F2S0lTTEh2VEFOQmdrcWhraUc5dzBCQVFzRkFEQXoKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEN6QUpCZ05WQkFNVApBbU5oTUI0WERUSXdNRFl5T0RFNU1ETXhOMW9YRFRJeE1EWXlPREU1TURNeE4xb3dQekVNTUFvR0ExVUVCaE1EClZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1SY3dGUVlEVlFRRERBNHFMbUZ3Y0hNdWRtTmgKY0M1dFpUQ0NBYUl3RFFZSktvWklodmNOQVFFQkJRQURnZ0dQQURDQ0FZb0NnZ0dCQU1IM0plOVFmTTZkWktKVwpFRVluUnQyMkw0cXowbi9jcVMzTUlVc1NHYVB1N09IMzRkTk1hbXpDZnpVa2h4TU5vTWJLSTB5YzhXSjFKc0ErCi9uSUN3dG1iTDBaeHdaOTNhNVhoYU5BVHpoS0N1ZWdHNXRQeEM1L2N4NmtKaDN3bEVwRlRpRzhmcGhsZWIwcEMKdGtzVklPRDVPVDY0SW1seXd0OE12YVRYeFZMNVcrS2w1M0haNWQxOWNPYWE0eWFMQktkTHZtVFlzcmtFbUVSZApsZ1B1bW9sR2Y5MTRCaWpjY1NaSGZrSk1OVGRibVVRdmNVQ080VzEydjBkN3IwN3N0OFdSV0N6WVZJZk11eHlCClh6RHdJenJIbEtkNFJCWHkzeVIwTXhOVWl2VlJaalgrSEZwL2NQckNRU3VKQVRZZ0ZvM2JjVTJQN1JaN08vNnMKejl0OHpUc2VSc0pWTWo5YjY3ZGE3bEJKcjRMb0Z2bmgra1FjY1k2OGhOT1ZRblJiTTYyT29IOWFsNmxJYVdBOApHU2VtMWNoL2gxUzEvRDRBUHhXMkQ5eFU3OWlJVVpOaEJSRWRid0N3b0ZYWHp3WHBsSkRpUkFxZnVpcmZTOWpoCndoSkEvQUJWY2Q2SzJ6ZmFQM2lWTlIvQVlHaThON0g1OUd2SG12NTBnQXJ0QUI0ejZ3SURBUUFCbzNVd2N6QU8KQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0V3REFZRFZSMFRBUUgvQkFJdwpBREFkQmdOVkhRNEVGZ1FVQW1zZnVHSTJoMGpzSGVtenRka0JEMXZwL1pFd0h3WURWUjBqQkJnd0ZvQVViU25yCkNXNTdScXdxWXFDNlNHNERUdlZsY1Znd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFCSStCV0N3TFl1RmRjenEKdUZqdTdSbm1kS3g3SElnTU1oWnA2OVU2VzRCejRaR2M1dGo4cWl1M0tlUGJDRTIzclZWNS9oUEpxa1JNM2hFSgpJb1BPbDNSTm5GeUptUmpzNHgzejhpZVU0S0V2dmJ5OEJkT0Z6aDQ5RFdqNFNicHNtcHB5RkhiWjRCYk1OTjA1Cm4vVXZJVGZoWi9pRTVaRGZ1WEdtT2k2Tmtlb05KQVlGdFpJMXJhTkxkUTJEWEJKU2RyMkxab0QreGtSN1o4eTkKSjlld0lwUnBqOU5nTkpiY2JTZHFJdlZaSkppTkx5V1pMaVQ3WUpGRGtkV2JtMHhHZ1FSUmkxdHBmZHVTK2dwRQpuN3Z4TVVxZ09rT2VFaVZoa1BpMFluNC82Y1JISUU0MVZ3Q1dkOEpwNVQ2K2RUeHFWRVI3RlIvK3dRbjVVNzhhClBmcFpQdVhjbUtYZE1pdnRSREp0VHk2d0MzWFJMQ3RzRXlwZ0lGUDFWQ3UwTmFsazRhdXBkYXFDZFgzeTdNNkkKYkQ1VFpqY0E4VEtCSVJvSCtqTVYxckpGckh1L1pPclVyWTVaaU5veTRFa0lBU3ZQT1hQbmxSUGxkZlNlNHcvTwpKd0I2eEkzamxPRUNrRWRQVWhMRWtiU0VGQUZmRU5mNTVpS0ZZdWVlUkZCZERrOEgzZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
---
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: istio-ingressgateway
  namespace: cf-system
spec:
  selector:
    istio: ingressgateway
  servers:
  - hosts:
    - '*'
    port:
      name: http
      number: 80
      protocol: HTTP
  - hosts:
    - cf-system/*.vcap.me
    - harbor/harbor.vcap.me
    - harbor/harbor.harbor.svc.cluster.local
    port:
      name: https-system
      number: 443
      protocol: HTTPS
    tls:
      mode: SIMPLE
      credentialName: cf-system-cert
  - hosts:
    - cf-workloads/*.apps.vcap.me
    port:
      name: https-workloads
      number: 443
      protocol: HTTPS
    tls:
      credentialName: cf-workloads-cert
      mode: SIMPLE
---
apiVersion: kapp.k14s.io/v1alpha1
kind: Config
metadata:
  name: kapp-config
rebaseRules:
- path:
  - metadata
  - annotations
  - pv.kubernetes.io/bind-completed
  type: copy
  sources:
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: PersistentVolumeClaim
- path:
  - metadata
  - annotations
  - pv.kubernetes.io/bound-by-controller
  type: copy
  sources:
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: PersistentVolumeClaim
- path:
  - metadata
  - annotations
  - volume.beta.kubernetes.io/storage-provisioner
  type: copy
  sources:
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: PersistentVolumeClaim
- path:
  - spec
  - volumeMode
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: PersistentVolumeClaim
- path:
  - webhooks
  - allIndexes: true
  - rules
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - metadata
  - annotations
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: ServiceAccount
- path:
  - metadata
  - annotations
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - webhooks
  - allIndexes: true
  - namespaceSelector
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - webhooks
  - allIndexes: true
  - clientConfig
  - service
  - path
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - webhooks
  - allIndexes: true
  - sideEffects
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - webhooks
  - allIndexes: true
  - timeoutSeconds
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: admissionregistration.k8s.io/v1beta1
      kind: MutatingWebhookConfiguration
      name: resource.webhook.kpack.pivotal.io
- path:
  - spec
  - healthCheckNodePort
  type: copy
  sources:
  - new
  - existing
  resourceMatchers:
  - apiVersionKindMatcher:
      apiVersion: v1
      kind: Service
---
apiVersion: v1
kind: Namespace
metadata:
  name: kpack
  labels:
    istio-injection: enabled
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: builds.build.pivotal.io
spec:
  group: build.pivotal.io
  version: v1alpha1
  names:
    kind: Build
    singular: build
    plural: builds
    shortNames:
    - cnbbuild
    - cnbbuilds
    - bld
    - blds
    categories:
    - kpack
  scope: Namespaced
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: Image
    type: string
    JSONPath: .status.latestImage
  - name: Succeeded
    type: string
    JSONPath: .status.conditions[?(@.type=="Succeeded")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: builders.build.pivotal.io
spec:
  group: build.pivotal.io
  version: v1alpha1
  names:
    kind: Builder
    singular: builder
    plural: builders
    shortNames:
    - cnbbuilder
    - cnbbuilders
    - bldr
    - bldrs
    categories:
    - kpack
  scope: Namespaced
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: LatestImage
    type: string
    JSONPath: .status.latestImage
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: clusterbuilders.build.pivotal.io
spec:
  group: build.pivotal.io
  version: v1alpha1
  names:
    kind: ClusterBuilder
    singular: clusterbuilder
    plural: clusterbuilders
    shortNames:
    - clstbldr
    categories:
    - kpack
  scope: Cluster
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: LatestImage
    type: string
    JSONPath: .status.latestImage
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kpack-controller
  namespace: kpack
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kpack-controller
  template:
    metadata:
      labels:
        app: kpack-controller
        version: 0.0.9-rc.41
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      serviceAccountName: controller
      containers:
      - name: controller
        image: gcr.io/cf-build-service-public/kpack/controller@sha256:6677501fb8073ddc6c61c9fb4bfd1427eb43ce3a06f9fb522ca2aff348ae6c90
        env:
        - name: CONFIG_LOGGING_NAME
          value: config-logging
        - name: CONFIG_OBSERVABILITY_NAME
          value: config-observability
        - name: METRICS_DOMAIN
          value: kpack.io
        - name: SYSTEM_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: BUILD_INIT_IMAGE
          value: gcr.io/cf-build-service-public/kpack/build-init@sha256:386452ea690ed497b092977209079c3f310e6fdf94523387e517df97f7f64cb3
        - name: REBASE_IMAGE
          value: gcr.io/cf-build-service-public/kpack/rebase@sha256:61f91010e8b77eb6b0d28d69a417a7f597a3fb0d9b2d4e63980be3e64d76721e
        - name: COMPLETION_IMAGE
          value: gcr.io/cf-build-service-public/kpack/completion@sha256:de0f72cae50a8db095c6b97a17e7acc79004a5468b1d554b7cd2a9019e9cc807
        - name: LIFECYCLE_IMAGE
          value: gcr.io/cf-build-service-public/kpack/lifecycle@sha256:8b0dea6d3ac03a2d4a2e6728e64ae0d6bf15bf619d4bfbe9ddd70e0fcd7909bc
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: controller
  namespace: kpack
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kpack-controller-admin
rules:
- apiGroups:
  - build.pivotal.io
  resources:
  - builds
  - builds/status
  - builds/finalizers
  - images
  - images/status
  - images/finalizers
  - builders
  - builders/status
  - clusterbuilders
  - clusterbuilders/status
  - sourceresolvers
  - sourceresolvers/status
  verbs:
  - get
  - list
  - create
  - update
  - delete
  - patch
  - watch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  verbs:
  - get
  - list
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  - pods
  verbs:
  - get
  - list
  - create
  - update
  - delete
  - watch
- apiGroups:
  - experimental.kpack.pivotal.io
  resources:
  - custombuilders
  - custombuilders/status
  - customclusterbuilders
  - customclusterbuilders/status
  - stores
  - stores/status
  - stacks
  - stacks/status
  verbs:
  - get
  - list
  - create
  - update
  - delete
  - patch
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kpack-controller-admin-binding
subjects:
- kind: ServiceAccount
  name: controller
  namespace: kpack
roleRef:
  kind: ClusterRole
  name: kpack-controller-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kpack-controller-local-config
  namespace: kpack
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kpack-controller-local-config-binding
  namespace: kpack
subjects:
- kind: ServiceAccount
  name: controller
  namespace: kpack
roleRef:
  kind: Role
  name: kpack-controller-local-config
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: custombuilders.experimental.kpack.pivotal.io
spec:
  group: experimental.kpack.pivotal.io
  version: v1alpha1
  names:
    kind: CustomBuilder
    singular: custombuilder
    plural: custombuilders
    shortNames:
    - custmbldr
    categories:
    - kpack
  scope: Namespaced
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: LatestImage
    type: string
    JSONPath: .status.latestImage
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: customclusterbuilders.experimental.kpack.pivotal.io
spec:
  group: experimental.kpack.pivotal.io
  version: v1alpha1
  names:
    kind: CustomClusterBuilder
    singular: customclusterbuilder
    plural: customclusterbuilders
    shortNames:
    - ccb
    categories:
    - kpack
  scope: Cluster
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: LatestImage
    type: string
    JSONPath: .status.latestImage
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: images.build.pivotal.io
spec:
  group: build.pivotal.io
  version: v1alpha1
  names:
    kind: Image
    singular: image
    plural: images
    shortNames:
    - cnbimage
    - cnbimages
    - img
    - imgs
    categories:
    - kpack
  scope: Namespaced
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: LatestImage
    type: string
    JSONPath: .status.latestImage
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: v1
kind: Service
metadata:
  name: kpack-webhook
  namespace: kpack
spec:
  ports:
  - port: 443
    targetPort: 8443
  selector:
    role: webhook
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: sourceresolvers.build.pivotal.io
spec:
  group: build.pivotal.io
  version: v1alpha1
  names:
    kind: SourceResolver
    singular: sourceresolver
    plural: sourceresolvers
    categories:
    - kpack
  scope: Namespaced
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: stacks.experimental.kpack.pivotal.io
spec:
  group: experimental.kpack.pivotal.io
  version: v1alpha1
  names:
    kind: Stack
    singular: stack
    plural: stacks
    categories:
    - kpack
  scope: Cluster
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: stores.experimental.kpack.pivotal.io
spec:
  group: experimental.kpack.pivotal.io
  version: v1alpha1
  names:
    kind: Store
    singular: store
    plural: stores
    categories:
    - kpack
  scope: Cluster
  subresources:
    status: {}
  additionalPrinterColumns:
  - name: Ready
    type: string
    JSONPath: .status.conditions[?(@.type=="Ready")].status
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  name: defaults.webhook.kpack.pivotal.io
webhooks:
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    service:
      name: kpack-webhook
      namespace: kpack
  failurePolicy: Fail
  sideEffects: None
  name: defaults.webhook.kpack.pivotal.io
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  name: validation.webhook.kpack.pivotal.io
webhooks:
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    service:
      name: kpack-webhook
      namespace: kpack
  failurePolicy: Fail
  sideEffects: None
  name: validation.webhook.kpack.pivotal.io
---
apiVersion: v1
kind: Secret
metadata:
  name: webhook-certs
  namespace: kpack
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kpack-webhook
  namespace: kpack
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kpack-webhook
  template:
    metadata:
      labels:
        app: kpack-webhook
        role: webhook
        version: 0.0.9-rc.41
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      serviceAccountName: webhook
      containers:
      - name: webhook
        image: gcr.io/cf-build-service-public/kpack/webhook@sha256:b57ef8d30ad548de39ee7105fe9f783c02ab181c2b80ef68cbd9b7a0bc66ac44
        ports:
        - name: https-webhook
          containerPort: 8443
        env:
        - name: CONFIG_LOGGING_NAME
          value: config-logging
        - name: CONFIG_OBSERVABILITY_NAME
          value: config-observability
        - name: METRICS_DOMAIN
          value: kpack.io
        - name: SYSTEM_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: webhook
  namespace: kpack
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kpack-webhook-certs-admin
  namespace: kpack
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - secrets
  resourceNames:
  - webhook-certs
  verbs:
  - update
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kpack-webhook-certs-admin-binding
  namespace: kpack
subjects:
- kind: ServiceAccount
  name: webhook
  namespace: kpack
roleRef:
  kind: Role
  name: kpack-webhook-certs-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kpack-webhook-mutatingwebhookconfiguration-admin
rules:
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  resourceNames:
  - defaults.webhook.kpack.pivotal.io
  verbs:
  - update
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - validatingwebhookconfigurations
  resourceNames:
  - validation.webhook.kpack.pivotal.io
  verbs:
  - update
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - validatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - storage.k8s.io
  resources:
  - storageclasses
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kpack-webhook-certs-mutatingwebhookconfiguration-admin-binding
subjects:
- kind: ServiceAccount
  name: webhook
  namespace: kpack
roleRef:
  kind: ClusterRole
  name: kpack-webhook-mutatingwebhookconfiguration-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: authentication.istio.io/v1alpha1
kind: Policy
metadata:
  name: cf-blobstore-allow-plaintext
  namespace: cf-blobstore
spec:
  targets:
  - name: cf-blobstore-minio
  peers:
  - mtls:
      mode: PERMISSIVE
---
apiVersion: authentication.istio.io/v1alpha1
kind: Policy
metadata:
  name: kpack-webhook-allow-plaintext
  namespace: kpack
spec:
  targets:
  - name: kpack-webhook
  peers:
  - mtls:
      mode: PERMISSIVE
---
kind: ServiceAccount
apiVersion: v1
metadata:
  name: fluentd-service-account
  namespace: cf-system
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: pod-namespace-read
  namespace: cf-system
rules:
- apiGroups:
  - '*'
  resources:
  - pods
  - namespaces
  verbs:
  - get
  - watch
  - list
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: fluentd-service-account-pod-namespace-read
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: pod-namespace-read
subjects:
- kind: ServiceAccount
  name: fluentd-service-account
  namespace: cf-system
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluentd-config
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  fluentd.conf: |
    # Inputs
    <source>
      @type forward
      tag forwarded.test
      port 24224
    </source>

    <source>
      @type tail
      @id in_tail_container_logs
      path /var/log/containers/*.log
      pos_file /var/log/fluentd-containers.log.pos
      tag kubernetes.*
      refresh_interval 1
      <parse>
        @type multi_format
        <pattern>
          format json
          time_key time
          time_format %Y-%m-%dT%H:%M:%S.%NZ
        </pattern>
        <pattern>
          format /^(?<time>.+) (?<stream>stdout|stderr) [^ ]* (?<log>.*)$/
          time_format %Y-%m-%dT%H:%M:%S.%N%:z
        </pattern>
      </parse>
      read_from_head true
    </source>

    # Filters
    <match kubernetes.var.log.containers.fluentd**>
      @type null
    </match>

    <filter kubernetes.**>
      @type kubernetes_metadata
    </filter>

    <filter kubernetes.**>
      @type record_transformer
      enable_ruby
      <record>
        app_id ${record.dig("kubernetes", "labels", "cloudfoundry_org/app_guid")}
        instance_id ${record.dig("kubernetes", "pod_id")}
        structured_data \[tags@47450 source_type="${record.dig("kubernetes", "labels", "cloudfoundry_org/source_type")}"\]
      </record>
    </filter>

    <filter forwarded.**>
      @type record_transformer
      enable_ruby
      <record>
        structured_data \[tags@47450 source_type="${record.dig("source_type")}"\]
      </record>
    </filter>

    <filter **>
      @type grep
      <regexp>
        key $.app_id
        pattern /.+/
      </regexp>
    </filter>

    <match **>
      @type syslog_rfc5424
      host log-cache-syslog
      port 8082
      transport tls
      trusted_ca_path /ca/tls.crt
      <format>
        @type syslog_rfc5424
        proc_id_field instance_id
        app_name_field app_id
        structured_data_field structured_data
      </format>

      <buffer>
        @type memory
        flush_mode immediate
      </buffer>
    </match>
---
apiVersion: v1
kind: Service
metadata:
  name: fluentd-forwarder-ingress
  namespace: cf-system
spec:
  selector:
    app: fluentd
  ports:
  - protocol: TCP
    port: 24224
---
apiVersion: v1
kind: Service
metadata:
  name: log-cache
  namespace: cf-system
spec:
  selector:
    app: log-cache
  ports:
  - protocol: TCP
    port: 8083
    name: http
---
apiVersion: v1
kind: Service
metadata:
  name: log-cache-syslog
  namespace: cf-system
spec:
  selector:
    app: log-cache
  ports:
  - protocol: TCP
    port: 8082
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: log-cache-external-virtual-service
  namespace: cf-system
spec:
  gateways:
  - cf-system/istio-ingressgateway
  hosts:
  - log-cache.vcap.me
  http:
  - route:
    - destination:
        host: log-cache.cf-system.svc.cluster.local
        port:
          number: 8083
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: log-cache-ca
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVaekNDQXMrZ0F3SUJBZ0lRSlB0LzdqL2IxQy83Z1RPd00vRHhiakFOQmdrcWhraUc5dzBCQVFzRkFEQTkKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEZUQVRCZ05WQkFNVApER3h2WnkxallXTm9aUzFqWVRBZUZ3MHlNREEyTWpneE9UQXpNakZhRncweU1UQTJNamd4T1RBek1qRmFNRDB4CkREQUtCZ05WQkFZVEExVlRRVEVXTUJRR0ExVUVDaE1OUTJ4dmRXUWdSbTkxYm1SeWVURVZNQk1HQTFVRUF4TU0KYkc5bkxXTmhZMmhsTFdOaE1JSUJvakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBWThBTUlJQmlnS0NBWUVBOTlSdApJdmNyeVN3K01qRTFVaW9Oa0w2aisyWGtzYmRIOXZUMFg3dWExbTIxODhqMVRLKzl2RlFUTGNBZGQ4V1Zab3AwCmZlZXZLaGdmVGExRG04dDB6VEpEcDlKZ1dsUjBiYXhSSDRDQXRxS0pCZkRoalFiUnJuUSs3Q21pV3BhQUQxRmQKWGVlcDV6eWJrRzhWQ0V2MkVwOEZCRkR6alJUeVM3VDQrb2wvcHdhVmhHTExJeW9IdnZSRXcyeGZqV2plQ2IxVQpPa2FGUWpxQ1M4NGM0U2pSd3ArS0hrYXhuSWgzQ2t2OW1ObEVrLzN5UktWWHc2dThBZThwVm5pZDE2RWhDYkFKCjFoeDNlREZIV1NpWm5TSURFOFUzWWZIWm40a09rOURsdmV3T3BONUtuRmRienRUWlJqazFtTnNLM0FEOFBzSncKQnROWUdhU1BFMVRUcWF1bS9BL3o3dFJRUVh2cytXZENCazY3akJNSS9kZWgvRUNvL2s2bXh0UjZobXJNNGNKSwp2SWwvZC9uZTBHZ3p2ZUFNcXZCK0Z1ejlKMittUWx2b21vYkdobWh2M2FTdGF0R2kyOVZzTFlLWk9DTUh1NTJOClFRRmRpZTV0bFpZL2MvRU1KZFRsUHhZTi9RSTZYd3U5VWcveTdpOXc4alNiUWdQdGFWYVppem5uc0JpREFnTUIKQUFHall6QmhNQTRHQTFVZER3RUIvd1FFQXdJQkJqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01CMEdBMVVkRGdRVwpCQlNyWDJrR0FQaTd5bzRNZWMvY2NWcytqQm50UURBZkJnTlZIU01FR0RBV2dCU3JYMmtHQVBpN3lvNE1lYy9jCmNWcytqQm50UURBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVlFQU9yT1Z4MDZ5bXBtaG5MbVg2Q3RtUEpLaE16dXoKY0dtdkU1Q2lrRExyY0pyTFozZnBOWnJ3NG9ESExOelJCRGk1cFJDUHduUENHd3M4bVNFM040eVJrNEJ1UE5qRApMMXpHZGNuOXpkT2ZtNzRNRlEwazAvTFlIWEtneGliYTI4VUZ2UFJ2ZUdxbENGM3p1RlVTbmh3MHdQV1NFKzZhCm9ya1phS1FPQk1OcG9uT2xzbkUzdVk2dkZ1Wm56RldHN2lUa2RaVnB2dkJ6Z2pWSWZtbWtjTHBIUEVaQUI1b0EKMEJGcjJLR0R4RGFzdE9BS3ZxdjlENDBpNUNPSzdBN2xhb3ZoeW1RRkdOT0g4K2NCQjhOT2pFRkl1VXoxK0VndgpzUnZDblVxbWFRQVZ4bTBMaUZGSlNlc0RSek02bGtscW1VWjA4R1VGUlBJSzlmR2tONEY4R29XVW1hdXlpZ2hICm5aVlJ6VWJWV2UrNUVpanhDNjdVQll6LytaZGlNMW1Halp1SGJZWFVSbnNFZEFTeUVVN1RYei80RW1EYkt3eE4KUTVMMlQwV3NmcW9SM3NxSEkwUzVRTjB0OEFlaXlyeHdkTzRkeDJzZkVEeXZtWTdYQzFFTWtYcDR2QkVaNHdQMwoyVkVMdENNdjBtQVNGM2tyeHZMa1ovTXdYMG8veExaV2FTdUQKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNHdJQkFBS0NBWUVBOTlSdEl2Y3J5U3crTWpFMVVpb05rTDZqKzJYa3NiZEg5dlQwWDd1YTFtMjE4OGoxClRLKzl2RlFUTGNBZGQ4V1Zab3AwZmVldktoZ2ZUYTFEbTh0MHpUSkRwOUpnV2xSMGJheFJINENBdHFLSkJmRGgKalFiUnJuUSs3Q21pV3BhQUQxRmRYZWVwNXp5YmtHOFZDRXYyRXA4RkJGRHpqUlR5UzdUNCtvbC9wd2FWaEdMTApJeW9IdnZSRXcyeGZqV2plQ2IxVU9rYUZRanFDUzg0YzRTalJ3cCtLSGtheG5JaDNDa3Y5bU5sRWsvM3lSS1ZYCnc2dThBZThwVm5pZDE2RWhDYkFKMWh4M2VERkhXU2lablNJREU4VTNZZkhabjRrT2s5RGx2ZXdPcE41S25GZGIKenRUWlJqazFtTnNLM0FEOFBzSndCdE5ZR2FTUEUxVFRxYXVtL0Evejd0UlFRWHZzK1dkQ0JrNjdqQk1JL2RlaAovRUNvL2s2bXh0UjZobXJNNGNKS3ZJbC9kL25lMEdnenZlQU1xdkIrRnV6OUoyK21RbHZvbW9iR2htaHYzYVN0CmF0R2kyOVZzTFlLWk9DTUh1NTJOUVFGZGllNXRsWlkvYy9FTUpkVGxQeFlOL1FJNlh3dTlVZy95N2k5dzhqU2IKUWdQdGFWYVppem5uc0JpREFnTUJBQUVDZ2dHQVFUbyswMEljMnlEeTZjRDcyTGxLd3JyNmEvT0FncW5MbmhzUQpxcFcxQmhUd0c4N2JpU2lFRnFwR05mZG5paHVOMitRN0R0eEl4UnArT3JLTXBkZWgwVlFXYkhnNWRlemVpL01iCmt0LytnSk04M3p4c0VQTW5ndlFEajZMUm9XZ1ZJbkwyMFAxbFFZQTVMWVdmRW9UenFpa0NhQVZxWk1xTGp4TjkKcUd0Q0Z0THJ6V0UzTi9VYS9zNUp2dW1xS0l6ZVM4L3grRGlSWUVJSUF5Mm5lamVGSmVWWnMraEZYUDZwM2lMcwpCeXZBR2ZkdnFWT2ZTdGZMYnZMa2ZXYlhuR1pDeUROM2VrTWlwaDFYYVNLWnZvSzg5ZldhQUJVOFRUTWZWSSsrCmxrcWEzSm9ZaXdRN1dlT2NIdjFLRFN5TVVsUWdWdEJoVEpnRE9EL0ZXRDNIL216SjFlVjU5T1VNOHlESUxuaGIKM3FMVm4vdnZQMTI1bHgrYmtmeGRBaDlJbGpqM244RHY5LzFNRmdtb0EzZW5EbDJreHlQZnVaRUZSSit0TmZGRwozVEVIYUdlM2VnVDlPbHRKcTVVa0pCdUtIcXZvWi9pNEZJME9EY3RBYWRCZSsrNm9Wb3UxQUxZcFJ1V3hqL3h2CktMczRWSnNTZ3F3ZXNUa29PQ0hTOS9qWklkWmhBb0hCQVBxVGxnUjZWdlRwelowWXpBWDBiVkZaZDltQ2FITTYKa0xQV0dEOE1yRUdQMXY1NHZyUVUzTWZ2YkJ1NjRTSmlNWlhvUFdNN2RVY3Z5U043T0JEVGdFeENSWXN3RDd6SwppY0ZoKzU4VFlyN3JNMnNPc28rZnl4L2JTK2RmU25sQkwvOVZMOS9rV0plSXNjSGhSbDNYYU51L0FkTTlCMTZhClVwWkNVZ3Q1OGhrZzdYQUo0S0k5b0MrZ090bm5rZ1VNY2RhUGpBamtTUlY0bHNqUU91K1VleUdwMTYxc1BUbmcKczc3RDJmb3NjVHpQam54ZmNBMHNaSXg0eVJWRndZWjdjd0tCd1FEOU1aNy9KSlduRCtMMER1M2lSTUtrKzJKYwo4a2RNaFdXc1dHQXo1QXJTQW1ibFdXdlFkRXQ0ZHR3ak9OM2JndkJ1a3Z5bGNhQ25zclpwbjBjSEI4bk1nSTFyCnZyT24wNXQ2bnZmSnlJdGlPc1M5SFBRSzBnTGY2Nyt5eTZpRENqWHJNR3dpZkNpZmYvRkdDZnYyeUYvUzdIVzYKUmpQVHRvRHQ4YlpJYUEwZFh3VWovOE00Y2Y1VGVUNnFWQy9DRWZ2SWRCR09QSWpuTWVnZWJ5N3h0L2lNRWhFVQppR0M4K09JWlFPRjRpTVBmbVlNZlp0RTN1VEV3cVJ4Z3RCZUV5ckVDZ2NBNGVONk1iODM5TUZ3b2xaZ1ZsM3F6CnBNZy8rd1h6UWpXdWNnZlEzZGhNaGxCYjFYYVZPMFp1d09US2N4bWVHQ2M0czdoeURzcGxtcjFvQTdNbEI2V1kKaWk4R0tYVENoWnI2UEV6ckV3RmtLYm5TM09NZFAxUVYvK1JoWnJad0VXTHgxbzhObEhicTMrRy80amRybXNxRgpDODByZ0V1UzVKRE1VSElSS0JDSjNVUGx4alFjSEd0bmtHTHpEUjk1aDg1NEhxM2VxeVJWZEhIM0hBYk1TOWhjClE5elp0dFV0b0JpaVc1MWFwbjEyeVFoQnUzaVRYM2ZodUs4STNrbTVOMFVDZ2NBT0FEaHlrMnRUR2FYTEtTZ3UKWXU4QWdJWW43WjNUdFd5eDR4RXV6V1ZyeDRZNUdJREZ2aWlPT01SampqbDJjZjhwbmljcVh1WXJYODZHZUxCTQp5emwxZllaVWR1OG9VS05BWEpvSEpuZk9yc0ZDVTkrSzJhSWZEOEpCK05FUXJmZmRVWWdwUUFSZkRZd2grMXRiCmdpa0tXTmtKdStnUnhQM01LcG1SMTI4aU9LYm9IclNFNG9qVnhOYWFSSjEvZGM4ZWZveVorTzc1R2VGa0RYSGoKRy9FNmphVTBKWFp6L0s5RUJqcHhsOTU4OXRneFhGWWxackE1cUtCUkdLUlVTNEVDZ2NFQTdGQkNJam9IR0JvbQpkMDhwVDV6S2ZqM3Urb1B1bmc1WS9sejdsS29sZWV6aWFyWGI4c0VqVjJscUxYWmx3YklVTDdMV2RXMHNvQkZhCm43TW9LdkpmbkRTdlU0Mzd2eFdlT3dIODk1UlB1aWVHTUwwdXpLRWtaRGJTY01maDJiVWJSRFB6L1c2NHFmMlcKSmJOOVhjdDBvS3ZVSUZYam80K3U2SFY3MW5DdUhCMWhIN0EzNUpyWDhabFVjZEJwWmxROE1oUlFBQXNzK2o0NwpUQ0pxUmlqYWU2RFNyM1ppb0k1NHlVUXpzRWpvQk5oMzlod3Ivd0RmZXF6eTJwOExKQXd2Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCgo=
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: log-cache
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVnRENDQXVpZ0F3SUJBZ0lRUnc4NWNzVjMzQUljaEJtOHQ2eklMVEFOQmdrcWhraUc5dzBCQVFzRkFEQTkKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEZUQVRCZ05WQkFNVApER3h2WnkxallXTm9aUzFqWVRBZUZ3MHlNREEyTWpneE9UQXpNak5hRncweU1UQTJNamd4T1RBek1qTmFNRG94CkREQUtCZ05WQkFZVEExVlRRVEVXTUJRR0ExVUVDaE1OUTJ4dmRXUWdSbTkxYm1SeWVURVNNQkFHQTFVRUF4TUoKYkc5bkxXTmhZMmhsTUlJQm9qQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FZOEFNSUlCaWdLQ0FZRUFzOFJpOHBBSQpIdGhYdUx3RFU4VWMyL0IwV0hUdHRaQ1FZR2cxZ0NHb3l5QUhjb3ZVemFRMlQxZmFUK2hNY0NhOGd1bnlOUnR5CmVYYjlwV3pEaGppcmxyZEk1Qk1tSEkrRFRtMUpNMUhyeXVjRnYzZUJFN1ZnaU5oakdDSytJNlRFUjE3Zm1wVGcKQVBxdWZ6VnU1bXdYMEo1NitOZVpEYnROZ0RGOTNsSnN6V1o4VWZHR3Z3bkUyaTVaVEJkQldNVVZuV1NmNEtKWApqYWRVZG43b25QR3ZwSlVsVVVpalM2YWRweXM5ZDJVbVRLTEpmb2tZM0lLOTNxMWNSWXhyWlM5WTZLQzJuNE9BCk1FdXdUc0JRUldNL09PK0U3RHRNWGpjWWlndXZHU1FIb1Uxd2RkNWFZM3E3RThQbURJVjladjZRVXprbVYwWnQKc3FFdzZENUJrd1VsNE5odG1vSmZPSXRUZE1hVW40NmV6Mm9GVUwzbEpQWWJaMTd3TTl4bTFRelNUWWg3MDg1ZgpPQVhxOVZRb1FTZWVvY29IZEJQTm8xU0puZ1p0eGRYaG9OOTVrWTVsSFNmOERmeXoxaUUwNnFuUTY1RXg3VFlPCmVHTmo1Q3JFLzdNUkp2cnk1alpESzg3bEs5MFMxMWFKbElsS3VXbmEyeWJwTzFxbysvbzFvT1JKQWdNQkFBR2oKZnpCOU1BNEdBMVVkRHdFQi93UUVBd0lGb0RBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSApBd0V3REFZRFZSMFRBUUgvQkFJd0FEQWRCZ05WSFE0RUZnUVUyaG44QmI4YTJDZXJwQnRoMzk5WnBOSkxTVVl3Ckh3WURWUjBqQkJnd0ZvQVVxMTlwQmdENHU4cU9ESG5QM0hGYlBvd1o3VUF3RFFZSktvWklodmNOQVFFTEJRQUQKZ2dHQkFGaGl4L0xxUDdTb1gwb1ZBQ2JlYXB5MnJrRlRtOVB1SXV3UmVFanBnRm9mbi9wNjRQcTZkT2krQWRGTQoycFJZZ3Y0Z0Q5aC85bDZHSEE1ZU8wd2c2d29BMGFVeUErTTRKS29jTmJOa0RKbkdpWmV6ZVI0MmhGY1VLUHBqCmVwUjNOWC9VblhVSmJ3ejRPdjZ3SmN1eTd5MHNTcFpIdkRZZHY1V1JxTGpCd3Nidm1tSUpPbUNSd1A3Sktkd1UKeXV3QnVTRHN6MHd4djFsczBiaHZobHpjMWM1MzA3cEhCb2xRVkxRMFRmQm1SZmoyV0lrSjlxYzJ1MGVOYTJEaQpPUCt0MXI5aEh6K1ZOSE1KL2RvNit3U3owQ01EVEtqVk16bE9EeXVxYkk5eWdUOS9NSXZtTmhUNVByendMVUFnCmJlLzlsRGt1NW4yQVdDa2ZveTA5WmlPTkF6OGN6cHhaaGN2QjlkTkhSOFE2R0FhVW1UR3BvenJmWGhmbjdjK2gKOUdVRVFuWWZKR3V4NEk2ajhJUUk2bGtjNjNsZjlyZmVTWmd6MFllcFdXcG1aUjhMOXVMMzBtSnducVlEclNrRgpRaUFKaEV2Q2pFM0tCdDB4aVR0Ykg1KzR4NjJFb044SUM2QUcyc1B0dFUzd2hSTU9Fb3J2QnhNbW9PSDZ1b05YClNiams3dz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNWdJQkFBS0NBWUVBczhSaThwQUlIdGhYdUx3RFU4VWMyL0IwV0hUdHRaQ1FZR2cxZ0NHb3l5QUhjb3ZVCnphUTJUMWZhVCtoTWNDYThndW55TlJ0eWVYYjlwV3pEaGppcmxyZEk1Qk1tSEkrRFRtMUpNMUhyeXVjRnYzZUIKRTdWZ2lOaGpHQ0srSTZURVIxN2ZtcFRnQVBxdWZ6VnU1bXdYMEo1NitOZVpEYnROZ0RGOTNsSnN6V1o4VWZHRwp2d25FMmk1WlRCZEJXTVVWbldTZjRLSlhqYWRVZG43b25QR3ZwSlVsVVVpalM2YWRweXM5ZDJVbVRLTEpmb2tZCjNJSzkzcTFjUll4clpTOVk2S0MybjRPQU1FdXdUc0JRUldNL09PK0U3RHRNWGpjWWlndXZHU1FIb1Uxd2RkNWEKWTNxN0U4UG1ESVY5WnY2UVV6a21WMFp0c3FFdzZENUJrd1VsNE5odG1vSmZPSXRUZE1hVW40NmV6Mm9GVUwzbApKUFliWjE3d005eG0xUXpTVFloNzA4NWZPQVhxOVZRb1FTZWVvY29IZEJQTm8xU0puZ1p0eGRYaG9OOTVrWTVsCkhTZjhEZnl6MWlFMDZxblE2NUV4N1RZT2VHTmo1Q3JFLzdNUkp2cnk1alpESzg3bEs5MFMxMWFKbElsS3VXbmEKMnlicE8xcW8rL28xb09SSkFnTUJBQUVDZ2dHQkFKVWd3ckRVbVZmMVF2aEdTRUJURWJqSEJjMW4ydGEzUVg0bwpsTkZobXVRL0FzNmNmNEhFeXlVUkRWTWlzMTZLVS9JS1gxcDlGWDc4SGprQVBFZDVkYWNIRDFuZEpNMm1wRmdJClF5Um12a1BKV0xSWVQrVG9uMWVHb3RZZjVEb3Zjb0Irak9Kd3hFOHJwbHh6R0RmZ3pmVExzOW9CQ01BaWRJMTMKQVNMUW45L1pPQ0xHU1hEcmlya3duL1dHaVRnNTdzOXQ3VTl0ZlZKTzBMdW9WaEgwVVRBb1poZkRPV3dGb1YxUAplcU0wYnd3K013ZGNkaHBmLzJEZDBlRUVOd2R1dVY2TXBxNm9tek1NamhUU1JiMjdVNXUxY3MwY2hkUzlibkJNCmxJOU05eEY0cTE4S0lHRW12QWl1RTg2VlVZWUgwTUZralZONktSN2wyTzhkUjg3Uk16NC9nUUpIMmxpQkNKOGEKejlMQlE4MndCTEp2SWx0MjlXSStxZFFaRkliNkU1dnA3cXpjRE02dzZFT0kvVTFwZ0ZWVnN3a08rKzZLbXRsdQozcStJbzZKOWRpSE5lY1FjaG5ZMitEUjJweGt6UEhvck05MHVmZW5wSEx5L2k2bWhSWDlIQUNQVkhsbmdNeGtFCjFoTjJuMjIxTlN5MjhaVUJWZ25UQUFtQ3Ywdjc4UUtCd1FEcXNjYjZoNU1VaHRmNzlnR0FsdW1xcGdQbWFhSmwKdzMxRGc3M3IyNWhFZXFTWHlJTG1SWlRSK3hrMTN3V1c1MXlnWndrU0NFaWRZL2p0bHFCTmxzdGlBWUhvWE1WWgowN0tNV05FVWswMDlTKzZYTHY2MGRUWDNQUVBhS1BnREtEUmtGWTIwaEVvdkJhM1NHcDArbDhjREhFeUlCcGJHCnVtcUsrYnpuL2k3U28rWHF5QjNIYXhPSGtCU1Q1cFJFRi9hZnhwRjNkeTIvcnk4cGxzRDBFalVmR3d3R2R6dWsKa0piWHZuVysxTjY3V2xjZlloakIzcDdxdE1vbW01VE1jYTBDZ2NFQXhCWWR6cmRlSFhoTnlTdkdvNXNnVS91MgpsakppN0gva0M2NWR0c0NLQUtrWGdDck1Zbk8zNGRhdDRVOXRMY3I5OU9wMjdMcjA0bEIwWkhXTElWa1VRZi9GCndqTWFUdjdSd3F3TDhrNGVnbW9ydHRuNkxpM3ZCaWhNYklXczFXNWdyZlRJOVFabzVQRllaUGVOQVM3aXhWbnkKSWhmK0huT0RPWElwNUxUVmk4cStONXVXS0F3elpUQWdnSXVOMGpROEx5SzQ4WTQyYWZnUGdJOTc2MjlkaHlVUAoxTmJzNW9EWEwrTGF4MThrdHJQNVY0MUJGc2NZcnlXOTJkOUpPR2lOQW9IQkFMSjhTemdpdlErQ1VXWDBQRVkvCi95cmhvTnV0Z0d6bUZEQ3hVMUc1S244QnlvVUlYOHlpSkVEaE50WUthMlROUlZ0VG9NbE85WEtGSWo0R0xKbDEKVWUyUitlcnVDc1I2eERJS0pkQUJDbC9RakgzN3BvYzFFTHFiYzMrSllyeDc2Z1FuaENKQjdXei9ZNmNDeUkxZQp2bUkyTmxuSXNRZ25vM2xYM251TWlxMTFLaGk0NGpUVDBRRnE2TXRtTTJIcDI0eTlaY20ySUZ2RDdoa3g1a0o0ClNtQUNvTTJXQmd6c1RWdDhKRzNoMUJZbDZWWWJzM3BWUlFSNFE3akMzNUh2N1FLQndRQ0o4V1VXdnppZVVydW0KQWYzRHFxV2JiMENMZVBiT21VbThUZlh2VXBQQzB6R05JSTZYMUFCUUI4NWE2cDFMMGJuR1NndFBqbFludjZHaAo2bTd1RHRTSmVYMk5tSld4Yk9IenFVVGVPTWFOeUZMb1Y0QUFiSi95SFBkbWdNT05naERSVDVydmhJcldSRktDCjlRTmxDYTdPVnZCWHU3a3hndUdWMEJKWXFqNXdFVGl2dGV4MFQrRDRGbHRIRXVXNk1yVUVFOUUzWFd3Nk1CLzMKdVBqY0w0UUVSclpVYkw1TGllZlg4Q2NvaW00eGVYcTNkTStOVHBLMjVENGl2MG1yUFNFQ2djRUFsb2grSzZibgovMzVWOWVEL3JRZlRSeDZIMjN0TjdOc2tZcHVDUnArYmdCTzllN1NJa0I5NE9vbmhFeXZxS0NRR2tFNkY4R1Z5CkRNblM0WHoxcythMWJIQS9LcTRYTGFhRVplUzlsakZHaE1sbDdpckhmbFZRY2lyTUIzbGF2ZEdIYlFXenRyZlAKcVZkTGx3L0xUUHBwOW1Zb05LMldtMEZnQUVSTE1idm9GdEp1OUZjdGFjTWJmb05veU9XWk1yY0VaY1Zoa1pDTgpXK25uWEd2NktzbVkwNWdlNFM0T3g1SnNJYVorcEt1T0NkS29UeGpPalVna0hJL2J0RWphVGs1YQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: log-cache-metrics
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVpRENDQXZDZ0F3SUJBZ0lRRCtuYVFjQ3MxVWY5V1lhejgrbTF2ekFOQmdrcWhraUc5dzBCQVFzRkFEQTkKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEZUQVRCZ05WQkFNVApER3h2WnkxallXTm9aUzFqWVRBZUZ3MHlNREEyTWpneE9UQXpNalZhRncweU1UQTJNamd4T1RBek1qVmFNRUl4CkREQUtCZ05WQkFZVEExVlRRVEVXTUJRR0ExVUVDaE1OUTJ4dmRXUWdSbTkxYm1SeWVURWFNQmdHQTFVRUF4TVIKYkc5bkxXTmhZMmhsTFcxbGRISnBZM013Z2dHaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQmp3QXdnZ0dLQW9JQgpnUURsN3NrSjlGNDZoVnlXMkgrbEYwUkk4WDlMTllhVnJ4Y0Z4cWxUb1FFQlFoZVdNQXZOWldXZkdVQTZWRVkrCmxIT0RlOVk4UnNYUC83aFI3M09xQmpsZHpCN28yK3hCOHplU2xEK3pTOEN4YllRaEU5SDhKUjE5d3lKa0l4dWUKcytOMFZKMEJnc1YwcTRNN2tmcXdKVHNPanVvSXRkSTllVElpT01LYmg4RE13UFdIUWFWdTlXdXV3dlJ0d2NCMApqZXRmZkVmL1ZEdXlRWklJY3Z2dVA2dHlSNU9YTXJ0cjkwbmRzTFhjYnZCMGFFa3VhQ0UrWHJFU0pEd2NYS2drCnk2VzJmQjhiQ1ZNWVFQb2JPWHlkbnBuRlJwcWhveExJV3NWalZuaEJOdTVNTk5GUVlMbzhvMnJRZCtWUjFFOEsKOHRCdkd2U0d3eERrdllxTXVMYWxJWmhaQ1JkN20xVXRoRE9pbHN3L0F3bFBMWUJyR3ZINlU5bzVOY0hlVktmOApwV3pWTVRwcCttaXJ0YTNrMmxTRUtGUjZ0T1ZzenJwc2M2YVk1WFI4ZGY2bDV3OE9XN0QzT1dSYk01dmpPcDQ4CjU5amZPckZiTXUxeVkwdXdseklSK1RjY3ZqUi8rME1XakZqaUVJZTFMUG9FM0JpUFlNYnNXTmFqS0ZGellNaWsKYmFNQ0F3RUFBYU4vTUgwd0RnWURWUjBQQVFIL0JBUURBZ1dnTUIwR0ExVWRKUVFXTUJRR0NDc0dBUVVGQndNQwpCZ2dyQmdFRkJRY0RBVEFNQmdOVkhSTUJBZjhFQWpBQU1CMEdBMVVkRGdRV0JCVE9mVGl3Y1NJenhDcnN3aU1WClBDOGtscTdkUkRBZkJnTlZIU01FR0RBV2dCU3JYMmtHQVBpN3lvNE1lYy9jY1ZzK2pCbnRRREFOQmdrcWhraUcKOXcwQkFRc0ZBQU9DQVlFQUdCcmR5VGR2NTRWK1k1NTU5eGJVRjVINytpRCtvMWZxUWVyL1p2YlNHUUlSS05mYwo3emJET3dBQjhabnY5L2F1OEZsYzRxUjMwVEp1dWxwQzg2Wk0reWhTUEZ5bVZrZW9SalBuMVFmSmZTVzRZSkllCmhXL3JBTGl0OGh4M1ArNEFQQ09NcjRtV1h3V0FwUlp2eEs4cGNmUWphK0RUUjFLYzA5SzN2UFY5YlE2WlNra2IKTExZMjF1L3VrWUw0Q1Z6bVpWWjdFVUtVUW00dkNkRE1GQWRrK0tDbEdXQkM1V3Q3QzQ1L2haOXQxMlkwLzUrVwp6MmNpWWVzUFdRbXBRTTA1UlhjQUJJa0dFMXJIcTVCWFlkc1l5QjkwZlM5Q0ZMS0g2cytiVkx0T2Rwd2h1U2FMCldDdXJkak9zc0dDNmJXSWY1NWc4Q0NmYUQ1ZjF4dmtNZ3g5alJxcVJFdHFkU1c2dWZzdXJodnFzMnphSDl6algKQ2wwcm4xdlR2ak1DT21qQVNBQXorR2dxZFFiSi9QMk9OT3h0cTlyd1JneHljanNUV1U1anpSbnJyMTRzbjdzRQpDOWJ1Zkg1em90aEc3OGJFbUFaTFVxSnlLRVRKeU9iT0VxK1VreGJaUUJJMjVQdjAvUzZpVms3UGpNbG5vdmo0CmM5L294QW5hMHVCK0N4bE4KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNUFJQkFBS0NBWUVBNWU3SkNmUmVPb1ZjbHRoL3BSZEVTUEYvU3pXR2xhOFhCY2FwVTZFQkFVSVhsakFMCnpXVmxueGxBT2xSR1BwUnpnM3ZXUEViRnovKzRVZTl6cWdZNVhjd2U2TnZzUWZNM2twUS9zMHZBc1cyRUlSUFIKL0NVZGZjTWlaQ01ibnJQamRGU2RBWUxGZEt1RE81SDZzQ1U3RG83cUNMWFNQWGt5SWpqQ200ZkF6TUQxaDBHbApidlZycnNMMGJjSEFkSTNyWDN4SC8xUTdza0dTQ0hMNzdqK3Jja2VUbHpLN2EvZEozYkMxM0c3d2RHaEpMbWdoClBsNnhFaVE4SEZ5b0pNdWx0bndmR3dsVEdFRDZHemw4blo2WnhVYWFvYU1TeUZyRlkxWjRRVGJ1VERUUlVHQzYKUEtOcTBIZmxVZFJQQ3ZMUWJ4cjBoc01RNUwyS2pMaTJwU0dZV1FrWGU1dFZMWVF6b3BiTVB3TUpUeTJBYXhyeAorbFBhT1RYQjNsU24vS1ZzMVRFNmFmcG9xN1d0NU5wVWhDaFVlclRsYk02NmJIT21tT1YwZkhYK3BlY1BEbHV3Cjl6bGtXek9iNHpxZVBPZlkzenF4V3pMdGNtTkxzSmN5RWZrM0hMNDBmL3RERm94WTRoQ0h0U3o2Qk53WWoyREcKN0ZqV295aFJjMkRJcEcyakFnTUJBQUVDZ2dHQU5SZmZTaklvTkFFcGNSZUsyZmMyYUZXRFhEMSsxejkzNUhpTQpEdWlGaitIUUNua0xzS0R5Unp1UWJpZVpsTWU0cUtyR3ZHSm5PUEZHZ1h6MlMxTm1tYmNSaUJtSVEyNUM3ZERYCnFMSWNTNXdMUDR3UkY5VUdLMDBNdXV5MGF3QUV6STdoTmtFWkVTaXRnK3JnWlI0anRlZmdPS1NyYUZCOCtCUDkKTSthejZWUEJIanRWVlByTW82MFd2ZVZZYUZHQkFTcDBnWXZVd1FPTkVmQmpKZytEcWo3RzRNbnhKeXdSM1dQNQppbTMvamhHcW5GR2xJMzdBQ24xZGQvc1pSRzNWWlBIRGxMK2dSQS9xemJYWnJEd3hZUFMvQ2poeFMzZ2RwWVQ0Ckx4VWt1aG1zOWhEaXg4L3dHMzJleG9WNmFMOENQeUJqL1JmbWN5dHVLUXdIL0RMZEVDU2I1U0Z6bVcwZ1VRL1AKb01wWldMMHkwNkMvMXpDTkIzZW5qRVBqdXZNbStkbXJoZTlhRlZzcU14L0tNM1Z0QzEzUngrejE3d004M0YvQQo0ZEp5RWJ4NUpCaUc4WmxtMGtyaGhKVWdBaUN6YStDaGltZWR2c05aVXBvQkxTTEk5WGFtdFRNNGdHTncxbGIyClUvQmFYemFqUVJaUUxZY0ZPQ1NyWDVUTnZtOTVBb0hCQVBBN0cvRnkrR01FUVlINm5MYzl1cnkrYVdUSmxjWlgKbEVjMmUrUkJmLzdJdmhqZjIxemtCY3RDbk4zbmRYQkhUSmdJSU01cnh2SWNITU9NcCtmVDBqTnFJaHdwTmNLWApXWExVektSVkZ5RnA1QS9pSzVWdUFVUy9JUEIxMko0UW80NXZjK2YyQjluSE5WNGJ0ZUE1TDk0ck1JTUNUeDFtCm81UGttZlJJSzRPK3krTVcxb2N2MTFkN3hKQkxhUnJqSWs3eUV5UWN6Q2p4alRSVzVmSG9JSmlaNlhNMUQ3MngKekVuajBnWHdBYkVNTHRMSGViekdBa2xKMmt2NHZVYm9aUUtCd1FEMUJwL0FYTE82a0JhMlhYUVdxUzM3SFc1bwpzSDJSVG9DK0tNbVlaZnNQMndmTmErblhVL0QyK0FwSUcxSkFCZnhJMkNRaVBjQ2Q5dlEyN0pwRHFKaGV6Z2wxCkU0dlNZQk42NnBxTS9vampUZnJGYm91UEdTdEJGWmdtbWZubWs0a2cya2dIVXBWclBqMk15TGFrRTJkaWxXMXQKZjhuOTZtS3duTkl1cXRjOXVPYnBxL1d3TWtkeEFUN3A4RXdSVDBYRk53MHJ5SkNHUm10RjZNWTE0OUU4K3R5QQpnSnhGV1lueE5lSllvVlRWeUdUbERjMVpaN2FUTDBBdit1MGw2V2NDZ2NBd3U5MEVVMDErVU11MVFaRHZQMitWCmdJOUM2ZjRmV1g3MEgySnN3TGpsaC9YQWVCRTVPK3pNK2p0MmJORVBNUGVoMCt4TDArTnRGRFRsbXJBcFFIaGgKQThQZHNLSitVbFBNRHMxZy9QNFBRanNJMmRuN20zQlljT21Pdm1sdVQzUE9ubCtHREF3MXFzcnh4MjlUQ0diawpqQ0J3UTFTbll6NEY3NWNuemtnOWxzUW4wbWM4ejREQTk1TzlyZjZwZkxCbUVZZStpTFVHRFZLVzdwWUJTQlRzCndEUnlzYTM2em9uaDUzeWd4YnFpSHhXVW52RGNVZEwrNlNPR3kvUWg0VjBDZ2NFQW5iekw3dncrditXdW1Xd0UKSmVwM3JXYy9BcXBMeTlWcnovOVYrSVArWWpDeER5OWZkTDJYTElaMXFBSGVxMVN2R3YzNkZRa0lEU2xFQW0vQwp4N2VyajZ5NExlU05hTHR0RHY0a3pJdTMrQXpsV1dCVys2SktWRFhnbzBrUXRiMVkxQXR4dnpVTTkrTXpvSVE5Ci85WjJBZU1NZFNlRkU2OW1KU2h2cnBkUXhXMVpTaWpubTZ4aWpYOHR6MUJneCt2dWtJMW1MeitJdXNodW1xekYKblQreUhiMnBZaGhwZ2NPb3A5MzJmdlF0TndzdzJMeFA3RFIyTnI1K1plVDE4aWdWQW9IQkFKL1JvSUlVeG5UcgpJdVNHaWZndHc2UHBobm9qV0NNUklrV3lNNGdWSjNSc3R0c0Vob1dNSjluTENVSmxITzNWZ1pqWEJURnY2VmlEClp6OTE2OWpCek9GbDZmNjhTU21YTUpOc1J1b2tuQUpmVW40R1hpbkRDZ3JYYkp3c2FXcGU2Ymx5M2dQbXFoMGkKQ2pzbTNiRVcyYytqTk9tVzF6bjJaSlYwVlhNWGQzU1U5ZjREeDZiNThYMHdYcm1lQ3NOWjhKY1hLSkhZY1pLMwovY004T2RTUjV2TVZiZlZGS2RtRFFpcWdVeTJmZ0pRYjRsZ3F4djlmQ0FWRVVLQjAvMXVCR2c9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: log-cache-gateway
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVvVENDQXdtZ0F3SUJBZ0lSQUx4Ynk1cWQ3TmpKMjdUNjZVWnJhM2t3RFFZSktvWklodmNOQVFFTEJRQXcKUFRFTU1Bb0dBMVVFQmhNRFZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1SVXdFd1lEVlFRRApFd3hzYjJjdFkyRmphR1V0WTJFd0hoY05NakF3TmpJNE1Ua3dNekkyV2hjTk1qRXdOakk0TVRrd016STJXakJDCk1Rd3dDZ1lEVlFRR0V3TlZVMEV4RmpBVUJnTlZCQW9URFVOc2IzVmtJRVp2ZFc1a2Nua3hHakFZQmdOVkJBTVQKRVd4dlp5MWpZV05vWlMxbllYUmxkMkY1TUlJQm9qQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FZOEFNSUlCaWdLQwpBWUVBcHZuQUlha0hFY00zcVRnYkticUlFUHZoY05BdjRmS3hvL3J1M2dIN3d0MGxsbXVGTEJKZlJPS2VvZUdnCjl5NFFaNXBwMlRJbWhGU0s0c2RleEdGQXZzUld2QTIwWGFVbVJYaHpPWDNjMlhZb1VEOXBtRnhhcHhBS3NEc04Kb1dxcmJGMTBTMzZ2YUJUZTY4eFV4MEZQQXpnZkhYVXR1RHh3b0tIbkx2eHNDeVBtUytWc3BLL1ZMNFhBbUkxeApQUkEydURjc0l6bG5RczZuYThVb1Jtc1lrVzg0TGZnWUtJN0JhVnJNbEdHd2E3VVV6L3gxcjBjSFJBcExaR1RBCk84YU9kYnhXSzJ3NjVPUDA4UFRNNFBSd0pDQWtaTjJtMmQwcU1aMmt2QTFwdnV1ZkpTemV3eFR1Y3JVd0NhUWMKWk10QUpaamIxZ0VoME9YbFQ4R0EzbjhvVUpzbUIzQjJqclBCdXhnOXd1MGlHWVJsbjdXYU5mNTU3UGREMFNqRApOYUI4Ymp3SDkzR2FCaWd3bmJuVnFVandQSHhjeWJFbEhzLzJ5STZYYVFOeDZTVWw2Z21NSFpweDNjcXVOSWJNCm1aaldtb3FaYW11SENnOWxPaEdsUktpckhYZHZoSGFNMUVNeFplSkVoZWxHa2VCUmhPaTdFK0ZwMzF3Z3d2eUMKTkVCdkFnTUJBQUdqZ1pZd2daTXdEZ1lEVlIwUEFRSC9CQVFEQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRgpCd01DQmdnckJnRUZCUWNEQVRBTUJnTlZIUk1CQWY4RUFqQUFNQjBHQTFVZERnUVdCQlIrWmNwekVRL1dreE5KClVwSElGTzk2VnMvaStUQWZCZ05WSFNNRUdEQVdnQlNyWDJrR0FQaTd5bzRNZWMvY2NWcytqQm50UURBVUJnTlYKSFJFRURUQUxnZ2xzYjJOaGJHaHZjM1F3RFFZSktvWklodmNOQVFFTEJRQURnZ0dCQUp2cEcvN3JTZU9aQW51UApuQmZsZFJBY0t4WFp6M3pYaGx0S1VEbEk0bXZFRTNmNHpJcGxhVzY5Z3pYK2lBQnk5U0hRQjFhZnRkOS9UbnpZClVzVWp0b1d3VlUwTlBTTjFBd3cyMkVBZTlHTjJqTEdvcVVOZk9rdjYxZU9IVnFia3hhczZ6S3RiRThHS3NlVGEKUzBqZm80L3I2U0xZOEk5dnpUVVJVK2wzTHhvblFBelpNYWh3bjB1bmRnVW1yc3ltWDF1MDA5bmZYS1NRdHZidQowQU1ZQ0NiM1ZNeXdvWnpOeXZWNGRQZExrVENHSFhsRzFZWW4vSThYbHllLzUvTjRJQktKenJJOEV3RjFEei95ClhlV0hiK0FzZkZkbWtyVS9TaTUyb21yekg2MkVUMXZNVWhFdU5nbHhxdkpTNXU4R3B3LzJYc0lyUExONHZicDkKT3F5TmxiTmRVQUx6cktncjlyYzRpLzJKSU1nSjJjTHF2c2xudXJ6bS9Yek9FS1hYS1J6RXo3NWtNZkg3NWw0MgpXRW9LZlF0aFd5YUFacXkrTlZOU3J5VFNMUmFnNHFTSDhjSjFPODJKc2xseVBsYmI2UVZQZkg1bElqS29iSldSClE5c0R2ZUNKc2RQRXZ4V0lYeVYzS0prTFVmR3RhUWwyVmUvOUd5SkR3S3FPY1lub0d3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNHdJQkFBS0NBWUVBcHZuQUlha0hFY00zcVRnYkticUlFUHZoY05BdjRmS3hvL3J1M2dIN3d0MGxsbXVGCkxCSmZST0tlb2VHZzl5NFFaNXBwMlRJbWhGU0s0c2RleEdGQXZzUld2QTIwWGFVbVJYaHpPWDNjMlhZb1VEOXAKbUZ4YXB4QUtzRHNOb1dxcmJGMTBTMzZ2YUJUZTY4eFV4MEZQQXpnZkhYVXR1RHh3b0tIbkx2eHNDeVBtUytWcwpwSy9WTDRYQW1JMXhQUkEydURjc0l6bG5RczZuYThVb1Jtc1lrVzg0TGZnWUtJN0JhVnJNbEdHd2E3VVV6L3gxCnIwY0hSQXBMWkdUQU84YU9kYnhXSzJ3NjVPUDA4UFRNNFBSd0pDQWtaTjJtMmQwcU1aMmt2QTFwdnV1ZkpTemUKd3hUdWNyVXdDYVFjWk10QUpaamIxZ0VoME9YbFQ4R0EzbjhvVUpzbUIzQjJqclBCdXhnOXd1MGlHWVJsbjdXYQpOZjU1N1BkRDBTakROYUI4Ymp3SDkzR2FCaWd3bmJuVnFVandQSHhjeWJFbEhzLzJ5STZYYVFOeDZTVWw2Z21NCkhacHgzY3F1TkliTW1aaldtb3FaYW11SENnOWxPaEdsUktpckhYZHZoSGFNMUVNeFplSkVoZWxHa2VCUmhPaTcKRStGcDMxd2d3dnlDTkVCdkFnTUJBQUVDZ2dHQVZ2ZUJ3SVplN2p0MVJDZTZ6aE1mUjJsSlZBNjZ3YjQ4RTZKZwp3elRaUWZjWTJxMkpvUmk0a2hKT2VSWWhWbHlob3JSa0tRSGIyZFNHdWZNSlF0TThlNStiWlRybUZGZ3VCTVRsCmpxNGxWd1lablNKS0IxY2l5QnlzMUhrTmNtTXlnYkJ6SDljTjJQSDE0VzU5UVlLY2VwckNhZjljSHJjc0doMzUKWVJtTDFJbVFLenVGU0lsa1Nlb3FFOHFuamh4aHc3VEl3bGZsbG9BMzV3TzdKR0luVzZoSDVIbHhhNzVlc2xiZQpjdkltaHhLN2tsQjFveU1sZjZTMCs4Y1Y4SXhMVTF5S1gxcytJS1VoUjhNdWgwOGorRS9vc1NxS2l0ZlpOaW82Cjh6Z213ckZsUkNCMWhEdGw0UVJMTnFJaXVRSDBlZzdPbHJlOHlQSTJtak03RTNRalRuaFRVc2FMRld6VHI1UzUKQ28yYUZIZUJXYVNrOWlMOTR0eldYaXo3MGFzOTVCclJtS1dnWEJrZTlQcFc1MGtHSUxScHRYVjQyZ2pkT3pCWQpFR294QUR0enZUL2Vhem9uaDdNTTAwV2lETWtIbzBZVnZBK0RsWTBiVHBCblpaT1gzSExlRzBrcyt3QThJWWh2CmdjbWpESXlaTy9kTUxUTTJwRXZHc3R3akpXQ2hBb0hCQU02MTZLZUIyOWVMVDFsMjFFbHY1UkhsdDFCRGRrWXYKekQrRHIyYnRMdmd1OEVLU0xrQjFZT3dpWXA2ZVlNUkZueWlMR2plNVNKdm1qcER3NXVqckZBcmRQZ1hDaEJhRgpLUFpqdTZ6cGp3UFFQNEdHYXBOSXh1T0hSYUF2aE96SUd1TlpjUmR1b0ZvT2ZnQ05ZU29zNGdOSzhXem1PRGc5Cmlqdjd1c3gyVGdtTDJreGVROHpHWkp2WU1PR3k0d0tlTWZKT3Urd0o5NDY4eHNjM1V4OFJIYXRRdm9QRUs3bm8KYTNKZEcvUFA1TXErMW9SMXM3Y3ozdXFKSW1vT2xvTklhUUtCd1FET3lsTnlVdURNNmNFclpwV1hFZnNicmMreQpDNFBGRlZSY1hROEVJbHdWbHQ2RFNINW44bWtPNjJPU3UwT2l4RkVHWTVDV2VuWVJudUVOK0RUQVNsVzkyT1J0CnFkTENwQ2YzcjZEcWN6S1hWWk85L2NIci82bXB3NC9rRDFwWUY0eFB4QlVLcFlqWXRxRzVPbmMyMjBhMjN4em0KWkNGTVlJcGVQaVltUHlrNW8zN1IwM1JGaTFQWTZqaUVlUzh2YlpGWnF0N1hzZXFrVjN6RzJuVElCRE1hTTgvZQo5OFFWcmprZTZQbEdZeFdRSFUvckdjdGYzTWN2RUo2d2dhTkM1eGNDZ2NBVldhS1RFbzJUWUxjc1pXS2R4eW5nCnhGby90d2dUVGNLSjJOOFlBVzExZ3R1YjlKOUVWeHRRcUdpSk81Q0JGVFBRS3pYbEJZVWpYUmZpam84N0JYVEgKZm54MmVkWE13YW91Y0xTa3NtYnNIT2xDUnBEaGI0WGpZRWhudUNEQm1CVjIzL2tYVTN6S2NHN0JQZGtJVXlSdwo5SitsQU01VHVMOTdYSSs1cUlwODMrNEhMMEZQZURwU0FtMWlFbWp5RDBiWFlSeDF6NzI3QjNKOGh4RlZ4eDNLCllRZWNjbm1WdFJUTDlpUDU5Y0lLMHRVelR6amx0anpTK3FFTVZUOWtoZWtDZ2NBTGFONXgwR0RXN1k3YTlpNEsKeDlNekU4UUI3dUMyWHhib2dibnlZSEwwUGY3SS81YjU1VVltckpZeDRtTTQ5OXdBbmoyOEQ4V3o4ekEzdFJvMApBZVg1TTU1bTdwZlNaWHhQRGtHeXJlaDhzUndWdjRxVG11ZWhsa2k2TEo2dmZaMGdTWkZmcFFLSDhvdTV6S0FIClJ0SUFCUTl6SnRNdmc2UWV6dzhMelRCWkhjeEJoNGxDelEwelNya1RsaHdrWWNkRFMwcEFYSEMxNEozaDJ1dlcKbldTMGJXZHF4Z0Ryc1ZFMWcyVTluUG56bWFwdkxsMHFUT1F3bEpvczR2by9Gc0VDZ2NFQXFUeUdmcVJTYnZlcAppWVV0K2doRkFKUkJESVZJTG9waXBhVmtkQW1UV2xiWmhzSXAyck1SSUNpYVJtQ2dMR05wWEkrYmhvdEF6N2FzCmh3UlRxbHFrRnB0TE5DZXowMmlQdy9EeGZCcUcxMUZaVmpCRUhoWERibmQzRmFBSHhTaysxQ3hGTklmNjgxNk0KRzVVSnROZUp6azJGM283azBra0lOU2tMNVE1eFZ2TUg5SzBnYSt1VmpZcXdxRXZDczF3K2FvTzVubmNyU0JodgpBNjEyYXg1SEdsUEFVekJwZ1RUK2Q5TGZNRUNDa3kvaHA0cFU3cnphQUw3d2Q4c0I0eVpRCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCgo=
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: log-cache-syslog
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVoekNDQXUrZ0F3SUJBZ0lRUVVCVXRBNlgwMDVQL2F2czB5WjZRekFOQmdrcWhraUc5dzBCQVFzRkFEQTkKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEZUQVRCZ05WQkFNVApER3h2WnkxallXTm9aUzFqWVRBZUZ3MHlNREEyTWpneE9UQXpNalJhRncweU1UQTJNamd4T1RBek1qUmFNRUV4CkREQUtCZ05WQkFZVEExVlRRVEVXTUJRR0ExVUVDaE1OUTJ4dmRXUWdSbTkxYm1SeWVURVpNQmNHQTFVRUF4TVEKYkc5bkxXTmhZMmhsTFhONWMyeHZaekNDQWFJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dHUEFEQ0NBWW9DZ2dHQgpBS3k2L044U3dSU0lkYU5WTHgxd3lBbmx4MVdoYytHZlI2TW9qMmxHeERzVHUxNndRNHdpcmVYdjBINVNtRUFKCklVbFQ3VEs2aExUSzZad0lnWEloaE9GS1dLNGhBZWE1YURFWDV5TGJwSzhhTmRnM0xJcVc0d1IwajhtbkVGM1gKZDNaWm9pZysrTEVVbktNTlZ0MUY3QlZaK25kS0FEZEV2SytRUHV4RU1hUzNWWUVBclJvRUdsOTJIOFpCdnZrdwpVZXF6LzhTb1NkVkdOeW9pazhZek5SNjFlbXZvYzNMZUIwVTMzZXJCakJMekFVOWxxSThWcEZTempqUDhZZ2l2CkRRRXRqbGh3d1ZGaVRzSEhzMTV1M2Rvbk05TzVEYVVTZURIa2tITzRIMVF5dnE3M1grNU9ZZ1JidXpTbFpsWXgKVU5lMnV3eFNsYkE1WlNkSkRrM1FOc2Z1WGxTRVB0OFZyRE41d0JZbWl6RUJRa3hDSTg5YlZvbG9RL0FyOFNrRwoxT1NiMlZlMGF4VGxXWUNiTDBJbWxxRFpkY1ZDTVc2Y2gwSXJncFVtOUh2RDlsekJDemN1L3AvNmQ0SlB0aG10Cjk1TUJDWXAyU2xBQ2VYUmtYd0xHeGFYbHJDNEJmYko5Z1ErU0gyQWNMRWQvSXJZZmtLNE5jTGpiMzhDSXd2cG8KK1FJREFRQUJvMzh3ZlRBT0JnTlZIUThCQWY4RUJBTUNCYUF3SFFZRFZSMGxCQll3RkFZSUt3WUJCUVVIQXdJRwpDQ3NHQVFVRkJ3TUJNQXdHQTFVZEV3RUIvd1FDTUFBd0hRWURWUjBPQkJZRUZHVjYzOEQxN1BuQWtxVDRKaXRQCkJFYklUWXpHTUI4R0ExVWRJd1FZTUJhQUZLdGZhUVlBK0x2S2pneDV6OXh4V3o2TUdlMUFNQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCZ1FDekkwaVcwZGdrdE9xNkkzejBxNEU3d1BUSDZ2TXh4RmF1ZnNjRmk2UXlvNElZWGJLbwpocE9RYy8xNmthVzdkcHN3WTQ2TnlZRDNtcnlNQ1lOOGwxdXpKelNhTXJmWWx6RExtTWt0VHljYXpEM1NKVGpxCnZvVEhTV1hHSkVNaWwzcE1FUm1LMFRzbndRNm5NdXNtUFVDZll3a08raGxLTUErbnNPYm0yRWhLM1ZLNmg3R0EKQ1pPUy9SbEMrQlhxMVJwZ1lkY2NMbHVHcVZ2ZTE2OTIwOVJZKzY4MmxLYjFBWHJxRkdBWjdSb2NqR3lzUzRQbwo2enhkZzU1dXVuRGdtb1BlN081T1lGUlZad29ockE3dmJ1aHpSdGZKc2UrZkFneTJUa0xyNGlQaE1rK3Q3U3BiCnRFbHUxYlZlYmtpdk9RTmc4MXY2azZMMFpjZXA5ZG1DN2cvRXI2eHhlWGFUMGJHVDVaZWZKUkpRM3k2dHVNTVIKbjFuSURid0RQMC8vYVcrNkxTb2NsdHhSSUxIU1BIR3BUQ2xHY2JLNzdkNm0vSHhWZGRQbWhNWlM0RHhlTnR3ZQp3MkhQZjRqZVZpWEhsYWtYSmpwY3ZjSWtScG0vaXZrMC9HUmpuRkQzRms3S3MxVzRRelc5TVIwQndnWTdHaFZNCjY3d0VZYW9kVGJTdWgzbz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNHdJQkFBS0NBWUVBckxyODN4TEJGSWgxbzFVdkhYRElDZVhIVmFGejRaOUhveWlQYVViRU94TzdYckJECmpDS3Q1ZS9RZmxLWVFBa2hTVlB0TXJxRXRNcnBuQWlCY2lHRTRVcFlyaUVCNXJsb01SZm5JdHVrcnhvMTJEY3MKaXBiakJIU1B5YWNRWGRkM2RsbWlLRDc0c1JTY293MVczVVhzRlZuNmQwb0FOMFM4cjVBKzdFUXhwTGRWZ1FDdApHZ1FhWDNZZnhrRysrVEJSNnJQL3hLaEoxVVkzS2lLVHhqTTFIclY2YStoemN0NEhSVGZkNnNHTUV2TUJUMldvCmp4V2tWTE9PTS94aUNLOE5BUzJPV0hEQlVXSk93Y2V6WG03ZDJpY3owN2tOcFJKNE1lU1FjN2dmVkRLK3J2ZGYKN2s1aUJGdTdOS1ZtVmpGUTE3YTdERktWc0RsbEowa09UZEEyeCs1ZVZJUSszeFdzTTNuQUZpYUxNUUZDVEVJagp6MXRXaVdoRDhDdnhLUWJVNUp2WlY3UnJGT1ZaZ0pzdlFpYVdvTmwxeFVJeGJweUhRaXVDbFNiMGU4UDJYTUVMCk55NytuL3AzZ2srMkdhMzNrd0VKaW5aS1VBSjVkR1JmQXNiRnBlV3NMZ0Y5c24yQkQ1SWZZQndzUjM4aXRoK1EKcmcxd3VOdmZ3SWpDK21qNUFnTUJBQUVDZ2dHQUNmbk9xdStCV1RjOFhBK0taZy9pYmJmb21FaDMwZHNLSHlFegpqeWY0STFWVFovZVVIeDdObms4SVlwTlFtYm90UXZmbTVod2hsL04wSkgvVlFnc3ZpbmRwd2J6RVNGZ0M3WHJzCjdYVjBBR3pxR1MrdWtkNS9BLzNiWkJFUy8raDJ6TTRHY0g2YWpGZWRhRWxYNy9XZTJlalZiMWhGeE90aVhsMWQKVlBYblRCVU9paUhJM1l6SkhTUk1WMzNxa3FlNHcyNWI0amE1OU9oV1BVZTc4eUYzK3VzT1EvY3IyOEY0K0FWdQorcVRzK3hjdnh5OGUyZ3lzN2Z0a3hobllhNW40ZFBzcTdQOFd5amo2ZjlMOW16cHMyT2ozUm1aTmlSeDJxdXZqCnByMG5lRllDcWZmK0FHL3YrVWxORmE3RlpTUG9XWlZBaUNObUJPWE4yeU0vNThVZStRRTR6V2xEczloNjdjU28KVW1BN3Q5MTJveURnMlB6RExtdDlhYWRmRWxUNmdmNmFjZTZMbHNFRGp2UkRJNld4eWh2MWxGbTg0ZkE4ZDBIbgpLc0IwQmJ2UzBpQWZ5OWlhNmgyNGdIWnFad1pRRitJT2JtMXNVYzJ1SmxSRnZhUDlnc3JpbzBHS1JQVXZvc1pjCkZ4SzUwTUUrNWN3UVdjK2ZQOWxDcWtGMlFBakZBb0hCQU4yc2pGaTJod2tQdGNrdjEyM0tSd2NkODIwMm1lV2cKNXlmUWxjYkU3d1lYOC82V0l4QXorYzBPLzRRMHNyS0pxeGtOYW9DSmQ5aVRySXdmOElvRnRNbVRPaC9RSWZlNwpaL2pXeitmbmtsVzdNUXRSRW4yRTJzMXJlYTRCTVhxVi8rTDlWK3FtM05LUGozUmx4c1JJNlJlbU5YRy9LcW5OCkdJOVhGV09nUEY3RmppOFhzd0tsdjVUMTRXNWlqK2FHa292bEcyQkR2eGptR2tRU3ZUdWVpRU42dVlHQ2JLVFUKSlU4dWVzNmtzNHJXMlpZODByNk1pVGxwbSt2MGo0OUtVd0tCd1FESGVrQWxENnBtbzVOd05RUERNSmJlaS9wdwowWmNHaDByZ0d6Njk4SWxxV0FCMTVnSVFPYUI1T2NVb3hmd1ZNYm5NbndhNnVyTVgrd2FwU2cxQ3JGd2I5NWhjClZWa1hmeVNnWTFyVzVDR2lUL25QMGdaTjM2dWJuTUpWM1EzalZBZThGUnU3MlU1U3pDRk1yV01XUW40akJTVWQKcHc5eXNWLzlBRG0vQzVJRm1qT1B2STdzbk04Z0U4TXRvaWFUYXhiMm1JK2xQRytKZmFKOFByQjE4ZnhteVlwdwpKMDdXcEtiREJ2M1JVN00xaElldk5TM3l3SG84SFZrSWNsbFVEZ01DZ2NBenFxTHZqbU44NWk5OW0rdi9SL1UwCklIUDdVWTJmS3RpVnZCVWN4Z3ZjQkxzMjdIRnh0bHVUd3RvbFMwOFhNK1V3S3FOWElETlJ4R0drSzFHYUtlaFEKVDBOdDVNbjEvclVtRjVOUHZ2YXBpcjdNbjNISzFhdFYwNllCdTM5M3pmeGRRS1U4S1BZeEVZcmpHMUd2c0RxNwo2MTVyaTUzN0E3V2t1eXhlRXh2ZkR2YXIzVDg0Nzc3dWpqeWp5TTgzY01nNVdRWC9jdXJZZDlGSmFvQzJvNldvCjdMTE9EOE1ZeStXQ1JoZ1RqK25WQTJ5bGlybW45Z09KNFNhWllXQVFpc2NDZ2NCMlA5QTZxQmk1azRwWlgvUUYKQjQ3SUNtN0I1bDBDNzd6Qk1TVjJiMXJtZ1poMFM0ODVrdy9BRFRFRlJLaDAzKzltajNicnhyVllKK1VCQWZidQphVUtKQ2JOMk9Ob0JoY3R1a0xkTzRCbllJRlRVajRwUks2Q05OTlkzRkQyaFh6VGVtQnpDdE1VcmEvcnBlM2RiCndMc0pnNGxIRkx1aG4raHBFSE1xLzI3bWgweTlqbWVqZUNtSXVHNWhaTmc5VjZSYk5vRWcwTHpGNG9ZcDVQZXkKVTJydWU5Ym5PVVlSRTdZUHN0dFA5YkFzcjQzSG5WekpwTFJSWW94ZTUzcHd5NFVDZ2NFQXdWTkY5d0svRDFXWgpuTm9PMXBPa3RvOWZOM2NkYUNYRVFNWm1LZlFQYUNHY2p1RmFuYUtVZ25wNDZZQnhDQ1g0bjNUTzZNV2ZyK3R6CkpwQVhwb2JkUnk1Qi94ZjYvVkJjM3lBUncybDhNTURmRWZwRWs4KzNyQ1FjRFdsSWhoVjhxODRZZUpSbFFvSVQKa29PRTYvZlQyRHJSTW1XQ1dwYzJVand1Tm9KaDlqMWpJVkYrVkR4ZTFNVUwwUmFlbGZQTkJLZUw2aE9tK1lpWApxREVwd2VMaG5NdTFQSnMxcTBXQWhIV0t0Vmd1Z012Uk84V3BNcnBJYlhDaTlzc0xxNG1aCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCgo=
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: fluentd
  namespace: cf-system
  labels:
    app: fluentd
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  selector:
    matchLabels:
      app: fluentd
  template:
    metadata:
      labels:
        app: fluentd
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      serviceAccountName: fluentd-service-account
      tolerations:
      - key: node-role.kubernetes.io/master
        effect: NoSchedule
      containers:
      - name: fluentd
        image: logcache/cf-k8s-logging@sha256:71fd09077b70fb43dfe91e4445b6528580355003255c8860f7238aaab7b5370b
        ports:
        - containerPort: 24224
        resources: {}
        volumeMounts:
        - name: fluentd-config
          mountPath: /fluentd/etc
        - name: varlog
          mountPath: /var/log
        - name: varvcapstore
          mountPath: /var/vcap/store
        - name: dockercontainers
          mountPath: /var/lib/docker/containers
        - mountPath: /ca
          name: ca
          readOnly: true
      terminationGracePeriodSeconds: 30
      volumes:
      - name: fluentd-config
        configMap:
          name: fluentd-config
      - name: varlog
        hostPath:
          path: /var/log
      - name: varvcapstore
        hostPath:
          path: /var/vcap/store
      - name: dockercontainers
        hostPath:
          path: /var/lib/docker/containers
      - name: ca
        secret:
          secretName: log-cache-ca
      priorityClassName: slightly-above-normal
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: log-cache
  namespace: cf-system
  labels:
    app: log-cache
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: log-cache
  template:
    metadata:
      labels:
        app: log-cache
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - name: cf-auth-proxy
        image: logcache/log-cache-cf-auth-proxy@sha256:df8ad4406febf47e8276be1df9cc376798faf34a5714f220cb481ada822c5e88
        ports:
        - containerPort: 8083
        env:
        - name: LOG_CACHE_GATEWAY_ADDR
          value: https://localhost:8081
        - name: CAPI_ADDR
          value: http://capi.cf-system.svc.cluster.local:80
        - name: UAA_ADDR
          value: http://uaa.cf-system.svc.cluster.local:8080
        volumeMounts:
        - mountPath: /ca
          name: ca
          readOnly: true
        - mountPath: /metrics-certs
          name: metrics-certs
          readOnly: true
      - name: syslog-server
        image: logcache/syslog-server@sha256:d859988406fc8ff1c1315cd00f5b1095d494ecb30387ab79d2fb8196d2787184
        ports:
        - containerPort: 8082
        env:
        - name: LOG_CACHE_ADDR
          value: localhost:8080
        volumeMounts:
        - mountPath: /ca
          name: ca
          readOnly: true
        - mountPath: /log-cache-certs
          name: log-cache-certs
          readOnly: true
        - mountPath: /syslog-server-certs
          name: syslog-server-certs
          readOnly: true
        - mountPath: /metrics-certs
          name: metrics-certs
          readOnly: true
      - name: log-cache
        image: logcache/log-cache@sha256:b964e0d786827994b363700fd5beacb7335d783c878fdbe623c3d3f06feda220
        volumeMounts:
        - mountPath: /ca
          name: ca
          readOnly: true
        - mountPath: /log-cache-certs
          name: log-cache-certs
          readOnly: true
        - mountPath: /metrics-certs
          name: metrics-certs
          readOnly: true
      - name: gateway
        image: logcache/log-cache-gateway@sha256:4ecda071c49886930fd5ab733c3caf97ae9b1db5ecd7da5d3e9eea13ff7082b9
        ports:
        - containerPort: 8081
        env:
        - name: LOG_CACHE_ADDR
          value: localhost:8080
        volumeMounts:
        - mountPath: /ca
          name: ca
          readOnly: true
        - mountPath: /log-cache-certs
          name: log-cache-certs
          readOnly: true
        - mountPath: /gateway-certs
          name: gateway-certs
          readOnly: true
        - mountPath: /metrics-certs
          name: metrics-certs
          readOnly: true
      volumes:
      - name: ca
        secret:
          secretName: log-cache-ca
      - name: log-cache-certs
        secret:
          secretName: log-cache
      - name: syslog-server-certs
        secret:
          secretName: log-cache-syslog
      - name: gateway-certs
        secret:
          secretName: log-cache-gateway
      - name: metrics-certs
        secret:
          secretName: log-cache-metrics
---
kind: ServiceAccount
apiVersion: v1
metadata:
  name: metric-proxy
  namespace: cf-system
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: metric-proxy
  namespace: cf-system
rules:
- apiGroups:
  - '*'
  resources:
  - pods
  - namespaces
  verbs:
  - get
  - watch
  - list
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: metric-proxy
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: metric-proxy
subjects:
- kind: ServiceAccount
  name: metric-proxy
  namespace: cf-system
---
apiVersion: v1
kind: Service
metadata:
  name: metric-proxy
  namespace: cf-system
spec:
  selector:
    app: metric-proxy
  ports:
  - protocol: TCP
    port: 8080
    name: https
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: metric-proxy-cert
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVoakNDQXU2Z0F3SUJBZ0lRWU51YTBSc1ludjhQbkVSbW5vS1l1VEFOQmdrcWhraUc5dzBCQVFzRkFEQkEKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEdEQVdCZ05WQkFNVApEMjFsZEhKcFl5MXdjbTk0ZVMxallUQWVGdzB5TURBMk1qZ3hPVEF6TWpsYUZ3MHlNVEEyTWpneE9UQXpNamxhCk1EMHhEREFLQmdOVkJBWVRBMVZUUVRFV01CUUdBMVVFQ2hNTlEyeHZkV1FnUm05MWJtUnllVEVWTUJNR0ExVUUKQXhNTWJXVjBjbWxqTFhCeWIzaDVNSUlCb2pBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVk4QU1JSUJpZ0tDQVlFQQp2UnhTcmJhMFJkU0RoTlVWeXFXcENLVStVWVB3VkFqZURoU3hZT1I0OE1FTFYveGs2eXhRSXFSTjNxUTZ4T0RLClJQWVRKWEJGQ0Vta0FsM29kUm80NThtbWVjdG9Ea1V3STQ1K0s5UmJQS29KNXp6N0lVejRtYjRySnQ0b0F0Q1IKYk9lUjQwNXJaY24xUFM5L2t2NDV5Sll6cHprdzdOb25NekVZQjBXU3Y3dzVBa0JOQTFWamJabmFUZENJMnRZaQpvamtHVWR6SkhEMFFSWi9xdm93bkk3K29HSWNGTzRIdGpsSEZCd2JCTXJmMjNkTWJYQ1BQSnMzUDFpaUVVVVFWCkZWU2JEcEJpYjBhT1E0STlpdHlsVkZGQ3VzRnZkdnpiWlB4Z2V2clhlb2U2OWZVUlZqaTJ2cWV2bktuMll4VGoKU1Q2bDFXSENzUHRiekZhZEJuTVFCdzZpVENFSEVZR3pzanRDYnhBbldrSHR4MkpyUHljR1ZTVVZYVTM3L0NPdQp0eHpYMmUxYWJpdGx1dml5cTNrUS81VGZzODdPUDQxZm1KUS94SmRBSUN4M1dyWStDRUM0TDZEU0ZuTHNZZDlsCmJWazhlMHJvZWhwYkExc2NIOWIyMVQ1bGJROSs0dURJSlFSWmh6dGpZRjRlM3ptSnE4NUgyd04xL1pOM3cvRUgKQWdNQkFBR2pmekI5TUE0R0ExVWREd0VCL3dRRUF3SUZvREFkQmdOVkhTVUVGakFVQmdnckJnRUZCUWNEQWdZSQpLd1lCQlFVSEF3RXdEQVlEVlIwVEFRSC9CQUl3QURBZEJnTlZIUTRFRmdRVWYweTlOTVVGUU5KTXVQL2JPSWZwClU4OUZhUlV3SHdZRFZSMGpCQmd3Rm9BVTF5RFordDB5ZS96R043V1JBWTBMOUxRTGlMVXdEUVlKS29aSWh2Y04KQVFFTEJRQURnZ0dCQUM1cjBYVldYWVRiMndOMEh1MHVUNUtPZ3M1eGpiKzRpdnNiWWZ1bHdGcGExbCtydmdxaAp4bXd5QjhzcW5aUEN2UXQ3TXBRdlhabG9aS09hWmlDanZtTzJTaS82ZmlnSXl3Y25QS1pmd2FGbllyTVcyYlJBCjNCT3NEZHdFYmx0STFDa2NabmJ6QXpNSThjb1ZSMVMvck1TRWYxN3RlMGtZMDh1dEVhYmZPQ1VteDl4OXpHYlkKT3Rld2twOGRjTXhmRXdNNVlOMEtZQS9UUzU0dWRFbCtFMGdxNWlDTDF5Y2ZRMUhvMVFFSW5HZnFjandpb0hELwpkaWR2Z0ZEd3FsS0ZuUzBrWld6aXRWbEZSUVh0RUNQN2tjNjNzT3J5K0ltdVRiZUpudUpza1RuM2EybGxwb0xtCmtSYVZ4c1JyT245RjZvL3NpNjhhWnVmWXB5ZUYrU1E5d2VNMExXUXFwRTdvZ0pXcFFDVkZDOWtwOGs3Zzk1TjMKRGd5K1B5bnNhUm5IWWNPYlNsdzd3NURDSE9oczFubzZYUWtFMGtNMG1CUDJ3b2MzL1pZcENSRkd1dUt1cEJPNQpERTE3dUZGc1lPRVFqcmphRjZMM1QwNWhuUGxSb0ZXZlhPcEZIRG00R3dNT3pqMUxWWFJZY0dkZzhQbWRxQzZhCm5HN3hjaVlkZzlNMEdRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNVFJQkFBS0NBWUVBdlJ4U3JiYTBSZFNEaE5VVnlxV3BDS1UrVVlQd1ZBamVEaFN4WU9SNDhNRUxWL3hrCjZ5eFFJcVJOM3FRNnhPREtSUFlUSlhCRkNFbWtBbDNvZFJvNDU4bW1lY3RvRGtVd0k0NStLOVJiUEtvSjV6ejcKSVV6NG1iNHJKdDRvQXRDUmJPZVI0MDVyWmNuMVBTOS9rdjQ1eUpZenB6a3c3Tm9uTXpFWUIwV1N2N3c1QWtCTgpBMVZqYlpuYVRkQ0kydFlpb2prR1VkekpIRDBRUlovcXZvd25JNytvR0ljRk80SHRqbEhGQndiQk1yZjIzZE1iClhDUFBKczNQMWlpRVVVUVZGVlNiRHBCaWIwYU9RNEk5aXR5bFZGRkN1c0Z2ZHZ6YlpQeGdldnJYZW9lNjlmVVIKVmppMnZxZXZuS24yWXhUalNUNmwxV0hDc1B0YnpGYWRCbk1RQnc2aVRDRUhFWUd6c2p0Q2J4QW5Xa0h0eDJKcgpQeWNHVlNVVlhVMzcvQ091dHh6WDJlMWFiaXRsdXZpeXEza1EvNVRmczg3T1A0MWZtSlEveEpkQUlDeDNXclkrCkNFQzRMNkRTRm5Mc1lkOWxiVms4ZTByb2VocGJBMXNjSDliMjFUNWxiUTkrNHVESUpRUlpoenRqWUY0ZTN6bUoKcTg1SDJ3TjEvWk4zdy9FSEFnTUJBQUVDZ2dHQVZjNE1GWlhZcGZhTzFpNTQvTUc5dUphQmVDc05XSlBOYlVZbQpWWGhWQjZnUHBaUjNsZDA5WHZwOStvODV1eXJqbS9hcktVbVBpUHNnMTVJVWIwMitsQzBDeERCdXZrcldWTXZLCm84aHV2VS9Kdm9vRXlFOU1YVFhVRG9hdVVOaWhvM0JPMlh3emJyUDcrZzhiSzI3K2VPenQ4dW9ZTU4rcSthZEUKNThmQmxnMnBNRVJNclQ2SkpxbXdTNjVhNmpCTzlwdzVLZHVyeEl4UVhjYjVsQXV6bHB6WGdJbUM3a1U5ckYyZApzRnA0UHJNSjZBeHBWWjFKMktsNXJBb21QMWxNRDZacWlOcUpoTVNtQUhVcmV1YjV1N3N4eVJqV2k4Nk5QMVdWCjdQYi9XTFptcmJ3MnFKUzVzZmplZHBKU1dPS3l1RThxS014cXY5dFhMVDUrK3A0NzB0VE02bjVtcktkTzVnMWoKaUJONjhiY0hkNm56N0RjYnZTWmNZWCtINFNHaTVGMklEbWFtazNPUityN0FPeDhRaXEyUUIrdzhFV3AzY3ZYQQpwczJVZDdNU2FpMGpVeFBHUHo4R0xYY01SVWxmRklPVGdxZjMzRUE0NkQrK3VxaFpGa2piWGVmY2pkSkMwYmFzCjZtM2FmN1lUbmUyRjVnaiswZnFBUTRoa0tyQUJBb0hCQU9sUmcwU0VrUDMyOW4xUHF2WnFrNnBnZTgyQ1N6blAKQ1hFcnI2clJVOHZVdG44VUNZS2Vubkc2dzdnb3RIcmwwcVhmUzRYU3hsWVluV3lTQk5teXd4WVBYcGZtTDU0YwpZOHR5cFRpMUlRTUk3cVMrVi9UOG9ReDhhRERVaFBhY1dyNnZJMzlEZEZyMnp3K3U3aCt4VnJXaUtKQldMTlQyCitaZXltZUhrNEdMNDVIdllvMEtMYTFBRVlCTW0wN2V5UXRvemEyTWFQTDRuQ1FDYW4zMUlRNGgrdjN5THB3VlkKK3pHbG5yWk9zRDJWYmFLK3owUTlTaC96bEp2Q0dRY1ZBUUtCd1FEUGZxRy9aV2F5SXMwK2owOXRwaXB2U1pOTgoyajc5a01mNzZ2UnNtVUg2OWZlTXI5Rk9sRnZnT09Ka21mbVFIdnlTQUJTY282K1lENmd4S1VBQ0V2WVZiT2w4Cm52ajNLcXU3U2J5ajN5cGlvM2ExckFpaFZSamVCcHNQdUlwZWY4bEhKWHpnczMrQllpS3pyekVTeHQ2amY3NVMKcm1MREs2TmtKckkrVUJCOWJlUUd2eTh3ODJsL29FRnJRQWRYSXRYZVp4dWhTU3I1aGFGcXZuK1RhZEk4UlhRbgp1U0VxZUxaQjMwSVNtdmxvTStZRzlKbVhLcjMvY1BpL05DTGNYZ2NDZ2NFQWs3NkdQVEVsRDJ6L2tVS05wQlRCCkJUYXJydXMrNzVCbkRqNzNzbGR6bExOU0RRNkhKeXVDY2NvdWZjTm81aG42VmdjY0w5WFV1bGhEOTZoUFlmdU4KQmI4ZHkxcDc5TWROZWx0U3ZLSVdFWEhxakcvc0NycWUwT1ZHcFFVdVhXdU5Hd3FVazlZSExFTDF3NXltTlhONgowUEdxZGh2YnI4L2xKV1ozZzFBSHR5U2Nxci80UWY4L0tTQmNKa1NEOU9MdzZuTjlJUGhRVnFrcFRqU2JvaDNNCmhmYWRFeVRyMHJzUjlkSkd1bk1CcnoyY2UxNFFxY21WMHIzUDhRSHNEMHdCQW9IQkFMbWlDUU02ck0zaDVNMTcKV1F3NEJPN2JYRFhpYzBoWEp4TngrSXJQOGYrYjNvUzNKd0t1S0NSSndBRlEzN3pZZkE0Q2xHNHU0d0dmd0ZGNwpIaEM4OWZ2bEhGNnB1d01sNGM0RkFnZDV1R25XNUhWVUc4UjZaV3o5YSt4OHBRNDJOTlM1N1NiNmI3QkpJOUt0CmdiSFN5WXhzMU5FVHdyZnBhcHhISW1BdE1ST0dKT01FV0N2ckdROWRTQ216ZHQyMkJMQ2NmbE9sS2hWaVFDOUgKanN0TGVSTUM4QkE1eURvL0ZJK0tOWXAvcTNKV1BBMHM5OXdPR1QxV3pMUUM2TTFPTVFLQndRQ3BRbnQ1d1RtSQpUNU1WWlBFWmtmSHJEYURjbkpKNUxsaWJ1dnhHN0lhL2hEaktkQ3hEQno0bW42ZmlONGJSUmZ1cjlicVVIaytKClVGMXEzckxYRy9peElZMk9TY3JxS2MvTitOMmUrcFhpWGp2ZE0xcHRlZU5GN052blFGZFowV29oMDVQT3doNEYKS1UybUtHYXlKRC9MUE1mcGZ1cW5iS3pUU0lyWVlQdWpGdmJtSzlCMmFxTjFrdVl2QW5tNFBCRTFLc3pVLzhIdQowMDlFbTIwWjE4TkozaHd3ZmtNOFBtOEdFUTR3NGFwelVveGJRQWhyV3hkQURjMUFtNzFFT2FZPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: metric-proxy-ca
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUViakNDQXRhZ0F3SUJBZ0lSQUxDNFFBY1ZiaHhkL1Zzd3MwaExodzB3RFFZSktvWklodmNOQVFFTEJRQXcKUURFTU1Bb0dBMVVFQmhNRFZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1SZ3dGZ1lEVlFRRApFdzl0WlhSeWFXTXRjSEp2ZUhrdFkyRXdIaGNOTWpBd05qSTRNVGt3TXpJM1doY05NakV3TmpJNE1Ua3dNekkzCldqQkFNUXd3Q2dZRFZRUUdFd05WVTBFeEZqQVVCZ05WQkFvVERVTnNiM1ZrSUVadmRXNWtjbmt4R0RBV0JnTlYKQkFNVEQyMWxkSEpwWXkxd2NtOTRlUzFqWVRDQ0FhSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnR1BBRENDQVlvQwpnZ0dCQUxTclhMNEMvdWlVWk9IQ00xY2RTWnJZMUhnOGxVU3E1aGpmd3NRamUzdHQ3bjdPcFBRSnNHMjErc3VvCktINUZhYTYyT2xuRW10VHJSeXZSU1B5OXB6YjU1NWZ3K1UxRjFhTXlFSytRNFNnQ3VFRXArcGJSN3FpblphRlMKT3pXUjFsYmF4NjR1NVFvN3ZlWG5haE9VYnJGbnhqQU9TckpFWGpwdFl4TmphdDMxeVdiL3l0aTNEOG1YK0lMUgp6aHJGZko3Y3R1ODIrWmdWbjA5aHE5YlJwa3BTb2YrTkZpZTJlWkgwV1BMUXZ4KzFDYTZydUY4UERlcUQ2akZhCmErK2k4WWVJOE8zMzZMOWF2aHd4aEJ3cmRMUG9ZODJzc0RTemxhTmExSG5hRFN3WWxHb3lkb2ZtcXJoNkk1YnUKbFliRmJKU3p6bGpod3QzWWtiVU1pNHMyenZ3enk5YTdRZW5uQlIvck5qMGQ2T3EzUDJ3V0h0UTBwbXJTaGl0cwp6bW9hUkY3NW9BL09oQVphMEhRaVRObnBwOS8ybStjSDBERnFRWXBRNitMbXhBQTJ3a281NVc1S01nR1UxMUErCnlTZ3R4MXViaUQ0eEZuNmo4UzdJVHRmOEdEWm9tRUN1QUdrVkY0NTJib29jUkhqcVRtd0tqaWsybFgyNHNXMkYKbFVhL1d3SURBUUFCbzJNd1lUQU9CZ05WSFE4QkFmOEVCQU1DQVFZd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZApCZ05WSFE0RUZnUVUxeURaK3QweWUvekdON1dSQVkwTDlMUUxpTFV3SHdZRFZSMGpCQmd3Rm9BVTF5RFordDB5CmUvekdON1dSQVkwTDlMUUxpTFV3RFFZSktvWklodmNOQVFFTEJRQURnZ0dCQUV3N3JkUkNYV2ZodDBqNWRNM1EKekFjWk9vMDRKUVBRcTQ0OEE4TStYUTFLNjZFOHhTVFpBZDE3ZlAyT3lQWEk4SUFvR1BKejNwbmdVcXVzejd2NwpUemhUaGhmSGtpSFRqMjZ0aUdVTmJpVlg3b3VEYjBzSkhaVDZPQm5KSStDbW1Obll4eTRLcGthTjh3STI4VVgyCk0rMER2SGRQQXZCeURYS0lMak9GbTJVTjZrNzhwbWVidWV0UnI5Tmt5RlJoTWprSVVwZGdIeEpYL3BtNUpOWkoKa2lUTndrRnp1Nk15WDEvVzZRdWtwaTBybkV2R0svMUUwV1N5TFBqS3RhWW9JMXBrR2hONWQzVzRTZ1VXblhlQQpsUTIrZ05wcmM0STQ4K2h0VzFUWm1uQmJvaWJqbHdvKzZuYUVwbWR6dis5QUxtMFNqRUVFV2tKUWJvbUhHb3Y0CnNUTUQ5bXNWY1g0eWRPOWNCYlhzMVVUS08vcXJzc0xRSW15MzJzdFpReEpzemZJdXc5ODR3ZGpyRTNQVzg3RUoKWFAyYWJibmZzSWFvV3NNKy9TcUJ5b2Q1NUM3OUFBWGRNbmhBbERXb21ZMDRXZlhjV0FwR21ZZEhUMHl4ejY5TQpSUVYvejZoOXNCcVJqbHc5QkFycSt6VW9GRGl5bDljYlJzYlBuNWFmV1dMTnJnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNHdJQkFBS0NBWUVBdEt0Y3ZnTCs2SlJrNGNJelZ4MUptdGpVZUR5VlJLcm1HTi9DeENON2UyM3VmczZrCjlBbXdiYlg2eTZnb2ZrVnByclk2V2NTYTFPdEhLOUZJL0wybk52bm5sL0Q1VFVYVm96SVFyNURoS0FLNFFTbjYKbHRIdXFLZGxvVkk3TlpIV1Z0ckhyaTdsQ2p1OTVlZHFFNVJ1c1dmR01BNUtza1JlT20xakUyTnEzZlhKWnYvSwoyTGNQeVpmNGd0SE9Hc1Y4bnR5Mjd6YjVtQldmVDJHcjF0R21TbEtoLzQwV0o3WjVrZlJZOHRDL0g3VUpycXU0Clh3OE42b1BxTVZwcjc2THhoNGp3N2Zmb3YxcStIREdFSEN0MHMraGp6YXl3TkxPVm8xclVlZG9OTEJpVWFqSjIKaCthcXVIb2psdTZWaHNWc2xMUE9XT0hDM2RpUnRReUxpemJPL0RQTDFydEI2ZWNGSCtzMlBSM282cmMvYkJZZQoxRFNtYXRLR0syek9haHBFWHZtZ0Q4NkVCbHJRZENKTTJlbW4zL2FiNXdmUU1XcEJpbERyNHViRUFEYkNTam5sCmJrb3lBWlRYVUQ3SktDM0hXNXVJUGpFV2ZxUHhMc2hPMS93WU5taVlRSzRBYVJVWGpuWnVpaHhFZU9wT2JBcU8KS1RhVmZiaXhiWVdWUnI5YkFnTUJBQUVDZ2dHQWN1cFFXaGVqdGFHMXJSY04rc29KS0RIa3F2bTE0L0JqM014dQpvTDBFN05SV2oxZTIrZll6dndTeUdkbkNyOVpNeXpEalduZkFGOC95Ky83cFVzRDYyL0FHaTlGZGNQWUxWZnNoCk85cUdMQ0hXdXJRTnpPS0l6OE54MUROdXI3c3NQeUIzUStaV0RyVkRLem1QY2hiR2RaYlJLMzNicXhucmFYUnMKUVVmS0VKWW1YWm96bHJhUmx5TlBrVDRMdjJGL3k3Z05yNGdqSjhZUkI3ZlRTaGNkazBhTi9mTHFkYVlPRzNUMQpJclQ5N0JnRnFaRlYremlqSEZoOW5KaXI4TWVOa1pGR0V5bS8xUHdoR2ZtYUFhay9FdHRHQ2d0RUZaSWNLcEdwCjYzV3UwdTQxSHZMUHZ5anZzdzltVW9scEYwNnV4dkN6TWpRaXhyb1Y3bHpaM1YzeDZlK2V1WndUL0hOSGNEeU8KenpnMTlMaHVNeCtVbUV2d1lCV0JLcEE4RnVmUGJ5Njh2OG5McHUxc2VyekpaUUI5VzFRRVBuOHM1TzBqK2JIcQoyM29PWkJGeW93eVI1dkxlRHkxTStRR000VGM5c0EzSkdkQVQyMGtkQ05SS2RuenlWb1A0MU1PZmhlRFBLREw4CmdkQjByRENOMU5rY0lzZkRxb1R6KzNuTzVlanBBb0hCQU5STXc2QkFoU3JqaGJKOVByOUpHdzduSEFTUGN2YzEKeHN6aE5pY1QwKy94bHAyUGpqUEFEY3hZRHgyMXZ6TmRaREozZWE3T21hQ1JydnhOeVFvMXNkbTVmRHNDZ2xKbgo5TGZJMGQvU2FyZDAydDAyZG5KS1ZWNENpSmFiSDdxVVpBRSsvWG1rZTc0eTREKy9OdUhBb0lIUkFhZlFnRmRXCm9uMzA1QU14RDljOXhJVVNCa28vZjRUdHdFY3pjZGpmN3FpZXRFd291OHhqcVp0bDNocXJ2WUJLTW5wZmthTlAKOWhObk1RNnl1akZtUlpBb2RNcTJ1YkxaZ2JYMWNrTWFqUUtCd1FEWjI5RHBSVGRWWWUyT1ZTeE9BaWJFOStRWgpIWEorRGIvVEJNQ3dkTU4vRXVja3BkQnlCSlc4c25jMnRRODlLNDEvcVc0WEJQbU5rMEU0b0hIbmVSdGQ0UmdFCkRyRTBvMlA3QkFxZDYyNEJqSitIa3JES2FZOW5Db2kwczhVdUsxNjZ3YUZsNko1aURhdGlYeGZaazhzRXNsT3MKaytWT1RPMGtYRCthalp1bnoxRjVGUXlDYjFqT0p0SnBIQUpkWXFYTVhFeXhKSUI3UVlZNU5DYlJiSk1keTFKMApxdFU1aUE0c0l3ZDduWHJ5Vy9BYytCS2diVWpYZlFibU8yY3FlNGNDZ2NBOXBoajh0UisyaDZGd1pteE5NZFo0CnFtWDVjUXFLZlFSQXhIbHNPWmJHeTVuWUlUTERGbGNyYXJyZy9zRUtFbW1oT2c2TTA1UExDK01MZ3k4SkZ2U1IKYkFxR1BFRkoyc1EyaGt0anVuK2d6SDh0MDczcmpHaGp4MHFRcVhVNlFoTVVSWTFud0hycWpXMlBOV0NqaDhOVQpUelF5M2hvV3dxS20vdkVqZUNESWVUaFRDQnZwZmF6ekZmTksrY1pxbXdSNzFMSTRsMitKZDd0dDA5UCtYTGJICnhVUUpReTFRaGt6SDc2UlFSMWhJTmhHblBnaEVRWEdGWFNJTWk3emxmWlVDZ2NCZUYzc3VGSy9tVjRvekxBUWIKbVFCSGw4elRNQTJ2OVo1QXRFL0lwbFY4LzV3SER2cHRGQi9ieExTS1V6N0dxNVhNYWsvYTcxSWMzRm1SN0hIbAppRC9TbHhJNVJtTXdtZFRucUFJeDNHbkJqNHVqRVM3NzdRVjdlbWc2cTEzaEorZ2MvdDRIVnFWNU1mQXdaMk8wCm5BbFYrUEw4bVUrek5yUkJQUHBYZFF1aU9YODFyV3FldHhxQ3h1K2ZaL0o1aE02WTZkQlJ2Yk1rQ05QQXh3NXcKNnRUTFRISkxZekQrVFEzWjhETWVKNURmTmVnSml2YjRoTnF0L3hqSXZTVThpdWNDZ2NFQXZ3QlZhbnlYd3B6RQpiQnFiYXMwUXptT0hncTd2amMxMWNKdm5TVmc0bGdUeGJsS0ZKd1RSMWZUREZTdDBZOWxJWVJEVG50a2VVN21TCno0c2lLVkRRZmNGMExCQWVtTUxKVW53dWF1MHpGa2FvVUR0QWdqdElvME9LbUVBNmRjZlBiK1NhZ1F1dm9OWVQKUDc4cjgva3NvRkRvZUVrVC9MNWI3THpGczZXUi9XK2FQRmoxdUw2ZjlkOWJPT3ZxdlhGVGpZUXE0SzVWUk94KwpReGxDWE0wamdFcm15Z2VyZSt3VUFWVTVYQ0w4RkJEeTlwaHVYa1pZT3V6OFJtRWtWaFF6Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCgo=
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: metric-proxy
  namespace: cf-system
  labels:
    app: metric-proxy
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: metric-proxy
  template:
    metadata:
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9090"
        prometheus.io/path: /metrics
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: metric-proxy
    spec:
      serviceAccountName: metric-proxy
      containers:
      - name: metric-proxy
        image: oratos/metric-proxy@sha256:0e933b4f7208d3d6453ee28044126392a92055a565288434f2c522bf18a44fe1
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
        - containerPort: 9090
        env:
        - name: ADDR
          value: :8080
        - name: APP_SELECTOR
          value: cloudfoundry.org/guid
        - name: NAMESPACE
          value: cf-workloads
        - name: QUERY_TIMEOUT
          value: "5"
        - name: CA_PATH
          value: /ca/tls.crt
        - name: CERT_PATH
          value: /metric-proxy-certs/tls.crt
        - name: KEY_PATH
          value: /metric-proxy-certs/tls.key
        volumeMounts:
        - mountPath: /ca
          name: ca
          readOnly: true
        - mountPath: /metric-proxy-certs
          name: metric-proxy-certs
          readOnly: true
      volumes:
      - name: ca
        secret:
          secretName: metric-proxy-ca
      - name: metric-proxy-certs
        secret:
          secretName: metric-proxy-cert
---
apiVersion: v1
kind: Namespace
metadata:
  name: cf-blobstore
  labels:
    istio-injection: enabled
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: minio-update-prometheus-secret
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cf-blobstore-minio
  namespace: cf-blobstore
---
apiVersion: v1
data:
  accesskey: YWRtaW4=
  secretkey: ZzAzeXZiemNvN3dvc2p4bHo5cm8=
kind: Secret
metadata:
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
type: Opaque
---
apiVersion: v1
data:
  initialize: |-
    #!/bin/sh
    set -e ; # Have script exit in the event of a failed command.
    MC_CONFIG_DIR="/etc/minio/mc/"
    MC="/usr/bin/mc --config-dir ${MC_CONFIG_DIR}"

    # connectToMinio
    # Use a check-sleep-check loop to wait for Minio service to be available
    connectToMinio() {
      SCHEME=$1
      ATTEMPTS=0 ; LIMIT=29 ; # Allow 30 attempts
      set -e ; # fail if we can't read the keys.
      ACCESS=$(cat /config/accesskey) ; SECRET=$(cat /config/secretkey) ;
      set +e ; # The connections to minio are allowed to fail.
      echo "Connecting to Minio server: $SCHEME://$MINIO_ENDPOINT:$MINIO_PORT" ;
      MC_COMMAND="${MC} config host add myminio $SCHEME://$MINIO_ENDPOINT:$MINIO_PORT $ACCESS $SECRET" ;
      $MC_COMMAND ;
      STATUS=$? ;
      until [ $STATUS = 0 ]
      do
        ATTEMPTS=`expr $ATTEMPTS + 1` ;
        echo \"Failed attempts: $ATTEMPTS\" ;
        if [ $ATTEMPTS -gt $LIMIT ]; then
          exit 1 ;
        fi ;
        sleep 2 ; # 1 second intervals between attempts
        $MC_COMMAND ;
        STATUS=$? ;
      done ;
      set -e ; # reset `e` as active
      return 0
    }

    # checkBucketExists ($bucket)
    # Check if the bucket exists, by using the exit code of `mc ls`
    checkBucketExists() {
      BUCKET=$1
      CMD=$(${MC} ls myminio/$BUCKET > /dev/null 2>&1)
      return $?
    }

    # createBucket ($bucket, $policy, $purge)
    # Ensure bucket exists, purging if asked to
    createBucket() {
      BUCKET=$1
      POLICY=$2
      PURGE=$3

      # Purge the bucket, if set & exists
      # Since PURGE is user input, check explicitly for `true`
      if [ $PURGE = true ]; then
        if checkBucketExists $BUCKET ; then
          echo "Purging bucket '$BUCKET'."
          set +e ; # don't exit if this fails
          ${MC} rm -r --force myminio/$BUCKET
          set -e ; # reset `e` as active
        else
          echo "Bucket '$BUCKET' does not exist, skipping purge."
        fi
      fi

      # Create the bucket if it does not exist
      if ! checkBucketExists $BUCKET ; then
        echo "Creating bucket '$BUCKET'"
        ${MC} mb myminio/$BUCKET
      else
        echo "Bucket '$BUCKET' already exists."
      fi

      # At this point, the bucket should exist, skip checking for existence
      # Set policy on the bucket
      echo "Setting policy of bucket '$BUCKET' to '$POLICY'."
      ${MC} policy set $POLICY myminio/$BUCKET
    }

    # Try connecting to Minio instance
    scheme=http
    connectToMinio $scheme
kind: ConfigMap
metadata:
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app: minio-update-prometheus-secret
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
rules:
- apiGroups:
  - ""
  resourceNames:
  - cf-blobstore-minio-prometheus
  resources:
  - secrets
  verbs:
  - get
  - create
  - update
  - patch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
- apiGroups:
  - monitoring.coreos.com
  resourceNames:
  - cf-blobstore-minio
  resources:
  - servicemonitors
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app: minio-update-prometheus-secret
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: cf-blobstore-minio-update-prometheus-secret
subjects:
- kind: ServiceAccount
  name: cf-blobstore-minio-update-prometheus-secret
  namespace: cf-blobstore
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
spec:
  ports:
  - name: http
    port: 9000
    protocol: TCP
    targetPort: 9000
  selector:
    app: minio
    release: cf-blobstore
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: RELEASE.2020-06-14T18-32-17Z
          Type: resolved
          URL: minio/minio:RELEASE.2020-06-14T18-32-17Z
        URL: index.docker.io/minio/minio@sha256:35d654988af3b5761162d5ce06243c1517ec34beeae271c8b5983b5082968858
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
  labels:
    app: minio
    chart: minio-5.0.30
    heritage: Helm
    release: cf-blobstore
  name: cf-blobstore-minio
  namespace: cf-blobstore
spec:
  selector:
    matchLabels:
      app: minio
      release: cf-blobstore
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 1
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/config: 6f2dbe8a0c3f59cb8d9e7051cd9370791c2df5ec3cbe0bad179295559a282d2f
        checksum/secrets: debfe7f1d286d311ff318bdae05da710f2c6b260e296564745e6e261a630dccb
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: minio
        release: cf-blobstore
      name: cf-blobstore-minio
    spec:
      containers:
      - command:
        - /bin/sh
        - -ce
        - /usr/bin/docker-entrypoint.sh minio -S /etc/minio/certs/ server /export
        env:
        - name: MINIO_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              key: accesskey
              name: cf-blobstore-minio
        - name: MINIO_SECRET_KEY
          valueFrom:
            secretKeyRef:
              key: secretkey
              name: cf-blobstore-minio
        - name: MINIO_API_READY_DEADLINE
          value: 5s
        image: index.docker.io/minio/minio@sha256:35d654988af3b5761162d5ce06243c1517ec34beeae271c8b5983b5082968858
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 1
          httpGet:
            path: /minio/health/live
            port: http
            scheme: HTTP
          initialDelaySeconds: 5
          periodSeconds: 5
          successThreshold: 1
          timeoutSeconds: 1
        name: minio
        ports:
        - containerPort: 9000
          name: http
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /minio/health/ready
            port: http
          initialDelaySeconds: 30
          periodSeconds: 5
          successThreshold: 1
          timeoutSeconds: 6
        resources: {}
        volumeMounts:
        - mountPath: /export
          name: export
      securityContext:
        fsGroup: 1000
        runAsGroup: 1000
        runAsUser: 1000
      serviceAccountName: cf-blobstore-minio
      volumes:
      - name: export
        persistentVolumeClaim:
          claimName: cf-blobstore-minio
      - name: minio-user
        secret:
          secretName: cf-blobstore-minio
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.2.4
  creationTimestamp: null
  name: routes.networking.cloudfoundry.org
spec:
  group: networking.cloudfoundry.org
  names:
    kind: Route
    listKind: RouteList
    plural: routes
    singular: route
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      description: Route is the Schema for the routes API
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation
            of an object. Servers should convert recognized schemas to the latest
            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this
            object represents. Servers may infer this from the endpoint the client
            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: RouteSpec defines the desired state of Route
          properties:
            destinations:
              items:
                properties:
                  app:
                    properties:
                      guid:
                        type: string
                      process:
                        properties:
                          type:
                            type: string
                        required:
                        - type
                        type: object
                    required:
                    - guid
                    - process
                    type: object
                  guid:
                    type: string
                  port:
                    type: integer
                  selector:
                    properties:
                      matchLabels:
                        additionalProperties:
                          type: string
                        type: object
                    required:
                    - matchLabels
                    type: object
                  weight:
                    type: integer
                required:
                - app
                - guid
                - port
                - selector
                type: object
              type: array
            domain:
              properties:
                internal:
                  type: boolean
                name:
                  type: string
              required:
              - internal
              - name
              type: object
            host:
              type: string
            path:
              type: string
            url:
              type: string
          required:
          - destinations
          - domain
          - host
          - url
          type: object
        status:
          description: RouteStatus defines the observed state of Route
          properties:
            conditions:
              items:
                properties:
                  status:
                    type: boolean
                  type:
                    type: string
                required:
                - status
                - type
                type: object
              type: array
          required:
          - conditions
          type: object
      type: object
  version: v1alpha1
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: istio-reader
    release: istio
  name: istio-reader-istio-system
rules:
- apiGroups:
  - config.istio.io
  - rbac.istio.io
  - security.istio.io
  - networking.istio.io
  - authentication.istio.io
  resources:
  - '*'
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - endpoints
  - pods
  - services
  - nodes
  - replicationcontrollers
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - replicasets
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app: istio-reader
    release: istio
  name: istio-reader-istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istio-reader-istio-system
subjects:
- kind: ServiceAccount
  name: istio-reader-service-account
  namespace: istio-system
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: core
    package: istio.io.mixer
    release: istio
  name: attributemanifests.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: attributemanifest
    plural: attributemanifests
    singular: attributemanifest
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Describes the rules used to configure Mixer''s policy and
            telemetry features. See more details at: https://istio.io/docs/reference/config/policy-and-telemetry/istio.policy.v1beta1.html'
          properties:
            attributes:
              additionalProperties:
                properties:
                  description:
                    description: A human-readable description of the attribute's purpose.
                    format: string
                    type: string
                  valueType:
                    description: The type of data carried by this attribute.
                    enum:
                    - VALUE_TYPE_UNSPECIFIED
                    - STRING
                    - INT64
                    - DOUBLE
                    - BOOL
                    - TIMESTAMP
                    - IP_ADDRESS
                    - EMAIL_ADDRESS
                    - URI
                    - DNS_NAME
                    - DURATION
                    - STRING_MAP
                    type: string
                type: object
              description: The set of attributes this Istio component will be responsible
                for producing at runtime.
              type: object
            name:
              description: Name of the component producing these attributes.
              format: string
              type: string
            revision:
              description: The revision of this document.
              format: string
              type: string
          type: object
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-pilot
    heritage: Tiller
    istio: rbac
    release: istio
  name: clusterrbacconfigs.rbac.istio.io
spec:
  group: rbac.istio.io
  names:
    categories:
    - istio-io
    - rbac-istio-io
    kind: ClusterRbacConfig
    plural: clusterrbacconfigs
    singular: clusterrbacconfig
  scope: Cluster
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration for Role Based Access Control. See more details
            at: https://istio.io/docs/reference/config/authorization/istio.rbac.v1alpha1.html'
          properties:
            enforcementMode:
              enum:
              - ENFORCED
              - PERMISSIVE
              type: string
            exclusion:
              description: A list of services or namespaces that should not be enforced
                by Istio RBAC policies.
              properties:
                namespaces:
                  description: A list of namespaces.
                  items:
                    format: string
                    type: string
                  type: array
                services:
                  description: A list of services.
                  items:
                    format: string
                    type: string
                  type: array
              type: object
            inclusion:
              description: A list of services or namespaces that should be enforced
                by Istio RBAC policies.
              properties:
                namespaces:
                  description: A list of namespaces.
                  items:
                    format: string
                    type: string
                  type: array
                services:
                  description: A list of services.
                  items:
                    format: string
                    type: string
                  type: array
              type: object
            mode:
              description: Istio RBAC mode.
              enum:
              - "OFF"
              - "ON"
              - ON_WITH_INCLUSION
              - ON_WITH_EXCLUSION
              type: string
          type: object
      type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: destinationrules.networking.istio.io
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.host
    description: The name of a service from the service registry
    name: Host
    type: string
  - JSONPath: .metadata.creationTimestamp
    description: |-
      CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC.
      Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata
    name: Age
    type: date
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: DestinationRule
    listKind: DestinationRuleList
    plural: destinationrules
    shortNames:
    - dr
    singular: destinationrule
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration affecting load balancing, outlier detection,
            etc. See more details at: https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule.html'
          properties:
            exportTo:
              description: A list of namespaces to which this destination rule is
                exported.
              items:
                format: string
                type: string
              type: array
            host:
              description: The name of a service from the service registry.
              format: string
              type: string
            subsets:
              items:
                properties:
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                  name:
                    description: Name of the subset.
                    format: string
                    type: string
                  trafficPolicy:
                    description: Traffic policies that apply to this subset.
                    properties:
                      connectionPool:
                        properties:
                          http:
                            description: HTTP connection pool settings.
                            properties:
                              h2UpgradePolicy:
                                description: Specify if http1.1 connection should
                                  be upgraded to http2 for the associated destination.
                                enum:
                                - DEFAULT
                                - DO_NOT_UPGRADE
                                - UPGRADE
                                type: string
                              http1MaxPendingRequests:
                                description: Maximum number of pending HTTP requests
                                  to a destination.
                                format: int32
                                type: integer
                              http2MaxRequests:
                                description: Maximum number of requests to a backend.
                                format: int32
                                type: integer
                              idleTimeout:
                                description: The idle timeout for upstream connection
                                  pool connections.
                                type: string
                              maxRequestsPerConnection:
                                description: Maximum number of requests per connection
                                  to a backend.
                                format: int32
                                type: integer
                              maxRetries:
                                format: int32
                                type: integer
                            type: object
                          tcp:
                            description: Settings common to both HTTP and TCP upstream
                              connections.
                            properties:
                              connectTimeout:
                                description: TCP connection timeout.
                                type: string
                              maxConnections:
                                description: Maximum number of HTTP1 /TCP connections
                                  to a destination host.
                                format: int32
                                type: integer
                              tcpKeepalive:
                                description: If set then set SO_KEEPALIVE on the socket
                                  to enable TCP Keepalives.
                                properties:
                                  interval:
                                    description: The time duration between keep-alive
                                      probes.
                                    type: string
                                  probes:
                                    type: integer
                                  time:
                                    type: string
                                type: object
                            type: object
                        type: object
                      loadBalancer:
                        description: Settings controlling the load balancer algorithms.
                        oneOf:
                        - required:
                          - simple
                        - properties:
                            consistentHash:
                              oneOf:
                              - required:
                                - httpHeaderName
                              - required:
                                - httpCookie
                              - required:
                                - useSourceIp
                          required:
                          - consistentHash
                        properties:
                          consistentHash:
                            properties:
                              httpCookie:
                                description: Hash based on HTTP cookie.
                                properties:
                                  name:
                                    description: Name of the cookie.
                                    format: string
                                    type: string
                                  path:
                                    description: Path to set for the cookie.
                                    format: string
                                    type: string
                                  ttl:
                                    description: Lifetime of the cookie.
                                    type: string
                                type: object
                              httpHeaderName:
                                description: Hash based on a specific HTTP header.
                                format: string
                                type: string
                              minimumRingSize:
                                type: integer
                              useSourceIp:
                                description: Hash based on the source IP address.
                                type: boolean
                            type: object
                          simple:
                            enum:
                            - ROUND_ROBIN
                            - LEAST_CONN
                            - RANDOM
                            - PASSTHROUGH
                            type: string
                        type: object
                      outlierDetection:
                        properties:
                          baseEjectionTime:
                            description: Minimum ejection duration.
                            type: string
                          consecutiveErrors:
                            format: int32
                            type: integer
                          interval:
                            description: Time interval between ejection sweep analysis.
                            type: string
                          maxEjectionPercent:
                            format: int32
                            type: integer
                          minHealthPercent:
                            format: int32
                            type: integer
                        type: object
                      portLevelSettings:
                        description: Traffic policies specific to individual ports.
                        items:
                          properties:
                            connectionPool:
                              properties:
                                http:
                                  description: HTTP connection pool settings.
                                  properties:
                                    h2UpgradePolicy:
                                      description: Specify if http1.1 connection should
                                        be upgraded to http2 for the associated destination.
                                      enum:
                                      - DEFAULT
                                      - DO_NOT_UPGRADE
                                      - UPGRADE
                                      type: string
                                    http1MaxPendingRequests:
                                      description: Maximum number of pending HTTP
                                        requests to a destination.
                                      format: int32
                                      type: integer
                                    http2MaxRequests:
                                      description: Maximum number of requests to a
                                        backend.
                                      format: int32
                                      type: integer
                                    idleTimeout:
                                      description: The idle timeout for upstream connection
                                        pool connections.
                                      type: string
                                    maxRequestsPerConnection:
                                      description: Maximum number of requests per
                                        connection to a backend.
                                      format: int32
                                      type: integer
                                    maxRetries:
                                      format: int32
                                      type: integer
                                  type: object
                                tcp:
                                  description: Settings common to both HTTP and TCP
                                    upstream connections.
                                  properties:
                                    connectTimeout:
                                      description: TCP connection timeout.
                                      type: string
                                    maxConnections:
                                      description: Maximum number of HTTP1 /TCP connections
                                        to a destination host.
                                      format: int32
                                      type: integer
                                    tcpKeepalive:
                                      description: If set then set SO_KEEPALIVE on
                                        the socket to enable TCP Keepalives.
                                      properties:
                                        interval:
                                          description: The time duration between keep-alive
                                            probes.
                                          type: string
                                        probes:
                                          type: integer
                                        time:
                                          type: string
                                      type: object
                                  type: object
                              type: object
                            loadBalancer:
                              description: Settings controlling the load balancer
                                algorithms.
                              oneOf:
                              - required:
                                - simple
                              - properties:
                                  consistentHash:
                                    oneOf:
                                    - required:
                                      - httpHeaderName
                                    - required:
                                      - httpCookie
                                    - required:
                                      - useSourceIp
                                required:
                                - consistentHash
                              properties:
                                consistentHash:
                                  properties:
                                    httpCookie:
                                      description: Hash based on HTTP cookie.
                                      properties:
                                        name:
                                          description: Name of the cookie.
                                          format: string
                                          type: string
                                        path:
                                          description: Path to set for the cookie.
                                          format: string
                                          type: string
                                        ttl:
                                          description: Lifetime of the cookie.
                                          type: string
                                      type: object
                                    httpHeaderName:
                                      description: Hash based on a specific HTTP header.
                                      format: string
                                      type: string
                                    minimumRingSize:
                                      type: integer
                                    useSourceIp:
                                      description: Hash based on the source IP address.
                                      type: boolean
                                  type: object
                                simple:
                                  enum:
                                  - ROUND_ROBIN
                                  - LEAST_CONN
                                  - RANDOM
                                  - PASSTHROUGH
                                  type: string
                              type: object
                            outlierDetection:
                              properties:
                                baseEjectionTime:
                                  description: Minimum ejection duration.
                                  type: string
                                consecutiveErrors:
                                  format: int32
                                  type: integer
                                interval:
                                  description: Time interval between ejection sweep
                                    analysis.
                                  type: string
                                maxEjectionPercent:
                                  format: int32
                                  type: integer
                                minHealthPercent:
                                  format: int32
                                  type: integer
                              type: object
                            port:
                              properties:
                                number:
                                  type: integer
                              type: object
                            tls:
                              description: TLS related settings for connections to
                                the upstream service.
                              properties:
                                caCertificates:
                                  format: string
                                  type: string
                                clientCertificate:
                                  description: REQUIRED if mode is `MUTUAL`.
                                  format: string
                                  type: string
                                mode:
                                  enum:
                                  - DISABLE
                                  - SIMPLE
                                  - MUTUAL
                                  - ISTIO_MUTUAL
                                  type: string
                                privateKey:
                                  description: REQUIRED if mode is `MUTUAL`.
                                  format: string
                                  type: string
                                sni:
                                  description: SNI string to present to the server
                                    during TLS handshake.
                                  format: string
                                  type: string
                                subjectAltNames:
                                  items:
                                    format: string
                                    type: string
                                  type: array
                              type: object
                          type: object
                        type: array
                      tls:
                        description: TLS related settings for connections to the upstream
                          service.
                        properties:
                          caCertificates:
                            format: string
                            type: string
                          clientCertificate:
                            description: REQUIRED if mode is `MUTUAL`.
                            format: string
                            type: string
                          mode:
                            enum:
                            - DISABLE
                            - SIMPLE
                            - MUTUAL
                            - ISTIO_MUTUAL
                            type: string
                          privateKey:
                            description: REQUIRED if mode is `MUTUAL`.
                            format: string
                            type: string
                          sni:
                            description: SNI string to present to the server during
                              TLS handshake.
                            format: string
                            type: string
                          subjectAltNames:
                            items:
                              format: string
                              type: string
                            type: array
                        type: object
                    type: object
                type: object
              type: array
            trafficPolicy:
              properties:
                connectionPool:
                  properties:
                    http:
                      description: HTTP connection pool settings.
                      properties:
                        h2UpgradePolicy:
                          description: Specify if http1.1 connection should be upgraded
                            to http2 for the associated destination.
                          enum:
                          - DEFAULT
                          - DO_NOT_UPGRADE
                          - UPGRADE
                          type: string
                        http1MaxPendingRequests:
                          description: Maximum number of pending HTTP requests to
                            a destination.
                          format: int32
                          type: integer
                        http2MaxRequests:
                          description: Maximum number of requests to a backend.
                          format: int32
                          type: integer
                        idleTimeout:
                          description: The idle timeout for upstream connection pool
                            connections.
                          type: string
                        maxRequestsPerConnection:
                          description: Maximum number of requests per connection to
                            a backend.
                          format: int32
                          type: integer
                        maxRetries:
                          format: int32
                          type: integer
                      type: object
                    tcp:
                      description: Settings common to both HTTP and TCP upstream connections.
                      properties:
                        connectTimeout:
                          description: TCP connection timeout.
                          type: string
                        maxConnections:
                          description: Maximum number of HTTP1 /TCP connections to
                            a destination host.
                          format: int32
                          type: integer
                        tcpKeepalive:
                          description: If set then set SO_KEEPALIVE on the socket
                            to enable TCP Keepalives.
                          properties:
                            interval:
                              description: The time duration between keep-alive probes.
                              type: string
                            probes:
                              type: integer
                            time:
                              type: string
                          type: object
                      type: object
                  type: object
                loadBalancer:
                  description: Settings controlling the load balancer algorithms.
                  oneOf:
                  - required:
                    - simple
                  - properties:
                      consistentHash:
                        oneOf:
                        - required:
                          - httpHeaderName
                        - required:
                          - httpCookie
                        - required:
                          - useSourceIp
                    required:
                    - consistentHash
                  properties:
                    consistentHash:
                      properties:
                        httpCookie:
                          description: Hash based on HTTP cookie.
                          properties:
                            name:
                              description: Name of the cookie.
                              format: string
                              type: string
                            path:
                              description: Path to set for the cookie.
                              format: string
                              type: string
                            ttl:
                              description: Lifetime of the cookie.
                              type: string
                          type: object
                        httpHeaderName:
                          description: Hash based on a specific HTTP header.
                          format: string
                          type: string
                        minimumRingSize:
                          type: integer
                        useSourceIp:
                          description: Hash based on the source IP address.
                          type: boolean
                      type: object
                    simple:
                      enum:
                      - ROUND_ROBIN
                      - LEAST_CONN
                      - RANDOM
                      - PASSTHROUGH
                      type: string
                  type: object
                outlierDetection:
                  properties:
                    baseEjectionTime:
                      description: Minimum ejection duration.
                      type: string
                    consecutiveErrors:
                      format: int32
                      type: integer
                    interval:
                      description: Time interval between ejection sweep analysis.
                      type: string
                    maxEjectionPercent:
                      format: int32
                      type: integer
                    minHealthPercent:
                      format: int32
                      type: integer
                  type: object
                portLevelSettings:
                  description: Traffic policies specific to individual ports.
                  items:
                    properties:
                      connectionPool:
                        properties:
                          http:
                            description: HTTP connection pool settings.
                            properties:
                              h2UpgradePolicy:
                                description: Specify if http1.1 connection should
                                  be upgraded to http2 for the associated destination.
                                enum:
                                - DEFAULT
                                - DO_NOT_UPGRADE
                                - UPGRADE
                                type: string
                              http1MaxPendingRequests:
                                description: Maximum number of pending HTTP requests
                                  to a destination.
                                format: int32
                                type: integer
                              http2MaxRequests:
                                description: Maximum number of requests to a backend.
                                format: int32
                                type: integer
                              idleTimeout:
                                description: The idle timeout for upstream connection
                                  pool connections.
                                type: string
                              maxRequestsPerConnection:
                                description: Maximum number of requests per connection
                                  to a backend.
                                format: int32
                                type: integer
                              maxRetries:
                                format: int32
                                type: integer
                            type: object
                          tcp:
                            description: Settings common to both HTTP and TCP upstream
                              connections.
                            properties:
                              connectTimeout:
                                description: TCP connection timeout.
                                type: string
                              maxConnections:
                                description: Maximum number of HTTP1 /TCP connections
                                  to a destination host.
                                format: int32
                                type: integer
                              tcpKeepalive:
                                description: If set then set SO_KEEPALIVE on the socket
                                  to enable TCP Keepalives.
                                properties:
                                  interval:
                                    description: The time duration between keep-alive
                                      probes.
                                    type: string
                                  probes:
                                    type: integer
                                  time:
                                    type: string
                                type: object
                            type: object
                        type: object
                      loadBalancer:
                        description: Settings controlling the load balancer algorithms.
                        oneOf:
                        - required:
                          - simple
                        - properties:
                            consistentHash:
                              oneOf:
                              - required:
                                - httpHeaderName
                              - required:
                                - httpCookie
                              - required:
                                - useSourceIp
                          required:
                          - consistentHash
                        properties:
                          consistentHash:
                            properties:
                              httpCookie:
                                description: Hash based on HTTP cookie.
                                properties:
                                  name:
                                    description: Name of the cookie.
                                    format: string
                                    type: string
                                  path:
                                    description: Path to set for the cookie.
                                    format: string
                                    type: string
                                  ttl:
                                    description: Lifetime of the cookie.
                                    type: string
                                type: object
                              httpHeaderName:
                                description: Hash based on a specific HTTP header.
                                format: string
                                type: string
                              minimumRingSize:
                                type: integer
                              useSourceIp:
                                description: Hash based on the source IP address.
                                type: boolean
                            type: object
                          simple:
                            enum:
                            - ROUND_ROBIN
                            - LEAST_CONN
                            - RANDOM
                            - PASSTHROUGH
                            type: string
                        type: object
                      outlierDetection:
                        properties:
                          baseEjectionTime:
                            description: Minimum ejection duration.
                            type: string
                          consecutiveErrors:
                            format: int32
                            type: integer
                          interval:
                            description: Time interval between ejection sweep analysis.
                            type: string
                          maxEjectionPercent:
                            format: int32
                            type: integer
                          minHealthPercent:
                            format: int32
                            type: integer
                        type: object
                      port:
                        properties:
                          number:
                            type: integer
                        type: object
                      tls:
                        description: TLS related settings for connections to the upstream
                          service.
                        properties:
                          caCertificates:
                            format: string
                            type: string
                          clientCertificate:
                            description: REQUIRED if mode is `MUTUAL`.
                            format: string
                            type: string
                          mode:
                            enum:
                            - DISABLE
                            - SIMPLE
                            - MUTUAL
                            - ISTIO_MUTUAL
                            type: string
                          privateKey:
                            description: REQUIRED if mode is `MUTUAL`.
                            format: string
                            type: string
                          sni:
                            description: SNI string to present to the server during
                              TLS handshake.
                            format: string
                            type: string
                          subjectAltNames:
                            items:
                              format: string
                              type: string
                            type: array
                        type: object
                    type: object
                  type: array
                tls:
                  description: TLS related settings for connections to the upstream
                    service.
                  properties:
                    caCertificates:
                      format: string
                      type: string
                    clientCertificate:
                      description: REQUIRED if mode is `MUTUAL`.
                      format: string
                      type: string
                    mode:
                      enum:
                      - DISABLE
                      - SIMPLE
                      - MUTUAL
                      - ISTIO_MUTUAL
                      type: string
                    privateKey:
                      description: REQUIRED if mode is `MUTUAL`.
                      format: string
                      type: string
                    sni:
                      description: SNI string to present to the server during TLS
                        handshake.
                      format: string
                      type: string
                    subjectAltNames:
                      items:
                        format: string
                        type: string
                      type: array
                  type: object
              type: object
          type: object
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: envoyfilters.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: EnvoyFilter
    plural: envoyfilters
    singular: envoyfilter
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Customizing Envoy configuration generated by Istio. See more
            details at: https://istio.io/docs/reference/config/networking/v1alpha3/envoy-filter.html'
          properties:
            configPatches:
              description: One or more patches with match conditions.
              items:
                properties:
                  applyTo:
                    enum:
                    - INVALID
                    - LISTENER
                    - FILTER_CHAIN
                    - NETWORK_FILTER
                    - HTTP_FILTER
                    - ROUTE_CONFIGURATION
                    - VIRTUAL_HOST
                    - HTTP_ROUTE
                    - CLUSTER
                    type: string
                  match:
                    description: Match on listener/route configuration/cluster.
                    oneOf:
                    - required:
                      - listener
                    - required:
                      - routeConfiguration
                    - required:
                      - cluster
                    properties:
                      cluster:
                        description: Match on envoy cluster attributes.
                        properties:
                          name:
                            description: The exact name of the cluster to match.
                            format: string
                            type: string
                          portNumber:
                            description: The service port for which this cluster was
                              generated.
                            type: integer
                          service:
                            description: The fully qualified service name for this
                              cluster.
                            format: string
                            type: string
                          subset:
                            description: The subset associated with the service.
                            format: string
                            type: string
                        type: object
                      context:
                        description: The specific config generation context to match
                          on.
                        enum:
                        - ANY
                        - SIDECAR_INBOUND
                        - SIDECAR_OUTBOUND
                        - GATEWAY
                        type: string
                      listener:
                        description: Match on envoy listener attributes.
                        properties:
                          filterChain:
                            description: Match a specific filter chain in a listener.
                            properties:
                              applicationProtocols:
                                description: Applies only to sidecars.
                                format: string
                                type: string
                              filter:
                                description: The name of a specific filter to apply
                                  the patch to.
                                properties:
                                  name:
                                    description: The filter name to match on.
                                    format: string
                                    type: string
                                  subFilter:
                                    properties:
                                      name:
                                        description: The filter name to match on.
                                        format: string
                                        type: string
                                    type: object
                                type: object
                              name:
                                description: The name assigned to the filter chain.
                                format: string
                                type: string
                              sni:
                                description: The SNI value used by a filter chain's
                                  match condition.
                                format: string
                                type: string
                              transportProtocol:
                                description: Applies only to SIDECAR_INBOUND context.
                                format: string
                                type: string
                            type: object
                          name:
                            description: Match a specific listener by its name.
                            format: string
                            type: string
                          portName:
                            format: string
                            type: string
                          portNumber:
                            type: integer
                        type: object
                      proxy:
                        description: Match on properties associated with a proxy.
                        properties:
                          metadata:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          proxyVersion:
                            format: string
                            type: string
                        type: object
                      routeConfiguration:
                        description: Match on envoy HTTP route configuration attributes.
                        properties:
                          gateway:
                            format: string
                            type: string
                          name:
                            description: Route configuration name to match on.
                            format: string
                            type: string
                          portName:
                            description: Applicable only for GATEWAY context.
                            format: string
                            type: string
                          portNumber:
                            type: integer
                          vhost:
                            properties:
                              name:
                                format: string
                                type: string
                              route:
                                description: Match a specific route within the virtual
                                  host.
                                properties:
                                  action:
                                    description: Match a route with specific action
                                      type.
                                    enum:
                                    - ANY
                                    - ROUTE
                                    - REDIRECT
                                    - DIRECT_RESPONSE
                                    type: string
                                  name:
                                    format: string
                                    type: string
                                type: object
                            type: object
                        type: object
                    type: object
                  patch:
                    description: The patch to apply along with the operation.
                    properties:
                      operation:
                        description: Determines how the patch should be applied.
                        enum:
                        - INVALID
                        - MERGE
                        - ADD
                        - REMOVE
                        - INSERT_BEFORE
                        - INSERT_AFTER
                        type: string
                      value:
                        description: The JSON config of the object being patched.
                        type: object
                    type: object
                type: object
              type: array
            filters:
              items:
                properties:
                  filterConfig:
                    type: object
                  filterName:
                    description: The name of the filter to instantiate.
                    format: string
                    type: string
                  filterType:
                    description: The type of filter to instantiate.
                    enum:
                    - INVALID
                    - HTTP
                    - NETWORK
                    type: string
                  insertPosition:
                    description: Insert position in the filter chain.
                    properties:
                      index:
                        description: Position of this filter in the filter chain.
                        enum:
                        - FIRST
                        - LAST
                        - BEFORE
                        - AFTER
                        type: string
                      relativeTo:
                        format: string
                        type: string
                    type: object
                  listenerMatch:
                    properties:
                      address:
                        description: One or more IP addresses to which the listener
                          is bound.
                        items:
                          format: string
                          type: string
                        type: array
                      listenerProtocol:
                        description: Selects a class of listeners for the same protocol.
                        enum:
                        - ALL
                        - HTTP
                        - TCP
                        type: string
                      listenerType:
                        description: Inbound vs outbound sidecar listener or gateway
                          listener.
                        enum:
                        - ANY
                        - SIDECAR_INBOUND
                        - SIDECAR_OUTBOUND
                        - GATEWAY
                        type: string
                      portNamePrefix:
                        format: string
                        type: string
                      portNumber:
                        type: integer
                    type: object
                type: object
              type: array
            workloadLabels:
              additionalProperties:
                format: string
                type: string
              description: Deprecated.
              type: object
            workloadSelector:
              properties:
                labels:
                  additionalProperties:
                    format: string
                    type: string
                  type: object
              type: object
          type: object
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: gateways.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: Gateway
    plural: gateways
    shortNames:
    - gw
    singular: gateway
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration affecting edge load balancer. See more details
            at: https://istio.io/docs/reference/config/networking/v1alpha3/gateway.html'
          properties:
            selector:
              additionalProperties:
                format: string
                type: string
              type: object
            servers:
              description: A list of server specifications.
              items:
                properties:
                  bind:
                    format: string
                    type: string
                  defaultEndpoint:
                    format: string
                    type: string
                  hosts:
                    description: One or more hosts exposed by this gateway.
                    items:
                      format: string
                      type: string
                    type: array
                  port:
                    properties:
                      name:
                        description: Label assigned to the port.
                        format: string
                        type: string
                      number:
                        description: A valid non-negative integer port number.
                        type: integer
                      protocol:
                        description: The protocol exposed on the port.
                        format: string
                        type: string
                    type: object
                  tls:
                    description: Set of TLS related options that govern the server's
                      behavior.
                    properties:
                      caCertificates:
                        description: REQUIRED if mode is `MUTUAL`.
                        format: string
                        type: string
                      cipherSuites:
                        description: 'Optional: If specified, only support the specified
                          cipher list.'
                        items:
                          format: string
                          type: string
                        type: array
                      credentialName:
                        format: string
                        type: string
                      httpsRedirect:
                        type: boolean
                      maxProtocolVersion:
                        description: 'Optional: Maximum TLS protocol version.'
                        enum:
                        - TLS_AUTO
                        - TLSV1_0
                        - TLSV1_1
                        - TLSV1_2
                        - TLSV1_3
                        type: string
                      minProtocolVersion:
                        description: 'Optional: Minimum TLS protocol version.'
                        enum:
                        - TLS_AUTO
                        - TLSV1_0
                        - TLSV1_1
                        - TLSV1_2
                        - TLSV1_3
                        type: string
                      mode:
                        enum:
                        - PASSTHROUGH
                        - SIMPLE
                        - MUTUAL
                        - AUTO_PASSTHROUGH
                        - ISTIO_MUTUAL
                        type: string
                      privateKey:
                        description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                        format: string
                        type: string
                      serverCertificate:
                        description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
                        format: string
                        type: string
                      subjectAltNames:
                        items:
                          format: string
                          type: string
                        type: array
                      verifyCertificateHash:
                        items:
                          format: string
                          type: string
                        type: array
                      verifyCertificateSpki:
                        items:
                          format: string
                          type: string
                        type: array
                    type: object
                type: object
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-mixer
    chart: istio
    heritage: Tiller
    release: istio
  name: httpapispecbindings.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: HTTPAPISpecBinding
    plural: httpapispecbindings
    singular: httpapispecbinding
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          properties:
            api_specs:
              items:
                properties:
                  name:
                    description: The short name of the HTTPAPISpec.
                    format: string
                    type: string
                  namespace:
                    description: Optional namespace of the HTTPAPISpec.
                    format: string
                    type: string
                type: object
              type: array
            apiSpecs:
              items:
                properties:
                  name:
                    description: The short name of the HTTPAPISpec.
                    format: string
                    type: string
                  namespace:
                    description: Optional namespace of the HTTPAPISpec.
                    format: string
                    type: string
                type: object
              type: array
            services:
              description: One or more services to map the listed HTTPAPISpec onto.
              items:
                properties:
                  domain:
                    description: Domain suffix used to construct the service FQDN
                      in implementations that support such specification.
                    format: string
                    type: string
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    description: Optional one or more labels that uniquely identify
                      the service version.
                    type: object
                  name:
                    description: The short name of the service such as "foo".
                    format: string
                    type: string
                  namespace:
                    description: Optional namespace of the service.
                    format: string
                    type: string
                  service:
                    description: The service FQDN.
                    format: string
                    type: string
                type: object
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-mixer
    chart: istio
    heritage: Tiller
    release: istio
  name: httpapispecs.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: HTTPAPISpec
    plural: httpapispecs
    singular: httpapispec
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          properties:
            api_keys:
              items:
                oneOf:
                - required:
                  - query
                - required:
                  - header
                - required:
                  - cookie
                properties:
                  cookie:
                    format: string
                    type: string
                  header:
                    description: API key is sent in a request header.
                    format: string
                    type: string
                  query:
                    description: API Key is sent as a query parameter.
                    format: string
                    type: string
                type: object
              type: array
            apiKeys:
              items:
                oneOf:
                - required:
                  - query
                - required:
                  - header
                - required:
                  - cookie
                properties:
                  cookie:
                    format: string
                    type: string
                  header:
                    description: API key is sent in a request header.
                    format: string
                    type: string
                  query:
                    description: API Key is sent as a query parameter.
                    format: string
                    type: string
                type: object
              type: array
            attributes:
              properties:
                attributes:
                  additionalProperties:
                    oneOf:
                    - required:
                      - stringValue
                    - required:
                      - int64Value
                    - required:
                      - doubleValue
                    - required:
                      - boolValue
                    - required:
                      - bytesValue
                    - required:
                      - timestampValue
                    - required:
                      - durationValue
                    - required:
                      - stringMapValue
                    properties:
                      boolValue:
                        type: boolean
                      bytesValue:
                        format: binary
                        type: string
                      doubleValue:
                        format: double
                        type: number
                      durationValue:
                        type: string
                      int64Value:
                        format: int64
                        type: integer
                      stringMapValue:
                        properties:
                          entries:
                            additionalProperties:
                              format: string
                              type: string
                            description: Holds a set of name/value pairs.
                            type: object
                        type: object
                      stringValue:
                        format: string
                        type: string
                      timestampValue:
                        format: dateTime
                        type: string
                    type: object
                  description: A map of attribute name to its value.
                  type: object
              type: object
            patterns:
              description: List of HTTP patterns to match.
              items:
                oneOf:
                - required:
                  - uriTemplate
                - required:
                  - regex
                properties:
                  attributes:
                    properties:
                      attributes:
                        additionalProperties:
                          oneOf:
                          - required:
                            - stringValue
                          - required:
                            - int64Value
                          - required:
                            - doubleValue
                          - required:
                            - boolValue
                          - required:
                            - bytesValue
                          - required:
                            - timestampValue
                          - required:
                            - durationValue
                          - required:
                            - stringMapValue
                          properties:
                            boolValue:
                              type: boolean
                            bytesValue:
                              format: binary
                              type: string
                            doubleValue:
                              format: double
                              type: number
                            durationValue:
                              type: string
                            int64Value:
                              format: int64
                              type: integer
                            stringMapValue:
                              properties:
                                entries:
                                  additionalProperties:
                                    format: string
                                    type: string
                                  description: Holds a set of name/value pairs.
                                  type: object
                              type: object
                            stringValue:
                              format: string
                              type: string
                            timestampValue:
                              format: dateTime
                              type: string
                          type: object
                        description: A map of attribute name to its value.
                        type: object
                    type: object
                  httpMethod:
                    format: string
                    type: string
                  regex:
                    format: string
                    type: string
                  uriTemplate:
                    format: string
                    type: string
                type: object
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-citadel
    chart: istio
    heritage: Tiller
    release: istio
  name: meshpolicies.authentication.istio.io
spec:
  group: authentication.istio.io
  names:
    categories:
    - istio-io
    - authentication-istio-io
    kind: MeshPolicy
    listKind: MeshPolicyList
    plural: meshpolicies
    singular: meshpolicy
  scope: Cluster
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Authentication policy for Istio services. See more details
            at: https://istio.io/docs/reference/config/istio.authentication.v1alpha1.html'
          properties:
            originIsOptional:
              type: boolean
            origins:
              description: List of authentication methods that can be used for origin
                authentication.
              items:
                properties:
                  jwt:
                    description: Jwt params for the method.
                    properties:
                      audiences:
                        items:
                          format: string
                          type: string
                        type: array
                      issuer:
                        description: Identifies the issuer that issued the JWT.
                        format: string
                        type: string
                      jwks:
                        description: JSON Web Key Set of public keys to validate signature
                          of the JWT.
                        format: string
                        type: string
                      jwks_uri:
                        format: string
                        type: string
                      jwksUri:
                        format: string
                        type: string
                      jwt_headers:
                        description: JWT is sent in a request header.
                        items:
                          format: string
                          type: string
                        type: array
                      jwtHeaders:
                        description: JWT is sent in a request header.
                        items:
                          format: string
                          type: string
                        type: array
                      jwtParams:
                        description: JWT is sent in a query parameter.
                        items:
                          format: string
                          type: string
                        type: array
                      trigger_rules:
                        items:
                          properties:
                            excluded_paths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            excludedPaths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            included_paths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            includedPaths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                          type: object
                        type: array
                      triggerRules:
                        items:
                          properties:
                            excluded_paths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            excludedPaths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            included_paths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            includedPaths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                          type: object
                        type: array
                    type: object
                type: object
              type: array
            peerIsOptional:
              type: boolean
            peers:
              description: List of authentication methods that can be used for peer
                authentication.
              items:
                oneOf:
                - required:
                  - mtls
                - required:
                  - jwt
                properties:
                  jwt:
                    properties:
                      audiences:
                        items:
                          format: string
                          type: string
                        type: array
                      issuer:
                        description: Identifies the issuer that issued the JWT.
                        format: string
                        type: string
                      jwks:
                        description: JSON Web Key Set of public keys to validate signature
                          of the JWT.
                        format: string
                        type: string
                      jwks_uri:
                        format: string
                        type: string
                      jwksUri:
                        format: string
                        type: string
                      jwt_headers:
                        description: JWT is sent in a request header.
                        items:
                          format: string
                          type: string
                        type: array
                      jwtHeaders:
                        description: JWT is sent in a request header.
                        items:
                          format: string
                          type: string
                        type: array
                      jwtParams:
                        description: JWT is sent in a query parameter.
                        items:
                          format: string
                          type: string
                        type: array
                      trigger_rules:
                        items:
                          properties:
                            excluded_paths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            excludedPaths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            included_paths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            includedPaths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                          type: object
                        type: array
                      triggerRules:
                        items:
                          properties:
                            excluded_paths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            excludedPaths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            included_paths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            includedPaths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                          type: object
                        type: array
                    type: object
                  mtls:
                    description: Set if mTLS is used.
                    properties:
                      allowTls:
                        description: WILL BE DEPRECATED, if set, will translates to
                          `TLS_PERMISSIVE` mode.
                        type: boolean
                      mode:
                        description: Defines the mode of mTLS authentication.
                        enum:
                        - STRICT
                        - PERMISSIVE
                        type: string
                    type: object
                type: object
              type: array
            principalBinding:
              description: Define whether peer or origin identity should be use for
                principal.
              enum:
              - USE_PEER
              - USE_ORIGIN
              type: string
            targets:
              description: List rules to select workloads that the policy should be
                applied on.
              items:
                properties:
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                  name:
                    description: The name must be a short name from the service registry.
                    format: string
                    type: string
                  ports:
                    description: Specifies the ports.
                    items:
                      oneOf:
                      - required:
                        - number
                      - required:
                        - name
                      properties:
                        name:
                          format: string
                          type: string
                        number:
                          type: integer
                      type: object
                    type: array
                type: object
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-citadel
    chart: istio
    heritage: Tiller
    release: istio
  name: policies.authentication.istio.io
spec:
  group: authentication.istio.io
  names:
    categories:
    - istio-io
    - authentication-istio-io
    kind: Policy
    plural: policies
    singular: policy
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Authentication policy for Istio services. See more details
            at: https://istio.io/docs/reference/config/istio.authentication.v1alpha1.html'
          properties:
            originIsOptional:
              type: boolean
            origins:
              description: List of authentication methods that can be used for origin
                authentication.
              items:
                properties:
                  jwt:
                    description: Jwt params for the method.
                    properties:
                      audiences:
                        items:
                          format: string
                          type: string
                        type: array
                      issuer:
                        description: Identifies the issuer that issued the JWT.
                        format: string
                        type: string
                      jwks:
                        description: JSON Web Key Set of public keys to validate signature
                          of the JWT.
                        format: string
                        type: string
                      jwks_uri:
                        format: string
                        type: string
                      jwksUri:
                        format: string
                        type: string
                      jwt_headers:
                        description: JWT is sent in a request header.
                        items:
                          format: string
                          type: string
                        type: array
                      jwtHeaders:
                        description: JWT is sent in a request header.
                        items:
                          format: string
                          type: string
                        type: array
                      jwtParams:
                        description: JWT is sent in a query parameter.
                        items:
                          format: string
                          type: string
                        type: array
                      trigger_rules:
                        items:
                          properties:
                            excluded_paths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            excludedPaths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            included_paths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            includedPaths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                          type: object
                        type: array
                      triggerRules:
                        items:
                          properties:
                            excluded_paths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            excludedPaths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            included_paths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            includedPaths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                          type: object
                        type: array
                    type: object
                type: object
              type: array
            peerIsOptional:
              type: boolean
            peers:
              description: List of authentication methods that can be used for peer
                authentication.
              items:
                oneOf:
                - required:
                  - mtls
                - required:
                  - jwt
                properties:
                  jwt:
                    properties:
                      audiences:
                        items:
                          format: string
                          type: string
                        type: array
                      issuer:
                        description: Identifies the issuer that issued the JWT.
                        format: string
                        type: string
                      jwks:
                        description: JSON Web Key Set of public keys to validate signature
                          of the JWT.
                        format: string
                        type: string
                      jwks_uri:
                        format: string
                        type: string
                      jwksUri:
                        format: string
                        type: string
                      jwt_headers:
                        description: JWT is sent in a request header.
                        items:
                          format: string
                          type: string
                        type: array
                      jwtHeaders:
                        description: JWT is sent in a request header.
                        items:
                          format: string
                          type: string
                        type: array
                      jwtParams:
                        description: JWT is sent in a query parameter.
                        items:
                          format: string
                          type: string
                        type: array
                      trigger_rules:
                        items:
                          properties:
                            excluded_paths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            excludedPaths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            included_paths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            includedPaths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                          type: object
                        type: array
                      triggerRules:
                        items:
                          properties:
                            excluded_paths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            excludedPaths:
                              description: List of paths to be excluded from the request.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            included_paths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                            includedPaths:
                              description: List of paths that the request must include.
                              items:
                                oneOf:
                                - required:
                                  - exact
                                - required:
                                  - prefix
                                - required:
                                  - suffix
                                - required:
                                  - regex
                                properties:
                                  exact:
                                    description: exact string match.
                                    format: string
                                    type: string
                                  prefix:
                                    description: prefix-based match.
                                    format: string
                                    type: string
                                  regex:
                                    description: ECMAscript style regex-based match
                                      as defined by [EDCA-262](http://en.cppreference.com/w/cpp/regex/ecmascript).
                                    format: string
                                    type: string
                                  suffix:
                                    description: suffix-based match.
                                    format: string
                                    type: string
                                type: object
                              type: array
                          type: object
                        type: array
                    type: object
                  mtls:
                    description: Set if mTLS is used.
                    properties:
                      allowTls:
                        description: WILL BE DEPRECATED, if set, will translates to
                          `TLS_PERMISSIVE` mode.
                        type: boolean
                      mode:
                        description: Defines the mode of mTLS authentication.
                        enum:
                        - STRICT
                        - PERMISSIVE
                        type: string
                    type: object
                type: object
              type: array
            principalBinding:
              description: Define whether peer or origin identity should be use for
                principal.
              enum:
              - USE_PEER
              - USE_ORIGIN
              type: string
            targets:
              description: List rules to select workloads that the policy should be
                applied on.
              items:
                properties:
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                  name:
                    description: The name must be a short name from the service registry.
                    format: string
                    type: string
                  ports:
                    description: Specifies the ports.
                    items:
                      oneOf:
                      - required:
                        - number
                      - required:
                        - name
                      properties:
                        name:
                          format: string
                          type: string
                        number:
                          type: integer
                      type: object
                    type: array
                type: object
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-mixer
    chart: istio
    heritage: Tiller
    release: istio
  name: quotaspecbindings.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: QuotaSpecBinding
    plural: quotaspecbindings
    singular: quotaspecbinding
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          properties:
            quotaSpecs:
              items:
                properties:
                  name:
                    description: The short name of the QuotaSpec.
                    format: string
                    type: string
                  namespace:
                    description: Optional namespace of the QuotaSpec.
                    format: string
                    type: string
                type: object
              type: array
            services:
              description: One or more services to map the listed QuotaSpec onto.
              items:
                properties:
                  domain:
                    description: Domain suffix used to construct the service FQDN
                      in implementations that support such specification.
                    format: string
                    type: string
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    description: Optional one or more labels that uniquely identify
                      the service version.
                    type: object
                  name:
                    description: The short name of the service such as "foo".
                    format: string
                    type: string
                  namespace:
                    description: Optional namespace of the service.
                    format: string
                    type: string
                  service:
                    description: The service FQDN.
                    format: string
                    type: string
                type: object
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-mixer
    chart: istio
    heritage: Tiller
    release: istio
  name: quotaspecs.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - apim-istio-io
    kind: QuotaSpec
    plural: quotaspecs
    singular: quotaspec
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: Determines the quotas used for individual requests.
          properties:
            rules:
              description: A list of Quota rules.
              items:
                properties:
                  match:
                    description: If empty, match all request.
                    items:
                      properties:
                        clause:
                          additionalProperties:
                            oneOf:
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                format: string
                                type: string
                            type: object
                          description: Map of attribute names to StringMatch type.
                          type: object
                      type: object
                    type: array
                  quotas:
                    description: The list of quotas to charge.
                    items:
                      properties:
                        charge:
                          format: int32
                          type: integer
                        quota:
                          format: string
                          type: string
                      type: object
                    type: array
                type: object
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: rbac
    package: istio.io.mixer
    release: istio
  name: rbacconfigs.rbac.istio.io
spec:
  group: rbac.istio.io
  names:
    categories:
    - istio-io
    - rbac-istio-io
    kind: RbacConfig
    plural: rbacconfigs
    singular: rbacconfig
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration for Role Based Access Control. See more details
            at: https://istio.io/docs/reference/config/authorization/istio.rbac.v1alpha1.html'
          properties:
            enforcementMode:
              enum:
              - ENFORCED
              - PERMISSIVE
              type: string
            exclusion:
              description: A list of services or namespaces that should not be enforced
                by Istio RBAC policies.
              properties:
                namespaces:
                  description: A list of namespaces.
                  items:
                    format: string
                    type: string
                  type: array
                services:
                  description: A list of services.
                  items:
                    format: string
                    type: string
                  type: array
              type: object
            inclusion:
              description: A list of services or namespaces that should be enforced
                by Istio RBAC policies.
              properties:
                namespaces:
                  description: A list of namespaces.
                  items:
                    format: string
                    type: string
                  type: array
                services:
                  description: A list of services.
                  items:
                    format: string
                    type: string
                  type: array
              type: object
            mode:
              description: Istio RBAC mode.
              enum:
              - "OFF"
              - "ON"
              - ON_WITH_INCLUSION
              - ON_WITH_EXCLUSION
              type: string
          type: object
      type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: core
    package: istio.io.mixer
    release: istio
  name: rules.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: rule
    plural: rules
    singular: rule
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Describes the rules used to configure Mixer''s policy and
            telemetry features. See more details at: https://istio.io/docs/reference/config/policy-and-telemetry/istio.policy.v1beta1.html'
          properties:
            actions:
              description: The actions that will be executed when match evaluates
                to `true`.
              items:
                properties:
                  handler:
                    description: Fully qualified name of the handler to invoke.
                    format: string
                    type: string
                  instances:
                    items:
                      format: string
                      type: string
                    type: array
                  name:
                    description: A handle to refer to the results of the action.
                    format: string
                    type: string
                type: object
              type: array
            match:
              description: Match is an attribute based predicate.
              format: string
              type: string
            requestHeaderOperations:
              items:
                properties:
                  name:
                    description: Header name literal value.
                    format: string
                    type: string
                  operation:
                    description: Header operation type.
                    enum:
                    - REPLACE
                    - REMOVE
                    - APPEND
                    type: string
                  values:
                    description: Header value expressions.
                    items:
                      format: string
                      type: string
                    type: array
                type: object
              type: array
            responseHeaderOperations:
              items:
                properties:
                  name:
                    description: Header name literal value.
                    format: string
                    type: string
                  operation:
                    description: Header operation type.
                    enum:
                    - REPLACE
                    - REMOVE
                    - APPEND
                    type: string
                  values:
                    description: Header value expressions.
                    items:
                      format: string
                      type: string
                    type: array
                type: object
              type: array
            sampling:
              properties:
                random:
                  description: Provides filtering of actions based on random selection
                    per request.
                  properties:
                    attributeExpression:
                      description: Specifies an attribute expression to use to override
                        the numerator in the `percent_sampled` field.
                      format: string
                      type: string
                    percentSampled:
                      description: The default sampling rate, expressed as a percentage.
                      properties:
                        denominator:
                          description: Specifies the denominator.
                          enum:
                          - HUNDRED
                          - TEN_THOUSAND
                          type: string
                        numerator:
                          description: Specifies the numerator.
                          type: integer
                      type: object
                    useIndependentRandomness:
                      description: By default sampling will be based on the value
                        of the request header `x-request-id`.
                      type: boolean
                  type: object
                rateLimit:
                  properties:
                    maxUnsampledEntries:
                      description: Number of entries to allow during the `sampling_duration`
                        before sampling is enforced.
                      format: int64
                      type: integer
                    samplingDuration:
                      description: Window in which to enforce the sampling rate.
                      type: string
                    samplingRate:
                      description: The rate at which to sample entries once the unsampled
                        limit has been reached.
                      format: int64
                      type: integer
                  type: object
              type: object
          type: object
      type: object
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: serviceentries.networking.istio.io
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.hosts
    description: The hosts associated with the ServiceEntry
    name: Hosts
    type: string
  - JSONPath: .spec.location
    description: Whether the service is external to the mesh or part of the mesh (MESH_EXTERNAL
      or MESH_INTERNAL)
    name: Location
    type: string
  - JSONPath: .spec.resolution
    description: Service discovery mode for the hosts (NONE, STATIC, or DNS)
    name: Resolution
    type: string
  - JSONPath: .metadata.creationTimestamp
    description: |-
      CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC.
      Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata
    name: Age
    type: date
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: ServiceEntry
    listKind: ServiceEntryList
    plural: serviceentries
    shortNames:
    - se
    singular: serviceentry
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration affecting service registry. See more details
            at: https://istio.io/docs/reference/config/networking/v1alpha3/service-entry.html'
          properties:
            addresses:
              description: The virtual IP addresses associated with the service.
              items:
                format: string
                type: string
              type: array
            endpoints:
              description: One or more endpoints associated with the service.
              items:
                properties:
                  address:
                    format: string
                    type: string
                  labels:
                    additionalProperties:
                      format: string
                      type: string
                    description: One or more labels associated with the endpoint.
                    type: object
                  locality:
                    description: The locality associated with the endpoint.
                    format: string
                    type: string
                  network:
                    format: string
                    type: string
                  ports:
                    additionalProperties:
                      type: integer
                    description: Set of ports associated with the endpoint.
                    type: object
                  weight:
                    description: The load balancing weight associated with the endpoint.
                    type: integer
                type: object
              type: array
            exportTo:
              description: A list of namespaces to which this service is exported.
              items:
                format: string
                type: string
              type: array
            hosts:
              description: The hosts associated with the ServiceEntry.
              items:
                format: string
                type: string
              type: array
            location:
              enum:
              - MESH_EXTERNAL
              - MESH_INTERNAL
              type: string
            ports:
              description: The ports associated with the external service.
              items:
                properties:
                  name:
                    description: Label assigned to the port.
                    format: string
                    type: string
                  number:
                    description: A valid non-negative integer port number.
                    type: integer
                  protocol:
                    description: The protocol exposed on the port.
                    format: string
                    type: string
                type: object
              type: array
            resolution:
              description: Service discovery mode for the hosts.
              enum:
              - NONE
              - STATIC
              - DNS
              type: string
            subjectAltNames:
              items:
                format: string
                type: string
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: rbac
    package: istio.io.mixer
    release: istio
  name: servicerolebindings.rbac.istio.io
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.roleRef.name
    description: The name of the ServiceRole object being referenced
    name: Reference
    type: string
  - JSONPath: .metadata.creationTimestamp
    description: |-
      CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC.
      Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata
    name: Age
    type: date
  group: rbac.istio.io
  names:
    categories:
    - istio-io
    - rbac-istio-io
    kind: ServiceRoleBinding
    plural: servicerolebindings
    singular: servicerolebinding
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration for Role Based Access Control. See more details
            at: https://istio.io/docs/reference/config/authorization/istio.rbac.v1alpha1.html'
          properties:
            actions:
              items:
                properties:
                  constraints:
                    description: Optional.
                    items:
                      properties:
                        key:
                          description: Key of the constraint.
                          format: string
                          type: string
                        values:
                          description: List of valid values for the constraint.
                          items:
                            format: string
                            type: string
                          type: array
                      type: object
                    type: array
                  hosts:
                    items:
                      format: string
                      type: string
                    type: array
                  methods:
                    description: Optional.
                    items:
                      format: string
                      type: string
                    type: array
                  notHosts:
                    items:
                      format: string
                      type: string
                    type: array
                  notMethods:
                    items:
                      format: string
                      type: string
                    type: array
                  notPaths:
                    items:
                      format: string
                      type: string
                    type: array
                  notPorts:
                    items:
                      format: int32
                      type: integer
                    type: array
                  paths:
                    description: Optional.
                    items:
                      format: string
                      type: string
                    type: array
                  ports:
                    items:
                      format: int32
                      type: integer
                    type: array
                  services:
                    description: A list of service names.
                    items:
                      format: string
                      type: string
                    type: array
                type: object
              type: array
            mode:
              enum:
              - ENFORCED
              - PERMISSIVE
              type: string
            role:
              format: string
              type: string
            roleRef:
              description: Reference to the ServiceRole object.
              properties:
                kind:
                  description: The type of the role being referenced.
                  format: string
                  type: string
                name:
                  description: The name of the ServiceRole object being referenced.
                  format: string
                  type: string
              type: object
            subjects:
              description: List of subjects that are assigned the ServiceRole object.
              items:
                properties:
                  group:
                    format: string
                    type: string
                  groups:
                    items:
                      format: string
                      type: string
                    type: array
                  ips:
                    items:
                      format: string
                      type: string
                    type: array
                  names:
                    items:
                      format: string
                      type: string
                    type: array
                  namespaces:
                    items:
                      format: string
                      type: string
                    type: array
                  notGroups:
                    items:
                      format: string
                      type: string
                    type: array
                  notIps:
                    items:
                      format: string
                      type: string
                    type: array
                  notNames:
                    items:
                      format: string
                      type: string
                    type: array
                  notNamespaces:
                    items:
                      format: string
                      type: string
                    type: array
                  properties:
                    additionalProperties:
                      format: string
                      type: string
                    description: Optional.
                    type: object
                  user:
                    description: Optional.
                    format: string
                    type: string
                type: object
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: rbac
    package: istio.io.mixer
    release: istio
  name: serviceroles.rbac.istio.io
spec:
  group: rbac.istio.io
  names:
    categories:
    - istio-io
    - rbac-istio-io
    kind: ServiceRole
    plural: serviceroles
    singular: servicerole
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration for Role Based Access Control. See more details
            at: https://istio.io/docs/reference/config/authorization/istio.rbac.v1alpha1.html'
          properties:
            rules:
              description: The set of access rules (permissions) that the role has.
              items:
                properties:
                  constraints:
                    description: Optional.
                    items:
                      properties:
                        key:
                          description: Key of the constraint.
                          format: string
                          type: string
                        values:
                          description: List of valid values for the constraint.
                          items:
                            format: string
                            type: string
                          type: array
                      type: object
                    type: array
                  hosts:
                    items:
                      format: string
                      type: string
                    type: array
                  methods:
                    description: Optional.
                    items:
                      format: string
                      type: string
                    type: array
                  notHosts:
                    items:
                      format: string
                      type: string
                    type: array
                  notMethods:
                    items:
                      format: string
                      type: string
                    type: array
                  notPaths:
                    items:
                      format: string
                      type: string
                    type: array
                  notPorts:
                    items:
                      format: int32
                      type: integer
                    type: array
                  paths:
                    description: Optional.
                    items:
                      format: string
                      type: string
                    type: array
                  ports:
                    items:
                      format: int32
                      type: integer
                    type: array
                  services:
                    description: A list of service names.
                    items:
                      format: string
                      type: string
                    type: array
                type: object
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: virtualservices.networking.istio.io
spec:
  additionalPrinterColumns:
  - JSONPath: .spec.gateways
    description: The names of gateways and sidecars that should apply these routes
    name: Gateways
    type: string
  - JSONPath: .spec.hosts
    description: The destination hosts to which traffic is being sent
    name: Hosts
    type: string
  - JSONPath: .metadata.creationTimestamp
    description: |-
      CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC.
      Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata
    name: Age
    type: date
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: VirtualService
    listKind: VirtualServiceList
    plural: virtualservices
    shortNames:
    - vs
    singular: virtualservice
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration affecting label/content routing, sni routing,
            etc. See more details at: https://istio.io/docs/reference/config/networking/v1alpha3/virtual-service.html'
          properties:
            exportTo:
              description: A list of namespaces to which this virtual service is exported.
              items:
                format: string
                type: string
              type: array
            gateways:
              description: The names of gateways and sidecars that should apply these
                routes.
              items:
                format: string
                type: string
              type: array
            hosts:
              description: The destination hosts to which traffic is being sent.
              items:
                format: string
                type: string
              type: array
            http:
              description: An ordered list of route rules for HTTP traffic.
              items:
                properties:
                  appendHeaders:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                  appendRequestHeaders:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                  appendResponseHeaders:
                    additionalProperties:
                      format: string
                      type: string
                    type: object
                  corsPolicy:
                    description: Cross-Origin Resource Sharing policy (CORS).
                    properties:
                      allowCredentials:
                        nullable: true
                        type: boolean
                      allowHeaders:
                        items:
                          format: string
                          type: string
                        type: array
                      allowMethods:
                        description: List of HTTP methods allowed to access the resource.
                        items:
                          format: string
                          type: string
                        type: array
                      allowOrigin:
                        description: The list of origins that are allowed to perform
                          CORS requests.
                        items:
                          format: string
                          type: string
                        type: array
                      exposeHeaders:
                        items:
                          format: string
                          type: string
                        type: array
                      maxAge:
                        type: string
                    type: object
                  fault:
                    description: Fault injection policy to apply on HTTP traffic at
                      the client side.
                    properties:
                      abort:
                        oneOf:
                        - properties:
                            percent: {}
                          required:
                          - httpStatus
                        - properties:
                            percent: {}
                          required:
                          - grpcStatus
                        - properties:
                            percent: {}
                          required:
                          - http2Error
                        properties:
                          grpcStatus:
                            format: string
                            type: string
                          http2Error:
                            format: string
                            type: string
                          httpStatus:
                            description: HTTP status code to use to abort the Http
                              request.
                            format: int32
                            type: integer
                          percent:
                            description: Percentage of requests to be aborted with
                              the error code provided (0-100).
                            format: int32
                            type: integer
                          percentage:
                            description: Percentage of requests to be aborted with
                              the error code provided.
                            properties:
                              value:
                                format: double
                                type: number
                            type: object
                        type: object
                      delay:
                        oneOf:
                        - properties:
                            percent: {}
                          required:
                          - fixedDelay
                        - properties:
                            percent: {}
                          required:
                          - exponentialDelay
                        properties:
                          exponentialDelay:
                            type: string
                          fixedDelay:
                            description: Add a fixed delay before forwarding the request.
                            type: string
                          percent:
                            description: Percentage of requests on which the delay
                              will be injected (0-100).
                            format: int32
                            type: integer
                          percentage:
                            description: Percentage of requests on which the delay
                              will be injected.
                            properties:
                              value:
                                format: double
                                type: number
                            type: object
                        type: object
                    type: object
                  headers:
                    properties:
                      request:
                        properties:
                          add:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          remove:
                            items:
                              format: string
                              type: string
                            type: array
                          set:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                        type: object
                      response:
                        properties:
                          add:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                          remove:
                            items:
                              format: string
                              type: string
                            type: array
                          set:
                            additionalProperties:
                              format: string
                              type: string
                            type: object
                        type: object
                    type: object
                  match:
                    items:
                      properties:
                        authority:
                          oneOf:
                          - required:
                            - exact
                          - required:
                            - prefix
                          - required:
                            - regex
                          properties:
                            exact:
                              format: string
                              type: string
                            prefix:
                              format: string
                              type: string
                            regex:
                              format: string
                              type: string
                          type: object
                        gateways:
                          items:
                            format: string
                            type: string
                          type: array
                        headers:
                          additionalProperties:
                            oneOf:
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                format: string
                                type: string
                            type: object
                          type: object
                        ignoreUriCase:
                          description: Flag to specify whether the URI matching should
                            be case-insensitive.
                          type: boolean
                        method:
                          oneOf:
                          - required:
                            - exact
                          - required:
                            - prefix
                          - required:
                            - regex
                          properties:
                            exact:
                              format: string
                              type: string
                            prefix:
                              format: string
                              type: string
                            regex:
                              format: string
                              type: string
                          type: object
                        name:
                          description: The name assigned to a match.
                          format: string
                          type: string
                        port:
                          description: Specifies the ports on the host that is being
                            addressed.
                          type: integer
                        queryParams:
                          additionalProperties:
                            oneOf:
                            - required:
                              - exact
                            - required:
                              - prefix
                            - required:
                              - regex
                            properties:
                              exact:
                                format: string
                                type: string
                              prefix:
                                format: string
                                type: string
                              regex:
                                format: string
                                type: string
                            type: object
                          description: Query parameters for matching.
                          type: object
                        scheme:
                          oneOf:
                          - required:
                            - exact
                          - required:
                            - prefix
                          - required:
                            - regex
                          properties:
                            exact:
                              format: string
                              type: string
                            prefix:
                              format: string
                              type: string
                            regex:
                              format: string
                              type: string
                          type: object
                        sourceLabels:
                          additionalProperties:
                            format: string
                            type: string
                          type: object
                        uri:
                          oneOf:
                          - required:
                            - exact
                          - required:
                            - prefix
                          - required:
                            - regex
                          properties:
                            exact:
                              format: string
                              type: string
                            prefix:
                              format: string
                              type: string
                            regex:
                              format: string
                              type: string
                          type: object
                      type: object
                    type: array
                  mirror:
                    properties:
                      host:
                        description: The name of a service from the service registry.
                        format: string
                        type: string
                      port:
                        description: Specifies the port on the host that is being
                          addressed.
                        properties:
                          number:
                            type: integer
                        type: object
                      subset:
                        description: The name of a subset within the service.
                        format: string
                        type: string
                    type: object
                  mirror_percent:
                    description: Percentage of the traffic to be mirrored by the `mirror`
                      field.
                    nullable: true
                    type: integer
                  mirrorPercent:
                    description: Percentage of the traffic to be mirrored by the `mirror`
                      field.
                    nullable: true
                    type: integer
                  name:
                    description: The name assigned to the route for debugging purposes.
                    format: string
                    type: string
                  redirect:
                    description: A http rule can either redirect or forward (default)
                      traffic.
                    properties:
                      authority:
                        format: string
                        type: string
                      redirectCode:
                        type: integer
                      uri:
                        format: string
                        type: string
                    type: object
                  removeRequestHeaders:
                    items:
                      format: string
                      type: string
                    type: array
                  removeResponseHeaders:
                    items:
                      format: string
                      type: string
                    type: array
                  retries:
                    description: Retry policy for HTTP requests.
                    properties:
                      attempts:
                        description: Number of retries for a given request.
                        format: int32
                        type: integer
                      perTryTimeout:
                        description: Timeout per retry attempt for a given request.
                        type: string
                      retryOn:
                        description: Specifies the conditions under which retry takes
                          place.
                        format: string
                        type: string
                    type: object
                  rewrite:
                    description: Rewrite HTTP URIs and Authority headers.
                    properties:
                      authority:
                        description: rewrite the Authority/Host header with this value.
                        format: string
                        type: string
                      uri:
                        format: string
                        type: string
                    type: object
                  route:
                    description: A http rule can either redirect or forward (default)
                      traffic.
                    items:
                      properties:
                        appendRequestHeaders:
                          additionalProperties:
                            format: string
                            type: string
                          description: Use of `append_request_headers` is deprecated.
                          type: object
                        appendResponseHeaders:
                          additionalProperties:
                            format: string
                            type: string
                          description: Use of `append_response_headers` is deprecated.
                          type: object
                        destination:
                          properties:
                            host:
                              description: The name of a service from the service
                                registry.
                              format: string
                              type: string
                            port:
                              description: Specifies the port on the host that is
                                being addressed.
                              properties:
                                number:
                                  type: integer
                              type: object
                            subset:
                              description: The name of a subset within the service.
                              format: string
                              type: string
                          type: object
                        headers:
                          properties:
                            request:
                              properties:
                                add:
                                  additionalProperties:
                                    format: string
                                    type: string
                                  type: object
                                remove:
                                  items:
                                    format: string
                                    type: string
                                  type: array
                                set:
                                  additionalProperties:
                                    format: string
                                    type: string
                                  type: object
                              type: object
                            response:
                              properties:
                                add:
                                  additionalProperties:
                                    format: string
                                    type: string
                                  type: object
                                remove:
                                  items:
                                    format: string
                                    type: string
                                  type: array
                                set:
                                  additionalProperties:
                                    format: string
                                    type: string
                                  type: object
                              type: object
                          type: object
                        removeRequestHeaders:
                          description: Use of `remove_request_headers` is deprecated.
                          items:
                            format: string
                            type: string
                          type: array
                        removeResponseHeaders:
                          description: Use of `remove_response_header` is deprecated.
                          items:
                            format: string
                            type: string
                          type: array
                        weight:
                          format: int32
                          type: integer
                      type: object
                    type: array
                  timeout:
                    description: Timeout for HTTP requests.
                    type: string
                  websocketUpgrade:
                    description: Deprecated.
                    type: boolean
                type: object
              type: array
            tcp:
              description: An ordered list of route rules for opaque TCP traffic.
              items:
                properties:
                  match:
                    items:
                      properties:
                        destinationSubnets:
                          description: IPv4 or IPv6 ip addresses of destination with
                            optional subnet.
                          items:
                            format: string
                            type: string
                          type: array
                        gateways:
                          description: Names of gateways where the rule should be
                            applied to.
                          items:
                            format: string
                            type: string
                          type: array
                        port:
                          description: Specifies the port on the host that is being
                            addressed.
                          type: integer
                        sourceLabels:
                          additionalProperties:
                            format: string
                            type: string
                          type: object
                        sourceSubnet:
                          description: IPv4 or IPv6 ip address of source with optional
                            subnet.
                          format: string
                          type: string
                      type: object
                    type: array
                  route:
                    description: The destination to which the connection should be
                      forwarded to.
                    items:
                      properties:
                        destination:
                          properties:
                            host:
                              description: The name of a service from the service
                                registry.
                              format: string
                              type: string
                            port:
                              description: Specifies the port on the host that is
                                being addressed.
                              properties:
                                number:
                                  type: integer
                              type: object
                            subset:
                              description: The name of a subset within the service.
                              format: string
                              type: string
                          type: object
                        weight:
                          format: int32
                          type: integer
                      type: object
                    type: array
                type: object
              type: array
            tls:
              items:
                properties:
                  match:
                    items:
                      properties:
                        destinationSubnets:
                          description: IPv4 or IPv6 ip addresses of destination with
                            optional subnet.
                          items:
                            format: string
                            type: string
                          type: array
                        gateways:
                          description: Names of gateways where the rule should be
                            applied to.
                          items:
                            format: string
                            type: string
                          type: array
                        port:
                          description: Specifies the port on the host that is being
                            addressed.
                          type: integer
                        sniHosts:
                          description: SNI (server name indicator) to match on.
                          items:
                            format: string
                            type: string
                          type: array
                        sourceLabels:
                          additionalProperties:
                            format: string
                            type: string
                          type: object
                        sourceSubnet:
                          description: IPv4 or IPv6 ip address of source with optional
                            subnet.
                          format: string
                          type: string
                      type: object
                    type: array
                  route:
                    description: The destination to which the connection should be
                      forwarded to.
                    items:
                      properties:
                        destination:
                          properties:
                            host:
                              description: The name of a service from the service
                                registry.
                              format: string
                              type: string
                            port:
                              description: Specifies the port on the host that is
                                being addressed.
                              properties:
                                number:
                                  type: integer
                              type: object
                            subset:
                              description: The name of a subset within the service.
                              format: string
                              type: string
                          type: object
                        weight:
                          format: int32
                          type: integer
                      type: object
                    type: array
                type: object
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: mixer-adapter
    package: adapter
    release: istio
  name: adapters.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: adapter
    plural: adapters
    singular: adapter
  scope: Namespaced
  subresources:
    status: {}
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: mixer-instance
    package: instance
    release: istio
  name: instances.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: instance
    plural: instances
    singular: instance
  scope: Namespaced
  subresources:
    status: {}
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: mixer-template
    package: template
    release: istio
  name: templates.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: template
    plural: templates
    singular: template
  scope: Namespaced
  subresources:
    status: {}
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: mixer
    chart: istio
    heritage: Tiller
    istio: mixer-handler
    package: handler
    release: istio
  name: handlers.config.istio.io
spec:
  group: config.istio.io
  names:
    categories:
    - istio-io
    - policy-istio-io
    kind: handler
    plural: handlers
    singular: handler
  scope: Namespaced
  subresources:
    status: {}
  versions:
  - name: v1alpha2
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-pilot
    chart: istio
    heritage: Tiller
    release: istio
  name: sidecars.networking.istio.io
spec:
  group: networking.istio.io
  names:
    categories:
    - istio-io
    - networking-istio-io
    kind: Sidecar
    plural: sidecars
    singular: sidecar
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration affecting network reachability of a sidecar.
            See more details at: https://istio.io/docs/reference/config/networking/v1alpha3/sidecar.html'
          properties:
            egress:
              items:
                properties:
                  bind:
                    format: string
                    type: string
                  captureMode:
                    enum:
                    - DEFAULT
                    - IPTABLES
                    - NONE
                    type: string
                  hosts:
                    items:
                      format: string
                      type: string
                    type: array
                  port:
                    description: The port associated with the listener.
                    properties:
                      name:
                        description: Label assigned to the port.
                        format: string
                        type: string
                      number:
                        description: A valid non-negative integer port number.
                        type: integer
                      protocol:
                        description: The protocol exposed on the port.
                        format: string
                        type: string
                    type: object
                type: object
              type: array
            ingress:
              items:
                properties:
                  bind:
                    description: The ip to which the listener should be bound.
                    format: string
                    type: string
                  captureMode:
                    enum:
                    - DEFAULT
                    - IPTABLES
                    - NONE
                    type: string
                  defaultEndpoint:
                    format: string
                    type: string
                  port:
                    description: The port associated with the listener.
                    properties:
                      name:
                        description: Label assigned to the port.
                        format: string
                        type: string
                      number:
                        description: A valid non-negative integer port number.
                        type: integer
                      protocol:
                        description: The protocol exposed on the port.
                        format: string
                        type: string
                    type: object
                type: object
              type: array
            outboundTrafficPolicy:
              description: This allows to configure the outbound traffic policy.
              properties:
                mode:
                  enum:
                  - REGISTRY_ONLY
                  - ALLOW_ANY
                  type: string
              type: object
            workloadSelector:
              properties:
                labels:
                  additionalProperties:
                    format: string
                    type: string
                  type: object
              type: object
          type: object
      type: object
  versions:
  - name: v1alpha3
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: istio-pilot
    heritage: Tiller
    istio: security
    release: istio
  name: authorizationpolicies.security.istio.io
spec:
  group: security.istio.io
  names:
    categories:
    - istio-io
    - security-istio-io
    kind: AuthorizationPolicy
    plural: authorizationpolicies
    singular: authorizationpolicy
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: 'Configuration for access control on workloads. See more details
            at: https://istio.io/docs/reference/config/security/v1beta1/authorization-policy.html'
          properties:
            rules:
              description: Optional.
              items:
                properties:
                  from:
                    description: Optional.
                    items:
                      properties:
                        source:
                          description: Source specifies the source of a request.
                          properties:
                            ipBlocks:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            namespaces:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            principals:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            requestPrincipals:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                          type: object
                      type: object
                    type: array
                  to:
                    description: Optional.
                    items:
                      properties:
                        operation:
                          description: Operation specifies the operation of a request.
                          properties:
                            hosts:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            methods:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            paths:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                            ports:
                              description: Optional.
                              items:
                                format: string
                                type: string
                              type: array
                          type: object
                      type: object
                    type: array
                  when:
                    description: Optional.
                    items:
                      properties:
                        key:
                          description: The name of an Istio attribute.
                          format: string
                          type: string
                        values:
                          description: The allowed values for the attribute.
                          items:
                            format: string
                            type: string
                          type: array
                      type: object
                    type: array
                type: object
              type: array
            selector:
              description: Optional.
              properties:
                matchLabels:
                  additionalProperties:
                    format: string
                    type: string
                  type: object
              type: object
          type: object
      type: object
  versions:
  - name: v1beta1
    served: true
    storage: true
---
apiVersion: v1
kind: Namespace
metadata:
  labels:
    istio-injection: disabled
    istio-operator-managed: Reconcile
    cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
  name: istio-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: istio-reader
    release: istio
  name: istio-reader-service-account
  namespace: istio-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: citadel
    release: istio
  name: istio-citadel-istio-system
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - create
  - get
  - update
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - get
  - watch
  - list
  - update
  - delete
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  - services
  - namespaces
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    release: istio
  name: istio-citadel-istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istio-citadel-istio-system
subjects:
- kind: ServiceAccount
  name: istio-citadel-service-account
  namespace: istio-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/citadel:1.4.5
        URL: gcr.io/cf-routing/citadel@sha256:b8e5503716365ce3919508d72c4555e6581731c2cd56a5d3e123547c276bf541
  labels:
    app: security
    istio: citadel
    release: istio
  name: istio-citadel
  namespace: istio-system
spec:
  replicas: 1
  selector:
    matchLabels:
      istio: citadel
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 25%
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: citadel
        istio: citadel
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - ppc64le
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - s390x
            weight: 2
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
                - ppc64le
                - s390x
      containers:
      - args:
        - --append-dns-names=true
        - --grpc-port=8060
        - --citadel-storage-namespace=istio-system
        - --custom-dns-names=istio-galley-service-account.istio-config:istio-galley.istio-config.svc,istio-galley-service-account.istio-control:istio-galley.istio-control.svc,istio-galley-service-account.istio-control-master:istio-galley.istio-control-master.svc,istio-galley-service-account.istio-master:istio-galley.istio-master.svc,istio-galley-service-account.istio-pilot11:istio-galley.istio-pilot11.svc,istio-pilot-service-account.istio-control:istio-pilot.istio-control,istio-pilot-service-account.istio-pilot11:istio-pilot.istio-system,istio-sidecar-injector-service-account.istio-control:istio-sidecar-injector.istio-control.svc,istio-sidecar-injector-service-account.istio-control-master:istio-sidecar-injector.istio-control-master.svc,istio-sidecar-injector-service-account.istio-master:istio-sidecar-injector.istio-master.svc,istio-sidecar-injector-service-account.istio-pilot11:istio-sidecar-injector.istio-pilot11.svc,istio-sidecar-injector-service-account.istio-remote:istio-sidecar-injector.istio-remote.svc,
        - --self-signed-ca=true
        - --trust-domain=cluster.local
        - --workload-cert-ttl=2160h
        env:
        - name: CITADEL_ENABLE_NAMESPACES_BY_DEFAULT
          value: "true"
        image: gcr.io/cf-routing/citadel@sha256:b8e5503716365ce3919508d72c4555e6581731c2cd56a5d3e123547c276bf541
        imagePullPolicy: IfNotPresent
        livenessProbe:
          httpGet:
            path: /version
            port: 15014
          initialDelaySeconds: 5
          periodSeconds: 5
        name: citadel
        resources: {}
      serviceAccountName: istio-citadel-service-account
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
  labels:
    app: security
    istio: citadel
    release: istio
  name: istio-citadel
  namespace: istio-system
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: citadel
      istio: citadel
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: security
    istio: citadel
    release: istio
  name: istio-citadel
  namespace: istio-system
spec:
  ports:
  - name: grpc-citadel
    port: 8060
    protocol: TCP
    targetPort: 8060
  - name: http-monitoring
    port: 15014
  selector:
    app: citadel
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: security
    release: istio
  name: istio-citadel-service-account
  namespace: istio-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    release: istio
  name: istio-galley-istio-system
rules:
- apiGroups:
  - authentication.istio.io
  - config.istio.io
  - networking.istio.io
  - rbac.istio.io
  - security.istio.io
  resources:
  - '*'
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - authentication.istio.io
  - config.istio.io
  - networking.istio.io
  - rbac.istio.io
  - security.istio.io
  resources:
  - '*/status'
  verbs:
  - update
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - validatingwebhookconfigurations
  verbs:
  - '*'
- apiGroups:
  - extensions
  - apps
  resourceNames:
  - istio-galley
  resources:
  - deployments
  verbs:
  - get
- apiGroups:
  - ""
  resources:
  - pods
  - nodes
  - services
  - endpoints
  - namespaces
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - extensions
  resources:
  - ingresses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - namespaces/finalizers
  verbs:
  - update
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - clusterroles
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    release: istio
  name: istio-galley-admin-role-binding-istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istio-galley-istio-system
subjects:
- kind: ServiceAccount
  name: istio-galley-service-account
  namespace: istio-system
---
apiVersion: v1
data:
  envoy.yaml.tmpl: |-
    admin:
      access_log_path: /dev/null
      address:
        socket_address:
          address: 127.0.0.1
          port_value: 15000

    static_resources:

      clusters:
      - name: in.9901
        http2_protocol_options: {}
        connect_timeout: 1.000s

        hosts:
        - socket_address:
            address: 127.0.0.1
            port_value: 9901

        circuit_breakers:
          thresholds:
          - max_connections: 100000
            max_pending_requests: 100000
            max_requests: 100000
            max_retries: 3

      listeners:
      - name: "15019"
        address:
          socket_address:
            address: 0.0.0.0
            port_value: 15019
        filter_chains:
        - filters:
          - name: envoy.http_connection_manager
            config:
              codec_type: HTTP2
              stat_prefix: "15010"
              http2_protocol_options:
                max_concurrent_streams: 1073741824

              access_log:
              - name: envoy.file_access_log
                config:
                  path: /dev/stdout

              http_filters:
              - name: envoy.router

              route_config:
                name: "15019"

                virtual_hosts:
                - name: istio-galley

                  domains:
                  - '*'

                  routes:
                  - match:
                      prefix: /
                    route:
                      cluster: in.9901
                      timeout: 0.000s
          tls_context:
            common_tls_context:
              alpn_protocols:
              - h2
              tls_certificates:
              - certificate_chain:
                  filename: /etc/certs/cert-chain.pem
                private_key:
                  filename: /etc/certs/key.pem
              validation_context:
                trusted_ca:
                  filename: /etc/certs/root-cert.pem
            require_client_certificate: true
kind: ConfigMap
metadata:
  labels:
    app: galley
    istio: galley
    release: istio
  name: galley-envoy-config
  namespace: istio-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: v1
data:
  mesh: '{}'
kind: ConfigMap
metadata:
  labels:
    release: istio
  name: istio-mesh-galley
  namespace: istio-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: v1
data:
  validatingwebhookconfiguration.yaml: |-
    apiVersion: admissionregistration.k8s.io/v1beta1
    kind: ValidatingWebhookConfiguration
    metadata:
      name: istio-galley-istio-system
      namespace: istio-system
      labels:
        app: galley
        release: istio
        istio: galley
    webhooks:
      - name: pilot.validation.istio.io
        clientConfig:
          service:
            name: istio-galley
            namespace: istio-system
            path: "/admitpilot"
          caBundle: ""
        rules:
          - operations:
            - CREATE
            - UPDATE
            apiGroups:
            - config.istio.io
            apiVersions:
            - v1alpha2
            resources:
            - httpapispecs
            - httpapispecbindings
            - quotaspecs
            - quotaspecbindings
          - operations:
            - CREATE
            - UPDATE
            apiGroups:
            - rbac.istio.io
            apiVersions:
            - "*"
            resources:
            - "*"
          - operations:
            - CREATE
            - UPDATE
            apiGroups:
            - security.istio.io
            apiVersions:
            - "*"
            resources:
            - "*"
          - operations:
            - CREATE
            - UPDATE
            apiGroups:
            - authentication.istio.io
            apiVersions:
            - "*"
            resources:
            - "*"
          - operations:
            - CREATE
            - UPDATE
            apiGroups:
            - networking.istio.io
            apiVersions:
            - "*"
            resources:
            - destinationrules
            - envoyfilters
            - gateways
            - serviceentries
            - sidecars
            - virtualservices
        failurePolicy: Fail
        sideEffects: None
      - name: mixer.validation.istio.io
        clientConfig:
          service:
            name: istio-galley
            namespace: istio-system
            path: "/admitmixer"
          caBundle: ""
        rules:
          - operations:
            - CREATE
            - UPDATE
            apiGroups:
            - config.istio.io
            apiVersions:
            - v1alpha2
            resources:
            - rules
            - attributemanifests
            - circonuses
            - deniers
            - fluentds
            - kubernetesenvs
            - listcheckers
            - memquotas
            - noops
            - opas
            - prometheuses
            - rbacs
            - solarwindses
            - stackdrivers
            - cloudwatches
            - dogstatsds
            - statsds
            - stdios
            - apikeys
            - authorizations
            - checknothings
            # - kuberneteses
            - listentries
            - logentries
            - metrics
            - quotas
            - reportnothings
            - tracespans
            - adapters
            - handlers
            - instances
            - templates
            - zipkins
        failurePolicy: Fail
        sideEffects: None
kind: ConfigMap
metadata:
  labels:
    release: istio
  name: istio-galley-configuration
  namespace: istio-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/galley:1.4.5
        URL: gcr.io/cf-routing/galley@sha256:bd723793a3ae89f1b04c639a2a60717355e509a5a4734b9fcecc75b6ede558be
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/proxyv2:1.4.5
        URL: gcr.io/cf-routing/proxyv2@sha256:d7792fed2b3e7ffc84bfc50f693a9dd8960883ea9685b12ae1f1ef7ee2133ea3
  labels:
    app: galley
    istio: galley
    release: istio
  name: istio-galley
  namespace: istio-system
spec:
  replicas: 1
  selector:
    matchLabels:
      istio: galley
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 25%
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: galley
        chart: galley
        heritage: Tiller
        istio: galley
        release: istio
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - ppc64le
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - s390x
            weight: 2
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
                - ppc64le
                - s390x
      containers:
      - command:
        - /usr/local/bin/galley
        - server
        - --meshConfigFile=/etc/mesh-config/mesh
        - --livenessProbeInterval=1s
        - --livenessProbePath=/tmp/healthliveness
        - --readinessProbePath=/tmp/healthready
        - --readinessProbeInterval=1s
        - --insecure=true
        - --enable-validation=true
        - --enable-reconcileWebhookConfiguration=true
        - --enable-server=true
        - --deployment-namespace=istio-system
        - --validation-webhook-config-file
        - /etc/config/validatingwebhookconfiguration.yaml
        - --monitoringPort=15014
        - --validation-port=9443
        - --log_output_level=default:info
        image: gcr.io/cf-routing/galley@sha256:bd723793a3ae89f1b04c639a2a60717355e509a5a4734b9fcecc75b6ede558be
        imagePullPolicy: IfNotPresent
        livenessProbe:
          exec:
            command:
            - /usr/local/bin/galley
            - probe
            - --probe-path=/tmp/healthliveness
            - --interval=10s
          initialDelaySeconds: 5
          periodSeconds: 5
        name: galley
        ports:
        - containerPort: 9443
        - containerPort: 15014
        - containerPort: 15019
        - containerPort: 9901
        readinessProbe:
          exec:
            command:
            - /usr/local/bin/galley
            - probe
            - --probe-path=/tmp/healthready
            - --interval=10s
          initialDelaySeconds: 5
          periodSeconds: 5
        resources: {}
        volumeMounts:
        - mountPath: /etc/certs
          name: istio-certs
          readOnly: true
        - mountPath: /etc/config
          name: config
          readOnly: true
        - mountPath: /etc/mesh-config
          name: mesh-config
          readOnly: true
      - args:
        - proxy
        - --serviceCluster
        - istio-galley
        - --templateFile
        - /var/lib/istio/galley/envoy/envoy.yaml.tmpl
        - --controlPlaneAuthPolicy
        - MUTUAL_TLS
        - --trust-domain=cluster.local
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: INSTANCE_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: SDS_ENABLED
          value: "false"
        image: gcr.io/cf-routing/proxyv2@sha256:d7792fed2b3e7ffc84bfc50f693a9dd8960883ea9685b12ae1f1ef7ee2133ea3
        imagePullPolicy: IfNotPresent
        name: istio-proxy
        ports:
        - containerPort: 9902
        resources: {}
        volumeMounts:
        - mountPath: /var/lib/istio/galley/envoy
          name: envoy-config
        - mountPath: /etc/certs
          name: istio-certs
          readOnly: true
      serviceAccountName: istio-galley-service-account
      volumes:
      - name: istio-certs
        secret:
          secretName: istio.istio-galley-service-account
      - configMap:
          name: galley-envoy-config
        name: envoy-config
      - configMap:
          name: istio-galley-configuration
        name: config
      - configMap:
          name: istio-mesh-galley
        name: mesh-config
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
  labels:
    app: galley
    istio: galley
    release: istio
  name: istio-galley
  namespace: istio-system
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: galley
      istio: galley
      release: istio
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: galley
    istio: galley
    release: istio
  name: istio-galley
  namespace: istio-system
spec:
  ports:
  - name: https-validation
    port: 443
    targetPort: 9443
  - name: http-monitoring
    port: 15014
  - name: grpc-mcp
    port: 9901
  - name: grpc-tls-mcp
    port: 15019
  selector:
    istio: galley
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: galley
    release: istio
  name: istio-galley-service-account
  namespace: istio-system
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/node-agent-k8s:1.4.5
        URL: gcr.io/cf-routing/node-agent-k8s@sha256:6519f82af6e85210d0ab81c6b88ae7632073fd98d203e1e073eb0db675fcc45a
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/proxyv2:1.4.5
        URL: gcr.io/cf-routing/proxyv2@sha256:d7792fed2b3e7ffc84bfc50f693a9dd8960883ea9685b12ae1f1ef7ee2133ea3
    kapp.k14s.io/change-group: istio.io/ingressgateway
  labels:
    app: istio-ingressgateway
    istio: ingressgateway
    release: istio
  name: istio-ingressgateway
  namespace: istio-system
spec:
  selector:
    matchLabels:
      app: istio-ingressgateway
      istio: ingressgateway
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: istio-ingressgateway
        chart: gateways
        heritage: Tiller
        istio: ingressgateway
        release: istio
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - ppc64le
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - s390x
            weight: 2
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
                - ppc64le
                - s390x
      containers:
      - env:
        - name: ENABLE_WORKLOAD_SDS
          value: "false"
        - name: ENABLE_INGRESS_GATEWAY_SDS
          value: "true"
        - name: INGRESS_GATEWAY_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        image: gcr.io/cf-routing/node-agent-k8s@sha256:6519f82af6e85210d0ab81c6b88ae7632073fd98d203e1e073eb0db675fcc45a
        imagePullPolicy: IfNotPresent
        name: ingress-sds
        resources: {}
        volumeMounts:
        - mountPath: /var/run/ingress_gateway
          name: ingressgatewaysdsudspath
      - args:
        - proxy
        - router
        - --domain
        - $(POD_NAMESPACE).svc.cluster.local
        - --proxyLogLevel=warning
        - --proxyComponentLogLevel=misc:error
        - --log_output_level=default:info
        - --drainDuration
        - 45s
        - --parentShutdownDuration
        - 1m0s
        - --connectTimeout
        - 10s
        - --serviceCluster
        - istio-ingressgateway
        - --zipkinAddress
        - zipkin.istio-system:9411
        - --proxyAdminPort
        - "15000"
        - --statusPort
        - "15020"
        - --controlPlaneAuthPolicy
        - MUTUAL_TLS
        - --discoveryAddress
        - istio-pilot.istio-system:15011
        - --trust-domain=cluster.local
        env:
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.nodeName
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: INSTANCE_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: SERVICE_ACCOUNT
          valueFrom:
            fieldRef:
              fieldPath: spec.serviceAccountName
        - name: ISTIO_META_WORKLOAD_NAME
          value: istio-ingressgateway
        - name: ISTIO_META_OWNER
          value: kubernetes://apis/apps/v1/namespaces/istio-system/deployments/istio-ingressgateway
        - name: ISTIO_META_MESH_ID
          value: cluster.local
        - name: ISTIO_META_POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: ISTIO_META_CONFIG_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: ISTIO_META_USER_SDS
          value: "true"
        - name: ISTIO_META_ROUTER_MODE
          value: sni-dnat
        - name: ISTIO_METAJSON_LABELS
          value: |
            {"app":"istio-ingressgateway","istio":"ingressgateway"}
        - name: ISTIO_META_CLUSTER_ID
          value: Kubernetes
        - name: SDS_ENABLED
          value: "false"
        image: gcr.io/cf-routing/proxyv2@sha256:d7792fed2b3e7ffc84bfc50f693a9dd8960883ea9685b12ae1f1ef7ee2133ea3
        imagePullPolicy: IfNotPresent
        name: istio-proxy
        ports:
        - containerPort: 15020
        - containerPort: 80
          hostPort: 80
        - containerPort: 443
          hostPort: 443
        - containerPort: 15029
        - containerPort: 15030
        - containerPort: 15031
        - containerPort: 15032
        - containerPort: 15443
        - containerPort: 15011
        - containerPort: 8060
        - containerPort: 853
        - containerPort: 15090
          name: http-envoy-prom
          protocol: TCP
        readinessProbe:
          failureThreshold: 30
          httpGet:
            path: /healthz/ready
            port: 15020
            scheme: HTTP
          initialDelaySeconds: 1
          periodSeconds: 2
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        volumeMounts:
        - mountPath: /etc/certs
          name: istio-certs
          readOnly: true
        - mountPath: /var/run/ingress_gateway
          name: ingressgatewaysdsudspath
        - mountPath: /etc/istio/ingressgateway-certs
          name: ingressgateway-certs
          readOnly: true
        - mountPath: /etc/istio/ingressgateway-ca-certs
          name: ingressgateway-ca-certs
          readOnly: true
      serviceAccountName: istio-ingressgateway-service-account
      volumes:
      - emptyDir: {}
        name: ingressgatewaysdsudspath
      - name: istio-certs
        secret:
          optional: true
          secretName: istio.istio-ingressgateway-service-account
      - name: ingressgateway-certs
        secret:
          optional: true
          secretName: istio-ingressgateway-certs
      - name: ingressgateway-ca-certs
        secret:
          optional: true
          secretName: istio-ingressgateway-ca-certs
      priorityClassName: slightly-above-normal
  updateStrategy:
    rollingUpdate:
      maxUnavailable: 1
---
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  labels:
    release: istio
  name: ingressgateway
  namespace: istio-system
spec:
  selector:
    istio: ingressgateway
  servers:
  - hosts:
    - '*'
    port:
      name: http
      number: 80
      protocol: HTTP
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
  labels:
    app: istio-ingressgateway
    istio: ingressgateway
    release: istio
  name: ingressgateway
  namespace: istio-system
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: istio-ingressgateway
      istio: ingressgateway
      release: istio
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    release: istio
  name: istio-ingressgateway-sds
  namespace: istio-system
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - watch
  - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    release: istio
  name: istio-ingressgateway-sds
  namespace: istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: istio-ingressgateway-sds
subjects:
- kind: ServiceAccount
  name: istio-ingressgateway-service-account
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: istio-ingressgateway
    release: istio
  name: istio-ingressgateway-service-account
  namespace: istio-system
---
apiVersion: networking.istio.io/v1alpha3
kind: Sidecar
metadata:
  labels:
    release: istio
  name: default
  namespace: istio-system
spec:
  egress:
  - hosts:
    - '*/*'
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: sidecar-injector
    istio: sidecar-injector
    release: istio
  name: istio-sidecar-injector-istio-system
rules:
- apiGroups:
  - ""
  resourceNames:
  - istio-sidecar-injector
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - admissionregistration.k8s.io
  resourceNames:
  - istio-sidecar-injector
  - istio-sidecar-injector-istio-system
  resources:
  - mutatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
  - patch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app: sidecar-injector
    istio: sidecar-injector
    release: istio
  name: istio-sidecar-injector-admin-role-binding-istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istio-sidecar-injector-istio-system
subjects:
- kind: ServiceAccount
  name: istio-sidecar-injector-service-account
  namespace: istio-system
---
apiVersion: v1
data:
  mesh: |-
    # Unix Domain Socket through which envoy communicates with NodeAgent SDS to get
    # key/cert for mTLS. Use secret-mount files instead of SDS if set to empty.
    sdsUdsPath: ""

    defaultConfig:
      #
      # TCP connection timeout between Envoy & the application, and between Envoys.
      connectTimeout: 10s
      #
      ### ADVANCED SETTINGS #############
      # Where should envoy's configuration be stored in the istio-proxy container
      configPath: "/etc/istio/proxy"
      # The pseudo service name used for Envoy.
      serviceCluster: istio-proxy
      # These settings that determine how long an old Envoy
      # process should be kept alive after an occasional reload.
      drainDuration: 45s
      parentShutdownDuration: 1m0s
      #
      # Port where Envoy listens (on local host) for admin commands
      # You can exec into the istio-proxy container in a pod and
      # curl the admin port (curl http://localhost:15000/) to obtain
      # diagnostic information from Envoy. See
      # https://lyft.github.io/envoy/docs/operations/admin.html
      # for more details
      proxyAdminPort: 15000
      #
      # Set concurrency to a specific number to control the number of Proxy worker threads.
      # If set to 0 (default), then start worker thread for each CPU thread/core.
      concurrency: 2
      #
      tracing:
        zipkin:
          # Address of the Zipkin collector
          address: zipkin.istio-system:9411
      #
      # Mutual TLS authentication between sidecars and istio control plane.
      controlPlaneAuthPolicy: MUTUAL_TLS
      #
      # Address where istio Pilot service is running
      discoveryAddress: istio-pilot.istio-system:15011
kind: ConfigMap
metadata:
  labels:
    release: istio
  name: injector-mesh
  namespace: istio-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/sidecar_injector:1.4.5
        URL: gcr.io/cf-routing/sidecar_injector@sha256:81e94732e7301ea9bc568adc391b68c0a1efbdd6f4ac28540d023daa2140d0e5
  labels:
    app: sidecarInjectorWebhook
    istio: sidecar-injector
    release: istio
  name: istio-sidecar-injector
  namespace: istio-system
spec:
  replicas: 1
  selector:
    matchLabels:
      istio: sidecar-injector
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 25%
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: sidecarInjectorWebhook
        chart: sidecarInjectorWebhook
        heritage: Tiller
        istio: sidecar-injector
        release: istio
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - ppc64le
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - s390x
            weight: 2
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
                - ppc64le
                - s390x
      containers:
      - args:
        - --caCertFile=/etc/istio/certs/root-cert.pem
        - --tlsCertFile=/etc/istio/certs/cert-chain.pem
        - --tlsKeyFile=/etc/istio/certs/key.pem
        - --injectConfig=/etc/istio/inject/config
        - --meshConfig=/etc/istio/config/mesh
        - --port=9443
        - --healthCheckInterval=2s
        - --healthCheckFile=/tmp/health
        - --reconcileWebhookConfig=true
        - --webhookConfigName=istio-sidecar-injector
        - --log_output_level=debug
        image: gcr.io/cf-routing/sidecar_injector@sha256:81e94732e7301ea9bc568adc391b68c0a1efbdd6f4ac28540d023daa2140d0e5
        imagePullPolicy: IfNotPresent
        livenessProbe:
          exec:
            command:
            - /usr/local/bin/sidecar-injector
            - probe
            - --probe-path=/tmp/health
            - --interval=4s
          initialDelaySeconds: 4
          periodSeconds: 4
        name: sidecar-injector-webhook
        readinessProbe:
          exec:
            command:
            - /usr/local/bin/sidecar-injector
            - probe
            - --probe-path=/tmp/health
            - --interval=4s
          initialDelaySeconds: 4
          periodSeconds: 4
        resources: {}
        volumeMounts:
        - mountPath: /etc/istio/config
          name: config-volume
          readOnly: true
        - mountPath: /etc/istio/certs
          name: certs
          readOnly: true
        - mountPath: /etc/istio/inject
          name: inject-config
          readOnly: true
      serviceAccountName: istio-sidecar-injector-service-account
      volumes:
      - configMap:
          name: injector-mesh
        name: config-volume
      - name: certs
        secret:
          secretName: istio.istio-sidecar-injector-service-account
      - configMap:
          items:
          - key: config
            path: config
          - key: values
            path: values
          name: istio-sidecar-injector
        name: inject-config
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  labels:
    app: sidecar-injector
    release: istio
  name: istio-sidecar-injector
  annotations:
    kapp.k14s.io/change-group: cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
webhooks:
- clientConfig:
    service:
      name: istio-sidecar-injector
      namespace: istio-system
      path: /inject
  failurePolicy: Fail
  name: sidecar-injector.istio.io
  namespaceSelector:
    matchLabels:
      istio-injection: enabled
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - pods
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
  labels:
    app: sidecar-injector
    istio: sidecar-injector
    release: istio
  name: istio-sidecar-injector
  namespace: istio-system
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: sidecar-injector
      istio: sidecar-injector
      release: istio
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: sidecarInjectorWebhook
    istio: sidecar-injector
    release: istio
  name: istio-sidecar-injector
  namespace: istio-system
spec:
  ports:
  - port: 443
    targetPort: 9443
  selector:
    istio: sidecar-injector
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: sidecarInjectorWebhook
    istio: sidecar-injector
    release: istio
  name: istio-sidecar-injector-service-account
  namespace: istio-system
---
apiVersion: v1
data:
  config: |-
    policy: enabled
    alwaysInjectSelector:
      []
    neverInjectSelector:
      []
    template: |
      {{- $cniDisabled := (not .Values.istio_cni.enabled) }}
      {{- $cniRepairEnabled := (and .Values.istio_cni.enabled .Values.istio_cni.repair.enabled) }}
      {{- $enableInitContainer := (or $cniDisabled $cniRepairEnabled .Values.global.proxy.enableCoreDump) }}
      rewriteAppHTTPProbe: {{ valueOrDefault .Values.sidecarInjectorWebhook.rewriteAppHTTPProbe false }}
      {{- if $enableInitContainer }}
      initContainers:
      {{- if ne (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `NONE` }}
      {{ if $cniRepairEnabled -}}
      - name: istio-validation
      {{ else -}}
      - name: istio-init
      {{ end -}}
      {{- if contains "/" .Values.global.proxy_init.image }}
        image: "{{ .Values.global.proxy_init.image }}"
      {{- else }}
        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy_init.image }}:{{ .Values.global.tag }}"
      {{- end }}
        command:
      {{- if $cniRepairEnabled }}
        - istio-iptables-go
      {{- else }}
        - istio-iptables
      {{- end }}
        - "-p"
        - "15001"
        - "-z"
        - "15006"
        - "-u"
        - 1337
        - "-m"
        - "{{ annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode }}"
        - "-i"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundIPRanges` .Values.global.proxy.includeIPRanges }}"
        - "-x"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundIPRanges` .Values.global.proxy.excludeIPRanges }}"
        - "-b"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` `*` }}"
        - "-d"
        - "{{ excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}"
        {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/excludeOutboundPorts`) (ne (valueOrDefault .Values.global.proxy.excludeOutboundPorts "") "") -}}
        - "-o"
        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundPorts` .Values.global.proxy.excludeOutboundPorts }}"
        {{ end -}}
        {{ if (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces`) -}}
        - "-k"
        - "{{ index .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces` }}"
        {{ end -}}
        {{ if $cniRepairEnabled -}}
        - "--run-validation"
        - "--skip-rule-apply"
        {{- end }}
        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
      {{- if .Values.global.proxy_init.resources }}
        resources:
          {{ toYaml .Values.global.proxy_init.resources | indent 4 }}
      {{- else }}
        resources: {}
      {{- end }}
        securityContext:
          allowPrivilegeEscalation: {{ .Values.global.proxy.privileged }}
          privileged: {{ .Values.global.proxy.privileged }}
          capabilities:
        {{- if not $cniRepairEnabled }}
            add:
            - NET_ADMIN
            - NET_RAW
        {{- end }}
            drop:
            - ALL
          readOnlyRootFilesystem: false
        {{- if not $cniRepairEnabled }}
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
        {{- else }}
          runAsGroup: 1337
          runAsUser: 1337
          runAsNonRoot: true
        {{- end }}
        restartPolicy: Always
      {{ end -}}
      {{- if eq .Values.global.proxy.enableCoreDump true }}
      - name: enable-core-dump
        args:
        - -c
        - sysctl -w kernel.core_pattern=/var/lib/istio/core.proxy && ulimit -c unlimited
        command:
          - /bin/sh
      {{- if contains "/" .Values.global.proxy_init.image }}
        image: "{{ .Values.global.proxy_init.image }}"
      {{- else }}
        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy_init.image }}:{{ .Values.global.tag }}"
      {{- end }}
        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
        resources: {}
        securityContext:
          allowPrivilegeEscalation: true
          capabilities:
            add:
            - SYS_ADMIN
            drop:
            - ALL
          privileged: true
          readOnlyRootFilesystem: false
          runAsGroup: 0
          runAsNonRoot: false
          runAsUser: 0
      {{ end }}
      {{ end }}
      containers:
      - name: istio-proxy
      {{- if contains "/" (annotation .ObjectMeta `sidecar.istio.io/proxyImage` .Values.global.proxy.image) }}
        image: "{{ annotation .ObjectMeta `sidecar.istio.io/proxyImage` .Values.global.proxy.image }}"
      {{- else }}
        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy.image }}:{{ .Values.global.tag }}"
      {{- end }}
        ports:
        - containerPort: 15090
          protocol: TCP
          name: http-envoy-prom
        args:
        - proxy
        - sidecar
        - --domain
        - $(POD_NAMESPACE).svc.{{ .Values.global.proxy.clusterDomain }}
        - --configPath
        - "/etc/istio/proxy"
        - --binaryPath
        - "/usr/local/bin/envoy"
        - --serviceCluster
        {{ if ne "" (index .ObjectMeta.Labels "app") -}}
        - "{{ index .ObjectMeta.Labels `app` }}.$(POD_NAMESPACE)"
        {{ else -}}
        - "{{ valueOrDefault .DeploymentMeta.Name `istio-proxy` }}.{{ valueOrDefault .DeploymentMeta.Namespace `default` }}"
        {{ end -}}
        - --drainDuration
        - "{{ formatDuration .ProxyConfig.DrainDuration }}"
        - --parentShutdownDuration
        - "{{ formatDuration .ProxyConfig.ParentShutdownDuration }}"
        - --discoveryAddress
        - "{{ annotation .ObjectMeta `sidecar.istio.io/discoveryAddress` .ProxyConfig.DiscoveryAddress }}"
      {{- if eq .Values.global.proxy.tracer "lightstep" }}
        - --lightstepAddress
        - "{{ .ProxyConfig.GetTracing.GetLightstep.GetAddress }}"
        - --lightstepAccessToken
        - "{{ .ProxyConfig.GetTracing.GetLightstep.GetAccessToken }}"
        - --lightstepSecure={{ .ProxyConfig.GetTracing.GetLightstep.GetSecure }}
        - --lightstepCacertPath
        - "{{ .ProxyConfig.GetTracing.GetLightstep.GetCacertPath }}"
      {{- else if eq .Values.global.proxy.tracer "zipkin" }}
        - --zipkinAddress
        - "{{ .ProxyConfig.GetTracing.GetZipkin.GetAddress }}"
      {{- else if eq .Values.global.proxy.tracer "datadog" }}
        - --datadogAgentAddress
        - "{{ .ProxyConfig.GetTracing.GetDatadog.GetAddress }}"
      {{- end }}
        - --proxyLogLevel={{ annotation .ObjectMeta `sidecar.istio.io/logLevel` .Values.global.proxy.logLevel}}
        - --proxyComponentLogLevel={{ annotation .ObjectMeta `sidecar.istio.io/componentLogLevel` .Values.global.proxy.componentLogLevel}}
        - --connectTimeout
        - "{{ formatDuration .ProxyConfig.ConnectTimeout }}"
      {{- if .Values.global.proxy.envoyStatsd.enabled }}
        - --statsdUdpAddress
        - "{{ .ProxyConfig.StatsdUdpAddress }}"
      {{- end }}
      {{- if .Values.global.proxy.envoyMetricsService.enabled }}
        - --envoyMetricsServiceAddress
        - "{{ .ProxyConfig.GetEnvoyMetricsService.GetAddress }}"
      {{- end }}
      {{- if .Values.global.proxy.envoyAccessLogService.enabled }}
        - --envoyAccessLogServiceAddress
        - "{{ .ProxyConfig.GetEnvoyAccessLogService.GetAddress }}"
      {{- end }}
        - --proxyAdminPort
        - "{{ .ProxyConfig.ProxyAdminPort }}"
        {{ if gt .ProxyConfig.Concurrency 0 -}}
        - --concurrency
        - "{{ .ProxyConfig.Concurrency }}"
        {{ end -}}
        {{- if .Values.global.controlPlaneSecurityEnabled }}
        - --controlPlaneAuthPolicy
        - MUTUAL_TLS
        {{- else }}
        - --controlPlaneAuthPolicy
        - NONE
        {{- end }}
        - --dnsRefreshRate
        - {{ valueOrDefault .Values.global.proxy.dnsRefreshRate "300s" }}
      {{- if (ne (annotation .ObjectMeta "status.sidecar.istio.io/port" .Values.global.proxy.statusPort) "0") }}
        - --statusPort
        - "{{ annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort }}"
        - --applicationPorts
        - "{{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/applicationPorts` (applicationPorts .Spec.Containers) }}"

      {{- end }}
      {{- if .Values.global.trustDomain }}
        - --trust-domain={{ .Values.global.trustDomain }}
      {{- end }}
      {{- if .Values.global.logAsJson }}
        - --log_as_json
      {{- end }}
      {{- if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
        - --templateFile=/etc/istio/custom-bootstrap/envoy_bootstrap.json
      {{- end }}
      {{- if .Values.global.proxy.lifecycle }}
        lifecycle:
          {{ toYaml .Values.global.proxy.lifecycle | indent 4 }}
        {{- end }}
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: INSTANCE_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: SERVICE_ACCOUNT
          valueFrom:
            fieldRef:
              fieldPath: spec.serviceAccountName
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
      {{- if eq .Values.global.proxy.tracer "datadog" }}
      {{- if isset .ObjectMeta.Annotations `apm.datadoghq.com/env` }}
      {{- range $key, $value := fromJSON (index .ObjectMeta.Annotations `apm.datadoghq.com/env`) }}
        - name: {{ $key }}
          value: "{{ $value }}"
      {{- end }}
      {{- end }}
      {{- end }}
        - name: ISTIO_META_POD_PORTS
          value: |-
            [
            {{- $first := true }}
            {{- range $index1, $c := .Spec.Containers }}
              {{- range $index2, $p := $c.Ports }}
                {{- if (structToJSON $p) }}
                {{if not $first}},{{end}}{{ structToJSON $p }}
                {{- $first = false }}
                {{- end }}
              {{- end}}
            {{- end}}
            ]
        - name: ISTIO_META_CLUSTER_ID
          value: "{{ valueOrDefault .Values.global.multiCluster.clusterName `Kubernetes` }}"
        - name: ISTIO_META_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: ISTIO_META_CONFIG_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: SDS_ENABLED
          value: "{{ .Values.global.sds.enabled }}"
        - name: ISTIO_META_INTERCEPTION_MODE
          value: "{{ or (index .ObjectMeta.Annotations `sidecar.istio.io/interceptionMode`) .ProxyConfig.InterceptionMode.String }}"
        - name: ISTIO_META_INCLUDE_INBOUND_PORTS
          value: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` (applicationPorts .Spec.Containers) }}"
        {{- if .Values.global.network }}
        - name: ISTIO_META_NETWORK
          value: "{{ .Values.global.network }}"
        {{- end }}
        {{ if .ObjectMeta.Annotations }}
        - name: ISTIO_METAJSON_ANNOTATIONS
          value: |
                 {{ toJSON .ObjectMeta.Annotations }}
        {{ end }}
        {{ if .ObjectMeta.Labels }}
        - name: ISTIO_METAJSON_LABELS
          value: |
                 {{ toJSON .ObjectMeta.Labels }}
        {{ end }}
        {{- if .DeploymentMeta.Name }}
        - name: ISTIO_META_WORKLOAD_NAME
          value: {{ .DeploymentMeta.Name }}
        {{ end }}
        {{- if and .TypeMeta.APIVersion .DeploymentMeta.Name }}
        - name: ISTIO_META_OWNER
          value: kubernetes://apis/{{ .TypeMeta.APIVersion }}/namespaces/{{ valueOrDefault .DeploymentMeta.Namespace `default` }}/{{ toLower .TypeMeta.Kind}}s/{{ .DeploymentMeta.Name }}
        {{- end}}
        {{- if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
        - name: ISTIO_BOOTSTRAP_OVERRIDE
          value: "/etc/istio/custom-bootstrap/custom_bootstrap.json"
        {{- end }}
        {{- if .Values.global.sds.customTokenDirectory }}
        - name: ISTIO_META_SDS_TOKEN_PATH
          value: "{{ .Values.global.sds.customTokenDirectory -}}/sdstoken"
        {{- end }}
        {{- if .Values.global.meshID }}
        - name: ISTIO_META_MESH_ID
          value: "{{ .Values.global.meshID }}"
        {{- else if .Values.global.trustDomain }}
        - name: ISTIO_META_MESH_ID
          value: "{{ .Values.global.trustDomain }}"
        {{- end }}
        {{- if and (eq .Values.global.proxy.tracer "datadog") (isset .ObjectMeta.Annotations `apm.datadoghq.com/env`) }}
        {{- range $key, $value := fromJSON (index .ObjectMeta.Annotations `apm.datadoghq.com/env`) }}
          - name: {{ $key }}
            value: "{{ $value }}"
        {{- end }}
        {{- end }}
        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
        {{ if ne (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) `0` }}
        readinessProbe:
          httpGet:
            path: /healthz/ready
            port: {{ annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort }}
          initialDelaySeconds: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/initialDelaySeconds` .Values.global.proxy.readinessInitialDelaySeconds }}
          periodSeconds: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/periodSeconds` .Values.global.proxy.readinessPeriodSeconds }}
          failureThreshold: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/failureThreshold` .Values.global.proxy.readinessFailureThreshold }}
        {{ end -}}
        securityContext:
          allowPrivilegeEscalation: {{ .Values.global.proxy.privileged }}
          capabilities:
            {{ if eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY` -}}
            add:
            - NET_ADMIN
            {{- end }}
            drop:
            - ALL
          privileged: {{ .Values.global.proxy.privileged }}
          readOnlyRootFilesystem: {{ not .Values.global.proxy.enableCoreDump }}
          runAsGroup: 1337
          {{ if eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY` -}}
          runAsNonRoot: false
          runAsUser: 0
          {{- else -}}
          runAsNonRoot: true
          runAsUser: 1337
          {{- end }}
        resources:
          {{ if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) -}}
          requests:
            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) -}}
            cpu: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU` }}"
            {{ end}}
            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) -}}
            memory: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory` }}"
            {{ end }}
        {{ else -}}
      {{- if .Values.global.proxy.resources }}
          {{ toYaml .Values.global.proxy.resources | indent 4 }}
      {{- end }}
        {{  end -}}
        volumeMounts:
        {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
        - mountPath: /etc/istio/custom-bootstrap
          name: custom-bootstrap-volume
        {{- end }}
        - mountPath: /etc/istio/proxy
          name: istio-envoy
        {{- if .Values.global.sds.enabled }}
        - mountPath: /var/run/sds
          name: sds-uds-path
          readOnly: true
        - mountPath: /var/run/secrets/tokens
          name: istio-token
        {{- if .Values.global.sds.customTokenDirectory }}
        - mountPath: "{{ .Values.global.sds.customTokenDirectory -}}"
          name: custom-sds-token
          readOnly: true
        {{- end }}
        {{- else }}
        - mountPath: /etc/certs/
          name: istio-certs
          readOnly: true
        {{- end }}
        {{- if and (eq .Values.global.proxy.tracer "lightstep") .Values.global.tracer.lightstep.cacertPath }}
        - mountPath: {{ directory .ProxyConfig.GetTracing.GetLightstep.GetCacertPath }}
          name: lightstep-certs
          readOnly: true
        {{- end }}
          {{- if isset .ObjectMeta.Annotations `sidecar.istio.io/userVolumeMount` }}
          {{ range $index, $value := fromJSON (index .ObjectMeta.Annotations `sidecar.istio.io/userVolumeMount`) }}
        - name: "{{  $index }}"
          {{ toYaml $value | indent 4 }}
          {{ end }}
          {{- end }}
      volumes:
      {{- if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
      - name: custom-bootstrap-volume
        configMap:
          name: {{ annotation .ObjectMeta `sidecar.istio.io/bootstrapOverride` "" }}
      {{- end }}
      - emptyDir:
          medium: Memory
        name: istio-envoy
      {{- if .Values.global.sds.enabled }}
      - name: sds-uds-path
        hostPath:
          path: /var/run/sds
      - name: istio-token
        projected:
          sources:
          - serviceAccountToken:
              path: istio-token
              expirationSeconds: 43200
              audience: {{ .Values.global.sds.token.aud }}
      {{- if .Values.global.sds.customTokenDirectory }}
      - name: custom-sds-token
        secret:
          secretName: sdstokensecret
      {{- end }}
      {{- else }}
      - name: istio-certs
        secret:
          optional: true
          {{ if eq .Spec.ServiceAccountName "" }}
          secretName: istio.default
          {{ else -}}
          secretName: {{  printf "istio.%s" .Spec.ServiceAccountName }}
          {{  end -}}
        {{- if isset .ObjectMeta.Annotations `sidecar.istio.io/userVolume` }}
        {{range $index, $value := fromJSON (index .ObjectMeta.Annotations `sidecar.istio.io/userVolume`) }}
      - name: "{{ $index }}"
        {{ toYaml $value | indent 2 }}
        {{ end }}
        {{ end }}
      {{- end }}
      {{- if and (eq .Values.global.proxy.tracer "lightstep") .Values.global.tracer.lightstep.cacertPath }}
      - name: lightstep-certs
        secret:
          optional: true
          secretName: lightstep.cacert
      {{- end }}
      {{- if .Values.global.podDNSSearchNamespaces }}
      dnsConfig:
        searches:
          {{- range .Values.global.podDNSSearchNamespaces }}
          - {{ render . }}
          {{- end }}
      {{- end }}
    injectedAnnotations:
  values: '{"certmanager":{"enabled":false,"hub":"quay.io/jetstack","image":"cert-manager-controller","namespace":"istio-system","tag":"v0.6.2"},"clusterResources":true,"cni":{"namespace":"istio-system"},"galley":{"enableAnalysis":false,"enabled":true,"image":"galley","namespace":"istio-system"},"gateways":{"istio-egressgateway":{"autoscaleEnabled":true,"enabled":false,"env":{"ISTIO_META_ROUTER_MODE":"sni-dnat"},"namespace":"istio-system","ports":[{"name":"http2","port":80},{"name":"https","port":443},{"name":"tls","port":15443,"targetPort":15443}],"secretVolumes":[{"mountPath":"/etc/istio/egressgateway-certs","name":"egressgateway-certs","secretName":"istio-egressgateway-certs"},{"mountPath":"/etc/istio/egressgateway-ca-certs","name":"egressgateway-ca-certs","secretName":"istio-egressgateway-ca-certs"}],"type":"ClusterIP","zvpn":{"enabled":true,"suffix":"global"}},"istio-ingressgateway":{"applicationPorts":"","autoscaleEnabled":false,"debug":"info","domain":"","enabled":true,"env":{"ISTIO_META_ROUTER_MODE":"sni-dnat"},"externalTrafficPolicy":"Local","meshExpansionPorts":[{"name":"tcp-pilot-grpc-tls","port":15011,"targetPort":15011},{"name":"tcp-citadel-grpc-tls","port":8060,"targetPort":8060},{"name":"tcp-dns-tls","port":853,"targetPort":853}],"namespace":"istio-system","ports":[{"name":"status-port","port":15020,"targetPort":15020},{"name":"http2","port":80,"targetPort":80},{"name":"https","port":443},{"name":"kiali","port":15029,"targetPort":15029},{"name":"prometheus","port":15030,"targetPort":15030},{"name":"grafana","port":15031,"targetPort":15031},{"name":"tracing","port":15032,"targetPort":15032},{"name":"tls","port":15443,"targetPort":15443}],"sds":{"enabled":true,"image":"node-agent-k8s","resources":{"limits":{"cpu":"2000m","memory":"1024Mi"},"requests":{"cpu":"100m","memory":"128Mi"}}},"secretVolumes":[{"mountPath":"/etc/istio/ingressgateway-certs","name":"ingressgateway-certs","secretName":"istio-ingressgateway-certs"},{"mountPath":"/etc/istio/ingressgateway-ca-certs","name":"ingressgateway-ca-certs","secretName":"istio-ingressgateway-ca-certs"}],"type":"LoadBalancer","zvpn":{"enabled":true,"suffix":"global"}}},"global":{"arch":{"amd64":2,"ppc64le":2,"s390x":2},"certificates":[],"configNamespace":"istio-system","configValidation":true,"controlPlaneSecurityEnabled":true,"defaultNodeSelector":{},"defaultPodDisruptionBudget":{"enabled":true},"defaultResources":{"requests":{"cpu":"10m"}},"disablePolicyChecks":true,"enableHelmTest":false,"enableTracing":true,"enabled":true,"hub":"gcr.io/cf-routing","imagePullPolicy":"IfNotPresent","imagePullSecrets":[],"istioNamespace":"istio-system","k8sIngress":{"enableHttps":false,"enabled":false,"gatewayName":"ingressgateway"},"localityLbSetting":{"enabled":true},"logAsJson":false,"logging":{"level":"default:info"},"meshExpansion":{"enabled":false,"useILB":false},"meshNetworks":{},"mtls":{"auto":true,"enabled":false},"multiCluster":{"clusterName":"","enabled":false},"namespace":"istio-system","network":"","omitSidecarInjectorConfigMap":false,"oneNamespace":false,"operatorManageWebhooks":false,"outboundTrafficPolicy":{"mode":"ALLOW_ANY"},"policyCheckFailOpen":false,"policyNamespace":"istio-system","priorityClassName":"","prometheusNamespace":"istio-system","proxy":{"accessLogEncoding":"JSON","accessLogFile":"/dev/stdout","accessLogFormat":"{\n  \"app_id\":
    \"%REQ(CF-APP-ID)%\",\n  \"authority\": \"%REQ(:AUTHORITY)%\",\n  \"bytes_received\":
    \"%BYTES_RECEIVED%\",\n  \"bytes_sent\": \"%BYTES_SENT%\",\n  \"downstream_local_address\":
    \"%DOWNSTREAM_LOCAL_ADDRESS%\",\n  \"downstream_remote_address\": \"%DOWNSTREAM_REMOTE_ADDRESS%\",\n  \"duration\":
    \"%DURATION%\",\n  \"method\": \"%REQ(:METHOD)%\",\n  \"organization_id\": \"%REQ(CF-ORGANIZATION-ID)%\",\n  \"path\":
    \"%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%\",\n  \"process_type\": \"%REQ(APP-PROCESS-TYPE)%\",\n  \"protocol\":
    \"%PROTOCOL%\",\n  \"referer\": \"%REQ(REFERER)%\",\n  \"request_id\": \"%REQ(X-REQUEST-ID)%\",\n  \"requested_server_name\":
    \"%REQUESTED_SERVER_NAME%\",\n  \"response_code\": \"%RESPONSE_CODE%\",\n  \"response_duration\":
    \"%RESPONSE_DURATION%\",\n  \"response_flags\": \"%RESPONSE_FLAGS%\",\n  \"response_tx_duration\":
    \"%RESPONSE_TX_DURATION%\",\n  \"space_id\": \"%REQ(CF-SPACE-ID)%\",\n  \"start_time\":
    \"%START_TIME%\",\n  \"upstream_cluster\": \"%UPSTREAM_CLUSTER%\",\n  \"upstream_host\":
    \"%UPSTREAM_HOST%\",\n  \"upstream_local_address\": \"%UPSTREAM_LOCAL_ADDRESS%\",\n  \"upstream_service_time\":
    \"%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%\",\n  \"upstream_transport_failure_reason\":
    \"%UPSTREAM_TRANSPORT_FAILURE_REASON%\",\n  \"user_agent\": \"%REQ(USER-AGENT)%\",\n  \"x_b3_parentspanid\":
    \"%REQ(X-B3-PARENTSPANID)%\",\n  \"x_b3_spanid\": \"%REQ(X-B3-SPANID)%\",\n  \"x_b3_traceid\":
    \"%REQ(X-B3-TRACEID)%\",\n  \"x_forwarded_for\": \"%REQ(X-FORWARDED-FOR)%\",\n  \"x_forwarded_proto\":
    \"%REQ(X-FORWARDED-PROTO)%\"\n}","autoInject":"enabled","clusterDomain":"cluster.local","componentLogLevel":"misc:error","concurrency":2,"dnsRefreshRate":"300s","enableCoreDump":false,"envoyAccessLogService":{"enabled":false},"envoyMetricsService":{"enabled":false,"tcpKeepalive":{"interval":"10s","probes":3,"time":"10s"},"tlsSettings":{"mode":"DISABLE","subjectAltNames":[]}},"envoyStatsd":{"enabled":false},"excludeIPRanges":"","excludeInboundPorts":"","excludeOutboundPorts":"","image":"proxyv2","includeIPRanges":"*","includeInboundPorts":"*","kubevirtInterfaces":"","logLevel":"warning","privileged":false,"protocolDetectionTimeout":"100ms","readinessFailureThreshold":30,"readinessInitialDelaySeconds":1,"readinessPeriodSeconds":2,"resources":{"limits":{"cpu":"2000m","memory":"1024Mi"},"requests":{"cpu":"100m","memory":"128Mi"}},"statusPort":15020,"tracer":"zipkin"},"proxy_init":{"image":"proxyv2","resources":{"limits":{"cpu":"100m","memory":"50Mi"},"requests":{"cpu":"10m","memory":"10Mi"}}},"sds":{"enabled":false,"token":{"aud":"istio-ca"},"udsPath":""},"securityNamespace":"istio-system","tag":"1.4.5","telemetryNamespace":"istio-system","tracer":{"datadog":{"address":"$(HOST_IP):8126"},"lightstep":{"accessToken":"","address":"","cacertPath":"","secure":true},"zipkin":{"address":""}},"trustDomain":"cluster.local","useMCP":true},"grafana":{"accessMode":"ReadWriteMany","contextPath":"/grafana","dashboardProviders":{"dashboardproviders.yaml":{"apiVersion":1,"providers":[{"disableDeletion":false,"folder":"istio","name":"istio","options":{"path":"/var/lib/grafana/dashboards/istio"},"orgId":1,"type":"file"}]}},"datasources":{"datasources.yaml":{"apiVersion":1}},"enabled":false,"env":{},"envSecrets":{},"image":{"repository":"grafana/grafana","tag":"6.4.3"},"ingress":{"enabled":false,"hosts":["grafana.local"]},"namespace":"istio-system","nodeSelector":{},"persist":false,"podAntiAffinityLabelSelector":[],"podAntiAffinityTermLabelSelector":[],"replicaCount":1,"security":{"enabled":false,"passphraseKey":"passphrase","secretName":"grafana","usernameKey":"username"},"service":{"annotations":{},"externalPort":3000,"name":"http","type":"ClusterIP"},"storageClassName":"","tolerations":[]},"istio_cni":{"enabled":false,"repair":{"enabled":true}},"istiocoredns":{"coreDNSImage":"coredns/coredns","coreDNSPluginImage":"istio/coredns-plugin:0.2-istio-1.1","coreDNSTag":"1.6.2","enabled":false,"namespace":"istio-system"},"kiali":{"contextPath":"/kiali","createDemoSecret":false,"dashboard":{"passphraseKey":"passphrase","secretName":"kiali","usernameKey":"username","viewOnlyMode":false},"enabled":false,"hub":"quay.io/kiali","ingress":{"enabled":false,"hosts":["kiali.local"]},"namespace":"istio-system","nodeSelector":{},"podAntiAffinityLabelSelector":[],"podAntiAffinityTermLabelSelector":[],"replicaCount":1,"security":{"cert_file":"/kiali-cert/cert-chain.pem","enabled":false,"private_key_file":"/kiali-cert/key.pem"},"tag":"v1.9"},"mixer":{"adapters":{"kubernetesenv":{"enabled":true},"prometheus":{"enabled":true,"metricsExpiryDuration":"10m"},"stackdriver":{"auth":{"apiKey":"","appCredentials":false,"serviceAccountPath":""},"enabled":false,"tracer":{"enabled":false,"sampleProbability":1}},"stdio":{"enabled":false,"outputAsJson":false},"useAdapterCRDs":false},"policy":{"adapters":{"kubernetesenv":{"enabled":true},"useAdapterCRDs":false},"autoscaleEnabled":true,"enabled":true,"image":"mixer","namespace":"istio-system","sessionAffinityEnabled":false},"telemetry":{"autoscaleEnabled":true,"enabled":true,"env":{"GOMAXPROCS":"6"},"image":"mixer","loadshedding":{"latencyThreshold":"100ms","mode":"enforce"},"namespace":"istio-system","nodeSelector":{},"podAntiAffinityLabelSelector":[],"podAntiAffinityTermLabelSelector":[],"replicaCount":1,"reportBatchMaxEntries":100,"reportBatchMaxTime":"1s","sessionAffinityEnabled":false,"tolerations":[],"useMCP":true}},"nodeagent":{"enabled":false,"image":"node-agent-k8s","namespace":"istio-system"},"pilot":{"appNamespaces":[],"autoscaleEnabled":true,"autoscaleMax":5,"autoscaleMin":1,"configMap":true,"configNamespace":"istio-config","cpu":{"targetAverageUtilization":80},"enableProtocolSniffingForInbound":false,"enableProtocolSniffingForOutbound":true,"enabled":true,"env":{},"image":"pilot","ingress":{"ingressClass":"istio","ingressControllerMode":"OFF","ingressService":"istio-ingressgateway"},"keepaliveMaxServerConnectionAge":"30m","meshNetworks":{"networks":{}},"namespace":"istio-system","nodeSelector":{},"podAntiAffinityLabelSelector":[],"podAntiAffinityTermLabelSelector":[],"policy":{"enabled":false},"replicaCount":1,"tolerations":[],"traceSampling":1,"useMCP":true},"prometheus":{"contextPath":"/prometheus","enabled":false,"hub":"docker.io/prom","ingress":{"enabled":false,"hosts":["prometheus.local"]},"namespace":"istio-system","nodeSelector":{},"podAntiAffinityLabelSelector":[],"podAntiAffinityTermLabelSelector":[],"replicaCount":1,"retention":"6h","scrapeInterval":"15s","security":{"enabled":true},"tag":"v2.12.0","tolerations":[]},"security":{"dnsCerts":{"istio-pilot-service-account.istio-control":"istio-pilot.istio-control"},"enableNamespacesByDefault":true,"enabled":true,"image":"citadel","namespace":"istio-system","selfSigned":true,"trustDomain":"cluster.local"},"sidecarInjectorWebhook":{"alwaysInjectSelector":[],"enableNamespacesByDefault":false,"enabled":true,"image":"sidecar_injector","injectLabel":"istio-injection","injectedAnnotations":{},"lifecycle":{},"namespace":"istio-system","neverInjectSelector":[],"nodeSelector":{},"objectSelector":{"autoInject":true,"enabled":false},"podAnnotations":{},"podAntiAffinityLabelSelector":[],"podAntiAffinityTermLabelSelector":[],"replicaCount":1,"resources":{},"rewriteAppHTTPProbe":true,"rollingMaxSurge":"100%","rollingMaxUnavailable":"25%","selfSigned":false,"tolerations":[]},"telemetry":{"enabled":true,"v1":{"enabled":true},"v2":{"enabled":false,"prometheus":{"enabled":true},"stackdriver":{"configOverride":{},"enabled":false,"logging":false,"monitoring":false,"topology":false}}},"tracing":{"enabled":false,"ingress":{"enabled":false},"jaeger":{"accessMode":"ReadWriteMany","enabled":false,"hub":"docker.io/jaegertracing","memory":{"max_traces":50000},"namespace":"istio-system","persist":false,"spanStorageType":"badger","storageClassName":"","tag":"1.14"},"nodeSelector":{},"opencensus":{"exporters":{"stackdriver":{"enable_tracing":true}},"hub":"docker.io/omnition","resources":{"limits":{"cpu":"1","memory":"2Gi"},"requests":{"cpu":"200m","memory":"400Mi"}},"tag":"0.1.9"},"podAntiAffinityLabelSelector":[],"podAntiAffinityTermLabelSelector":[],"provider":"jaeger","service":{"annotations":{},"externalPort":9411,"name":"http-query","type":"ClusterIP"},"zipkin":{"hub":"docker.io/openzipkin","javaOptsHeap":700,"maxSpans":500000,"node":{"cpus":2},"probeStartupDelay":200,"queryPort":9411,"resources":{"limits":{"cpu":"300m","memory":"900Mi"},"requests":{"cpu":"150m","memory":"900Mi"}},"tag":"2.14.2"}},"version":""}'
kind: ConfigMap
metadata:
  labels:
    app: sidecar-injector
    istio: sidecar-injector
    release: istio
  name: istio-sidecar-injector
  namespace: istio-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: pilot
    release: istio
  name: istio-pilot
  namespace: istio-system
spec:
  maxReplicas: 5
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: istio-pilot
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: pilot
    release: istio
  name: istio-pilot-istio-system
rules:
- apiGroups:
  - config.istio.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - rbac.istio.io
  resources:
  - '*'
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - security.istio.io
  resources:
  - '*'
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - networking.istio.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - authentication.istio.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - '*'
- apiGroups:
  - extensions
  resources:
  - ingresses
  - ingresses/status
  verbs:
  - '*'
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - create
  - get
  - list
  - watch
  - update
- apiGroups:
  - ""
  resources:
  - endpoints
  - pods
  - services
  - namespaces
  - nodes
  - secrets
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - create
  - get
  - watch
  - list
  - update
  - delete
- apiGroups:
  - certificates.k8s.io
  resources:
  - certificatesigningrequests
  - certificatesigningrequests/approval
  - certificatesigningrequests/status
  verbs:
  - update
  - create
  - get
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app: pilot
    release: istio
  name: istio-pilot-istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istio-pilot-istio-system
subjects:
- kind: ServiceAccount
  name: istio-pilot-service-account
  namespace: istio-system
---
apiVersion: v1
data:
  envoy.yaml.tmpl: |-
    admin:
      access_log_path: /dev/null
      address:
        socket_address:
          address: 127.0.0.1
          port_value: 15000

    static_resources:
      clusters:
      - name: in.15010
        http2_protocol_options: {}
        connect_timeout: 1.000s

        hosts:
        - socket_address:
            address: 127.0.0.1
            port_value: 15010

        circuit_breakers:
          thresholds:
          - max_connections: 100000
            max_pending_requests: 100000
            max_requests: 100000
            max_retries: 3

    # TODO: telemetry using EDS
    # TODO: other pilots using EDS, load balancing
    # TODO: galley using EDS

      - name: out.galley.15019
        http2_protocol_options: {}
        connect_timeout: 1.000s
        type: STRICT_DNS

        circuit_breakers:
          thresholds:
            - max_connections: 100000
              max_pending_requests: 100000
              max_requests: 100000
              max_retries: 3
        hosts:
          - socket_address:
              address: istio-galley.istio-system
              port_value: 15019
        tls_context:
          common_tls_context:
            tls_certificates:
            - certificate_chain:
                filename: /etc/certs/cert-chain.pem
              private_key:
                filename: /etc/certs/key.pem
            validation_context:
              trusted_ca:
                filename: /etc/certs/root-cert.pem
              verify_subject_alt_name:
              - spiffe://cluster.local/ns/istio-system/sa/istio-galley-service-account

      listeners:
      - name: "in.15011"
        address:
          socket_address:
            address: 0.0.0.0
            port_value: 15011
        filter_chains:
        - filters:
          - name: envoy.http_connection_manager
            #typed_config
            #"@type": "type.googleapis.com/",
            config:
              codec_type: HTTP2
              stat_prefix: "15011"
              http2_protocol_options:
                max_concurrent_streams: 1073741824

              access_log:
              - name: envoy.file_access_log
                config:
                  path: /dev/stdout

              http_filters:
              - name: envoy.router

              route_config:
                name: "15011"

                virtual_hosts:
                - name: istio-pilot

                  domains:
                  - '*'

                  routes:
                  - match:
                      prefix: /
                    route:
                      cluster: in.15010
                      timeout: 0.000s
                    decorator:
                      operation: xDS
          tls_context:
            common_tls_context:
              alpn_protocols:
              - h2
              tls_certificates:
              - certificate_chain:
                  filename: /etc/certs/cert-chain.pem
                private_key:
                  filename: /etc/certs/key.pem
              validation_context:
                trusted_ca:
                  filename: /etc/certs/root-cert.pem
            require_client_certificate: true


      # Manual 'whitebox' mode
      - name: "local.15019"
        address:
          socket_address:
            address: 127.0.0.1
            port_value: 15019
        filter_chains:
          - filters:
              - name: envoy.http_connection_manager
                config:
                  codec_type: HTTP2
                  stat_prefix: "15019"
                  http2_protocol_options:
                    max_concurrent_streams: 1073741824

                  access_log:
                    - name: envoy.file_access_log
                      config:
                        path: /dev/stdout

                  http_filters:
                    - name: envoy.router

                  route_config:
                    name: "15019"

                    virtual_hosts:
                      - name: istio-galley

                        domains:
                          - '*'

                        routes:
                          - match:
                              prefix: /
                            route:
                              cluster: out.galley.15019
                              timeout: 0.000s
kind: ConfigMap
metadata:
  labels:
    release: istio
  name: pilot-envoy-config
  namespace: istio-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: v1
data:
  mesh: |-
    # Set enableTracing to false to disable request tracing.
    enableTracing: true

    # Set accessLogFile to empty string to disable access log.
    accessLogFile: "/dev/stdout"

    accessLogFormat: "{\n  \"app_id\": \"%REQ(CF-APP-ID)%\",\n  \"authority\": \"%REQ(:AUTHORITY)%\",\n  \"bytes_received\": \"%BYTES_RECEIVED%\",\n  \"bytes_sent\": \"%BYTES_SENT%\",\n  \"downstream_local_address\": \"%DOWNSTREAM_LOCAL_ADDRESS%\",\n  \"downstream_remote_address\": \"%DOWNSTREAM_REMOTE_ADDRESS%\",\n  \"duration\": \"%DURATION%\",\n  \"method\": \"%REQ(:METHOD)%\",\n  \"organization_id\": \"%REQ(CF-ORGANIZATION-ID)%\",\n  \"path\": \"%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%\",\n  \"process_type\": \"%REQ(APP-PROCESS-TYPE)%\",\n  \"protocol\": \"%PROTOCOL%\",\n  \"referer\": \"%REQ(REFERER)%\",\n  \"request_id\": \"%REQ(X-REQUEST-ID)%\",\n  \"requested_server_name\": \"%REQUESTED_SERVER_NAME%\",\n  \"response_code\": \"%RESPONSE_CODE%\",\n  \"response_duration\": \"%RESPONSE_DURATION%\",\n  \"response_flags\": \"%RESPONSE_FLAGS%\",\n  \"response_tx_duration\": \"%RESPONSE_TX_DURATION%\",\n  \"space_id\": \"%REQ(CF-SPACE-ID)%\",\n  \"start_time\": \"%START_TIME%\",\n  \"upstream_cluster\": \"%UPSTREAM_CLUSTER%\",\n  \"upstream_host\": \"%UPSTREAM_HOST%\",\n  \"upstream_local_address\": \"%UPSTREAM_LOCAL_ADDRESS%\",\n  \"upstream_service_time\": \"%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%\",\n  \"upstream_transport_failure_reason\": \"%UPSTREAM_TRANSPORT_FAILURE_REASON%\",\n  \"user_agent\": \"%REQ(USER-AGENT)%\",\n  \"x_b3_parentspanid\": \"%REQ(X-B3-PARENTSPANID)%\",\n  \"x_b3_spanid\": \"%REQ(X-B3-SPANID)%\",\n  \"x_b3_traceid\": \"%REQ(X-B3-TRACEID)%\",\n  \"x_forwarded_for\": \"%REQ(X-FORWARDED-FOR)%\",\n  \"x_forwarded_proto\": \"%REQ(X-FORWARDED-PROTO)%\"\n}"

    accessLogEncoding: 'JSON'

    enableEnvoyAccessLogService: false
    mixerCheckServer: istio-policy.istio-system.svc.cluster.local:15004
    mixerReportServer: istio-telemetry.istio-system.svc.cluster.local:15004
    # policyCheckFailOpen allows traffic in cases when the mixer policy service cannot be reached.
    # Default is false which means the traffic is denied when the client is unable to connect to Mixer.
    policyCheckFailOpen: false
    # reportBatchMaxEntries is the number of requests that are batched before telemetry data is sent to the mixer server
    reportBatchMaxEntries: 100
    # reportBatchMaxTime is the max waiting time before the telemetry data of a request is sent to the mixer server
    reportBatchMaxTime: 1s
    disableMixerHttpReports: false

    disablePolicyChecks: true

    # Automatic protocol detection uses a set of heuristics to
    # determine whether the connection is using TLS or not (on the
    # server side), as well as the application protocol being used
    # (e.g., http vs tcp). These heuristics rely on the client sending
    # the first bits of data. For server first protocols like MySQL,
    # MongoDB, etc., Envoy will timeout on the protocol detection after
    # the specified period, defaulting to non mTLS plain TCP
    # traffic. Set this field to tweak the period that Envoy will wait
    # for the client to send the first bits of data. (MUST BE >=1ms)
    protocolDetectionTimeout: 100ms

    # This is the k8s ingress service name, update if you used a different name
    ingressService: "istio-ingressgateway"
    ingressControllerMode: "OFF"
    ingressClass: "istio"

    # The trust domain corresponds to the trust root of a system.
    # Refer to https://github.com/spiffe/spiffe/blob/master/standards/SPIFFE-ID.md#21-trust-domain
    trustDomain: "cluster.local"

    #  The trust domain aliases represent the aliases of trust_domain.
    #  For example, if we have
    #  trustDomain: td1
    #  trustDomainAliases: [td2, "td3"]
    #  Any service with the identity "td1/ns/foo/sa/a-service-account", "td2/ns/foo/sa/a-service-account",
    #  or "td3/ns/foo/sa/a-service-account" will be treated the same in the Istio mesh.
    trustDomainAliases:

    # Set expected values when SDS is disabled
    # Unix Domain Socket through which envoy communicates with NodeAgent SDS to get
    # key/cert for mTLS. Use secret-mount files instead of SDS if set to empty.
    sdsUdsPath: ""

    # This flag is used by secret discovery service(SDS).
    # If set to true(prerequisite: https://kubernetes.io/docs/concepts/storage/volumes/#projected), Istio will inject volumes mount
    # for k8s service account JWT, so that K8s API server mounts k8s service account JWT to envoy container, which
    # will be used to generate key/cert eventually. This isn't supported for non-k8s case.
    enableSdsTokenMount: false

    # This flag is used by secret discovery service(SDS).
    # If set to true, envoy will fetch normal k8s service account JWT from '/var/run/secrets/kubernetes.io/serviceaccount/token'
    # (https://kubernetes.io/docs/tasks/access-application-cluster/access-cluster/#accessing-the-api-from-a-pod)
    # and pass to sds server, which will be used to request key/cert eventually.
    # this flag is ignored if enableSdsTokenMount is set.
    # This isn't supported for non-k8s case.
    sdsUseK8sSaJwt: false

    # If true, automatically configure client side mTLS settings to match the corresponding service's
    # server side mTLS authentication policy, when destination rule for that service does not specify
    # TLS settings.
    enableAutoMtls: true
    config_sources:
    - address: localhost:15019

    outboundTrafficPolicy:
      mode: ALLOW_ANY
    localityLbSetting:
      enabled: true

    # Configures DNS certificates provisioned through Chiron linked into Pilot.
    # The DNS certificate provisioning is enabled by default now so it get tested.
    # TODO (lei-tang): we'll decide whether enable it by default or not before Istio 1.4 Release.
    certificates:
      []

    defaultConfig:
      #
      # TCP connection timeout between Envoy & the application, and between Envoys.
      connectTimeout: 10s
      #
      ### ADVANCED SETTINGS #############
      # Where should envoy's configuration be stored in the istio-proxy container
      configPath: "/etc/istio/proxy"
      # The pseudo service name used for Envoy.
      serviceCluster: istio-proxy
      # These settings that determine how long an old Envoy
      # process should be kept alive after an occasional reload.
      drainDuration: 45s
      parentShutdownDuration: 1m0s
      #
      # Port where Envoy listens (on local host) for admin commands
      # You can exec into the istio-proxy container in a pod and
      # curl the admin port (curl http://localhost:15000/) to obtain
      # diagnostic information from Envoy. See
      # https://lyft.github.io/envoy/docs/operations/admin.html
      # for more details
      proxyAdminPort: 15000
      #
      # Set concurrency to a specific number to control the number of Proxy worker threads.
      # If set to 0 (default), then start worker thread for each CPU thread/core.
      concurrency: 2
      #
      tracing:
        zipkin:
          # Address of the Zipkin collector
          address: zipkin.istio-system:9411
      #
      # Mutual TLS authentication between sidecars and istio control plane.
      controlPlaneAuthPolicy: MUTUAL_TLS
      #
      # Address where istio Pilot service is running
      discoveryAddress: istio-pilot.istio-system:15011
  meshNetworks: |-
    # Network config
    networks: {}
  values.yaml: |-
    appNamespaces: []
    autoscaleEnabled: true
    autoscaleMax: 5
    autoscaleMin: 1
    configMap: true
    configNamespace: istio-config
    cpu:
      targetAverageUtilization: 80
    enableProtocolSniffingForInbound: false
    enableProtocolSniffingForOutbound: true
    enabled: true
    env: {}
    image: pilot
    ingress:
      ingressClass: istio
      ingressControllerMode: "OFF"
      ingressService: istio-ingressgateway
    keepaliveMaxServerConnectionAge: 30m
    meshNetworks:
      networks: {}
    namespace: istio-system
    nodeSelector: {}
    plugins: []
    podAnnotations: {}
    podAntiAffinityLabelSelector: []
    podAntiAffinityTermLabelSelector: []
    policy:
      enabled: false
    replicaCount: 1
    resources:
      requests:
        cpu: 500m
        memory: 2048Mi
    rollingMaxSurge: 100%
    rollingMaxUnavailable: 25%
    tolerations: []
    traceSampling: 1
    useMCP: true
kind: ConfigMap
metadata:
  labels:
    release: istio
  name: istio
  namespace: istio-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/pilot:1.4.5
        URL: gcr.io/cf-routing/pilot@sha256:5fc0e678e471be946719f9a866ac99252d3c7a7d1561020ed34adfba4c457e58
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/proxyv2:1.4.5
        URL: gcr.io/cf-routing/proxyv2@sha256:d7792fed2b3e7ffc84bfc50f693a9dd8960883ea9685b12ae1f1ef7ee2133ea3
  labels:
    app: pilot
    istio: pilot
    release: istio
  name: istio-pilot
  namespace: istio-system
spec:
  selector:
    matchLabels:
      istio: pilot
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 25%
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: pilot
        chart: pilot
        heritage: Tiller
        istio: pilot
        release: istio
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - ppc64le
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - s390x
            weight: 2
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
                - ppc64le
                - s390x
      containers:
      - args:
        - discovery
        - --monitoringAddr=:15014
        - --log_output_level=default:info
        - --domain
        - cluster.local
        - --secureGrpcAddr
        - ""
        - --trust-domain=cluster.local
        - --keepaliveMaxServerConnectionAge
        - 30m
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: PILOT_TRACE_SAMPLING
          value: "1"
        - name: CONFIG_NAMESPACE
          value: istio-config
        - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_OUTBOUND
          value: "true"
        - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_INBOUND
          value: "false"
        image: gcr.io/cf-routing/pilot@sha256:5fc0e678e471be946719f9a866ac99252d3c7a7d1561020ed34adfba4c457e58
        imagePullPolicy: IfNotPresent
        name: discovery
        ports:
        - containerPort: 8080
        - containerPort: 15010
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 30
          timeoutSeconds: 5
        resources: {}
        volumeMounts:
        - mountPath: /etc/istio/config
          name: config-volume
      - args:
        - proxy
        - --domain
        - $(POD_NAMESPACE).svc.cluster.local
        - --serviceCluster
        - istio-pilot
        - --templateFile
        - /var/lib/envoy/envoy.yaml.tmpl
        - --controlPlaneAuthPolicy
        - MUTUAL_TLS
        - --trust-domain=cluster.local
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: INSTANCE_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: SDS_ENABLED
          value: "false"
        image: gcr.io/cf-routing/proxyv2@sha256:d7792fed2b3e7ffc84bfc50f693a9dd8960883ea9685b12ae1f1ef7ee2133ea3
        imagePullPolicy: IfNotPresent
        name: istio-proxy
        ports:
        - containerPort: 15011
        resources: {}
        volumeMounts:
        - mountPath: /var/lib/envoy
          name: pilot-envoy-config
        - mountPath: /etc/certs
          name: istio-certs
          readOnly: true
      serviceAccountName: istio-pilot-service-account
      volumes:
      - name: istio-certs
        secret:
          optional: true
          secretName: istio.istio-pilot-service-account
      - configMap:
          name: istio
        name: config-volume
      - configMap:
          name: pilot-envoy-config
        name: pilot-envoy-config
---
apiVersion: authentication.istio.io/v1alpha1
kind: MeshPolicy
metadata:
  labels:
    release: istio
  name: default
spec:
  peers:
  - mtls:
      mode: STRICT
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
  labels:
    app: pilot
    istio: pilot
    release: istio
  name: istio-pilot
  namespace: istio-system
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: pilot
      istio: pilot
      release: istio
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: pilot
    istio: pilot
    release: istio
  name: istio-pilot
  namespace: istio-system
spec:
  ports:
  - name: grpc-xds
    port: 15010
  - name: https-xds
    port: 15011
  - name: http-legacy-discovery
    port: 8080
  - name: http-monitoring
    port: 15014
  selector:
    istio: pilot
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: pilot
    release: istio
  name: istio-pilot-service-account
  namespace: istio-system
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: mixer
    release: istio
  name: istio-policy
  namespace: istio-system
spec:
  maxReplicas: 5
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: istio-policy
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: istio-policy
    release: istio
  name: istio-policy
rules:
- apiGroups:
  - config.istio.io
  resources:
  - '*'
  verbs:
  - create
  - get
  - list
  - watch
  - patch
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - configmaps
  - endpoints
  - pods
  - services
  - namespaces
  - secrets
  - replicationcontrollers
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - extensions
  - apps
  resources:
  - replicasets
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app: istio-policy
    release: istio
  name: istio-policy-admin-role-binding-istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istio-policy
subjects:
- kind: ServiceAccount
  name: istio-policy-service-account
  namespace: istio-system
---
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  labels:
    app: istio-policy
    release: istio
  name: istio-policy
  namespace: istio-system
spec:
  host: istio-policy.istio-system.svc.cluster.local
  trafficPolicy:
    connectionPool:
      http:
        http2MaxRequests: 10000
        maxRequestsPerConnection: 10000
    portLevelSettings:
    - port:
        number: 15004
      tls:
        mode: ISTIO_MUTUAL
    - port:
        number: 9091
      tls:
        mode: DISABLE
---
apiVersion: v1
data:
  envoy.yaml.tmpl: |-
    admin:
      access_log_path: /dev/null
      address:
        socket_address:
          address: 127.0.0.1
          port_value: 15000
    stats_config:
      use_all_default_tags: false
      stats_tags:
      - tag_name: cluster_name
        regex: '^cluster\.((.+?(\..+?\.svc\.cluster\.local)?)\.)'
      - tag_name: tcp_prefix
        regex: '^tcp\.((.*?)\.)\w+?$'
      - tag_name: response_code
        regex: '_rq(_(\d{3}))$'
      - tag_name: response_code_class
        regex: '_rq(_(\dxx))$'
      - tag_name: http_conn_manager_listener_prefix
        regex: '^listener(?=\.).*?\.http\.(((?:[_.[:digit:]]*|[_\[\]aAbBcCdDeEfF[:digit:]]*))\.)'
      - tag_name: http_conn_manager_prefix
        regex: '^http\.(((?:[_.[:digit:]]*|[_\[\]aAbBcCdDeEfF[:digit:]]*))\.)'
      - tag_name: listener_address
        regex: '^listener\.(((?:[_.[:digit:]]*|[_\[\]aAbBcCdDeEfF[:digit:]]*))\.)'

    static_resources:
      clusters:
      - name: prometheus_stats
        type: STATIC
        connect_timeout: 0.250s
        lb_policy: ROUND_ROBIN
        hosts:
        - socket_address:
            protocol: TCP
            address: 127.0.0.1
            port_value: 15000

      - circuit_breakers:
          thresholds:
          - max_connections: 100000
            max_pending_requests: 100000
            max_requests: 100000
            max_retries: 3
        connect_timeout: 1.000s
        hosts:
        - pipe:
            path: /sock/mixer.socket
        http2_protocol_options: {}
        name: inbound_9092

      - circuit_breakers:
          thresholds:
          - max_connections: 100000
            max_pending_requests: 100000
            max_requests: 100000
            max_retries: 3
        connect_timeout: 1.000s
        hosts:
        - socket_address:
            address: istio-telemetry
            port_value: 15004
        http2_protocol_options: {}
        name: mixer_report_server
        tls_context:
          common_tls_context:
            tls_certificates:
            - certificate_chain:
                filename: /etc/certs/cert-chain.pem
              private_key:
                filename: /etc/certs/key.pem
            validation_context:
              trusted_ca:
                filename: /etc/certs/root-cert.pem
              verify_subject_alt_name:
              - spiffe://cluster.local/ns/istio-system/sa/istio-mixer-service-account
        type: STRICT_DNS
        dns_lookup_family: V4_ONLY

      - name: out.galley.15019
        http2_protocol_options: {}
        connect_timeout: 1.000s
        type: STRICT_DNS

        circuit_breakers:
          thresholds:
            - max_connections: 100000
              max_pending_requests: 100000
              max_requests: 100000
              max_retries: 3
        hosts:
          - socket_address:
              address: istio-galley.istio-system
              port_value: 15019
        tls_context:
          common_tls_context:
            tls_certificates:
            - certificate_chain:
                filename: /etc/certs/cert-chain.pem
              private_key:
                filename: /etc/certs/key.pem
            validation_context:
              trusted_ca:
                filename: /etc/certs/root-cert.pem
              verify_subject_alt_name:
              - spiffe://cluster.local/ns/istio-system/sa/istio-galley-service-account

      listeners:
      - name: "15090"
        address:
          socket_address:
            protocol: TCP
            address: 0.0.0.0
            port_value: 15090
        filter_chains:
        - filters:
          - name: envoy.http_connection_manager
            config:
              codec_type: AUTO
              stat_prefix: stats
              route_config:
                virtual_hosts:
                - name: backend
                  domains:
                  - '*'
                  routes:
                  - match:
                      prefix: /stats/prometheus
                    route:
                      cluster: prometheus_stats
              http_filters:
              - name: envoy.router

      - name: "15004"
        address:
          socket_address:
            address: 0.0.0.0
            port_value: 15004
        filter_chains:
        - filters:
          - config:
              codec_type: HTTP2
              http2_protocol_options:
                max_concurrent_streams: 1073741824
              generate_request_id: true
              http_filters:
              - config:
                  default_destination_service: istio-policy.istio-system.svc.cluster.local
                  service_configs:
                    istio-policy.istio-system.svc.cluster.local:
                      disable_check_calls: true
    {{- if .DisableReportCalls }}
                      disable_report_calls: true
    {{- end }}
                      mixer_attributes:
                        attributes:
                          destination.service.host:
                            string_value: istio-policy.istio-system.svc.cluster.local
                          destination.service.uid:
                            string_value: istio://istio-system/services/istio-policy
                          destination.service.name:
                            string_value: istio-policy
                          destination.service.namespace:
                            string_value: istio-system
                          destination.uid:
                            string_value: kubernetes://{{ .PodName }}.istio-system
                          destination.namespace:
                            string_value: istio-system
                          destination.ip:
                            bytes_value: {{ .PodIP }}
                          destination.port:
                            int64_value: 15004
                          context.reporter.kind:
                            string_value: inbound
                          context.reporter.uid:
                            string_value: kubernetes://{{ .PodName }}.istio-system
                  transport:
                    check_cluster: mixer_check_server
                    report_cluster: mixer_report_server
                    attributes_for_mixer_proxy:
                      attributes:
                        source.uid:
                          string_value: kubernetes://{{ .PodName }}.istio-system
                name: mixer
              - name: envoy.router
              route_config:
                name: "15004"
                virtual_hosts:
                - domains:
                  - '*'
                  name: istio-policy.istio-system.svc.cluster.local
                  routes:
                  - decorator:
                      operation: Check
                    match:
                      prefix: /
                    route:
                      cluster: inbound_9092
                      timeout: 0.000s
              stat_prefix: "15004"
            name: envoy.http_connection_manager
          tls_context:
            common_tls_context:
              alpn_protocols:
              - h2
              tls_certificates:
              - certificate_chain:
                  filename: /etc/certs/cert-chain.pem
                private_key:
                  filename: /etc/certs/key.pem
              validation_context:
                trusted_ca:
                  filename: /etc/certs/root-cert.pem
            require_client_certificate: true

      - name: "9091"
        address:
          socket_address:
            address: 0.0.0.0
            port_value: 9091
        filter_chains:
        - filters:
          - config:
              codec_type: HTTP2
              http2_protocol_options:
                max_concurrent_streams: 1073741824
              generate_request_id: true
              http_filters:
              - config:
                  default_destination_service: istio-policy.istio-system.svc.cluster.local
                  service_configs:
                    istio-policy.istio-system.svc.cluster.local:
                      disable_check_calls: true
    {{- if .DisableReportCalls }}
                      disable_report_calls: true
    {{- end }}
                      mixer_attributes:
                        attributes:
                          destination.service.host:
                            string_value: istio-policy.istio-system.svc.cluster.local
                          destination.service.uid:
                            string_value: istio://istio-system/services/istio-policy
                          destination.service.name:
                            string_value: istio-policy
                          destination.service.namespace:
                            string_value: istio-system
                          destination.uid:
                            string_value: kubernetes://{{ .PodName }}.istio-system
                          destination.namespace:
                            string_value: istio-system
                          destination.ip:
                            bytes_value: {{ .PodIP }}
                          destination.port:
                            int64_value: 9091
                          context.reporter.kind:
                            string_value: inbound
                          context.reporter.uid:
                            string_value: kubernetes://{{ .PodName }}.istio-system
                  transport:
                    check_cluster: mixer_check_server
                    report_cluster: mixer_report_server
                    attributes_for_mixer_proxy:
                      attributes:
                        source.uid:
                          string_value: kubernetes://{{ .PodName }}.istio-system
                name: mixer
              - name: envoy.router
              route_config:
                name: "9091"
                virtual_hosts:
                - domains:
                  - '*'
                  name: istio-policy.istio-system.svc.cluster.local
                  routes:
                  - decorator:
                      operation: Check
                    match:
                      prefix: /
                    route:
                      cluster: inbound_9092
                      timeout: 0.000s
              stat_prefix: "9091"
            name: envoy.http_connection_manager
        name: "9091"

      - name: "local.15019"
        address:
          socket_address:
            address: 127.0.0.1
            port_value: 15019
        filter_chains:
          - filters:
              - name: envoy.http_connection_manager
                config:
                  codec_type: HTTP2
                  stat_prefix: "15019"
                  http2_protocol_options:
                    max_concurrent_streams: 1073741824

                  access_log:
                    - name: envoy.file_access_log
                      config:
                        path: /dev/stdout

                  http_filters:
                    - name: envoy.router

                  route_config:
                    name: "15019"

                    virtual_hosts:
                      - name: istio-galley

                        domains:
                          - '*'

                        routes:
                          - match:
                              prefix: /
                            route:
                              cluster: out.galley.15019
                              timeout: 0.000s
kind: ConfigMap
metadata:
  labels:
    release: istio
  name: policy-envoy-config
  namespace: istio-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/mixer:1.4.5
        URL: gcr.io/cf-routing/mixer@sha256:b9472ceaa66dcc34e3ca49813c994ddde6af49ab86bc07ca981ba1f3763d2e00
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/proxyv2:1.4.5
        URL: gcr.io/cf-routing/proxyv2@sha256:d7792fed2b3e7ffc84bfc50f693a9dd8960883ea9685b12ae1f1ef7ee2133ea3
  labels:
    app: istio-policy
    istio: mixer
    release: istio
  name: istio-policy
  namespace: istio-system
spec:
  selector:
    matchLabels:
      istio: mixer
      istio-mixer-type: policy
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 25%
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: policy
        istio: mixer
        istio-mixer-type: policy
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - ppc64le
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - s390x
            weight: 2
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
                - ppc64le
                - s390x
      containers:
      - args:
        - --monitoringPort=15014
        - --address
        - unix:///sock/mixer.socket
        - --log_output_level=default:info
        - --configStoreURL=mcp://localhost:15019
        - --configDefaultNamespace=istio-system
        - --useAdapterCRDs=false
        - --useTemplateCRDs=false
        - --trace_zipkin_url=http://zipkin.istio-system:9411/api/v1/spans
        env:
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        image: gcr.io/cf-routing/mixer@sha256:b9472ceaa66dcc34e3ca49813c994ddde6af49ab86bc07ca981ba1f3763d2e00
        imagePullPolicy: IfNotPresent
        livenessProbe:
          httpGet:
            path: /version
            port: 15014
          initialDelaySeconds: 5
          periodSeconds: 5
        name: mixer
        ports:
        - containerPort: 9091
        - containerPort: 15014
        - containerPort: 42422
        resources: {}
        volumeMounts:
        - mountPath: /etc/certs
          name: istio-certs
          readOnly: true
        - mountPath: /sock
          name: uds-socket
        - mountPath: /var/run/secrets/istio.io/policy/adapter
          name: policy-adapter-secret
          readOnly: true
      - args:
        - proxy
        - --domain
        - $(POD_NAMESPACE).svc.cluster.local
        - --serviceCluster
        - istio-policy
        - --templateFile
        - /var/lib/envoy/envoy.yaml.tmpl
        - --controlPlaneAuthPolicy
        - MUTUAL_TLS
        - --trust-domain=cluster.local
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: INSTANCE_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: SDS_ENABLED
          value: "false"
        image: gcr.io/cf-routing/proxyv2@sha256:d7792fed2b3e7ffc84bfc50f693a9dd8960883ea9685b12ae1f1ef7ee2133ea3
        imagePullPolicy: IfNotPresent
        name: istio-proxy
        ports:
        - containerPort: 15004
        - containerPort: 15090
          name: http-envoy-prom
          protocol: TCP
        resources: {}
        volumeMounts:
        - mountPath: /var/lib/envoy
          name: policy-envoy-config
        - mountPath: /etc/certs
          name: istio-certs
          readOnly: true
        - mountPath: /sock
          name: uds-socket
      serviceAccountName: istio-policy-service-account
      volumes:
      - name: istio-certs
        secret:
          optional: true
          secretName: istio.istio-policy-service-account
      - emptyDir: {}
        name: uds-socket
      - name: policy-adapter-secret
        secret:
          optional: true
          secretName: policy-adapter-secret
      - configMap:
          name: policy-envoy-config
        name: policy-envoy-config
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
  labels:
    app: policy
    istio: mixer
    istio-mixer-type: policy
    release: istio
  name: istio-policy
  namespace: istio-system
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: policy
      istio: mixer
      istio-mixer-type: policy
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: mixer
    istio: mixer
    release: istio
  name: istio-policy
  namespace: istio-system
spec:
  ports:
  - name: grpc-mixer
    port: 9091
  - name: grpc-mixer-mtls
    port: 15004
  - name: http-policy-monitoring
    port: 15014
  selector:
    istio: mixer
    istio-mixer-type: policy
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: istio-policy
    release: istio
  name: istio-policy-service-account
  namespace: istio-system
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: mixer
    release: istio
  name: istio-telemetry
  namespace: istio-system
spec:
  maxReplicas: 5
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: istio-telemetry
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: istio-mixer-istio-system
rules:
- apiGroups:
  - config.istio.io
  resources:
  - '*'
  verbs:
  - create
  - get
  - list
  - watch
  - patch
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - configmaps
  - endpoints
  - pods
  - services
  - namespaces
  - secrets
  - replicationcontrollers
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - extensions
  - apps
  resources:
  - replicasets
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: istio-mixer-admin-role-binding-istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istio-mixer-istio-system
subjects:
- kind: ServiceAccount
  name: istio-mixer-service-account
  namespace: istio-system
---
apiVersion: config.istio.io/v1alpha2
kind: attributemanifest
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: istioproxy
  namespace: istio-system
spec:
  attributes:
    api.operation:
      valueType: STRING
    api.protocol:
      valueType: STRING
    api.service:
      valueType: STRING
    api.version:
      valueType: STRING
    check.cache_hit:
      valueType: BOOL
    check.error_code:
      valueType: INT64
    check.error_message:
      valueType: STRING
    connection.duration:
      valueType: DURATION
    connection.event:
      valueType: STRING
    connection.id:
      valueType: STRING
    connection.mtls:
      valueType: BOOL
    connection.received.bytes:
      valueType: INT64
    connection.received.bytes_total:
      valueType: INT64
    connection.requested_server_name:
      valueType: STRING
    connection.sent.bytes:
      valueType: INT64
    connection.sent.bytes_total:
      valueType: INT64
    context.protocol:
      valueType: STRING
    context.proxy_error_code:
      valueType: STRING
    context.proxy_version:
      valueType: STRING
    context.reporter.kind:
      valueType: STRING
    context.reporter.local:
      valueType: BOOL
    context.reporter.uid:
      valueType: STRING
    context.time:
      valueType: TIMESTAMP
    context.timestamp:
      valueType: TIMESTAMP
    destination.port:
      valueType: INT64
    destination.principal:
      valueType: STRING
    destination.uid:
      valueType: STRING
    origin.ip:
      valueType: IP_ADDRESS
    origin.uid:
      valueType: STRING
    origin.user:
      valueType: STRING
    quota.cache_hit:
      valueType: BOOL
    rbac.permissive.effective_policy_id:
      valueType: STRING
    rbac.permissive.response_code:
      valueType: STRING
    request.api_key:
      valueType: STRING
    request.auth.audiences:
      valueType: STRING
    request.auth.claims:
      valueType: STRING_MAP
    request.auth.presenter:
      valueType: STRING
    request.auth.principal:
      valueType: STRING
    request.auth.raw_claims:
      valueType: STRING
    request.headers:
      valueType: STRING_MAP
    request.host:
      valueType: STRING
    request.id:
      valueType: STRING
    request.method:
      valueType: STRING
    request.path:
      valueType: STRING
    request.query_params:
      valueType: STRING_MAP
    request.reason:
      valueType: STRING
    request.referer:
      valueType: STRING
    request.scheme:
      valueType: STRING
    request.size:
      valueType: INT64
    request.time:
      valueType: TIMESTAMP
    request.total_size:
      valueType: INT64
    request.url_path:
      valueType: STRING
    request.useragent:
      valueType: STRING
    response.code:
      valueType: INT64
    response.duration:
      valueType: DURATION
    response.grpc_message:
      valueType: STRING
    response.grpc_status:
      valueType: STRING
    response.headers:
      valueType: STRING_MAP
    response.size:
      valueType: INT64
    response.time:
      valueType: TIMESTAMP
    response.total_size:
      valueType: INT64
    source.principal:
      valueType: STRING
    source.uid:
      valueType: STRING
    source.user:
      valueType: STRING
---
apiVersion: config.istio.io/v1alpha2
kind: attributemanifest
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: kubernetes
  namespace: istio-system
spec:
  attributes:
    destination.container.name:
      valueType: STRING
    destination.ip:
      valueType: IP_ADDRESS
    destination.labels:
      valueType: STRING_MAP
    destination.metadata:
      valueType: STRING_MAP
    destination.name:
      valueType: STRING
    destination.namespace:
      valueType: STRING
    destination.owner:
      valueType: STRING
    destination.service.host:
      valueType: STRING
    destination.service.name:
      valueType: STRING
    destination.service.namespace:
      valueType: STRING
    destination.service.uid:
      valueType: STRING
    destination.serviceAccount:
      valueType: STRING
    destination.workload.name:
      valueType: STRING
    destination.workload.namespace:
      valueType: STRING
    destination.workload.uid:
      valueType: STRING
    source.ip:
      valueType: IP_ADDRESS
    source.labels:
      valueType: STRING_MAP
    source.metadata:
      valueType: STRING_MAP
    source.name:
      valueType: STRING
    source.namespace:
      valueType: STRING
    source.owner:
      valueType: STRING
    source.serviceAccount:
      valueType: STRING
    source.services:
      valueType: STRING
    source.workload.name:
      valueType: STRING
    source.workload.namespace:
      valueType: STRING
    source.workload.uid:
      valueType: STRING
---
apiVersion: config.istio.io/v1alpha2
kind: instance
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: requestcount
  namespace: istio-system
spec:
  compiledTemplate: metric
  params:
    dimensions:
      connection_security_policy: conditional((context.reporter.kind | "inbound")
        == "outbound", "unknown", conditional(connection.mtls | false, "mutual_tls",
        "none"))
      destination_app: destination.labels["app"] | "unknown"
      destination_principal: destination.principal | "unknown"
      destination_service: destination.service.host | conditional((destination.service.name
        | "unknown") == "unknown", "unknown", request.host)
      destination_service_name: destination.service.name | "unknown"
      destination_service_namespace: destination.service.namespace | "unknown"
      destination_version: destination.labels["version"] | "unknown"
      destination_workload: destination.workload.name | "unknown"
      destination_workload_namespace: destination.workload.namespace | "unknown"
      permissive_response_code: rbac.permissive.response_code | "none"
      permissive_response_policyid: rbac.permissive.effective_policy_id | "none"
      reporter: conditional((context.reporter.kind | "inbound") == "outbound", "source",
        "destination")
      request_protocol: api.protocol | context.protocol | "unknown"
      response_code: response.code | 200
      response_flags: context.proxy_error_code | "-"
      source_app: source.labels["app"] | "unknown"
      source_principal: source.principal | "unknown"
      source_version: source.labels["version"] | "unknown"
      source_workload: source.workload.name | "unknown"
      source_workload_namespace: source.workload.namespace | "unknown"
    monitored_resource_type: '"UNSPECIFIED"'
    value: "1"
---
apiVersion: config.istio.io/v1alpha2
kind: instance
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: requestduration
  namespace: istio-system
spec:
  compiledTemplate: metric
  params:
    dimensions:
      connection_security_policy: conditional((context.reporter.kind | "inbound")
        == "outbound", "unknown", conditional(connection.mtls | false, "mutual_tls",
        "none"))
      destination_app: destination.labels["app"] | "unknown"
      destination_principal: destination.principal | "unknown"
      destination_service: destination.service.host | conditional((destination.service.name
        | "unknown") == "unknown", "unknown", request.host)
      destination_service_name: destination.service.name | "unknown"
      destination_service_namespace: destination.service.namespace | "unknown"
      destination_version: destination.labels["version"] | "unknown"
      destination_workload: destination.workload.name | "unknown"
      destination_workload_namespace: destination.workload.namespace | "unknown"
      permissive_response_code: rbac.permissive.response_code | "none"
      permissive_response_policyid: rbac.permissive.effective_policy_id | "none"
      reporter: conditional((context.reporter.kind | "inbound") == "outbound", "source",
        "destination")
      request_protocol: api.protocol | context.protocol | "unknown"
      response_code: response.code | 200
      response_flags: context.proxy_error_code | "-"
      source_app: source.labels["app"] | "unknown"
      source_principal: source.principal | "unknown"
      source_version: source.labels["version"] | "unknown"
      source_workload: source.workload.name | "unknown"
      source_workload_namespace: source.workload.namespace | "unknown"
    monitored_resource_type: '"UNSPECIFIED"'
    value: response.duration | "0ms"
---
apiVersion: config.istio.io/v1alpha2
kind: instance
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: requestsize
  namespace: istio-system
spec:
  compiledTemplate: metric
  params:
    dimensions:
      connection_security_policy: conditional((context.reporter.kind | "inbound")
        == "outbound", "unknown", conditional(connection.mtls | false, "mutual_tls",
        "none"))
      destination_app: destination.labels["app"] | "unknown"
      destination_principal: destination.principal | "unknown"
      destination_service: destination.service.host | conditional((destination.service.name
        | "unknown") == "unknown", "unknown", request.host)
      destination_service_name: destination.service.name | "unknown"
      destination_service_namespace: destination.service.namespace | "unknown"
      destination_version: destination.labels["version"] | "unknown"
      destination_workload: destination.workload.name | "unknown"
      destination_workload_namespace: destination.workload.namespace | "unknown"
      permissive_response_code: rbac.permissive.response_code | "none"
      permissive_response_policyid: rbac.permissive.effective_policy_id | "none"
      reporter: conditional((context.reporter.kind | "inbound") == "outbound", "source",
        "destination")
      request_protocol: api.protocol | context.protocol | "unknown"
      response_code: response.code | 200
      response_flags: context.proxy_error_code | "-"
      source_app: source.labels["app"] | "unknown"
      source_principal: source.principal | "unknown"
      source_version: source.labels["version"] | "unknown"
      source_workload: source.workload.name | "unknown"
      source_workload_namespace: source.workload.namespace | "unknown"
    monitored_resource_type: '"UNSPECIFIED"'
    value: request.size | 0
---
apiVersion: config.istio.io/v1alpha2
kind: instance
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: responsesize
  namespace: istio-system
spec:
  compiledTemplate: metric
  params:
    dimensions:
      connection_security_policy: conditional((context.reporter.kind | "inbound")
        == "outbound", "unknown", conditional(connection.mtls | false, "mutual_tls",
        "none"))
      destination_app: destination.labels["app"] | "unknown"
      destination_principal: destination.principal | "unknown"
      destination_service: destination.service.host | conditional((destination.service.name
        | "unknown") == "unknown", "unknown", request.host)
      destination_service_name: destination.service.name | "unknown"
      destination_service_namespace: destination.service.namespace | "unknown"
      destination_version: destination.labels["version"] | "unknown"
      destination_workload: destination.workload.name | "unknown"
      destination_workload_namespace: destination.workload.namespace | "unknown"
      permissive_response_code: rbac.permissive.response_code | "none"
      permissive_response_policyid: rbac.permissive.effective_policy_id | "none"
      reporter: conditional((context.reporter.kind | "inbound") == "outbound", "source",
        "destination")
      request_protocol: api.protocol | context.protocol | "unknown"
      response_code: response.code | 200
      response_flags: context.proxy_error_code | "-"
      source_app: source.labels["app"] | "unknown"
      source_principal: source.principal | "unknown"
      source_version: source.labels["version"] | "unknown"
      source_workload: source.workload.name | "unknown"
      source_workload_namespace: source.workload.namespace | "unknown"
    monitored_resource_type: '"UNSPECIFIED"'
    value: response.size | 0
---
apiVersion: config.istio.io/v1alpha2
kind: instance
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: tcpbytesent
  namespace: istio-system
spec:
  compiledTemplate: metric
  params:
    dimensions:
      connection_security_policy: conditional((context.reporter.kind | "inbound")
        == "outbound", "unknown", conditional(connection.mtls | false, "mutual_tls",
        "none"))
      destination_app: destination.labels["app"] | "unknown"
      destination_principal: destination.principal | "unknown"
      destination_service: destination.service.host | "unknown"
      destination_service_name: destination.service.name | "unknown"
      destination_service_namespace: destination.service.namespace | "unknown"
      destination_version: destination.labels["version"] | "unknown"
      destination_workload: destination.workload.name | "unknown"
      destination_workload_namespace: destination.workload.namespace | "unknown"
      reporter: conditional((context.reporter.kind | "inbound") == "outbound", "source",
        "destination")
      response_flags: context.proxy_error_code | "-"
      source_app: source.labels["app"] | "unknown"
      source_principal: source.principal | "unknown"
      source_version: source.labels["version"] | "unknown"
      source_workload: source.workload.name | "unknown"
      source_workload_namespace: source.workload.namespace | "unknown"
    monitored_resource_type: '"UNSPECIFIED"'
    value: connection.sent.bytes | 0
---
apiVersion: config.istio.io/v1alpha2
kind: instance
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: tcpbytereceived
  namespace: istio-system
spec:
  compiledTemplate: metric
  params:
    dimensions:
      connection_security_policy: conditional((context.reporter.kind | "inbound")
        == "outbound", "unknown", conditional(connection.mtls | false, "mutual_tls",
        "none"))
      destination_app: destination.labels["app"] | "unknown"
      destination_principal: destination.principal | "unknown"
      destination_service: destination.service.host | "unknown"
      destination_service_name: destination.service.name | "unknown"
      destination_service_namespace: destination.service.namespace | "unknown"
      destination_version: destination.labels["version"] | "unknown"
      destination_workload: destination.workload.name | "unknown"
      destination_workload_namespace: destination.workload.namespace | "unknown"
      reporter: conditional((context.reporter.kind | "inbound") == "outbound", "source",
        "destination")
      response_flags: context.proxy_error_code | "-"
      source_app: source.labels["app"] | "unknown"
      source_principal: source.principal | "unknown"
      source_version: source.labels["version"] | "unknown"
      source_workload: source.workload.name | "unknown"
      source_workload_namespace: source.workload.namespace | "unknown"
    monitored_resource_type: '"UNSPECIFIED"'
    value: connection.received.bytes | 0
---
apiVersion: config.istio.io/v1alpha2
kind: instance
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: tcpconnectionsopened
  namespace: istio-system
spec:
  compiledTemplate: metric
  params:
    dimensions:
      connection_security_policy: conditional((context.reporter.kind | "inbound")
        == "outbound", "unknown", conditional(connection.mtls | false, "mutual_tls",
        "none"))
      destination_app: destination.labels["app"] | "unknown"
      destination_principal: destination.principal | "unknown"
      destination_service: destination.service.host | "unknown"
      destination_service_name: destination.service.name | "unknown"
      destination_service_namespace: destination.service.namespace | "unknown"
      destination_version: destination.labels["version"] | "unknown"
      destination_workload: destination.workload.name | "unknown"
      destination_workload_namespace: destination.workload.namespace | "unknown"
      reporter: conditional((context.reporter.kind | "inbound") == "outbound", "source",
        "destination")
      response_flags: context.proxy_error_code | "-"
      source_app: source.labels["app"] | "unknown"
      source_principal: source.principal | "unknown"
      source_version: source.labels["version"] | "unknown"
      source_workload: source.workload.name | "unknown"
      source_workload_namespace: source.workload.namespace | "unknown"
    monitored_resource_type: '"UNSPECIFIED"'
    value: "1"
---
apiVersion: config.istio.io/v1alpha2
kind: instance
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: tcpconnectionsclosed
  namespace: istio-system
spec:
  compiledTemplate: metric
  params:
    dimensions:
      connection_security_policy: conditional((context.reporter.kind | "inbound")
        == "outbound", "unknown", conditional(connection.mtls | false, "mutual_tls",
        "none"))
      destination_app: destination.labels["app"] | "unknown"
      destination_principal: destination.principal | "unknown"
      destination_service: destination.service.host | "unknown"
      destination_service_name: destination.service.name | "unknown"
      destination_service_namespace: destination.service.namespace | "unknown"
      destination_version: destination.labels["version"] | "unknown"
      destination_workload: destination.workload.name | "unknown"
      destination_workload_namespace: destination.workload.namespace | "unknown"
      reporter: conditional((context.reporter.kind | "inbound") == "outbound", "source",
        "destination")
      response_flags: context.proxy_error_code | "-"
      source_app: source.labels["app"] | "unknown"
      source_principal: source.principal | "unknown"
      source_version: source.labels["version"] | "unknown"
      source_workload: source.workload.name | "unknown"
      source_workload_namespace: source.workload.namespace | "unknown"
    monitored_resource_type: '"UNSPECIFIED"'
    value: "1"
---
apiVersion: config.istio.io/v1alpha2
kind: handler
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: prometheus
  namespace: istio-system
spec:
  compiledAdapter: prometheus
  params:
    metrics:
    - instance_name: requestcount.instance.istio-system
      kind: COUNTER
      label_names:
      - reporter
      - source_app
      - source_principal
      - source_workload
      - source_workload_namespace
      - source_version
      - destination_app
      - destination_principal
      - destination_workload
      - destination_workload_namespace
      - destination_version
      - destination_service
      - destination_service_name
      - destination_service_namespace
      - request_protocol
      - response_code
      - response_flags
      - permissive_response_code
      - permissive_response_policyid
      - connection_security_policy
      name: requests_total
    - buckets:
        explicit_buckets:
          bounds:
          - 0.005
          - 0.01
          - 0.025
          - 0.05
          - 0.1
          - 0.25
          - 0.5
          - 1
          - 2.5
          - 5
          - 10
      instance_name: requestduration.instance.istio-system
      kind: DISTRIBUTION
      label_names:
      - reporter
      - source_app
      - source_principal
      - source_workload
      - source_workload_namespace
      - source_version
      - destination_app
      - destination_principal
      - destination_workload
      - destination_workload_namespace
      - destination_version
      - destination_service
      - destination_service_name
      - destination_service_namespace
      - request_protocol
      - response_code
      - response_flags
      - permissive_response_code
      - permissive_response_policyid
      - connection_security_policy
      name: request_duration_seconds
    - buckets:
        exponentialBuckets:
          growthFactor: 10
          numFiniteBuckets: 8
          scale: 1
      instance_name: requestsize.instance.istio-system
      kind: DISTRIBUTION
      label_names:
      - reporter
      - source_app
      - source_principal
      - source_workload
      - source_workload_namespace
      - source_version
      - destination_app
      - destination_principal
      - destination_workload
      - destination_workload_namespace
      - destination_version
      - destination_service
      - destination_service_name
      - destination_service_namespace
      - request_protocol
      - response_code
      - response_flags
      - permissive_response_code
      - permissive_response_policyid
      - connection_security_policy
      name: request_bytes
    - buckets:
        exponentialBuckets:
          growthFactor: 10
          numFiniteBuckets: 8
          scale: 1
      instance_name: responsesize.instance.istio-system
      kind: DISTRIBUTION
      label_names:
      - reporter
      - source_app
      - source_principal
      - source_workload
      - source_workload_namespace
      - source_version
      - destination_app
      - destination_principal
      - destination_workload
      - destination_workload_namespace
      - destination_version
      - destination_service
      - destination_service_name
      - destination_service_namespace
      - request_protocol
      - response_code
      - response_flags
      - permissive_response_code
      - permissive_response_policyid
      - connection_security_policy
      name: response_bytes
    - instance_name: tcpbytesent.instance.istio-system
      kind: COUNTER
      label_names:
      - reporter
      - source_app
      - source_principal
      - source_workload
      - source_workload_namespace
      - source_version
      - destination_app
      - destination_principal
      - destination_workload
      - destination_workload_namespace
      - destination_version
      - destination_service
      - destination_service_name
      - destination_service_namespace
      - connection_security_policy
      - response_flags
      name: tcp_sent_bytes_total
    - instance_name: tcpbytereceived.instance.istio-system
      kind: COUNTER
      label_names:
      - reporter
      - source_app
      - source_principal
      - source_workload
      - source_workload_namespace
      - source_version
      - destination_app
      - destination_principal
      - destination_workload
      - destination_workload_namespace
      - destination_version
      - destination_service
      - destination_service_name
      - destination_service_namespace
      - connection_security_policy
      - response_flags
      name: tcp_received_bytes_total
    - instance_name: tcpconnectionsopened.instance.istio-system
      kind: COUNTER
      label_names:
      - reporter
      - source_app
      - source_principal
      - source_workload
      - source_workload_namespace
      - source_version
      - destination_app
      - destination_principal
      - destination_workload
      - destination_workload_namespace
      - destination_version
      - destination_service
      - destination_service_name
      - destination_service_namespace
      - connection_security_policy
      - response_flags
      name: tcp_connections_opened_total
    - instance_name: tcpconnectionsclosed.instance.istio-system
      kind: COUNTER
      label_names:
      - reporter
      - source_app
      - source_principal
      - source_workload
      - source_workload_namespace
      - source_version
      - destination_app
      - destination_principal
      - destination_workload
      - destination_workload_namespace
      - destination_version
      - destination_service
      - destination_service_name
      - destination_service_namespace
      - connection_security_policy
      - response_flags
      name: tcp_connections_closed_total
    metricsExpirationPolicy:
      metricsExpiryDuration: 10m
---
apiVersion: config.istio.io/v1alpha2
kind: rule
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: promhttp
  namespace: istio-system
spec:
  actions:
  - handler: prometheus
    instances:
    - requestcount
    - requestduration
    - requestsize
    - responsesize
  match: (context.protocol == "http" || context.protocol == "grpc") && (match((request.useragent
    | "-"), "kube-probe*") == false) && (match((request.useragent | "-"), "Prometheus*")
    == false)
---
apiVersion: config.istio.io/v1alpha2
kind: rule
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: promtcp
  namespace: istio-system
spec:
  actions:
  - handler: prometheus
    instances:
    - tcpbytesent
    - tcpbytereceived
  match: context.protocol == "tcp"
---
apiVersion: config.istio.io/v1alpha2
kind: rule
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: promtcpconnectionopen
  namespace: istio-system
spec:
  actions:
  - handler: prometheus
    instances:
    - tcpconnectionsopened
  match: context.protocol == "tcp" && ((connection.event | "na") == "open")
---
apiVersion: config.istio.io/v1alpha2
kind: rule
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: promtcpconnectionclosed
  namespace: istio-system
spec:
  actions:
  - handler: prometheus
    instances:
    - tcpconnectionsclosed
  match: context.protocol == "tcp" && ((connection.event | "na") == "close")
---
apiVersion: config.istio.io/v1alpha2
kind: handler
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: kubernetesenv
  namespace: istio-system
spec:
  compiledAdapter: kubernetesenv
  params: null
---
apiVersion: config.istio.io/v1alpha2
kind: rule
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: kubeattrgenrulerule
  namespace: istio-system
spec:
  actions:
  - handler: kubernetesenv
    instances:
    - attributes
---
apiVersion: config.istio.io/v1alpha2
kind: rule
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: tcpkubeattrgenrulerule
  namespace: istio-system
spec:
  actions:
  - handler: kubernetesenv
    instances:
    - attributes
  match: context.protocol == "tcp"
---
apiVersion: config.istio.io/v1alpha2
kind: instance
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: attributes
  namespace: istio-system
spec:
  attributeBindings:
    destination.container.name: $out.destination_container_name | "unknown"
    destination.ip: $out.destination_pod_ip | ip("0.0.0.0")
    destination.labels: $out.destination_labels | emptyStringMap()
    destination.name: $out.destination_pod_name | "unknown"
    destination.namespace: $out.destination_namespace | "default"
    destination.owner: $out.destination_owner | "unknown"
    destination.serviceAccount: $out.destination_service_account_name | "unknown"
    destination.uid: $out.destination_pod_uid | "unknown"
    destination.workload.name: $out.destination_workload_name | "unknown"
    destination.workload.namespace: $out.destination_workload_namespace | "unknown"
    destination.workload.uid: $out.destination_workload_uid | "unknown"
    source.ip: $out.source_pod_ip | ip("0.0.0.0")
    source.labels: $out.source_labels | emptyStringMap()
    source.name: $out.source_pod_name | "unknown"
    source.namespace: $out.source_namespace | "default"
    source.owner: $out.source_owner | "unknown"
    source.serviceAccount: $out.source_service_account_name | "unknown"
    source.uid: $out.source_pod_uid | "unknown"
    source.workload.name: $out.source_workload_name | "unknown"
    source.workload.namespace: $out.source_workload_namespace | "unknown"
    source.workload.uid: $out.source_workload_uid | "unknown"
  compiledTemplate: kubernetes
  params:
    destination_port: destination.port | 0
    destination_uid: destination.uid | ""
    source_ip: source.ip | ip("0.0.0.0")
    source_uid: source.uid | ""
---
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: istio-telemetry
  namespace: istio-system
spec:
  host: istio-telemetry.istio-system.svc.cluster.local
  trafficPolicy:
    connectionPool:
      http:
        http2MaxRequests: 10000
        maxRequestsPerConnection: 10000
    portLevelSettings:
    - port:
        number: 15004
      tls:
        mode: ISTIO_MUTUAL
    - port:
        number: 9091
      tls:
        mode: DISABLE
---
apiVersion: v1
data:
  envoy.yaml.tmpl: |-
    admin:
      access_log_path: /dev/null
      address:
        socket_address:
          address: 127.0.0.1
          port_value: 15000
    stats_config:
      use_all_default_tags: false
      stats_tags:
      - tag_name: cluster_name
        regex: '^cluster\.((.+?(\..+?\.svc\.cluster\.local)?)\.)'
      - tag_name: tcp_prefix
        regex: '^tcp\.((.*?)\.)\w+?$'
      - tag_name: response_code
        regex: '_rq(_(\d{3}))$'
      - tag_name: response_code_class
        regex: '_rq(_(\dxx))$'
      - tag_name: http_conn_manager_listener_prefix
        regex: '^listener(?=\.).*?\.http\.(((?:[_.[:digit:]]*|[_\[\]aAbBcCdDeEfF[:digit:]]*))\.)'
      - tag_name: http_conn_manager_prefix
        regex: '^http\.(((?:[_.[:digit:]]*|[_\[\]aAbBcCdDeEfF[:digit:]]*))\.)'
      - tag_name: listener_address
        regex: '^listener\.(((?:[_.[:digit:]]*|[_\[\]aAbBcCdDeEfF[:digit:]]*))\.)'

    static_resources:
      clusters:
      - name: prometheus_stats
        type: STATIC
        connect_timeout: 0.250s
        lb_policy: ROUND_ROBIN
        hosts:
        - socket_address:
            protocol: TCP
            address: 127.0.0.1
            port_value: 15000

      - name: inbound_9092
        circuit_breakers:
          thresholds:
          - max_connections: 100000
            max_pending_requests: 100000
            max_requests: 100000
            max_retries: 3
        connect_timeout: 1.000s
        hosts:
        - pipe:
            path: /sock/mixer.socket
        http2_protocol_options: {}

      - name: out.galley.15019
        http2_protocol_options: {}
        connect_timeout: 1.000s
        type: STRICT_DNS

        circuit_breakers:
          thresholds:
            - max_connections: 100000
              max_pending_requests: 100000
              max_requests: 100000
              max_retries: 3
        hosts:
          - socket_address:
              address: istio-galley.istio-system
              port_value: 15019
        tls_context:
          common_tls_context:
            tls_certificates:
            - certificate_chain:
                filename: /etc/certs/cert-chain.pem
              private_key:
                filename: /etc/certs/key.pem
            validation_context:
              trusted_ca:
                filename: /etc/certs/root-cert.pem
              verify_subject_alt_name:
              - spiffe://cluster.local/ns/istio-system/sa/istio-galley-service-account

      listeners:
      - name: "15090"
        address:
          socket_address:
            protocol: TCP
            address: 0.0.0.0
            port_value: 15090
        filter_chains:
        - filters:
          - name: envoy.http_connection_manager
            config:
              codec_type: AUTO
              stat_prefix: stats
              route_config:
                virtual_hosts:
                - name: backend
                  domains:
                  - '*'
                  routes:
                  - match:
                      prefix: /stats/prometheus
                    route:
                      cluster: prometheus_stats
              http_filters:
              - name: envoy.router

      - name: "15004"
        address:
          socket_address:
            address: 0.0.0.0
            port_value: 15004
        filter_chains:
        - filters:
          - config:
              codec_type: HTTP2
              http2_protocol_options:
                max_concurrent_streams: 1073741824
              generate_request_id: true
              http_filters:
              - config:
                  default_destination_service: istio-telemetry.istio-system.svc.cluster.local
                  service_configs:
                    istio-telemetry.istio-system.svc.cluster.local:
                      disable_check_calls: true
    {{- if .DisableReportCalls }}
                      disable_report_calls: true
    {{- end }}
                      mixer_attributes:
                        attributes:
                          destination.service.host:
                            string_value: istio-telemetry.istio-system.svc.cluster.local
                          destination.service.uid:
                            string_value: istio://istio-system/services/istio-telemetry
                          destination.service.name:
                            string_value: istio-telemetry
                          destination.service.namespace:
                            string_value: istio-system
                          destination.uid:
                            string_value: kubernetes://{{ .PodName }}.istio-system
                          destination.namespace:
                            string_value: istio-system
                          destination.ip:
                            bytes_value: {{ .PodIP }}
                          destination.port:
                            int64_value: 15004
                          context.reporter.kind:
                            string_value: inbound
                          context.reporter.uid:
                            string_value: kubernetes://{{ .PodName }}.istio-system
                  transport:
                    check_cluster: mixer_check_server
                    report_cluster: inbound_9092
                name: mixer
              - name: envoy.router
              route_config:
                name: "15004"
                virtual_hosts:
                - domains:
                  - '*'
                  name: istio-telemetry.istio-system.svc.cluster.local
                  routes:
                  - decorator:
                      operation: Report
                    match:
                      prefix: /
                    route:
                      cluster: inbound_9092
                      timeout: 0.000s
              stat_prefix: "15004"
            name: envoy.http_connection_manager
          tls_context:
            common_tls_context:
              alpn_protocols:
              - h2
              tls_certificates:
              - certificate_chain:
                  filename: /etc/certs/cert-chain.pem
                private_key:
                  filename: /etc/certs/key.pem
              validation_context:
                trusted_ca:
                  filename: /etc/certs/root-cert.pem
            require_client_certificate: true

      - name: "9091"
        address:
          socket_address:
            address: 0.0.0.0
            port_value: 9091
        filter_chains:
        - filters:
          - config:
              codec_type: HTTP2
              http2_protocol_options:
                max_concurrent_streams: 1073741824
              generate_request_id: true
              http_filters:
              - config:
                  default_destination_service: istio-telemetry.istio-system.svc.cluster.local
                  service_configs:
                    istio-telemetry.istio-system.svc.cluster.local:
                      disable_check_calls: true
    {{- if .DisableReportCalls }}
                      disable_report_calls: true
    {{- end }}
                      mixer_attributes:
                        attributes:
                          destination.service.host:
                            string_value: istio-telemetry.istio-system.svc.cluster.local
                          destination.service.uid:
                            string_value: istio://istio-system/services/istio-telemetry
                          destination.service.name:
                            string_value: istio-telemetry
                          destination.service.namespace:
                            string_value: istio-system
                          destination.uid:
                            string_value: kubernetes://{{ .PodName }}.istio-system
                          destination.namespace:
                            string_value: istio-system
                          destination.ip:
                            bytes_value: {{ .PodIP }}
                          destination.port:
                            int64_value: 9091
                          context.reporter.kind:
                            string_value: inbound
                          context.reporter.uid:
                            string_value: kubernetes://{{ .PodName }}.istio-system
                  transport:
                    check_cluster: mixer_check_server
                    report_cluster: inbound_9092
                name: mixer
              - name: envoy.router
              route_config:
                name: "9091"
                virtual_hosts:
                - domains:
                  - '*'
                  name: istio-telemetry.istio-system.svc.cluster.local
                  routes:
                  - decorator:
                      operation: Report
                    match:
                      prefix: /
                    route:
                      cluster: inbound_9092
                      timeout: 0.000s
              stat_prefix: "9091"
            name: envoy.http_connection_manager

      - name: "local.15019"
        address:
          socket_address:
            address: 127.0.0.1
            port_value: 15019
        filter_chains:
          - filters:
              - name: envoy.http_connection_manager
                config:
                  codec_type: HTTP2
                  stat_prefix: "15019"
                  http2_protocol_options:
                    max_concurrent_streams: 1073741824

                  access_log:
                    - name: envoy.file_access_log
                      config:
                        path: /dev/stdout

                  http_filters:
                    - name: envoy.router

                  route_config:
                    name: "15019"

                    virtual_hosts:
                      - name: istio-galley

                        domains:
                          - '*'

                        routes:
                          - match:
                              prefix: /
                            route:
                              cluster: out.galley.15019
                              timeout: 0.000s
kind: ConfigMap
metadata:
  labels:
    release: istio
  name: telemetry-envoy-config
  namespace: istio-system
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/mixer:1.4.5
        URL: gcr.io/cf-routing/mixer@sha256:b9472ceaa66dcc34e3ca49813c994ddde6af49ab86bc07ca981ba1f3763d2e00
      - Metas:
        - Tag: 1.4.5
          Type: resolved
          URL: gcr.io/cf-routing/proxyv2:1.4.5
        URL: gcr.io/cf-routing/proxyv2@sha256:d7792fed2b3e7ffc84bfc50f693a9dd8960883ea9685b12ae1f1ef7ee2133ea3
  labels:
    app: istio-mixer
    istio: mixer
    release: istio
  name: istio-telemetry
  namespace: istio-system
spec:
  replicas: 1
  selector:
    matchLabels:
      istio: mixer
      istio-mixer-type: telemetry
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 25%
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
      labels:
        app: telemetry
        istio: mixer
        istio-mixer-type: telemetry
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - ppc64le
            weight: 2
          - preference:
              matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - s390x
            weight: 2
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: beta.kubernetes.io/arch
                operator: In
                values:
                - amd64
                - ppc64le
                - s390x
      containers:
      - args:
        - --monitoringPort=15014
        - --address
        - unix:///sock/mixer.socket
        - --log_output_level=default:info
        - --configStoreURL=mcp://localhost:15019
        - --configDefaultNamespace=istio-system
        - --useAdapterCRDs=false
        - --useTemplateCRDs=false
        - --trace_zipkin_url=http://zipkin.istio-system:9411/api/v1/spans
        env:
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: GOMAXPROCS
          value: "6"
        image: gcr.io/cf-routing/mixer@sha256:b9472ceaa66dcc34e3ca49813c994ddde6af49ab86bc07ca981ba1f3763d2e00
        imagePullPolicy: IfNotPresent
        livenessProbe:
          httpGet:
            path: /version
            port: 15014
          initialDelaySeconds: 5
          periodSeconds: 5
        name: mixer
        ports:
        - containerPort: 9091
        - containerPort: 15014
        - containerPort: 42422
        resources: {}
        volumeMounts:
        - mountPath: /etc/certs
          name: istio-certs
          readOnly: true
        - mountPath: /sock
          name: uds-socket
        - mountPath: /var/run/secrets/istio.io/telemetry/adapter
          name: telemetry-adapter-secret
          readOnly: true
      - args:
        - proxy
        - --domain
        - $(POD_NAMESPACE).svc.cluster.local
        - --serviceCluster
        - istio-telemetry
        - --templateFile
        - /var/lib/envoy/envoy.yaml.tmpl
        - --controlPlaneAuthPolicy
        - MUTUAL_TLS
        - --trust-domain=cluster.local
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: INSTANCE_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: SDS_ENABLED
          value: "false"
        image: gcr.io/cf-routing/proxyv2@sha256:d7792fed2b3e7ffc84bfc50f693a9dd8960883ea9685b12ae1f1ef7ee2133ea3
        imagePullPolicy: IfNotPresent
        name: istio-proxy
        ports:
        - containerPort: 15004
        - containerPort: 15090
          name: http-envoy-prom
          protocol: TCP
        resources: {}
        volumeMounts:
        - mountPath: /var/lib/envoy
          name: telemetry-envoy-config
        - mountPath: /etc/certs
          name: istio-certs
          readOnly: true
        - mountPath: /sock
          name: uds-socket
      serviceAccountName: istio-mixer-service-account
      volumes:
      - name: istio-certs
        secret:
          optional: true
          secretName: istio.istio-mixer-service-account
      - emptyDir: {}
        name: uds-socket
      - name: telemetry-adapter-secret
        secret:
          optional: true
          secretName: telemetry-adapter-secret
      - configMap:
          name: telemetry-envoy-config
        name: telemetry-envoy-config
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  annotations:
    kapp.k14s.io/update-strategy: fallback-on-replace
  labels:
    app: telemetry
    istio: mixer
    istio-mixer-type: telemetry
    release: istio
  name: istio-telemetry
  namespace: istio-system
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: telemetry
      istio: mixer
      istio-mixer-type: telemetry
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: mixer
    istio: mixer
    release: istio
  name: istio-telemetry
  namespace: istio-system
spec:
  ports:
  - name: grpc-mixer
    port: 9091
  - name: grpc-mixer-mtls
    port: 15004
  - name: http-monitoring
    port: 15014
  - name: prometheus
    port: 42422
  selector:
    istio: mixer
    istio-mixer-type: telemetry
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: istio-telemetry
    release: istio
  name: istio-mixer-service-account
  namespace: istio-system
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: pilot-network-policy
  namespace: istio-system
spec:
  ingress:
  - ports:
    - port: 15004
    - port: 15010
    - port: 15011
    - port: 15014
  podSelector:
    matchLabels:
      app: pilot
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: citadel-network-policy
  namespace: istio-system
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
    ports:
    - port: 8060
    - port: 8080
  - ports:
    - port: 15014
  podSelector:
    matchLabels:
      app: citadel
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: mixer-network-policy
  namespace: istio-system
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
    ports:
    - port: 9091
    - port: 15004
    - port: 15090
    - port: 42422
  - ports:
    - port: 15014
  podSelector:
    matchLabels:
      app: mixer
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: sidecar-injector-network-policy
  namespace: istio-system
spec:
  ingress:
  - ports:
    - port: 9443
    - port: 15014
  podSelector:
    matchLabels:
      app: sidecarInjectorWebhook
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: ingressgateway-network-policy-pilot
  namespace: istio-system
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          cf-for-k8s.cloudfoundry.org/istio-system-ns: ""
    ports:
    - port: 15443
    - port: 15020
  - ports:
    - port: 80
    - port: 443
  podSelector:
    matchLabels:
      app: istio-ingressgateway
  policyTypes:
  - Ingress
---
apiVersion: networking.istio.io/v1alpha3
kind: Sidecar
metadata:
  name: default
  namespace: cf-workloads
spec:
  egress:
  - hosts:
    - cf-system/*
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: routecontroller
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: routecontroller
subjects:
- kind: ServiceAccount
  name: routecontroller
  namespace: cf-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: routecontroller
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
rules:
- apiGroups:
  - networking.cloudfoundry.org
  resources:
  - routes
  - routes/status
  verbs:
  - create
  - delete
  - get
  - update
  - list
  - watch
- apiGroups:
  - networking.istio.io
  resources:
  - virtualservices
  verbs:
  - create
  - delete
  - get
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - create
  - delete
  - get
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: routecontroller-config
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
    kapp.k14s.io/num-versions: "2"
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
data:
  ISTIO_GATEWAY_NAME: cf-system/istio-ingressgateway
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: routecontroller
  namespace: cf-system
  labels:
    app: routecontroller
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
spec:
  replicas: 1
  selector:
    matchLabels:
      app: routecontroller
  template:
    metadata:
      namespace: cf-system
      labels:
        app: routecontroller
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      containers:
      - name: routecontroller
        image: gcr.io/cf-networking-images/cf-k8s-networking/routecontroller@sha256:ed4b3e351a31313ebf974439e4fb43210281a02f0a9125cb8ea880c572385b5f
        resources: {}
        envFrom:
        - configMapRef:
            name: routecontroller-config
      terminationGracePeriodSeconds: 10
      serviceAccountName: routecontroller
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: routecontroller
  namespace: cf-system
  annotations:
    kapp.k14s.io/change-group: cf-k8s-networking/routecontroller
---
apiVersion: v1
kind: Namespace
metadata:
  name: cf-db
  labels:
    istio-injection: enabled
---
apiVersion: v1
kind: Secret
metadata:
  name: cf-db-admin-secret
  namespace: cf-db
data:
  postgresql-password: ZGFmNDhhM2x3eGQxZXVyOHlzN2k=
---
apiVersion: v1
kind: Secret
metadata:
  name: cf-db-credentials
  namespace: cf-db
data:
  ccdb-username: Y2xvdWRfY29udHJvbGxlcg==
  ccdb-password: amJ5azJrbG5lbWFhNXVvMm8wMm8=
  uaadb-username: dWFh
  uaadb-password: ODBtOXk0Z3c1eWFiajE1MXhsajU=
---
apiVersion: v1
data:
  init.sh: |
    #!/bin/bash
    CCDB_USERNAME=$(cat /docker-entrypoint-initdb.d/secret/ccdb-username)
    CCDB_PASSWORD=$(cat /docker-entrypoint-initdb.d/secret/ccdb-password)
    UAADB_USERNAME=$(cat /docker-entrypoint-initdb.d/secret/uaadb-username)
    UAADB_PASSWORD=$(cat /docker-entrypoint-initdb.d/secret/uaadb-password)
    cat > /tmp/setup_db.sql <<EOT
    CREATE DATABASE cloud_controller;
    CREATE ROLE ${CCDB_USERNAME} LOGIN PASSWORD '${CCDB_PASSWORD}';
    CREATE DATABASE uaa;
    CREATE ROLE ${UAADB_USERNAME} LOGIN PASSWORD '${UAADB_PASSWORD}';
    EOT
    psql -U postgres -f /tmp/setup_db.sql
    psql -U postgres -d cloud_controller -c "CREATE EXTENSION citext"
    psql -U postgres -d uaa -c "CREATE EXTENSION citext"
kind: ConfigMap
metadata:
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql-init-scripts
  namespace: cf-db
  annotations:
    kapp.k14s.io/versioned: ""
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql-headless
  namespace: cf-db
spec:
  clusterIP: None
  ports:
  - name: tcp-postgresql
    port: 5432
    targetPort: tcp-postgresql
  selector:
    app: postgresql
    release: cf-db
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql
  namespace: cf-db
spec:
  ports:
  - name: tcp-postgresql
    port: 5432
    targetPort: tcp-postgresql
  selector:
    app: postgresql
    release: cf-db
    role: master
  type: ClusterIP
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  annotations:
    kbld.k14s.io/images: |
      - Metas:
        - Tag: 11.8.0-debian-10-r33
          Type: resolved
          URL: docker.io/bitnami/postgresql:11.8.0-debian-10-r33
        URL: index.docker.io/bitnami/postgresql@sha256:0f76a419cfd9996036e3a53672f50cf69ed7699f1241cbf8e20af17bbbdf0683
    kapp.k14s.io/change-group.cf-db-postgresql: cf-for-k8s.cloudfoundry.org/cf-db-postgresql
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
  labels:
    app: postgresql
    chart: postgresql-8.10.6
    heritage: Helm
    release: cf-db
  name: cf-db-postgresql
  namespace: cf-db
spec:
  replicas: 1
  selector:
    matchLabels:
      app: postgresql
      release: cf-db
      role: master
  serviceName: cf-db-postgresql-headless
  template:
    metadata:
      labels:
        app: postgresql
        chart: postgresql-8.10.6
        heritage: Helm
        release: cf-db
        role: master
      name: cf-db-postgresql
    spec:
      containers:
      - env:
        - name: BITNAMI_DEBUG
          value: "false"
        - name: POSTGRESQL_PORT_NUMBER
          value: "5432"
        - name: POSTGRESQL_VOLUME_DIR
          value: /bitnami/postgresql
        - name: PGDATA
          value: /bitnami/postgresql/data
        - name: POSTGRES_USER
          value: postgres
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              key: postgresql-password
              name: cf-db-admin-secret
        - name: POSTGRESQL_ENABLE_LDAP
          value: "no"
        image: index.docker.io/bitnami/postgresql@sha256:0f76a419cfd9996036e3a53672f50cf69ed7699f1241cbf8e20af17bbbdf0683
        imagePullPolicy: IfNotPresent
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - exec pg_isready -U "postgres" -h 127.0.0.1 -p 5432
          failureThreshold: 6
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        name: cf-db-postgresql
        ports:
        - containerPort: 5432
          name: tcp-postgresql
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - -e
            - |
              exec pg_isready -U "postgres" -h 127.0.0.1 -p 5432
              [ -f /opt/bitnami/postgresql/tmp/.initialized ] || [ -f /bitnami/postgresql/.initialized ]
          failureThreshold: 6
          initialDelaySeconds: 5
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          requests:
            cpu: 250m
            memory: 256Mi
        securityContext:
          runAsUser: 1001
        volumeMounts:
        - mountPath: /docker-entrypoint-initdb.d/
          name: custom-init-scripts
        - mountPath: /docker-entrypoint-initdb.d/secret
          name: custom-init-scripts-secret
        - mountPath: /dev/shm
          name: dshm
        - mountPath: /bitnami/postgresql
          name: data
          subPath: null
      securityContext:
        fsGroup: 1001
      volumes:
      - configMap:
          name: cf-db-postgresql-init-scripts
        name: custom-init-scripts
      - name: custom-init-scripts-secret
        secret:
          secretName: cf-db-credentials
      - emptyDir:
          medium: Memory
          sizeLimit: 1Gi
        name: dshm
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 8Gi
---
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: slightly-above-normal
description: Useful for DaemonSets which don't really have higher priority but should
  move other pods to other nodes
value: 1
---
apiVersion: v1
kind: Namespace
metadata:
  name: cf-system
  labels:
    istio-injection: enabled
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: uaa-config
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
  annotations:
    kapp.k14s.io/versioned: ""
data:
  uaa.yml: |
    issuer:
      uri: https://uaa.vcap.me
    encryption:
      active_key_label: default_encryption_key
      encryption_keys:
      - label: default_encryption_key
        passphrase: 5urlc13b4ndh3suwwd5u
    login:
      serviceProviderKey: |
        -----BEGIN RSA PRIVATE KEY-----
        MIIG5AIBAAKCAYEAtoGBJhf7dWqRBz9UTW8ivQjMjfyAEAFLzUFMmuybV8NMU37F
        AlDEpVd8nRCwH7PyIF/bL3QBuqfaAwlHmkAT4BPRe/HwdbzBuQ2bMdrly8pTJqiX
        au8ejsdL6mtoSqGsvHY96mqDVmyqaXjCDs9vSW8NsiM/C7ZTB99tIkHhkBQ6hITQ
        uRqXQjDLY5ZZ0ao6l0SAMqnBU5heu63v4w+43P3C2WA57eqc6PozQrGo9y/K3etz
        E/fWSzlaPX+UAbQtbAnAEV+BjQXgCP5zViHgssoUXffItDgxB3CHxqju3qZqg8vd
        qjyLCbTNNTlQCe1DNpLY3AjOIgzHKfqKm1kl274MnHsIRJDKvYxLPi5bjEGbHBF/
        6q8PxRwjA296AwoHxcktM7YORCOvOWJtRxOldAUKdoxCQgY8V2TN9Fr+NUsmSDT6
        Tiv500qwe1Vg9kqJzfWHfFQ9YSH1QQQ++LMbqyHMIaDY9u0tFeEw8FAYuZpQAzrM
        tjs7iz4CelMmGiPnAgMBAAECggGAYpvifgSjNzPXHIVZNWWA7YZdj7IIN52bqVFI
        5MRGwsqg6NQr+i5NsdBtYifsIZUGk/t24FLbxFCA+PcAmxVYJ9BNdZypgdP1D9mM
        KwnM86lj+BVLitmcNyTznbte5EQqosF4froCMKYSBV7b60ilJpY8Xi2xGNDwV+ae
        fs394+0qGQPyCrGVXIwkuLA545EIi0bVxYn3DQXc2acHYDXUeoMZzn2xjx0enrrh
        C34Wf0hxYiqfSQC15nsciPHvtGP25AOgg30tS9R3UDKSWuFdk1kZXsKSVN5o0juk
        8u9GhpIgPYeEWV/neWZ1ACdyXAx/mmlo9PIHPNlhoaDb3a0YNnIM2izl5btwhKBN
        UKq3t73pJ5IrcUhggUK8O1D8PXOIMqPBnYPstqN3b4erfKTrCpNw79+Vkbc6opoo
        9hHaRHdO4uy6ocLS8K0CITZV2diZPm5ioJQarbe0BdOXEuwL3n05II/l7fEUykWl
        HxTnhSQc1W0P1/IFe06A4bTT1h0BAoHBAO+B7CBTRViTYEKc+N3Jp06EoNbJC0A0
        sMswGA7jiVnOk9zQDYzr23a9n0kTzKyaSobKYpe+1y5JYY1/aGysdPqb7dYRjUJX
        h1Y8D344BSAeQrIpfajkcTtxvNRq3/sV69E1IJ7miiCEETbg/GCoVWiq8Q7exzjn
        y1EcO0l7jcO6UU1aHM1oXdhZoBMXPOsKDRvElarkYfjKptTGNLoy5h7tMVb/bkjb
        U27EpBqvYbCHpKlMAx0Oia0kIf0kXCxtwQKBwQDDEr98/HCn0aHhHdz8Cnz/ad5p
        UyPxqKCMCL7ZTOISTqEcxR1dEF1+iQML6P9p4gh/mQLwCuRwJraw7Dj3VRGsLou1
        fyAZZGD43kCDroBk5Y4EhffZr8Ule741+n93ZGbeAgJr93rPFE1oNB7QHsSagkjs
        QA62YK0wwkO/XrxLUwJWMknqGm6Ce4T9dU80DXAyJKzxJ7YIJ94bcnoceGGLCnV5
        Ua9n2Ty3plJbM52z3hiM6qhOVbSIbjOZUoy3S6cCgcEA0pXinr14sJvMPGW2b5O5
        llEI9jEIwmhRtiXQUW8AukTnP3RzJZ/PdETfw6o0AOMceg2CyLeUjW8Z5gbLMxoj
        NKJbaSg/ksBRD6J5YNoyr33L2MigYxqQ8NpdVEuwKh2pHWZgCzba5iIY3K7PWNFJ
        X2FF2HRKqJ8t5mAzRLXs/NZaW+/KeVS1ht+u3npFJsfMpMihbAOonM7aByVLARh1
        u2WER2EJf+fQIQmm3IuuEkABqJVb+3Vn2iN1+xS4MpxBAoHAROIL6DCj/z6RMRMA
        g6eYeACEXyDSonTvLEOyUL1LXzeQwL4CHmi2+wWao8wE1PjSE2yOkwDlpYymGldv
        zjal5O0SvGZFiXHepEKm+VjXUcmVmpdL6/ybWx8VDa6E8D3t7Rs8i696GEGNC+zL
        rKYQupai9XmxOElvHraagasMRnTrcFCVtSrcNwsy7OVNsI3GPo6g2w8wwjSBw6Nq
        5z7DAvwQe2SS0dLuE9ORZU8WsvsMJEaAZBjzhPGVGuEBe4AlAoHBAMf922gPiTXj
        cXu2kfainhlr6Yz3wKG6T4MmABglAWsG3KT5/I+XRuyiAXxpXYFeF1QttjJWwsHL
        NEupv7Q7VrR8P7Pe2mBKAI6vFL9X2lr1V71aJ7EJo1uvdhrkdBUTxUinpJdpBFBR
        Pm7LDkx8EhhSQ9DuJBmkuEBR/Fom0X+px2vLebIz4zGfYrtHToDK42L9315pk2k4
        usPgVeZZWnHBfjxcu99p4MuCCPjJ2bLmHk7UuyUbm/T4yKTEdE50sw==
        -----END RSA PRIVATE KEY-----
      serviceProviderKeyPassword: ""
      serviceProviderCertificate: |
        -----BEGIN CERTIFICATE-----
        MIIEfTCCAuWgAwIBAgIQPD8PiHPKiAOEORFPJuHSfjANBgkqhkiG9w0BAQsFADAz
        MQwwCgYDVQQGEwNVU0ExFjAUBgNVBAoTDUNsb3VkIEZvdW5kcnkxCzAJBgNVBAMT
        AmNhMB4XDTIwMDYyODE5MDMyMFoXDTIxMDYyODE5MDMyMFowSzEMMAoGA1UEBhMD
        VVNBMRYwFAYDVQQKEw1DbG91ZCBGb3VuZHJ5MSMwIQYDVQQDDBp1YWFfbG9naW5f
        c2VydmljZV9wcm92aWRlcjCCAaIwDQYJKoZIhvcNAQEBBQADggGPADCCAYoCggGB
        ALaBgSYX+3VqkQc/VE1vIr0IzI38gBABS81BTJrsm1fDTFN+xQJQxKVXfJ0QsB+z
        8iBf2y90Abqn2gMJR5pAE+AT0Xvx8HW8wbkNmzHa5cvKUyaol2rvHo7HS+praEqh
        rLx2Pepqg1Zsqml4wg7Pb0lvDbIjPwu2UwffbSJB4ZAUOoSE0Lkal0Iwy2OWWdGq
        OpdEgDKpwVOYXrut7+MPuNz9wtlgOe3qnOj6M0KxqPcvyt3rcxP31ks5Wj1/lAG0
        LWwJwBFfgY0F4Aj+c1Yh4LLKFF33yLQ4MQdwh8ao7t6maoPL3ao8iwm0zTU5UAnt
        QzaS2NwIziIMxyn6iptZJdu+DJx7CESQyr2MSz4uW4xBmxwRf+qvD8UcIwNvegMK
        B8XJLTO2DkQjrzlibUcTpXQFCnaMQkIGPFdkzfRa/jVLJkg0+k4r+dNKsHtVYPZK
        ic31h3xUPWEh9UEEPvizG6shzCGg2PbtLRXhMPBQGLmaUAM6zLY7O4s+AnpTJhoj
        5wIDAQABo3UwczAOBgNVHQ8BAf8EBAMCBaAwEwYDVR0lBAwwCgYIKwYBBQUHAwEw
        DAYDVR0TAQH/BAIwADAdBgNVHQ4EFgQUotusgBe4tz0rgPuAugZIM05kCxcwHwYD
        VR0jBBgwFoAUbSnrCW57RqwqYqC6SG4DTvVlcVgwDQYJKoZIhvcNAQELBQADggGB
        AIpuHJzbSrh0YfatdwnruDTCQafHuoFnQaQHS/MxHG/zvBkjYckhbdQkJnMDSUdA
        Erck0buzXvH+1nCCUQCMgTw//zbZ84LyjwlComffiUr31ydjj/jXyDXDtDO+UF+S
        AOZiEuKLcWOCi6V9zh1jRZ9yH9UixwdR4O/GMwqgH8qzm6br3qfQ7nXOlRu08hnc
        r/rgfM/gr5E+ejCxTNCrJvw1q0zuVRA9NCJ+J1+UO+xLX9wngxZ8mATzHLxXfpAS
        xbMDqEvvFBQbvlI65pcDhBXL7Y0iAzQOVIQ3PcrQ2E8ZmIZYWlxXW1sY+CvNUeMw
        NhE8AYj4w4NirEXBTWQNB39bM2eeJun8G48RQ0BK46ksRGOy/MTykAynCyxswjm1
        E2BwA0AT0h/xt5nSPBYfyRoLVBukYcGNDssEAkmxtdxNl1qk+dbOWvtkenmT9/vU
        659UmxMg/1IiSI8OyhoW4iLWl6X4OQAtuPrX/vWpVrqLu9cgzvwBGQCcm1MP60y/
        sw==
        -----END CERTIFICATE-----
      url: https://login.vcap.me
      entityBaseURL: https://uaa.vcap.me
      entityID: cloudfoundry-saml-login
    LOGIN_SECRET: uaa-login-secret
    database:
      maxactive: 100
      maxidle: 10
      minidle: 0
      removeabandoned: false
      logabandoned: true
      abandonedtimeout: 300
      url: jdbc:postgresql://cf-db-postgresql.cf-db.svc.cluster.local:5432/uaa?sslmode=disable
    smtp:
      host: null
      port: 25
      starttls: null
      from_address: null
    oauth:
      client:
        override: true
      clients:
        admin:
          authorized-grant-types: client_credentials
          authorities: clients.read,clients.write,clients.secret,uaa.admin,scim.read,scim.write,password.write,openid
          autoapprove:
          - openid
          id: admin
        cf:
          id: cf
          override: true
          authorized-grant-types: password,refresh_token
          scope: cloud_controller.read,cloud_controller.write,openid,password.write,cloud_controller.admin,scim.read,scim.write,doppler.firehose,uaa.user,routing.router_groups.read,routing.router_groups.write
          authorities: uaa.none
          access-token-validity: 600
          refresh-token-validity: 2592000
          secret: ""
        cf-k8s-networking:
          authorities: uaa.resource,cloud_controller.admin_read_only
          authorized-grant-types: client_credentials
          secret: whqizmu0vdn00bbnf8gk
        cloud_controller_username_lookup:
          authorities: scim.userids
          authorized-grant-types: client_credentials
          secret: whqizmu0vdn00bbnf8gk
        capi_kpack_watcher:
          authorities: cloud_controller.write,cloud_controller.update_build_state
          authorized-grant-types: client_credentials
          secret: whqizmu0vdn00bbnf8gk
      user:
        authorities:
        - openid
        - scim.me
        - scim.userids
        - cloud_controller.read
        - cloud_controller.write
        - cloud_controller_service_permissions.read
        - password.write
        - uaa.user
        - approvals.me
        - oauth.approvals
        - profile
        - roles
        - user_attributes
        - uaa.offline_token
    scim:
      userids_enabled: true
      user:
        override: true
      users:
      - admin|coia6raakqwhrgga79sj|admin@admin.tld|first|last|clients.read,cloud_controller.admin,doppler.firehose,network.admin,openid,routing.router_groups.read,routing.router_groups.write,scim.read,scim.write|uaa
      groups:
        zones.read: Read identity zones
        zones.write: Create and update identity zones
        idps.read: Retrieve identity providers
        idps.write: Create and update identity providers
        clients.admin: Create, modify and delete OAuth clients
        clients.write: Create and modify OAuth clients
        clients.read: Read information about OAuth clients
        clients.secret: Change the password of an OAuth client
        scim.write: Create, modify and delete SCIM entities, i.e. users and groups
        scim.read: Read all SCIM entities, i.e. users and groups
        scim.create: Create users
        scim.userids: Read user IDs and retrieve users by ID
        scim.zones: Control a user's ability to manage a zone
        scim.invite: Send invitations to users
        password.write: Change your password
        oauth.approval: Manage approved scopes
        oauth.login: Authenticate users outside of the UAA
        openid: Access profile information, i.e. email, first and last name, and phone
          number
        groups.update: Update group information and memberships
        uaa.user: Act as a user in the UAA
        uaa.resource: Serve resources protected by the UAA
        uaa.admin: Act as an administrator throughout the UAA
        uaa.none: Forbid acting as a user
        uaa.offline_token: Allow offline access
    zones:
      internal:
        hostnames:
        - uaa.cf-system.svc.cluster.local
    uaa:
      url: https://uaa.vcap.me
      token:
        url: https://uaa.vcap.me/oauth/token
      approvals:
        url: https://uaa.vcap.me/approvals
      login:
        url: https://uaa.vcap.me/authenticate
      limitedFunctionality:
        enabled: false
        whitelist:
          endpoints:
          - /oauth/authorize/**
          - /oauth/token/**
          - /check_token/**
          - /login/**
          - /login.do
          - /logout/**
          - /logout.do
          - /saml/**
          - /autologin/**
          - /authenticate/**
          - /idp_discovery/**
          methods:
          - GET
          - HEAD
          - OPTIONS
  log4j2.properties: |-
    status = error
    dest = err
    name = UaaLog

    property.log_pattern=[%d{yyyy-MM-dd HH:mm:ss.SSS}] uaa%X{context} - %pid [%t] .... %5p --- %c{1}: %replace{%m}{(?<=password=|client_secret=)([^&]*)}{<redacted>}%n

    appender.uaaDefaultAppender.type = Console
    appender.uaaDefaultAppender.name = UaaDefaultAppender
    appender.uaaDefaultAppender.layout.type = PatternLayout
    appender.uaaDefaultAppender.layout.pattern = [UAA] ${log_pattern}

    appender.uaaAuditAppender.type = Console
    appender.uaaAuditAppender.name = UaaAuditAppender
    appender.uaaAuditAppender.layout.type = PatternLayout
    appender.uaaAuditAppender.layout.pattern = [UAA_AUDIT] ${log_pattern}

    rootLogger.level = info
    rootLogger.appenderRef.uaaDefaultAppender.ref = UaaDefaultAppender

    logger.UAAAudit.name = UAA.Audit
    logger.UAAAudit.level = info
    logger.UAAAudit.additivity = true
    logger.UAAAudit.appenderRef.auditEventLog.ref = UaaAuditAppender

    logger.cfIdentity.name = org.cloudfoundry.identity
    logger.cfIdentity.level = info
    logger.cfIdentity.additivity = false
    logger.cfIdentity.appenderRef.uaaDefaultAppender.ref = UaaDefaultAppender
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: uaa
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  selector:
    matchLabels:
      app: uaa-deployment
  replicas: 1
  template:
    metadata:
      labels:
        app: uaa-deployment
        app.kubernetes.io/name: uaa
        app.kubernetes.io/instance: uaa-standalone
        app.kubernetes.io/version: 74.12.0
        app.kubernetes.io/component: authorization_server
        app.kubernetes.io/part-of: uaa
        app.kubernetes.io/managed-by: kubectl
      namespace: cf-system
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      serviceAccountName: uaa
      initContainers:
      - name: build-uaa-truststore
        image: index.docker.io/cfidentity/uaa@sha256:a315e5fcbba36f7be09b9e762e2669e7de5a87880a1aa1e50f403bbf0bc28ba3
        command:
        - sh
        - -c
        - |
          find_keytool_or_fail_fast() {
            local has_keytool
            ls "${JAVA_HOME}"/bin/keytool
            has_keytool=$?

            if [ ${has_keytool} -ne 0 ]; then
              exit ${has_keytool}
            fi
          }

          import_cert() {
            local pemfile="${1}"
            local alias="${2}"

            echo "Adding ${pemfile} to truststore"

            # Have to use cat instead of -file
            # because keytool won't understand all of the filenames!
            cat "${pemfile}" | "${JAVA_HOME}"/bin/keytool \
              -noprompt \
              -import \
              -trustcacerts \
              -alias "${alias}" \
              -keystore "${TRUSTSTORE_FILE}" \
              -storepass "${TRUSTSTORE_PASSWORD}"
          }

          get_alias() {
            local pemfile="${1}"
            basename "${pemfile}" .pem
          }

          add_ca_certs() {
            local has_ca_certs
            ls ${SECRETS_DIR}/ca_certs/*.pem
            has_ca_certs=$?

            if [ ${has_ca_certs} -eq 0 ]; then
              for cert in ${SECRETS_DIR}/ca_certs/*.pem; do
                import_cert "${cert}" "$(get_alias $cert)"
              done
            fi
          }

          add_system_certs() {
            for cert in $OS_CERTS_DIR/*.pem; do
              import_cert "${cert}" "$(get_alias $cert)"
            done
          }

          main() {
            find_keytool_or_fail_fast
            add_ca_certs
            add_system_certs
          }

          main
        env:
        - name: SECRETS_DIR
          value: /etc/secrets
        - name: TRUSTSTORE_FILE
          value: /etc/truststore/uaa.pkcs12.truststore
        - name: TRUSTSTORE_PASSWORD
          value: changeit
        - name: JAVA_HOME
          value: /layers/paketo-buildpacks_bellsoft-liberica/jre
        - name: OS_CERTS_DIR
          value: /etc/ssl/certs
        volumeMounts:
        - name: ca-certs-files
          mountPath: /etc/secrets/ca_certs
          readOnly: true
        - name: truststore-file
          mountPath: /etc/truststore
      containers:
      - name: uaa
        image: index.docker.io/cfidentity/uaa@sha256:a315e5fcbba36f7be09b9e762e2669e7de5a87880a1aa1e50f403bbf0bc28ba3
        resources: {}
        ports:
        - name: http-uaa
          containerPort: 8080
          protocol: TCP
        env:
        - name: BPL_TOMCAT_ACCESS_LOGGING
          value: "y"
        - name: JAVA_OPTS
          value: -Dspring_profiles=postgresql -Djava.security.egd=file:/dev/./urandom
            -Dlogging.config=/etc/config/log4j2.properties -Dlog4j.configurationFile=/etc/config/log4j2.properties
            -DCLOUDFOUNDRY_CONFIG_PATH=/etc/config -DSECRETS_DIR=/etc/secrets -Djavax.net.ssl.trustStore=/etc/truststore/uaa.pkcs12.truststore
            -Djavax.net.ssl.trustStoreType=PKCS12 -Djavax.net.ssl.trustStorePassword=changeit
            -Dstatsd.enabled=true
        volumeMounts:
        - name: uaa-config
          mountPath: /etc/config
        - name: smtp-credentials-file
          mountPath: /etc/secrets/smtp_credentials.yml
          subPath: smtp_credentials.yml
          readOnly: true
        - name: database-credentials-file
          mountPath: /etc/secrets/database_credentials.yml
          subPath: database_credentials.yml
          readOnly: true
        - name: admin-client-credentials-file
          mountPath: /etc/secrets/admin_client_credentials.yml
          subPath: admin_client_credentials.yml
          readOnly: true
        - name: jwt-policy-signing-keys-file
          mountPath: /etc/secrets/jwt_policy_signing_keys.yml
          subPath: jwt_policy_signing_keys.yml
          readOnly: true
        - name: truststore-file
          mountPath: /etc/truststore
          readOnly: true
      volumes:
      - name: uaa-config
        configMap:
          name: uaa-config
      - name: smtp-credentials-file
        secret:
          optional: true
          secretName: uaa-smtp-credentials
      - name: database-credentials-file
        secret:
          optional: true
          secretName: uaa-database-credentials
      - name: admin-client-credentials-file
        secret:
          secretName: uaa-admin-client-credentials
      - name: jwt-policy-signing-keys-file
        secret:
          secretName: uaa-jwt-policy-signing-keys
      - name: ca-certs-files
        secret:
          optional: true
          secretName: uaa-ca-certs
      - name: truststore-file
        emptyDir: {}
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-admin-client-credentials
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  admin_client_credentials.yml: |
    oauth:
      clients:
        admin:
          secret: whqizmu0vdn00bbnf8gk
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-database-credentials
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
type: Opaque
stringData:
  database_credentials.yml: |
    database:
      username: uaa
      password: 80m9y4gw5yabj151xlj5
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-jwt-policy-signing-keys
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
stringData:
  jwt_policy_signing_keys.yml: |
    jwt:
      token:
        policy:
          activeKeyId: default_jwt_policy_key
          keys:
            default_jwt_policy_key:
              signingKey: |
                -----BEGIN RSA PRIVATE KEY-----
                MIIG5AIBAAKCAYEAvm2SULHjHvWl/iZJtydn0A0ZB4nEevAj19fEXGowVduTnEpF
                YlAFJ0NA1cBhD+RUDQGg4EjxEhqGZH5oDjq98k6lss2tJHlXNcPALlGvy4vbY3HG
                vCre0B2nNCmdW8WmL2rQ4JjpIZwKi5ALWbQlxx6nopgqUGDwOMgK1c1ae2Y4Ol6G
                zvqs2JkHjYlFPa7Z98u0ak0v06Tm/kDKltMwwY3aFKMuvzZk7ucYQYoUR3VfIf5k
                5cXJCVPz8qnTy0QhoiJFs68KmQSlh7Wla2m3l3T8oIgLJvwcq8tcHACVr56BkThV
                tKDqrAzjk2qDCDjAZIvDlRCYAu8iZpNu35+/jtap4Q48tipmOIXts5Zmq8yVQ6zY
                sOo0ZYpaIzvZ1BXz8YqbSElFBykhR2rNvRoUga6Jg4T4jR88k07kXFuU0l8fBC1t
                WIqOiJZ+waYK+Pa6jqgQS3KEh/1arskA+uAYGx8UCYjL2VF4IoKB+UOvI/B7GcPU
                jtsMYqIr2ga7uZCdAgMBAAECggGBAItg55bonLQsWDKNE6da0EEXVRqPW6Af5Bw3
                cSGzF23AKWpbci1jJGJ4dxv8kw5usJZUesuul8QIZhVn8AF6PUz9A4q7v97ScWKI
                xEEiyOjSlOFUhYF0X2E0Uw166BIjuF88b2X0ha5z58P+yk/96yiy5z+64D20th7Z
                TBTxGSj4yG7wgPs9vwVJ/J07u9JKCH+2OXcUx8zBBdFS2vVJ3oXMrbItPin2RioW
                O0q9JdqnrdnTuUX0XhDVwdf7NWmxkyi2LQAoilz+tc4X1NvSkZxn111gqw2NTeuJ
                4AIRB0vTzx5kijcRXrdPRmm9cG9h8TvUg2iiontWwbmpgSfLo6oPYL9ecFSzNtDd
                7z7InHYm2uiWtdIcmpJArHBEq9NLeyhmo/JTFoY52Potez/FThv82kprUWDZ+Ihj
                CCd/l5WOudN0OZuXSXRCx++fbDSocgsyBcZnjkPz5Y9pKWp9+C9/ipo5YOxyy/+M
                w1o3ma4lhWyWFNk2Zbd8zO606Dw8AQKBwQDQTdUB76W3mVuLtxg7nBd/MbX7CVvK
                kjO3HkDdrR2BYu1dre/Z9hu9vDkcisyTUuL+t9y1vaYYcWXOKv/wrST+eLc0PYoU
                8MjxPg42QTb5cH3sZ0DySSrNFQ00QsE0NUx3caEXvzy5xSOTwwO65wAcO72H3gRr
                pN8iNMm074Ft2cVnXA860aL9UzlyVcyDTXc+vrLm7gdEz88nIax64/GNS4S1QcyB
                Pb+QNO4YdextdMiSzCQAT7LxE02l2zSY8QkCgcEA6gfmaeekYaB44XNZgZFEpbQ6
                JtF388QbNBRd9HU76W8ufWI38AnRGtBr/vckB4ATjA1JxP3WQqZl7AfMmX03ZTqJ
                6GwGNckCMB1ZGlLSHZeaP0S/UZKfzZiouRX6nCqyIUg3tUiThixSIZqGTww9CP9m
                q94jXz1ugdy0pE6JHkvivNl+0lFmccBNaLhxPrr9BDvumLSKAnDII6sgIt7DFn62
                pFoml6xErzQdqSf/TypNKGENuKrHWiXQet0EY4v1AoHBAMMMznNEqsEzqeQ260sO
                C3Z/3u6VQc16f1Bt1MF+U82PC8MXlytaZ3mP4U6XrZ4aFBH9qn7HedsTfAfEfeoo
                xyY9dRdGtKCNIyu6NuaYxFhn/JG70bXNy3VDzBxukalIazTBQt4QpVUygvDewARo
                P9MwIXYy76K4PHQ0R9fUGTb6nvz82An0uRFKt9UXACzHAezP9oeExWuqx0fWIULl
                ZI8w8rAjT9KJNnJbDcP70ApiO1oyK1fbSSyyLZgrnaHEuQKBwElWSm0bitaRC/BS
                TlUc6a8niCWL9JPt+zxZuYuWhTzEe4QNGExfNyi48W7HkYHML9PughR6Gv9t13ic
                hRAAPjC5pGeyGkwWfloHiFmIZJGjZVG4QF/Wm784vH6rlYoEkyd80wA7Cwe7sc0X
                +EijJClCp7Dp/pmkzZFiUTU/6xYUX6wgV+6eVYUF5vwO+GXZANqn0UAHK0xSfVU4
                Fez3c5kEAkYEfh1/fVKN+VF92DK9pcomh787vRbRzMADrJFpVQKBwEIwALs3GBoQ
                7TRpnYm98Mug4+axAOVCNTOK4ikx4uWzuD2czcCqIDxIoUljubHZmH9sSzOMwi/Q
                3i2kEuyCF/peNx+us0WeZVxXqMJA/ity/Lbx4oLzg3AgwgxzyQwvPOq+gBWTPUAa
                QxHiksDZ4CHn8X9pQb31bun6ttLKPvBzYrB9E0ssHUQchJ5gjapSVlv5ZxYy4JwW
                zzNbHhn18kcPbaiMRY3ov06O6HH1gm6B7iK2+4cHri7BS4NLGNheHQ==
                -----END RSA PRIVATE KEY-----
---
apiVersion: v1
kind: Service
metadata:
  name: uaa
  labels:
    app: uaa-deployment
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
  namespace: cf-system
spec:
  type: ClusterIP
  ports:
  - port: 8080
    name: http-uaa
    targetPort: 8080
    protocol: TCP
  selector:
    app: uaa-deployment
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: uaa
  namespace: cf-system
  labels:
    app.kubernetes.io/name: uaa
    app.kubernetes.io/instance: uaa-standalone
    app.kubernetes.io/version: 74.12.0
    app.kubernetes.io/component: authorization_server
    app.kubernetes.io/part-of: uaa
    app.kubernetes.io/managed-by: kubectl
automountServiceAccountToken: false
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: uaa-external-virtual-service
  namespace: cf-system
spec:
  hosts:
  - uaa.vcap.me
  - '*.uaa.vcap.me'
  - login.vcap.me
  - '*.login.vcap.me'
  gateways:
  - cf-system/istio-ingressgateway
  http:
  - route:
    - destination:
        host: uaa.cf-system.svc.cluster.local
        port:
          number: 8080
---
apiVersion: v1
kind: Secret
metadata:
  name: uaa-certs
  namespace: cf-system
  annotations:
    kapp.k14s.io/versioned: ""
type: Opaque
data:
  uaa.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNUFJQkFBS0NBWUVBdGRyRk11SkRLbDlOSERkUFl3c21yMnJsTExwVDBxOG80YldGenNYblJEcUtlTHIrCkl2c0NXMi9mTnY1QzBKWnRVU0FCRmVzMy81Wk1aYnVLRmJlaXlNNVhpV1BwWnJ3MUNFOFlxQ2xEalRPdElnbXoKV3ZEVFB2c3lyY05kOGxGK3RkNmFWQVFDeFo4VkF0anQ3aldTRFNCZ0VUTXYrUkZDUGFhbUlwT1hWMlVzZGtYeQpZQjF2N1RvZ2dXVHRGKzAvVllWdG5CdXh4QWNJbzgxaHZWUGFiOG1YQmxWVlRtSzlwaDFOZU4xa2RrbTBaNjFaCnNtaDFsTEVsMmhvS2pYMjdhai96NDN4cFpXSWg2UHJUQ3BURk9vQnJsWGhVZzJNT04rZGh0c0h6QVJOckY2dFkKV1lHR1ZaajhYOCtFRk4zQUxpKy9wRUEzZFpSRkYwT3IxL3pkOUcwa21YNlBhNHdUWFJ0OWgvWGJRaGlhQmdNZAprYkphRFNHaVRSUnVJRXcrL2VWZnc3dEd0NjUySVA0ZGVOYmRCQVp6R0hIdmRGQnlxK0lXMFM4eDZWUHdnMUc2CjBTZTRBUUNoQmVnUmdDWVMrWXQ1amVyUGE1UVdzZTFqMm02cmZVa3A4eTdHWnA4Q1N6WWZrb284VnJBRDhFL2gKM0NoaVk4SWxPcXc0ZnlFekFnTUJBQUVDZ2dHQkFKL1RPOGp5cmxFSkhQNFZaa0lIeE9JYXNudlM3bVNWNlBvbAp6UW5qU05QZ0YxN3dDUGE1WUdMNE9WZGRzMThiTmN3OHNuZVBHTklhUjk2SktselgzY3RaL2ZrVHhFZTBWVytPCkJIK1dkSFllMnFTMW5kbnBHZCthYWZucFlDSGRtZDFCWEtWR09TRnlKTWN4M0Rxay9rMW5ETWRSRTNKMHhxRGsKVzlLN29DRUJIRWgrUlB4UUl0UjlaNkFSRVljYnpiUGQ1bTF5c1pNMUUxVFM1bm04dnBmTXRseXNscUtqaVVYNwpMdUZ3d2lCcnVvLzcvSDhkNjJqWklBbEZKYzBnbUNCSDdLME1Ia3VqRENlV0Q0N2JWdWlDOTNoR0xzd3dGT1NiCkprSVB2YkV5aDJDVWV6aUZFMUsyYTVvZWdpVldicmY1MnBVWTNVUWlicjhyNUtrc0lGZDNNM1FUNk9iQm95OE4KWTV3L0tldzBoMjJIYkcyZDVQYWFnQXgvMEpCVE9SV3lKK2R5MXVjVkVvYi91UkloOWEraytLOGhaSHE5RVpQNwpxaXhFazN4SllMQ21qTkpUVmo5OWJ5MTlaRHRWKzAxOVZBRUt2c2VMYzM5UWppb3FQeTZqaUtrbEsxRnYrem9lCkV6TEZnNHgyYVFMdmlLWDJZWWxHTmtaY0QwRE8wUUtCd1FES1dOMjlWeWNuMEhVTHlDS1M5VlNXWnlXTUxVay8KM2swU3daTE8yZkFrbzNqWUs0a3lvZVhGbGk5RzJhVk55dkkrRDhKT1RYR2hkYm1EaEVhd0ZGa0EvZ01TR1kwagppMmNuRUlSaVB1dlVpTkh6Nll6ZGVRMlovelNxbHNJTDNUVWVLYWdiNXN5eHdPTmdxL004SmpVU2RvY01uWkkxClBuTi9mbUZGdlRtMmpxUUdsc0pUcXFnNkw2SXZBVEVPdU1YUlhjZys3ZHkvZWFYdi9oYUtQdkVrR0FrMjlMQWkKVzh2WjV6RGg5R2phK3BCM3F0SGNQa2x0ZHc2RmpxMENZaVVDZ2NFQTVoTGpZeXFXRitpUEowNW8zcDR5VWN0UQp2Z1ZkbnRubU9BbDd3RDRoZlRUU1dVTENVZjVrdG1lUERyRmkvTUw2ck8zUkJOUDJFTm9GKzYrcGVUa2c5VWo3CnZEZU4yUHVvMGozRnBSb3NhMmlRWTNWNjBHMkZKSkMwYWp0V0Zja3RldUU3U2VCeTV6dlY0ZFVGeGpPTTNtNEMKSUdQUjRZVzdrMFI5VnE4NTRIUHd4TE5mYkZjdXBTZUhZZDkvKzdCSFZqMVFMTFUvbTJQOExCMnljVUxsVy9yYwp5SUR1akFsN3R6ZFJHM0t4ejZIRGlnZVZWTHNJRENjcEd3ZFFrTnAzQW9IQVB3VDhVbXJoVkFJVllnejd6NTgrCnIvVUIrYTFsQWRJL1dOY1czUHQ5VWp2amVCZmZDL2ptTWVwN1lPcUtGRGRmeUxwcHZxOVo4M3BSdzhjZnFOazkKZXhTaGFqS3hCVi8yU1hGWWVheTFFQ1ZvbGptbjJKWktDU3MxZ09laEdjYlVNMGV3QnJpVUNjeFVSSmhwRWRPbwpkYzZhY3ZCa1I5YmlhOU8xZ2QzVUtxbzBKYVV3Y3BSVS9vSTFWY1JlUGdLSUFaUGV1TkttRExCYllPcFdwTW5ECm1vVXQ0WUxGbEgzWWVFNExxR1BSZ0ZuSFFxM2QzR1U5d3l6d1JlSlF1Y3hOQW9IQkFKaTBMS3dqRmQva2dTOUwKZ1p0UVVJR3RlbmZFdy9DdEczcFNBUXNGc2VDU2NKTENGb3VwVjFzaHZQZTVrTVBHL2U1TkloQWNSeFBFUVhoZApqUlJpY0plY3kwaVBidHgzbkFOKzhIRzJ2NGpDckNMM1ZINkdVbnFFZU5xUmEzK21PVU4zdm93NEpzdUhFVnlFCnNRSnVNSzlwUUl3UzlMakV0RXo0aG1CRWlSdUttR0ZWMUozcDk1R3lmTTdmTXVqd2hVaWVCVnJIS2VLUEtFNTMKbjNwQk5rNG9ZT1hMZllrQXVsWk9wc3liQVoyWDlscmswWjZkVEtnVVRkb2Nyc0tWM1FLQndFdU9PaC8xODAyego4cERiYjhhVnZ6QVkwQ29Xb1VVYnZKdXhIWDlvUVNRb3lsMS9vUFBSWVBkd3RuSWNDdlV3NmRZV29ab0RKbGdIClp3cy9RYW9mMXp2ZnNpdzhYa3FHR1d6QTArV0lVcWJTR3BodkFaeXdkUnFOT3NFT3IxZGkrdFlQc1BTV0N4ZSsKc3JLVWRJUFpiaHRkcGxrM1pJd2wwZk9BeUtuOEp6VENlYTNqV0NrQjVSQUJJWHQxTlRzWTNhdFhwVDFpUENHNApRRzJVWFNQUVh4OWNYQUdqVmJreDZRTzRVRTIzTE43VHh0VkRmUFJyZGNDU3hXMUVaMkM3QUE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
  uaa.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVzekNDQXh1Z0F3SUJBZ0lRTW8wUDAyVlRwbjlkQ0l2SnBYUkRrREFOQmdrcWhraUc5dzBCQVFzRkFEQXoKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEN6QUpCZ05WQkFNVApBbU5oTUI0WERUSXdNRFl5T0RFNU1ETXhPRm9YRFRJeE1EWXlPREU1TURNeE9Gb3dUakVNTUFvR0ExVUVCaE1EClZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1TWXdKQVlEVlFRRERCMHFMbU5tTFhONWMzUmwKYlM1emRtTXVZMngxYzNSbGNpNXNiMk5oYkRDQ0FhSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnR1BBRENDQVlvQwpnZ0dCQUxYYXhUTGlReXBmVFJ3M1QyTUxKcTlxNVN5NlU5S3ZLT0cxaGM3RjUwUTZpbmk2L2lMN0FsdHYzemIrClF0Q1diVkVnQVJYck4vK1dUR1c3aWhXM29zak9WNGxqNldhOE5RaFBHS2dwUTQwenJTSUpzMXJ3MHo3N01xM0QKWGZKUmZyWGVtbFFFQXNXZkZRTFk3ZTQxa2cwZ1lCRXpML2tSUWoybXBpS1RsMWRsTEhaRjhtQWRiKzA2SUlGawo3UmZ0UDFXRmJad2JzY1FIQ0tQTlliMVQybS9KbHdaVlZVNWl2YVlkVFhqZFpIWkp0R2V0V2JKb2RaU3hKZG9hCkNvMTl1Mm8vOCtOOGFXVmlJZWo2MHdxVXhUcUFhNVY0VklOakRqZm5ZYmJCOHdFVGF4ZXJXRm1CaGxXWS9GL1AKaEJUZHdDNHZ2NlJBTjNXVVJSZERxOWY4M2ZSdEpKbCtqMnVNRTEwYmZZZjEyMElZbWdZREhaR3lXZzBob2swVQpiaUJNUHYzbFg4TzdScmV1ZGlEK0hYalczUVFHY3hoeDczUlFjcXZpRnRFdk1lbFQ4SU5SdXRFbnVBRUFvUVhvCkVZQW1Fdm1MZVkzcXoydVVGckh0WTlwdXEzMUpLZk11eG1hZkFrczJINUtLUEZhd0EvQlA0ZHdvWW1QQ0pUcXMKT0g4aE13SURBUUFCbzRHbk1JR2tNQTRHQTFVZER3RUIvd1FFQXdJRm9EQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRgpCUWNEQWdZSUt3WUJCUVVIQXdFd0RBWURWUjBUQVFIL0JBSXdBREFkQmdOVkhRNEVGZ1FVaElqODVnS292VndJCjNRQnNOejJLYVVBc0w1UXdId1lEVlIwakJCZ3dGb0FVYlNuckNXNTdScXdxWXFDNlNHNERUdlZsY1Znd0pRWUQKVlIwUkJCNHdISUlhS2k1b1lYSmliM0l1YzNaakxtTnNkWE4wWlhJdWJHOWpZV3d3RFFZSktvWklodmNOQVFFTApCUUFEZ2dHQkFDdng0a25WY2IwSUF6OHZpaWIvb3BGS2hFNEZjYVFUR2lVNnhXVlhjUUFkc1E3ZGhrMXJiYWlVCmdCdjFQM1FjNVNqZGlDTjZoU25BazJzYUt6c09DUHdrMTZqK1gvcFljOFN1c2RTYVFvTHhJUHhES1JPVkV2YUYKZk5nYU9jTy81cXBsYTlQK3RwMEVVQkxRNEhrblR2SEZNTVl2YTc4UERyaTJ1Y0dlUXRCVDd5SlZVRE5FT0Z0agpiQ25Ld1RPMUVxU1lIZ0FnUjE3dE8zazNibUlqQW5Bb2EzS0ZHWVdDM1ZwTWs2ZnowK01tcDhVeVFGYTExNHF4CmpoUjRXQWlqRGlYcG1Vb3c1amJ1R3V3SDNtZklKa25UNSt1R0RsZkg2ZmRBeXpOS0wzVUI3NnZzSW1LVy9MdnkKOGRFbzRETjBnT3IrZGNDNmhlTG5jRWN2MXhsamZNQ1RPZDZEdEc0OGx5eUQ2VkJtRTAxaDByRy9CVWg1VTdNKwpYOXVKV09LUHc5VVVxYkJ5VnNoSjhOYjg5cFhzWm80WmYwUDRQSkQvd3ZJMG9HeDJFb1pMcG04TThvV3pLYTRyCkhZUmlJaDhoZDg1aU1IRVRhUUJUK3kwRFlzRmJwYTFHY3NVQVJvc1JGMjFNZlpqVHBYd0xYelN2dzJkUlc5cjIKU1hCV0EvNk4vdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
---
apiVersion: v1
kind: Namespace
metadata:
  name: cf-workloads
  annotations:
    kapp.k14s.io/change-rule.cf-workloads-namespace: delete before deleting cf-k8s-networking/routecontroller
  labels:
    istio-injection: enabled
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: system:aggregated-metrics-reader
  labels:
    rbac.authorization.k8s.io/aggregate-to-view: "true"
    rbac.authorization.k8s.io/aggregate-to-edit: "true"
    rbac.authorization.k8s.io/aggregate-to-admin: "true"
rules:
- apiGroups:
  - metrics.k8s.io
  resources:
  - pods
  - nodes
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: metrics-server:system:auth-delegator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:auth-delegator
subjects:
- kind: ServiceAccount
  name: metrics-server
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: metrics-server-auth-reader
  namespace: kube-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: extension-apiserver-authentication-reader
subjects:
- kind: ServiceAccount
  name: metrics-server
  namespace: kube-system
---
apiVersion: apiregistration.k8s.io/v1beta1
kind: APIService
metadata:
  name: v1beta1.metrics.k8s.io
spec:
  service:
    name: metrics-server
    namespace: kube-system
  group: metrics.k8s.io
  version: v1beta1
  insecureSkipTLSVerify: true
  groupPriorityMinimum: 100
  versionPriority: 100
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: metrics-server
  namespace: kube-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: metrics-server
  namespace: kube-system
  labels:
    k8s-app: metrics-server
  annotations:
    kapp.k14s.io/change-rule.istio-sidecar-injector: upsert after upserting cf-for-k8s.cloudfoundry.org/istio-sidecar-injector
spec:
  selector:
    matchLabels:
      k8s-app: metrics-server
  template:
    metadata:
      name: metrics-server
      labels:
        k8s-app: metrics-server
      annotations:
        sidecar.istio.io/proxyCPU: 0m
        sidecar.istio.io/proxyMemory: 0M
    spec:
      serviceAccountName: metrics-server
      volumes:
      - name: tmp-dir
        emptyDir: {}
      containers:
      - name: metrics-server
        image: oratos/metrics-server:v0.3.6@sha256:a37da13de7b74c373e8698dee7836ce5fdbd102c3c1c8b9953a95e7f20138ab6
        imagePullPolicy: IfNotPresent
        args:
        - --cert-dir=/tmp
        - --secure-port=4443
        - --kubelet-insecure-tls
        - --kubelet-preferred-address-types=InternalIP
        ports:
        - name: main-port
          containerPort: 4443
          protocol: TCP
        securityContext:
          readOnlyRootFilesystem: true
          runAsNonRoot: true
          runAsUser: 1000
        volumeMounts:
        - name: tmp-dir
          mountPath: /tmp
      nodeSelector:
        kubernetes.io/os: linux
        kubernetes.io/arch: amd64
---
apiVersion: v1
kind: Service
metadata:
  name: metrics-server
  namespace: kube-system
  labels:
    kubernetes.io/name: Metrics-server
    kubernetes.io/cluster-service: "true"
spec:
  selector:
    k8s-app: metrics-server
  ports:
  - port: 443
    protocol: TCP
    targetPort: main-port
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: system:metrics-server
rules:
- apiGroups:
  - ""
  resources:
  - pods
  - nodes
  - nodes/stats
  - namespaces
  - configmaps
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: system:metrics-server
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:metrics-server
subjects:
- kind: ServiceAccount
  name: metrics-server
  namespace: kube-system
---
apiVersion: v1
kind: Secret
metadata:
  name: harbor-internal-tls-certs
  namespace: harbor
  annotations:
    kapp.k14s.io/versioned: ""
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVzekNDQXh1Z0F3SUJBZ0lRTW8wUDAyVlRwbjlkQ0l2SnBYUkRrREFOQmdrcWhraUc5dzBCQVFzRkFEQXoKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEN6QUpCZ05WQkFNVApBbU5oTUI0WERUSXdNRFl5T0RFNU1ETXhPRm9YRFRJeE1EWXlPREU1TURNeE9Gb3dUakVNTUFvR0ExVUVCaE1EClZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1TWXdKQVlEVlFRRERCMHFMbU5tTFhONWMzUmwKYlM1emRtTXVZMngxYzNSbGNpNXNiMk5oYkRDQ0FhSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnR1BBRENDQVlvQwpnZ0dCQUxYYXhUTGlReXBmVFJ3M1QyTUxKcTlxNVN5NlU5S3ZLT0cxaGM3RjUwUTZpbmk2L2lMN0FsdHYzemIrClF0Q1diVkVnQVJYck4vK1dUR1c3aWhXM29zak9WNGxqNldhOE5RaFBHS2dwUTQwenJTSUpzMXJ3MHo3N01xM0QKWGZKUmZyWGVtbFFFQXNXZkZRTFk3ZTQxa2cwZ1lCRXpML2tSUWoybXBpS1RsMWRsTEhaRjhtQWRiKzA2SUlGawo3UmZ0UDFXRmJad2JzY1FIQ0tQTlliMVQybS9KbHdaVlZVNWl2YVlkVFhqZFpIWkp0R2V0V2JKb2RaU3hKZG9hCkNvMTl1Mm8vOCtOOGFXVmlJZWo2MHdxVXhUcUFhNVY0VklOakRqZm5ZYmJCOHdFVGF4ZXJXRm1CaGxXWS9GL1AKaEJUZHdDNHZ2NlJBTjNXVVJSZERxOWY4M2ZSdEpKbCtqMnVNRTEwYmZZZjEyMElZbWdZREhaR3lXZzBob2swVQpiaUJNUHYzbFg4TzdScmV1ZGlEK0hYalczUVFHY3hoeDczUlFjcXZpRnRFdk1lbFQ4SU5SdXRFbnVBRUFvUVhvCkVZQW1Fdm1MZVkzcXoydVVGckh0WTlwdXEzMUpLZk11eG1hZkFrczJINUtLUEZhd0EvQlA0ZHdvWW1QQ0pUcXMKT0g4aE13SURBUUFCbzRHbk1JR2tNQTRHQTFVZER3RUIvd1FFQXdJRm9EQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRgpCUWNEQWdZSUt3WUJCUVVIQXdFd0RBWURWUjBUQVFIL0JBSXdBREFkQmdOVkhRNEVGZ1FVaElqODVnS292VndJCjNRQnNOejJLYVVBc0w1UXdId1lEVlIwakJCZ3dGb0FVYlNuckNXNTdScXdxWXFDNlNHNERUdlZsY1Znd0pRWUQKVlIwUkJCNHdISUlhS2k1b1lYSmliM0l1YzNaakxtTnNkWE4wWlhJdWJHOWpZV3d3RFFZSktvWklodmNOQVFFTApCUUFEZ2dHQkFDdng0a25WY2IwSUF6OHZpaWIvb3BGS2hFNEZjYVFUR2lVNnhXVlhjUUFkc1E3ZGhrMXJiYWlVCmdCdjFQM1FjNVNqZGlDTjZoU25BazJzYUt6c09DUHdrMTZqK1gvcFljOFN1c2RTYVFvTHhJUHhES1JPVkV2YUYKZk5nYU9jTy81cXBsYTlQK3RwMEVVQkxRNEhrblR2SEZNTVl2YTc4UERyaTJ1Y0dlUXRCVDd5SlZVRE5FT0Z0agpiQ25Ld1RPMUVxU1lIZ0FnUjE3dE8zazNibUlqQW5Bb2EzS0ZHWVdDM1ZwTWs2ZnowK01tcDhVeVFGYTExNHF4CmpoUjRXQWlqRGlYcG1Vb3c1amJ1R3V3SDNtZklKa25UNSt1R0RsZkg2ZmRBeXpOS0wzVUI3NnZzSW1LVy9MdnkKOGRFbzRETjBnT3IrZGNDNmhlTG5jRWN2MXhsamZNQ1RPZDZEdEc0OGx5eUQ2VkJtRTAxaDByRy9CVWg1VTdNKwpYOXVKV09LUHc5VVVxYkJ5VnNoSjhOYjg5cFhzWm80WmYwUDRQSkQvd3ZJMG9HeDJFb1pMcG04TThvV3pLYTRyCkhZUmlJaDhoZDg1aU1IRVRhUUJUK3kwRFlzRmJwYTFHY3NVQVJvc1JGMjFNZlpqVHBYd0xYelN2dzJkUlc5cjIKU1hCV0EvNk4vdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCg==
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNUFJQkFBS0NBWUVBdGRyRk11SkRLbDlOSERkUFl3c21yMnJsTExwVDBxOG80YldGenNYblJEcUtlTHIrCkl2c0NXMi9mTnY1QzBKWnRVU0FCRmVzMy81Wk1aYnVLRmJlaXlNNVhpV1BwWnJ3MUNFOFlxQ2xEalRPdElnbXoKV3ZEVFB2c3lyY05kOGxGK3RkNmFWQVFDeFo4VkF0anQ3aldTRFNCZ0VUTXYrUkZDUGFhbUlwT1hWMlVzZGtYeQpZQjF2N1RvZ2dXVHRGKzAvVllWdG5CdXh4QWNJbzgxaHZWUGFiOG1YQmxWVlRtSzlwaDFOZU4xa2RrbTBaNjFaCnNtaDFsTEVsMmhvS2pYMjdhai96NDN4cFpXSWg2UHJUQ3BURk9vQnJsWGhVZzJNT04rZGh0c0h6QVJOckY2dFkKV1lHR1ZaajhYOCtFRk4zQUxpKy9wRUEzZFpSRkYwT3IxL3pkOUcwa21YNlBhNHdUWFJ0OWgvWGJRaGlhQmdNZAprYkphRFNHaVRSUnVJRXcrL2VWZnc3dEd0NjUySVA0ZGVOYmRCQVp6R0hIdmRGQnlxK0lXMFM4eDZWUHdnMUc2CjBTZTRBUUNoQmVnUmdDWVMrWXQ1amVyUGE1UVdzZTFqMm02cmZVa3A4eTdHWnA4Q1N6WWZrb284VnJBRDhFL2gKM0NoaVk4SWxPcXc0ZnlFekFnTUJBQUVDZ2dHQkFKL1RPOGp5cmxFSkhQNFZaa0lIeE9JYXNudlM3bVNWNlBvbAp6UW5qU05QZ0YxN3dDUGE1WUdMNE9WZGRzMThiTmN3OHNuZVBHTklhUjk2SktselgzY3RaL2ZrVHhFZTBWVytPCkJIK1dkSFllMnFTMW5kbnBHZCthYWZucFlDSGRtZDFCWEtWR09TRnlKTWN4M0Rxay9rMW5ETWRSRTNKMHhxRGsKVzlLN29DRUJIRWgrUlB4UUl0UjlaNkFSRVljYnpiUGQ1bTF5c1pNMUUxVFM1bm04dnBmTXRseXNscUtqaVVYNwpMdUZ3d2lCcnVvLzcvSDhkNjJqWklBbEZKYzBnbUNCSDdLME1Ia3VqRENlV0Q0N2JWdWlDOTNoR0xzd3dGT1NiCkprSVB2YkV5aDJDVWV6aUZFMUsyYTVvZWdpVldicmY1MnBVWTNVUWlicjhyNUtrc0lGZDNNM1FUNk9iQm95OE4KWTV3L0tldzBoMjJIYkcyZDVQYWFnQXgvMEpCVE9SV3lKK2R5MXVjVkVvYi91UkloOWEraytLOGhaSHE5RVpQNwpxaXhFazN4SllMQ21qTkpUVmo5OWJ5MTlaRHRWKzAxOVZBRUt2c2VMYzM5UWppb3FQeTZqaUtrbEsxRnYrem9lCkV6TEZnNHgyYVFMdmlLWDJZWWxHTmtaY0QwRE8wUUtCd1FES1dOMjlWeWNuMEhVTHlDS1M5VlNXWnlXTUxVay8KM2swU3daTE8yZkFrbzNqWUs0a3lvZVhGbGk5RzJhVk55dkkrRDhKT1RYR2hkYm1EaEVhd0ZGa0EvZ01TR1kwagppMmNuRUlSaVB1dlVpTkh6Nll6ZGVRMlovelNxbHNJTDNUVWVLYWdiNXN5eHdPTmdxL004SmpVU2RvY01uWkkxClBuTi9mbUZGdlRtMmpxUUdsc0pUcXFnNkw2SXZBVEVPdU1YUlhjZys3ZHkvZWFYdi9oYUtQdkVrR0FrMjlMQWkKVzh2WjV6RGg5R2phK3BCM3F0SGNQa2x0ZHc2RmpxMENZaVVDZ2NFQTVoTGpZeXFXRitpUEowNW8zcDR5VWN0UQp2Z1ZkbnRubU9BbDd3RDRoZlRUU1dVTENVZjVrdG1lUERyRmkvTUw2ck8zUkJOUDJFTm9GKzYrcGVUa2c5VWo3CnZEZU4yUHVvMGozRnBSb3NhMmlRWTNWNjBHMkZKSkMwYWp0V0Zja3RldUU3U2VCeTV6dlY0ZFVGeGpPTTNtNEMKSUdQUjRZVzdrMFI5VnE4NTRIUHd4TE5mYkZjdXBTZUhZZDkvKzdCSFZqMVFMTFUvbTJQOExCMnljVUxsVy9yYwp5SUR1akFsN3R6ZFJHM0t4ejZIRGlnZVZWTHNJRENjcEd3ZFFrTnAzQW9IQVB3VDhVbXJoVkFJVllnejd6NTgrCnIvVUIrYTFsQWRJL1dOY1czUHQ5VWp2amVCZmZDL2ptTWVwN1lPcUtGRGRmeUxwcHZxOVo4M3BSdzhjZnFOazkKZXhTaGFqS3hCVi8yU1hGWWVheTFFQ1ZvbGptbjJKWktDU3MxZ09laEdjYlVNMGV3QnJpVUNjeFVSSmhwRWRPbwpkYzZhY3ZCa1I5YmlhOU8xZ2QzVUtxbzBKYVV3Y3BSVS9vSTFWY1JlUGdLSUFaUGV1TkttRExCYllPcFdwTW5ECm1vVXQ0WUxGbEgzWWVFNExxR1BSZ0ZuSFFxM2QzR1U5d3l6d1JlSlF1Y3hOQW9IQkFKaTBMS3dqRmQva2dTOUwKZ1p0UVVJR3RlbmZFdy9DdEczcFNBUXNGc2VDU2NKTENGb3VwVjFzaHZQZTVrTVBHL2U1TkloQWNSeFBFUVhoZApqUlJpY0plY3kwaVBidHgzbkFOKzhIRzJ2NGpDckNMM1ZINkdVbnFFZU5xUmEzK21PVU4zdm93NEpzdUhFVnlFCnNRSnVNSzlwUUl3UzlMakV0RXo0aG1CRWlSdUttR0ZWMUozcDk1R3lmTTdmTXVqd2hVaWVCVnJIS2VLUEtFNTMKbjNwQk5rNG9ZT1hMZllrQXVsWk9wc3liQVoyWDlscmswWjZkVEtnVVRkb2Nyc0tWM1FLQndFdU9PaC8xODAyego4cERiYjhhVnZ6QVkwQ29Xb1VVYnZKdXhIWDlvUVNRb3lsMS9vUFBSWVBkd3RuSWNDdlV3NmRZV29ab0RKbGdIClp3cy9RYW9mMXp2ZnNpdzhYa3FHR1d6QTArV0lVcWJTR3BodkFaeXdkUnFOT3NFT3IxZGkrdFlQc1BTV0N4ZSsKc3JLVWRJUFpiaHRkcGxrM1pJd2wwZk9BeUtuOEp6VENlYTNqV0NrQjVSQUJJWHQxTlRzWTNhdFhwVDFpUENHNApRRzJVWFNQUVh4OWNYQUdqVmJreDZRTzRVRTIzTE43VHh0VkRmUFJyZGNDU3hXMUVaMkM3QUE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQoK
  tls.ca: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVVekNDQXJ1Z0F3SUJBZ0lRZmJZSFdnd0FtS1BiWjNGcWcrR3dmREFOQmdrcWhraUc5dzBCQVFzRkFEQXoKTVF3d0NnWURWUVFHRXdOVlUwRXhGakFVQmdOVkJBb1REVU5zYjNWa0lFWnZkVzVrY25reEN6QUpCZ05WQkFNVApBbU5oTUI0WERUSXdNRFl5T0RFNU1ETXhOVm9YRFRJeE1EWXlPREU1TURNeE5Wb3dNekVNTUFvR0ExVUVCaE1EClZWTkJNUll3RkFZRFZRUUtFdzFEYkc5MVpDQkdiM1Z1WkhKNU1Rc3dDUVlEVlFRREV3SmpZVENDQWFJd0RRWUoKS29aSWh2Y05BUUVCQlFBRGdnR1BBRENDQVlvQ2dnR0JBSlMvYWJGNmh3US82Rjh5eVdNOWhqNEI0ZEo2d1dHZQptZ3pwb3p1dCtQanFNOUFTT3FsNXkwVThUU2JRSVlBMDlEU2FwNldBQ2puTHBCUVdKcW9wM2EvWXJxOTRyZHo5CmJZLzFrWUJJbE54dlNZRUw4QjgwTDY4UGtiWXVYc1dFTDB1RFFhc2F3Sjd3ZG1CbUYrWW90Y1BQTHc5WS9hM1IKaFF0c0FhajIrdHFmZnZmRU00djZpWkcvQkNxcnNlUk9hdzRVZnVGbE85TytnMDZZbCt0K3VRRHZYak50bnFGUwpteUZQalJleXFHYm5PVVVKNWFCQjZsTndTZjI4WWtDMTlwb1dRTXZKL2FGNjJQeGFpQVExU2JYc3hEeW9CenNQCkRzc3BNL04vQjEyc3F5b3Jqdm1xUXNQSkNhUWN0WGVZU2JoYXR5L1U5YnprTnlVbXBIWmFVOU90ZkN6SjA1UmgKNVA4SjZQTGQ4b2w3L2k0L0JRY0ZyR0VVRG12Smw4c3V5d2c5Yk9wSlFGS3pFOEpkMTA5aUxxSnpRN3EwcGlVKwo5YVNKbnRuTitPYitacmJzVmdXOE5FRGxGYmZJRWVNTVpDRlVqNG1HQTdva3h1MDNNMjlkdGJ0VHlGSjNxNC94ClpTdUIxMEJSSTN3elVxamh2eU82RGFyOWlrVFZuYTkwbHdJREFRQUJvMk13WVRBT0JnTlZIUThCQWY4RUJBTUMKQVFZd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVWJTbnJDVzU3UnF3cVlxQzZTRzREVHZWbApjVmd3SHdZRFZSMGpCQmd3Rm9BVWJTbnJDVzU3UnF3cVlxQzZTRzREVHZWbGNWZ3dEUVlKS29aSWh2Y05BUUVMCkJRQURnZ0dCQUhudUcwaEo3aTlXR0hKcVRQNTlValFrK3p4UnBKOVc1a2hwMDFLWjlJdk1UcHdIZWg5RzFEcUwKb1dCKy92UllZYkYwZ0pPUkNta1d4Tm9vaGVZZm81QytiRytLUkVrUGhueWdybjNiRVdMeG0zdXZRdk1PZk5VbwpaYUQ1Z25wbXZBaGNvaTZhMXZ6UDB4UmZwMk01VW1TYm1Qakh2TkRqNVFsYk0zMEtNbGp5VDZZN0FpRkRlRENoClhuYUE1N2I4cVpObGFaek52R1lGMGphcUtFQmljVTdXNnRTcnFMQVJQWWJuM1ZyWjVkN0pLTkZPRmhKeTloclcKZ0pBTGQwa2xHMmNHTGhNQWUreU5lVVl4YU1qYVFPYVpvU1JGUmZramczNFJwWDUrRC9mbHcrSnVwNk1Sd0RqawpTcldQZCtNdjlpRk5TaDR5ODBnSXVkTGp3ZUx3Rk5JY2ZBUmtKdEFJaFZDNm5CdmpxYkdUbTB1WkJZNHZidnBvCmhPUFd2aG1XQUFqYm1iY3liTlJvT0Zpd050RVJhMmREWEhQd09pS00zSzJvMEc4bER6a2JhQ3V5R3FhaldnQk8Kdm1teVZRRmV2VkpOdDhNUmRtcUJjelFSa0UzYUI5UHJxaTd5YnJremk2VVgweHJRWFdpaFlDbWpzR1Mra3RUcgpLL3ovMHZaVGlnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
---
apiVersion: v1
kind: Namespace
metadata:
  name: harbor
  labels:
    istio-injection: disabled
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: harbor-virtual-service
  namespace: harbor
spec:
  hosts:
  - harbor.vcap.me
  gateways:
  - cf-system/istio-ingressgateway
  http:
  - route:
    - destination:
        host: harbor.harbor.svc.cluster.local
        port:
          number: 80
---
apiVersion: v1
kind: Namespace
metadata:
  name: jaeger-operator
  labels:
    istio-injection: disabled
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: jaeger-virtual-service
  namespace: jaeger-operator
spec:
  hosts:
  - jaeger.vcap.me
  gateways:
  - cf-system/istio-ingressgateway
  http:
  - route:
    - destination:
        host: jaeger-operator-jaeger-query.jaeger-operator.svc.cluster.local
        port:
          number: 16686
---
apiVersion: v1
kind: Namespace
metadata:
  name: minibroker
  labels:
    istio-injection: disabled
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: alertmanager-virtual-service
  namespace: prometheus-operator
spec:
  hosts:
  - alertmanager.vcap.me
  gateways:
  - cf-system/istio-ingressgateway
  http:
  - route:
    - destination:
        host: prometheus-operator-alertmanager.prometheus-operator.svc.cluster.local
        port:
          number: 9093
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: grafana-virtual-service
  namespace: prometheus-operator
spec:
  hosts:
  - grafana.vcap.me
  gateways:
  - cf-system/istio-ingressgateway
  http:
  - route:
    - destination:
        host: prometheus-operator-grafana.prometheus-operator.svc.cluster.local
        port:
          number: 80
---
apiVersion: v1
kind: Namespace
metadata:
  name: prometheus-operator
  labels:
    istio-injection: disabled
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: prometheus-virtual-service
  namespace: prometheus-operator
spec:
  hosts:
  - prometheus.vcap.me
  gateways:
  - cf-system/istio-ingressgateway
  http:
  - route:
    - destination:
        host: prometheus-operator-prometheus.prometheus-operator.svc.cluster.local
        port:
          number: 9090
---
apiVersion: v1
kind: Namespace
metadata:
  name: catalog
  labels:
    istio-injection: disabled
